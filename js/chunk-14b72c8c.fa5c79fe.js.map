{"version":3,"sources":["webpack:///./node_modules/engine.io-client/lib/xmlhttprequest.js","webpack:///./node_modules/yeast/index.js","webpack:///./node_modules/engine.io-client/lib/transports/websocket.js","webpack:///./node_modules/engine.io-client/lib/transports/polling.js","webpack:///./node_modules/engine.io-client/lib/transports/polling-jsonp.js","webpack:///./node_modules/backo2/index.js","webpack:///./node_modules/engine.io-client/lib/transport.js","webpack:///./node_modules/engine.io-client/node_modules/debug/src/browser.js","webpack:///./node_modules/base64-js/index.js","webpack:///./node_modules/socket.io-client/lib/socket.js","webpack:///./src/assets/images.png","webpack:///./node_modules/socket.io-client/node_modules/socket.io-parser/binary.js","webpack:///./node_modules/component-bind/index.js","webpack:///./node_modules/node-libs-browser/mock/process.js","webpack:///./node_modules/socket.io-client/node_modules/debug/src/debug.js","webpack:///./node_modules/parseqs/index.js","webpack:///./node_modules/socket.io-client/node_modules/socket.io-parser/index.js","webpack:///./node_modules/parseuri/index.js","webpack:///./node_modules/has-binary2/index.js","webpack:///./node_modules/engine.io-client/node_modules/ms/index.js","webpack:///./node_modules/engine.io-parser/lib/browser.js","webpack:///./node_modules/component-inherit/index.js","webpack:///./node_modules/engine.io-client/lib/transports/index.js","webpack:///./node_modules/component-emitter/index.js","webpack:///./node_modules/engine.io-parser/lib/keys.js","webpack:///./node_modules/socket.io-client/lib/manager.js","webpack:///./node_modules/fabric/dist/fabric.js","webpack:///./node_modules/socket.io-client/lib/index.js","webpack:///./node_modules/base64-arraybuffer/lib/base64-arraybuffer.js","webpack:///./node_modules/to-array/index.js","webpack:///./node_modules/ieee754/index.js","webpack:///./src/components/Board.vue?ec39","webpack:///src/components/Board.vue","webpack:///./src/components/Board.vue?6514","webpack:///./src/components/Board.vue","webpack:///./node_modules/engine.io-client/lib/index.js","webpack:///./node_modules/engine.io-client/node_modules/debug/src/debug.js","webpack:///./node_modules/socket.io-client/node_modules/isarray/index.js","webpack:///./src/components/Board.vue?2edf","webpack:///./node_modules/engine.io-parser/lib/utf8.js","webpack:///./node_modules/socket.io-client/node_modules/socket.io-parser/is-buffer.js","webpack:///./node_modules/core-js/modules/es.function.name.js","webpack:///./node_modules/buffer/index.js","webpack:///./node_modules/core-js/modules/web.url.to-json.js","webpack:///./node_modules/socket.io-client/node_modules/debug/src/browser.js","webpack:///./node_modules/has-cors/index.js","webpack:///./node_modules/arraybuffer.slice/index.js","webpack:///./node_modules/socket.io-client/lib/url.js","webpack:///./node_modules/after/index.js","webpack:///./node_modules/engine.io-client/lib/transports/polling-xhr.js","webpack:///./node_modules/blob/index.js","webpack:///./node_modules/socket.io-client/lib/on.js","webpack:///./node_modules/engine.io-client/lib/globalThis.browser.js","webpack:///./node_modules/engine.io-client/lib/socket.js","webpack:///./node_modules/path-browserify/index.js","webpack:///./node_modules/isarray/index.js","webpack:///./node_modules/socket.io-client/node_modules/ms/index.js","webpack:///./node_modules/has-binary2/node_modules/isarray/index.js","webpack:///./node_modules/indexof/index.js"],"names":["hasCORS","globalThis","module","exports","opts","xdomain","xscheme","enablesXDR","XMLHttpRequest","e","XDomainRequest","concat","join","prev","alphabet","split","length","map","seed","i","encode","num","encoded","Math","floor","decode","str","decoded","charAt","yeast","now","Date","BrowserWebSocket","NodeWebSocket","Transport","parser","parseqs","inherit","debug","WebSocket","self","MozWebSocket","window","WebSocketImpl","WS","forceBase64","this","supportsBinary","perMessageDeflate","usingBrowserWebSocket","forceNode","protocols","call","prototype","name","doOpen","check","uri","isReactNative","agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","extraHeaders","headers","localAddress","ws","err","emit","undefined","binaryType","supports","binary","addEventListeners","onopen","onOpen","onclose","onClose","onmessage","ev","onData","data","onerror","onError","write","packets","writable","total","l","packet","encodePacket","options","compress","len","Buffer","byteLength","threshold","send","done","setTimeout","doClose","close","query","schema","secure","port","Number","timestampRequests","timestampParam","b64","ipv6","hostname","indexOf","path","Polling","hasXHR2","xhr","responseType","poll","pause","onPause","readyState","polling","once","doPoll","callback","index","type","onPacket","decodePayload","socket","callbackfn","encodePayload","doWrite","sid","JSONPPolling","callbacks","rNewline","rEscapedNewline","empty","___eio","push","msg","j","addEventListener","script","parentNode","removeChild","form","iframe","document","createElement","async","src","insertAt","getElementsByTagName","insertBefore","head","body","appendChild","isUAgecko","navigator","test","userAgent","fn","area","id","iframeId","className","style","position","top","left","target","method","setAttribute","complete","initIframe","html","action","replace","value","submit","attachEvent","onreadystatechange","onload","Backoff","ms","min","max","factor","jitter","attempts","duration","pow","rand","random","deviation","reset","setMin","setMax","setJitter","Emitter","withCredentials","desc","Error","description","open","decodePacket","useColors","process","toLowerCase","match","documentElement","WebkitAppearance","console","firebug","exception","table","parseInt","RegExp","$1","formatArgs","args","namespace","humanize","diff","c","color","splice","lastC","log","Function","apply","arguments","save","namespaces","storage","removeItem","load","r","DEBUG","localstorage","localStorage","chrome","local","colors","formatters","v","JSON","stringify","message","enable","toByteArray","fromByteArray","lookup","revLookup","Arr","Uint8Array","Array","code","charCodeAt","getLens","validLen","placeHoldersLen","lens","_byteLength","tmp","arr","curByte","tripletToBase64","encodeChunk","uint8","start","end","output","extraBytes","parts","maxChunkLength","len2","toArray","on","bind","hasBin","Socket","events","connect","connect_error","connect_timeout","connecting","disconnect","error","reconnect","reconnect_attempt","reconnect_failed","reconnect_error","reconnecting","ping","pong","io","nsp","json","ids","acks","receiveBuffer","sendBuffer","connected","disconnected","flags","autoConnect","subEvents","subs","unshift","hasOwnProperty","BINARY_EVENT","EVENT","pop","CONNECT","reason","onpacket","sameNamespace","rootNamespaceError","ERROR","onconnect","onevent","ACK","onack","BINARY_ACK","DISCONNECT","ondisconnect","ack","sent","emitBuffered","destroy","isArray","isBuf","toString","Object","withNativeBlob","Blob","withNativeFile","File","_deconstructPacket","buffers","placeholder","_placeholder","newData","_reconstructPacket","deconstructPacket","packetData","pack","attachments","reconstructPacket","removeBlobs","_removeBlobs","obj","curKey","containingObject","pendingBlobs","fileReader","FileReader","result","bloblessData","readAsArrayBuffer","slice","nextTick","shift","platform","arch","execPath","title","pid","browser","env","argv","binding","cwd","chdir","dir","resolve","exit","kill","umask","dlopen","uptime","memoryUsage","uvCounters","features","selectColor","hash","abs","createDebug","prevTime","enabled","curr","coerce","format","formatter","val","logFn","init","instances","names","skips","substr","instance","disable","stack","encodeURIComponent","qs","qry","pairs","pair","decodeURIComponent","Encoder","protocol","types","Decoder","ERROR_PACKET","encodeAsString","payload","tryStringify","encodeAsBinary","writeEncoding","deconstruction","reconstructor","decodeString","p","buf","substring","next","tryParse","isPayloadValid","parse","BinaryReconstructor","reconPack","encoding","add","base64","takeBinaryData","finishedReconstruction","binData","re","pathNames","regx","queryKey","$0","$2","b","m","exec","source","host","authority","ipv6uri","hasBinary","isBuffer","ArrayBuffer","toJSON","s","h","d","y","String","n","parseFloat","fmtShort","round","fmtLong","plural","ceil","isNaN","long","base64encoder","keys","sliceBuffer","after","utf8","isAndroid","isPhantomJS","dontSendBlobs","upgrade","noop","packetslist","encodeBase64Object","encodeArrayBuffer","encodeBase64Packet","contentArray","resultBuffer","buffer","encodeBlobAsArrayBuffer","fr","encodeBlob","blob","tryDecode","strict","ary","each","eachWithIndex","el","cb","utf8encode","b64data","readAsDataURL","fromCharCode","typed","basic","btoa","utf8decode","decodeBase64Packet","asArray","rest","isBinary","encodePayloadAsBlob","encodePayloadAsArrayBuffer","setLengthHeader","encodeOne","doneCallback","results","decodePayloadAsBinary","chr","ret","encodedPackets","totalLength","reduce","acc","resultArray","bufferIndex","forEach","isString","ab","view","lenStr","binaryIdentifier","size","lengthAry","bufferTail","tailArray","msgLength","a","constructor","XHR","JSONP","websocket","xd","xs","jsonp","location","isSSL","forceJSONP","mixin","event","_callbacks","off","removeListener","removeAllListeners","removeEventListener","listeners","hasListeners","has","eio","Manager","nsps","reconnection","reconnectionAttempts","Infinity","reconnectionDelay","reconnectionDelayMax","randomizationFactor","backoff","timeout","lastPing","packetBuffer","_parser","encoder","decoder","emitAll","updateSocketIds","generateId","engine","_reconnection","_reconnectionAttempts","_reconnectionDelay","_randomizationFactor","_reconnectionDelayMax","_timeout","maybeReconnectOnOpen","skipReconnect","openSub","errorSub","cleanup","timer","clearTimeout","onping","onpong","ondata","ondecoded","onConnecting","processPacketQueue","subsLength","sub","delay","onreconnect","attempt","fabric","version","HTMLDocument","Document","implementation","createHTMLDocument","jsdom","virtualWindow","JSDOM","FetchExternalResources","resources","jsdomImplForWrapper","implForWrapper","nodeCanvas","Canvas","DOMParser","resizeCanvasIfNeeded","pipelineState","targetCanvas","width","height","dWidth","destinationWidth","dHeight","destinationHeight","copyGLTo2DDrawImage","gl","glCanvas","canvas","ctx","getContext","translate","scale","sourceY","drawImage","copyGLTo2DPutImageData","numBytes","u8","imageBuffer","u8Clamped","Uint8ClampedArray","readPixels","RGBA","UNSIGNED_BYTE","imgData","ImageData","putImageData","isTouchSupported","maxTouchPoints","isLikelyNode","SHARED_ATTRIBUTES","DPI","reNum","commaWsp","rePathCommand","reNonWord","fontPaths","iMatrix","svgNS","perfLimitSizeTotal","maxCacheSideLimit","minCacheSideLimit","charWidthsCache","textureSize","disableStyleCopyPaste","enableGLFiltering","devicePixelRatio","webkitDevicePixelRatio","mozDevicePixelRatio","browserShadowBlurConstant","arcToSegmentsCache","boundsOfCurveCache","cachesBoundsOfCurve","forceGLPutImageData","initFilterBackend","isWebglSupported","maxTextureSize","WebglFilterBackend","tileSize","Canvas2dFilterBackend","_removeEventListener","eventName","handler","__eventListeners","eventListener","util","array","fill","prop","fire","listenersForEvent","filter","Observable","Collection","_objects","_onObjectAdded","renderOnAddRemove","requestRenderAll","object","nonSplicing","objects","remove","somethingRemoved","_onObjectRemoved","forEachObject","context","getObjects","o","item","isEmpty","contains","complexity","memo","current","CommonMethods","_setOptions","set","_initGradient","filler","property","colorStops","Gradient","_initPattern","Pattern","_setObject","_set","toggle","get","global","sqrt","atan2","PiBy180","PI","PiBy2","cos","angle","angleSlice","sin","sign","removeFromArray","idx","getRandomInt","degreesToRadians","degrees","radiansToDegrees","radians","rotatePoint","point","origin","newPoint","Point","x","rotateVector","addEquals","vector","rx","ry","transformPoint","t","ignoreOffset","makeBoundingBoxFromPoints","points","transform","xPoints","minX","maxX","yPoints","minY","maxY","invertTransform","toFixed","number","fractionDigits","parseUnit","fontSize","unit","Text","DEFAULT_SVG_FONT_SIZE","falseFunction","getKlass","string","camelize","toUpperCase","resolveNamespace","getSvgAttributes","attributes","loadImage","url","crossOrigin","img","createImage","onLoadCallback","loadImageInDom","div","querySelector","enlivenObjects","reviver","enlivenedObjects","numLoadedObjects","numTotalObjects","onLoaded","klass","fromObject","enlivenPatterns","patterns","numLoadedPatterns","numPatterns","enlivenedPatterns","pattern","groupSVGElements","elements","centerPoint","Group","sourcePath","populateWithProperties","destination","properties","drawDashedLine","x2","y2","da","dx","dy","rot","dc","di","draw","moveTo","rotate","restore","createCanvasElement","copyCanvasElement","newCanvas","toDataURL","canvasEl","quality","multiplyTransformMatrices","is2x2","qrDecompose","denom","scaleX","scaleY","skewX","skewY","translateX","translateY","calcRotateMatrix","theta","calcDimensionsMatrix","scaleMatrix","flipX","flipY","multiply","tan","composeMatrix","matrix","resetObjectTransform","saveObjectTransform","isTransparent","tolerance","temp","_isTransparent","imageData","getImageData","parsePreserveAspectRatioAttribute","attribute","align","meetOrSlice","alignX","alignY","aspectRatioAttrs","clearFabricFontCache","fontFamily","limitDimsByArea","ar","maximumArea","roughWidth","perfLimitSizeY","capValue","findScaleToFit","findScaleToCover","matrixToSVG","NUM_FRACTION_DIGITS","removeTransformFromObject","inverted","finalTransform","calcOwnMatrix","applyTransformToObject","addTransformToObject","center","setPositionByOrigin","sizeAfterTransform","dimX","dimY","transformMatrix","bbox","_join","commandLengths","q","repeatedCommands","M","segmentToBezier","th2","th3","cosTh","sinTh","cx1","cy1","mT","fromX","fromY","costh2","sinth2","costh3","sinth3","toX","toY","cp1X","cp1Y","cp2X","cp2Y","arcToSegments","large","sweep","rotateX","th","px","py","rx2","ry2","py2","px2","pl","root","cx","cy","mTheta","calcVectorAngle","dtheta","segments","mDelta","ux","uy","vx","vy","ta","tb","getBoundsOfCurve","x0","y0","x1","y1","x3","y3","argsString","t1","t2","b2ac","sqrtb2ac","tvalues","bounds","mt","jlen","fromArcToBeziers","fx","fy","coords","tx","ty","segsNorm","makePathSimpler","converted","previous","controlX","controlY","destinationPath","calcLineLength","CB1","CB2","CB3","CB4","getPointOnCubicBezierIterator","p1x","p1y","p2x","p2y","p3x","p3y","p4x","p4y","pct","c1","c2","c3","c4","getTangentCubicIterator","invT","tangentX","tangentY","QB1","QB2","QB3","getPointOnQuadraticBezierIterator","getTangentQuadraticIterator","pathIterator","iterator","perc","tempP","tmpLen","findPercentageForDistance","segInfo","distance","nextLen","lastPerc","nextStep","angleFinder","getPathSegmentsInfo","tempInfo","info","command","destX","destY","getPointOnPath","infos","segPercent","segment","lerp","parsePath","pathString","currentPath","parsed","coordsStr","rNumber","rNumberCommaWsp","rFlagCommaWsp","rArcSeq","regArcArgumentSequence","coordsParsed","trim","commandLength","repeatedCommand","k","klen","getBoundsOfArc","bound","segs","drawArc","beziers","bezier","bezierCurveTo","fromArcToBeizers","invoke","byProperty","find","value1","value2","condition","extend","deep","Element","clone","character","capitalize","firstLetterOnly","escapeXml","graphemeSplit","textstring","graphemes","getWholeChar","emptyFunction","IS_DONTENUM_BUGGY","addMethods","parent","superclass","returnValue","valueOf","Subclass","callSuper","methodName","parentMethod","_this","superClassMethod","createClass","initialize","subclasses","couldUseAttachEvent","touchEvents","getTouchInfo","touchProp","changedTouches","addListener","element","getPointer","scroll","getScrollLeftTop","_evt","clientX","clientY","isTouchEvent","pointerType","setStyle","styles","elementStyle","cssText","setOpacity","normalizedProperty","styleFloat","parseEl","supportsOpacity","opacity","supportsFilters","reOpacity","es","currentStyle","hasLayout","zoom","_slice","getById","getElementById","sliceCanConvertNodelists","getElementStyle","arrayLike","childNodes","makeElement","tagName","htmlFor","addClass","wrapElement","wrapper","replaceChild","docElement","scrollLeft","scrollTop","nodeType","getElementOffset","docElem","scrollLeftTop","doc","ownerDocument","box","offset","offsetAttributes","borderLeftWidth","borderTopWidth","paddingLeft","paddingTop","attr","getBoundingClientRect","clientLeft","clientTop","getNodeCanvas","impl","_canvas","_image","cleanUpJsdomNode","_currentSrc","_attributes","_classList","setImageSmoothing","imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","defaultView","getComputedStyle","selectProp","makeElementUnselectable","onselectstart","unselectable","makeElementSelectable","addParamToUrl","param","emptyFn","request","onComplete","parameters","setRequestHeader","warn","defaultEasing","animate","requestAnimFrame","timestamp","time","finish","onChange","abort","easing","startValue","endValue","byValue","onStart","tick","ticktime","currentTime","timePerc","valuePerc","_requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","_cancelAnimFrame","cancelAnimationFrame","cancelAnimFrame","calculateColor","begin","pos","animateColor","fromColor","toColor","startColor","Color","getSource","endColor","originalOnComplete","originalOnChange","posValue","colorEasing","normalize","asin","elastic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce","ease","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","svgValidTagNames","svgViewBoxElements","svgInvalidAncestors","svgValidParents","attributesMap","display","visibility","colorAttributes","stroke","fSize","cPath","normalizeAttr","normalizeValue","parentAttributes","parseTransformAttribute","visible","fillIndex","strokeIndex","getSvgRegex","_setStrokeFillOpacity","setAlpha","getAlpha","toRgba","_getMultipleNodes","nodeNames","nodeName","nodeList","nodeArray","parseStyleString","oStyle","chunk","parseStyleObject","getGlobalStylesForElement","svgUid","rule","cssRules","elementMatchesRule","selectors","firstMatching","parentMatching","selectorMatches","doesSomeParentMatch","selector","matcher","classNames","getAttribute","elementById","node","nodelist","parseUseDirectives","xlinkAttribute","attrs","xlink","el2","cloneNode","currentTrans","oldLength","applyViewboxTransform","el3","createElementNS","setAttributeNS","nodeValue","firstChild","removeAttribute","svgValidTagNamesRegEx","svgViewBoxElementsRegEx","svgInvalidAncestorsRegEx","svgValidParentsRegEx","gradientDefs","clipPaths","rotateMatrix","multiplierX","multiplierY","skewMatrix","translateMatrix","transforms","transformList","reTransformList","reTransform","attributeValue","matrices","operation","combinedMatrix","reViewBoxAttrValue","viewBoxWidth","viewBoxHeight","viewBoxAttr","widthAttr","heightAttr","preserveAspectRatio","missingViewBox","missingDimAttr","toBeParsed","parsedDim","widthDiff","heightDiff","hasAncestorWithNodeName","recursivelyParseGradientsXlink","gradient","gradientsAttrs","xlinkAttr","xLink","referencedGradient","hasAttribute","children","referenceClone","parseSVGDocument","parsingOptions","__uid","descendants","selectNodes","getGradientDefs","getCSSRules","parseElements","reFontDeclaration","parseFontDeclaration","fontStyle","fontWeight","lineHeight","tagArray","elList","parseAttributes","parentFontSize","ownAttributes","cssAttrs","parseStyleAttribute","normalizedAttr","normalizedValue","normalizedStyle","font","mergedAttrs","ElementsParser","parsePointsAttribute","parsedPoints","rules","allRules","styleContents","textContent","ruleObj","declaration","propertyValuePairs","_rule","loadSVGFromURL","xml","responseXML","_options","allElements","loadSVGFromString","parseFromString","regexUrl","proto","numElements","createObjects","createObject","findTag","fromElement","createCallback","checkIfDone","resolveGradient","Image","_originalElement","_removeTransformMatrix","resolveClipPath","extractPropertyDefinition","regex","lastIndex","gradientDef","opacityAttr","createClipPathCallback","container","_newObj","fillRule","clipRule","usingElement","objTransformInv","gTransform","clipPath","calcTransformMatrix","clipPathTag","clipPathOwner","that","scalarAdd","scalar","scalarAddEquals","subtract","subtractEquals","scalarSubtract","scalarSubtractEquals","multiplyEquals","divide","divideEquals","eq","lt","lte","gt","gte","distanceFrom","midPointFrom","setXY","setX","setY","setFromPoint","swap","Intersection","status","appendPoint","appendPoints","intersectLineLine","a1","a2","b1","b2","uaT","ubT","uB","ua","ub","intersectLinePolygon","inter","intersectPolygonPolygon","points1","points2","intersectPolygonRectangle","r1","r2","topRight","bottomLeft","inter1","inter2","inter3","inter4","_tryParsingColor","setSource","hue2rgb","colorNameMap","sourceFromHex","sourceFromRgb","sourceFromHsl","_rgbToHsl","g","_source","toRgb","toHsl","hsl","toHsla","toHex","toHexa","alpha","toGrayscale","average","currentAlpha","toBlackWhite","overlayWith","otherColor","otherAlpha","otherSource","reRGBa","reHSLa","reHex","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgrey","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","fromRgb","fromSource","fromRgba","fromHsl","fromHsla","fromHex","isShortNotation","isRGBa","oColor","scaleMap","skewMap","controls","LEFT","TOP","RIGHT","BOTTOM","CENTER","opposite","bottom","right","findCornerQuadrant","fabricObject","control","cornerAngle","fireEvent","canvasOptions","scaleIsProportional","eventData","uniScaleKey","uniformIsToggled","uniformScaling","isTransformCentered","originX","originY","scalingIsForbidden","by","scaleProportionally","lockX","lockScalingX","lockY","lockScalingY","scaleCursorStyleHandler","notAllowed","skewCursorStyleHandler","lockSkewingY","lockSkewingX","scaleSkewCursorStyleHandler","altActionKey","scaleOrSkewActionName","isAlternative","rotationStyleHandler","lockRotation","cursorStyle","commonEventInfo","pointer","wrapWithFixedAnchor","actionHandler","getCenterPoint","constraint","translateToOriginPoint","actionPerformed","wrapWithFireEvent","getLocalPoint","corner","getZoom","padding","localPoint","toLocalPoint","offsetX","offsetY","targetHasOneFlip","compensateScaleForSkew","oppositeSkew","scaleToCompensate","axis","reference","newDim","_getTransformedDimensions","newValue","skewObjectX","newSkew","dimNoSkew","totalSkewSize","currentSkew","hasSkewed","dimBeforeSkewing","skewObjectY","skewHandlerX","localPointFromCenter","finalHandler","skewHandlerY","rotationWithSnapping","pivotPoint","lastAngle","ey","ex","curAngle","hasRotated","snapAngle","snapThreshold","rightAngleLocked","leftAngleLocked","scaleObject","dim","signX","signY","forbidScaling","gestureScale","lockScalingFlip","original","originalDistance","oldScaleX","oldScaleY","scaleObjectFromCorner","scaleObjectX","scaleObjectY","scalingYOrSkewingX","scalingY","scalingXOrSkewingY","scalingX","changeWidth","strokePadding","strokeWidth","strokeUniform","multiplier","oldWidth","newWidth","dragHandler","newLeft","newTop","moveX","moveY","scalingEqually","controlsUtils","renderCircleControl","styleOverride","xSize","sizeX","cornerSize","ySize","sizeY","transparentCorners","cornerStrokeColor","myLeft","myTop","fillStyle","cornerColor","strokeStyle","lineWidth","beginPath","arc","renderSquareControl","xSizeBy2","ySizeBy2","strokeRect","Control","actionName","touchSizeX","touchSizeY","withConnection","mouseDownHandler","mouseUpHandler","getActionHandler","getMouseDownHandler","getMouseUpHandler","cursorStyleHandler","getActionName","getVisibility","controlKey","objectVisibility","_controlsVisibility","setVisibility","positionHandler","finalMatrix","calcCornerCoords","objectAngle","objectCornerSize","centerX","centerY","isTouch","cosHalfOffset","sinHalfOffset","cosHalfOffsetComp","sinHalfOffsetComp","controlTriangleAngle","cornerHypotenuse","newTheta","newThetaComp","tl","tr","bl","br","render","cornerStyle","getColorStop","colorAlpha","keyValuePairs","getLinearCoords","getRadialCoords","__convertPercentUnitsToValues","svgOptions","gradientUnits","propValue","finalValue","gradientTransform","option","addColorStop","toObject","propertiesToInclude","toSVG","markup","commonAttributes","needsSwap","withViewport","additionalTransform","sort","pathOffset","reverse","minRadius","maxRadius","percentageShift","colorStop","toLive","createLinearGradient","createRadialGradient","colorStopEls","repeat","patternTransform","setOptions","isError","patternSource","patternWidth","patternHeight","patternOffsetX","patternOffsetY","patternImgSrc","naturalWidth","naturalHeight","createPattern","Shadow","blur","affectStroke","includeDefaultValues","nonScaling","_parseShadow","shadow","shadowStr","offsetsAndBlur","reOffsetsAndBlur","fBoxX","fBoxY","BLUR_BOX","StaticCanvas","CANVAS_INIT_ERROR","renderAndResetBound","renderAndReset","requestRenderAllBound","_initStatic","backgroundColor","backgroundImage","overlayColor","overlayImage","stateful","controlsAboveOverlay","allowTouchScrolling","viewportTransform","backgroundVpt","overlayVpt","enableRetinaScaling","vptCoords","skipOffscreen","_createLowerCanvas","_initOptions","interactive","_initRetinaScaling","setOverlayImage","setBackgroundImage","setBackgroundColor","setOverlayColor","calcOffset","_isRetinaScaling","getRetinaScaling","scaleRatio","__initRetinaScaling","lowerCanvasEl","contextContainer","upperCanvasEl","contextTop","_offset","image","__setBgOverlayImage","__setBgOverlayColor","_createCanvasElement","_applyCanvasStyle","getWidth","getHeight","setWidth","setDimensions","setHeight","dimensions","cssValue","cssOnly","_setBackstoreDimension","hasLostContext","backstoreOnly","_setCssDimension","_isCurrentlyDrawing","freeDrawingBrush","_setBrushStyles","cacheCanvasEl","wrapperEl","setViewportTransform","vpt","activeObject","_activeObject","backgroundObject","overlayObject","group","setCoords","calcViewportBoundaries","zoomToPoint","before","setZoom","absolutePan","relativePan","getElement","setupState","clearContext","clearRect","clear","_hasITextHandlers","_mouseUpITextHandler","_iTextInstances","renderAll","canvasToDrawOn","renderCanvas","isRendering","iVpt","cancelRequestedRender","_renderBackground","_renderObjects","drawControls","shouldCache","_transformDone","renderCache","forClipping","drawClipPathOnCanvas","_renderOverlay","globalCompositeOperation","zoomX","zoomY","_cacheCanvas","cacheTranslationX","cacheTranslationY","_renderBackgroundOrOverlay","needsVpt","lineTo","closePath","getCenter","centerObjectH","_centerObject","centerObjectV","centerObject","viewportCenterObject","vpCenter","getVpCenter","viewportCenterObjectH","viewportCenterObjectV","toDatalessJSON","toDatalessObject","_toObjectMethod","_toObjects","_toObject","__serializeBgOverlay","excludeFromExport","originalValue","bgImage","overlay","background","svgViewportTransformation","_setSVGPreamble","_setSVGHeader","clipPathId","_setSVGBgOverlayColor","_setSVGBgOverlayImage","_setSVGObjects","suppressPreamble","viewBox","createSVGFontFacesMarkup","createSVGRefElementsMarkup","createSVGClipPathMarkup","toClipPathSVG","shouldTransform","row","rowIndex","_char","charIndex","fontList","_setSVGObject","finalWidth","finalHeight","shouldInvert","sendToBack","objs","activeSelection","bringToFront","sendBackwards","intersecting","newIdx","objsMoved","_findNewLowerIndex","isIntersecting","intersectsWithObject","isContainedWithinObject","bringForward","_findNewUpperIndex","dispose","DataURLExporter","EMPTY_JSON","setLineDash","createPNGStream","createJPEGStream","BaseBrush","strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeDashArray","limitedToCanvasSize","lineCap","miterLimit","lineJoin","_saveAndTransform","_setShadow","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","needsFullRender","_resetShadow","_isOutSideCanvas","PencilBrush","decimate","_points","_drawSegment","p1","p2","midPoint","quadraticCurveTo","onMouseDown","_isMainEvent","_prepareForDrawing","_captureDrawingPath","_render","onMouseMove","oldEnd","onMouseUp","_finalizeAndAddPath","_reset","_addPoint","pointerPoint","convertPointsToSVGPath","multSignX","multSignY","manyPoints","createPath","pathData","Path","decimatePoints","cDistance","adjustedDistance","lastPoint","newPoints","CircleBrush","drawDot","addPoint","dot","radius","originalRenderOnAddRemove","circles","circle","Circle","circleRadius","circleColor","SprayBrush","density","dotWidth","dotWidthVariance","randomOpacity","optimizeOverlapping","sprayChunks","addSprayChunk","sprayChunkPoints","rects","ilen","sprayChunk","rect","Rect","_getOptimizedRects","uniqueRects","uniqueRectsArray","globalAlpha","fillRect","PatternBrush","getPatternSrc","dotDistance","patternCanvas","patternCtx","getPatternSrcFunction","getPattern","topLeft","_getLeftTopCoords","supportLineDash","STROKE_OFFSET","_initInteractive","_createCacheCanvas","centeredScaling","centeredRotation","centeredKey","selection","selectionKey","altSelectionKey","selectionColor","selectionDashArray","selectionBorderColor","selectionLineWidth","selectionFullyContained","hoverCursor","moveCursor","defaultCursor","freeDrawingCursor","rotationCursor","notAllowedCursor","containerClass","perPixelTargetFind","targetFindTolerance","skipTargetFind","isDrawingMode","preserveObjectStacking","stopContextMenu","fireRightClick","fireMiddleClick","targets","_hoveredTarget","_hoveredTargets","_currentTransform","_groupSelector","_initWrapperElement","_createUpperCanvas","_initEventListeners","_chooseObjectsToRender","objsToRender","activeGroupObjects","activeObjects","getActiveObjects","contextTopDirty","renderTopLayer","_drawSelection","renderTop","_normalizePointer","invertedM","vptPointer","restorePointerVpt","isTargetTransparent","normalizedPointer","targetRelativeX","targetRelativeY","_cacheContext","contextCache","originalColor","selectionBackgroundColor","_isSelectionKeyPressed","selectionKeyPressed","_shouldClearSelection","evented","selectable","_shouldCenterTransform","altKey","centerTransform","_getOriginFromCorner","_getActionFromCorner","alreadySelected","_setupCurrentTransform","__corner","lastX","lastY","shiftKey","_beforeTransform","setCursor","cursor","groupSelector","aleft","atop","_setLineDash","findTarget","skipGroup","activeTarget","activeTargetSubs","ignoreZoom","aObjects","shouldLookForActive","_findTargetCorner","_searchPossibleTargets","_checkTarget","globalPointer","containsPoint","isEditing","subTarget","objToCheck","pointerToUse","subTargetCheck","_absolutePointer","_pointer","cssScale","boundsWidth","boundsHeight","retinaScaling","lowerCanvasClass","_copyCanvasStyle","fromEl","toEl","getSelectionContext","getSelectionElement","getActiveObject","active","_discardActiveObject","_fireSelectionEvents","oldObjects","somethingChanged","added","removed","oldObject","selected","deselected","updated","setActiveObject","currentActives","_setActiveObject","onSelect","onDeselect","discardActiveObject","removeListeners","_renderControls","originalProperties","_realizeGroupTransformOnObject","_unwindGroupTransformOnObject","layoutProps","originalValues","clearContextTop","RIGHT_CLICK","MIDDLE_CLICK","LEFT_CLICK","addEventOptions","passive","checkClick","button","mainTouchId","_bindEvents","addOrRemove","_getEventPrefix","enablePointerEvents","functor","eventjsFunctor","canvasElement","eventTypePrefix","_onResize","_onMouseDown","_onMouseMove","_onMouseOut","_onMouseEnter","_onMouseWheel","_onContextMenu","_onDoubleClick","_onDragOver","_onDragEnter","_onDragLeave","_onDrop","_onTouchStart","eventjs","_onGesture","_onDrag","_onOrientationChange","_onShake","_onLongPress","_onMouseUp","_onTouchEnd","eventsBound","_simpleEventHandler","__onTransformGesture","__onDrag","__onMouseWheel","_target","hiddenTextarea","focus","__onOrientationChange","__onShake","__onLongPress","preventDefault","_fireEnterLeaveEvents","stopPropagation","_cacheTransformEventData","_handleEvent","_resetTransformEventData","getPointerId","evt","identifier","pointerId","isPrimary","touches","__onMouseDown","__onMouseUp","_willAddMouseDown","__onMouseMove","_shouldRender","shouldRender","isClick","_onMouseUpInDrawingMode","_finalizeCurrentTransform","targetWasActive","_maybeGroupObjects","activeOn","isMoving","_setCursorFromEvent","eventType","subTargets","absolutePointer","currentTarget","currentSubTargets","_scaling","hasStateChanged","_addEventOptions","_fire","_onMouseDownInDrawingMode","_onMouseMoveInDrawingMode","_previousPointer","shouldGroup","_shouldGroup","_handleGrouping","saveState","_transformObject","_fireOverOutEvents","fireSyntheticInOutEvents","oldTarget","evtOut","canvasEvtOut","evtIn","canvasEvtIn","_draggedoverTarget","config","inOpt","outOpt","outFires","inFires","targetChanged","previousTarget","nextTarget","_performTransformAction","getCornerCursor","_updateActiveSelection","_createActiveSelection","currentActiveObjects","removeWithUpdate","addWithUpdate","_createGroup","isActiveLower","groupObjects","exitEditing","ActiveSelection","_groupSelectedObjects","aGroup","_collectObjects","currentObject","selectionX1Y1","selectionX2Y2","allowIntersect","intersectsWithRect","isContainedWithinRect","toCanvasElement","cropping","scaledWidth","scaledHeight","originalWidth","originalHeight","newZoom","vp","originalInteractive","newVp","originalRetina","originalContextTop","loadFromJSON","serialized","_enlivenObjects","_setBgOverlay","enlivenedCanvasClip","__setupCanvas","loaded","cbIfLoaded","__setBgOverlay","enlivedObject","_toDataURL","_toDataURLWithMultiplier","toDataURLWithMultiplier","cloneWithoutData","backgroundImageOpacity","backgroundImageStretch","supportsLineDash","objectCaching","ALIASING_LIMIT","touchCornerSize","borderColor","borderDashArray","cornerDashArray","strokeDashOffset","borderOpacityWhenMoving","borderScaleFactor","minScaleLimit","hasControls","hasBorders","lockMovementX","lockMovementY","statefullCache","noScaleCache","dirty","paintFirst","stateProperties","cacheProperties","colorProperties","absolutePositioned","_cacheProperties","_updateCacheCanvas","_limitCacheSize","dims","limitedDims","capped","_getCacheCanvasDimensions","objectScale","getTotalObjectScaling","neededX","neededY","drawingWidth","drawingHeight","minCacheSize","dimensionsChanged","cacheWidth","cacheHeight","zoomChanged","shouldRedraw","additionalWidth","additionalHeight","shouldResizeCanvas","canvasWidth","canvasHeight","sizeGrowing","sizeShrinking","setTransform","needFullTransform","_removeDefaultValues","getObjectScaling","retina","getObjectOpacity","shouldConstrainValue","isChanged","groupNeedsUpdate","_constrainScale","isOnACache","setOnGroup","getViewportTransform","isNotVisible","isOnScreen","_setupCompositeOperation","drawSelectionBackground","_setOpacity","drawCacheOnCanvas","_removeCacheCanvas","drawObject","propertySet","isCacheDirty","hasStroke","hasFill","needsItsOwnCache","ownCaching","willDrawShadow","drawClipPathOnCache","originalFill","originalStroke","_setClippingProperties","_drawClipPath","skipCanvas","_getNonTransformedDimensions","_removeShadow","_setStrokeStyles","decl","lineDashOffset","_applyPatternForTransformedGradient","_applyPatternGradientTransform","_setFillStyles","dashArray","alternative","drawBorders","forActiveSelection","drawBordersInGroup","scaling","multX","multY","_renderPaintInOrder","_renderStroke","_renderFill","_renderDashedStroke","pCtx","pCanvas","_findCenterFromElement","_assignTransformMatrixProps","preserveAspectRatioOptions","cropX","cropY","offsetLeft","offsetTop","objectForm","_fromObject","cloneAsImage","utils","origParams","originalGroup","originalShadow","withoutTransform","withoutShadow","boundingRect","getBoundingRect","shadowOffset","originalCanvas","isType","shouldCenterOrigin","_setOriginToCenter","_resetOrigin","centerH","viewportCenterH","centerV","viewportCenterV","viewportCenter","getLocalPointer","pClicked","objectLeftTop","createAccessors","extraParam","enlivedProps","originXOffset","originYOffset","translateToGivenOrigin","fromOriginX","fromOriginY","toOriginX","toOriginY","translateToCenterPoint","leftTop","getPointByOrigin","adjustPosition","to","offsetFrom","offsetTo","hypotFull","getScaledWidth","xFull","yFull","_originalOriginX","_originalOriginY","originPoint","arrayFromCoords","multiplyMatrices","oCoords","aCoords","lineCoords","ownMatrixCache","matrixCache","_getCoords","absolute","calculate","calcACoords","calcLineCoords","getCoords","pointTL","pointBR","intersection","other","otherCoords","lines","_getImageLines","_findCrossPoints","some","_containsCenterOfCanvas","isPartiallyOnScreen","allPointsAreOutside","every","topline","rightline","bottomline","leftline","xi","iLine","xcount","lineKey","getScaledHeight","scaleToWidth","boundingRectFactor","scaleToHeight","calcCoords","calcOCoords","cosP","sinP","cosPSinP","cosPMinusSinP","_calcRotateMatrix","_calcTranslateMatrix","startMatrix","_calculateCurrentDimensions","forEachControl","w","skipCorners","_setCornerCoords","transformMatrixKey","sep","prefix","cache","tMatrix","_calcDimensionsTransformMatrix","flipping","noSkew","_finalizeDimensions","getSvgColorString","getSvgStyles","skipShadow","getSvgFilter","getSvgSpanStyles","useWhiteSpace","term","textDecoration","getSvgTextDecoration","deltaY","decoration","getSvgCommons","getSvgTransform","full","svgTransform","_setSVGBg","textBgRects","_getFillAttributes","_createBaseSVGMarkup","_toSVG","_createBaseClipPathSVGMarkup","objectMarkup","commonPieces","clipPathMarkup","noStyle","styleInfo","shadowInfo","withShadow","vectorEffect","absoluteClipPath","addPaintOrder","originalSet","saveProps","props","tmpObj","_isEqual","origValue","currentValue","firstPass","dashedPropertySet","forTouch","isControlVisible","touchCorner","controlObject","wh","shouldStroke","setControlVisible","setControlsVisibility","FX_DURATION","fxCenterObjectH","fxCenterObjectV","fxRemove","skipCallbacks","propsToAnimate","_animate","propPair","propIsColor","from","valueProgress","timeProgress","coordProps","makeEdgeToOriginGetter","propertyNames","originValues","axis1","axis2","dimension","nearest","farthest","Line","_setWidthHeight","_getLeftToOriginX","_getTopToOriginY","calcLinePoints","origStrokeStyle","xMult","yMult","ATTRIBUTE_NAMES","parsedAttributes","_callback","pi","isValidRadius","startAngle","endAngle","setRadius","svgString","startX","startY","endX","endY","largeFlag","getRadiusX","getRadiusY","Triangle","widthBy2","heightBy2","piBy2","Ellipse","getRx","getRy","_initRxRy","isRounded","Polyline","_setPositionDimensions","correctLeftTop","calcDim","_calcDimensions","fromSVG","diffX","diffY","commonRender","fromElementGenerator","_class","Polygon","_toString","fromArray","_renderPathCommands","subpathStartX","subpathStartY","_getOffsetTransform","digits","aX","aY","deltaX","pathUrl","useSetOnGroup","isAlreadyGrouped","_updateObjectsACoords","_calcBounds","_updateObjectsCoords","skipControls","_updateObjectCoords","objectLeft","objectTop","nested","_restoreObjectsState","_includeDefaultValues","objsToObject","originalDefaults","_obj","ownCache","groupMatrix","realizeTransform","parentMatrix","toActiveSelection","ungroupOnCanvas","setObjectsCoords","onlyWidthHeight","iLen","jLen","_getBounds","minXY","maxXY","enlivedClipPath","toGroup","newGroup","childrenOverride","srcFromAttribute","_lastScaleX","_lastScaleY","_filterScalingX","_filterScalingY","minimumScaleTrigger","cacheKey","imageSmoothing","filters","_initElement","_element","setElement","removeTexture","_initConfig","applyFilters","resizeFilter","applyResizeFilters","backend","filterBackend","evictCachesForKey","getCrossOrigin","getOriginalSize","_stroke","filterObj","getSrc","hasCrop","strokeSvg","imageMarkup","imageRendering","getSvgSrc","origFill","filtered","setSrc","minimumScale","elementToFilter","_filteredEl","sourceWidth","sourceHeight","isNeutralState","imgElement","_needsResize","elementToDraw","elWidth","elHeight","sX","sY","sW","sH","maxDestW","maxDestH","_resetWidthHeight","CSS_CANVAS","_initFilters","pAR","rWidth","rHeight","pWidth","pHeight","_object","resizeFilters","fromURL","imgOptions","_getAngleValueForStraighten","straighten","fxStraighten","straightenObject","fxStraightenObject","testPrecision","precision","fragmentSource","fragmentShader","createShader","FRAGMENT_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","setupGLContext","captureGPUInfo","isSupported","getParameter","MAX_TEXTURE_SIZE","precisions","webGlPrecision","createWebGLCanvas","aPosition","Float32Array","chooseFastestCopyGLTo2DMethod","canUseImageData","canMeasurePerf","performance","canUseArrayBuffer","canUseUint8Clamped","copyGLTo2D","startTime","drawImageTime","putImageDataTime","testContext","glOptions","premultipliedAlpha","depth","stencil","antialias","clearColor","cachedTexture","getCachedTexture","sourceTexture","createTexture","targetTexture","originalTexture","passes","webgl","programCache","pass","tempFbo","createFramebuffer","bindFramebuffer","FRAMEBUFFER","applyTo","bindTexture","TEXTURE_2D","deleteTexture","deleteFramebuffer","clearWebGLCaches","textureCache","textureImageSource","texture","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","uniqueId","gpuInfo","renderer","vendor","ext","getExtension","UNMASKED_RENDERER_WEBGL","UNMASKED_VENDOR_WEBGL","sourceElement","originalImageData","originalEl","BaseFilter","vertexSource","createProgram","vertexShader","VERTEX_SHADER","getShaderInfoLog","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","attributeLocations","getAttributeLocations","uniformLocations","getUniformLocations","uStepW","getUniformLocation","uStepH","getAttribLocation","sendAttributeData","aPositionData","attributeLocation","createBuffer","bindBuffer","ARRAY_BUFFER","enableVertexAttribArray","vertexAttribPointer","FLOAT","bufferData","STATIC_DRAW","_setupFrameBuffer","framebufferTexture2D","COLOR_ATTACHMENT0","_swapTextures","main","mainParameter","applyToWebGL","applyTo2d","retrieveShader","shader","useProgram","uniform1f","sendUniformData","viewport","drawArrays","TRIANGLE_STRIP","bindAdditionalTexture","textureUnit","activeTexture","TEXTURE0","unbindAdditionalTexture","getMainParameter","setMainParameter","createHelpLayer","helpLayer","mainP","ColorMatrix","colorsOnly","uColorMatrix","uConstants","constants","uniformMatrix4fv","uniform4fv","Brightness","brightness","uBrightness","Convolute","opaque","Convolute_3_1","Convolute_3_0","Convolute_5_1","Convolute_5_0","Convolute_7_1","Convolute_7_0","Convolute_9_1","Convolute_9_0","dstOff","scx","scy","srcOff","wt","weights","side","halfSide","sw","sh","createImageData","dst","alphaFac","uMatrix","uOpaque","uHalfSize","uSize","uniform1fv","Grayscale","lightness","luminosity","mode","uMode","uniform1i","Invert","invert","uInvert","Noise","noise","uNoise","uSeed","Pixelate","blocksize","_i","_j","_iLen","_jLen","uBlocksize","RemoveColor","useAlpha","lowC","highC","uLow","uHigh","Brownie","Vintage","Kodachrome","Technicolor","Polaroid","Sepia","BlackWhite","BlendColor","screen","lighten","darken","exclusion","tint","buildSource","tg","alpha1","uColor","BlendImage","mask","TEXTURE1","calculateMatrix","canvas1","blendData","blendImage","uTransformMatrix","uImage","uniformMatrix3fv","Resize","resizeType","lanczosLobes","uDelta","uTaps","uniform2fv","horizontal","taps","filterWindow","getFilterWindow","generateShader","tempScale","getTaps","lobeFunction","lanczosCreate","offsets","fragmentSourceTOP","dW","dH","lobes","xx","rcpScaleX","rcpScaleY","oW","oH","sliceByTwo","hermiteFastResize","bilinearFiltering","lanczosResize","tmpCanvas","mult","doneW","doneH","stepW","stepH","dX","dY","u","weight","fX","fY","ratioX","icenter","ratioY","range2X","cacheLanc","range2Y","lanczos","rcpRatioX","rcpRatioY","srcData","destData","destImg","xDiff","yDiff","chnl","origPix","w4","pixels","destImage","destPixels","ratioW","ratioH","ratioWHalf","ratioHHalf","img2","data2","weightsAlpha","gxR","gxG","gxB","gxA","yy","w0","Contrast","contrast","contrastF","uContrast","Saturation","saturation","adjust","uSaturation","Blur","aspectRatio","simpleBlur","canvas2","blurLayer1","blurLayer2","percent","ctx1","ctx2","nSamples","newImageData","delta","chooseRightDelta","blurScale","Gamma","gamma","rInv","gInv","bInv","rVals","gVals","bVals","uGamma","uniform3fv","Composed","subFilters","HueRotation","rotation","rad","aThird","aThirdSqtSin","OneMinusCos","additionalProps","_dimensionAffectingProps","_reNewline","_reSpacesAndTabs","_reSpaceAndTab","_reWords","underline","overline","linethrough","textAlign","superscript","baseline","subscript","textBackgroundColor","_fontSizeFraction","_fontSizeMult","charSpacing","_measuringContext","direction","_styleProperties","__charBounds","CACHE_FONT_SIZE","MIN_TEXT_WIDTH","text","__skipDimension","setPathInfo","initDimensions","segmentsInfo","getMeasuringContext","_splitText","newLines","_splitTextIntoLines","textLines","_textLines","graphemeLines","_unwrappedTextLines","_unwrappedLines","_text","graphemeText","_clearCache","calcTextWidth","cursorWidth","calcTextHeight","enlargeSpaces","diffSpace","currentLineWidth","numberOfSpaces","accumulatedSpace","line","charBound","spaces","isEndOfWrapping","getLineWidth","kernedWidth","lineIndex","missingNewlineOffset","_setTextStyles","_renderTextLinesBackground","_renderTextDecoration","_renderText","_renderTextStroke","_renderTextFill","charStyle","forMeasuring","textBaseline","_getFontDeclaration","maxWidth","_renderTextLine","_renderChars","styleHas","heightOfLine","lineLeftOffset","lastColor","charBox","currentColor","drawStart","leftOffset","_getLeftOffset","lineTopOffset","_getTopOffset","boxStart","boxWidth","getHeightOfLine","_getLineLeftOffset","getValueOfPropertyAt","renderLeft","getFontCache","cacheProp","_measureChar","previousChar","prevCharStyle","coupleWidth","previousWidth","fontCache","fontDeclaration","previousFontDeclaration","couple","stylesAreEqual","fontMultiplier","measureText","getHeightOfChar","measureLine","lineInfo","_measureLine","_getWidthOfCharSpacing","grapheme","prevGrapheme","graphemeInfo","startingPoint","totalPathLength","numOfSpaces","lineBounds","positionInPath","_getGraphemeBox","_setGraphemeOnPath","centerPosition","skipLeft","getCompleteStyleDeclaration","prevStyle","previousBox","__lineHeights","maxHeight","_renderTextCommon","lineHeights","isEmptyStyles","actualStyle","nextStyle","timeToRender","drawingLeft","isJustify","charsToRender","shortCut","isLtr","_renderChar","_hasStyleChanged","_applyPatternGradientTransformText","handleFiller","fillOffsets","strokeOffsets","_getStyleDeclaration","fullDecl","shouldFill","fillText","strokeText","setSuperscript","_setScript","setSubscript","loc","get2DCursorLocation","setSelectionStyles","thisStyle","_hasStyleChangedForSvg","lineDiff","__lineWidths","_shouldClearDimensionCache","shouldClear","_forceClearCache","_size","_dy","lastDecoration","currentDecoration","currentFill","lastFill","topOffset","styleObject","family","fontIsGeneric","genericFonts","newLine","newText","additionalProperties","needsDims","isAddingPath","_key","parsedAnchor","textAnchor","originalStrokeWidth","textHeightScaleFactor","lineHeightDiff","scaledDiff","textHeight","offX","objectCopy","textInstance","pathInstance","p3","0","cleanStyle","letterCount","stylePropertyValue","stylesCount","allStyleObjectPropertiesMatch","graphemeCount","stylePropertyHasBeenSet","removeStyle","lineNum","charNum","_extendStyles","_getLineStyle","_setLineStyle","_setStyleDeclaration","selectionStart","skipWrapping","getSelectionStyles","startIndex","endIndex","selectionEnd","getStyleAtPosition","lineStyle","_deleteStyleDeclaration","_deleteLineStyle","parseDecoration","IText","editable","editingBorderColor","cursorColor","cursorDelay","cursorDuration","caching","_reSpace","_currentCursorOpacity","_selectionDirection","_abortCursorAnimation","__widthOfSpace","inCompositionMode","initBehavior","setSelectionStart","_updateAndFire","setSelectionEnd","_fireSelectionChanged","_updateTextarea","initDelayedCursor","cursorOffsetCache","renderCursorOrSelection","skipRestore","_clearTextArea","boundaries","_getCursorBoundaries","renderCursor","renderSelection","_getCursorBoundariesOffsets","cursorPosition","cursorLocation","charHeight","__isMousedown","startLine","endLine","startChar","endChar","lineOffset","realLineHeight","boxEnd","drawWidth","drawHeight","extraTop","compositionColor","getCurrentCharFontSize","cp","_getCurrentCharIndex","getCurrentCharColor","initAddedHandler","initRemovedHandler","initCursorSelectionHandlers","initDoubleClickSimulation","mouseMoveHandler","_initCanvasHandlers","_removeCanvasHandlers","_tick","_currentTickState","_animateCursor","targetOpacity","completeMethod","tickState","isAborted","_onTickComplete","_cursorTimeout1","_currentTickCompleteState","restart","abortCursorAnimation","_cursorTimeout2","selectAll","getSelectedText","findWordBoundaryLeft","startFrom","findWordBoundaryRight","findLineBoundaryLeft","findLineBoundaryRight","searchWordBoundary","selectWord","newSelectionStart","newSelectionEnd","selectLine","enterEditing","exitEditingOnOthers","initHiddenTextarea","_saveEditingProps","_setEditingProps","_textBeforeEdit","initMouseMoveHandler","getSelectionStartFromPointer","currentStart","currentEnd","__selectionStartOnMouseDown","restartCursorIfNeeded","fromStringToGraphemeSelection","smallerTextStart","graphemeStart","smallerTextEnd","graphemeEnd","fromGraphemeToStringSelection","newSelection","updateTextareaPosition","updateFromTextArea","_calcTextareaPosition","desiredPosition","compositionStart","upperCanvas","upperCanvasWidth","upperCanvasHeight","clientWidth","clientHeight","_savedProps","_restoreEditingProps","isTextChanged","_removeExtraneousStyles","removeStyleFromTo","styleObj","cursorStart","cursorEnd","lineStart","charStart","lineEnd","charEnd","shiftLineStyles","numericChar","clonedStyles","numericLine","insertNewlineStyleObject","qty","copiedStyle","currentCharStyle","newLineStyles","somethingAdded","isEndOfLine","numIndex","styleCarriedOver","insertCharStyleObject","quantity","currentLineStyles","currentLineStylesCloned","numericIndex","newStyle","insertNewStyleBlock","insertedText","cursorLoc","addedLines","linesLength","setSelectionStartEndWithShift","setSelectionInBoundaries","__lastClickTime","__lastLastClickTime","__lastPointer","__newClickTime","newPointer","isTripleClick","_stopEvent","__lastIsEditing","__lastSelected","initMousedownHandler","initMouseupHandler","initClicks","doubleClickHandler","tripleClickHandler","_mouseDownHandler","setCursorByClick","_mouseDownHandlerBefore","currentActive","mouseOffset","prevWidth","_getNewSelectionStartFromOffset","distanceBtwLastCharAndCursor","distanceBtwNextCharAndCursor","onKeyDown","onKeyUp","onInput","copy","paste","onCompositionStart","onCompositionUpdate","onCompositionEnd","_clickHandlerInitialized","onClick","keysMap","9","27","33","34","35","36","37","38","39","40","keysMapRtl","ctrlKeysMapUp","67","88","ctrlKeysMapDown","65","keyMap","keyCode","ctrlKey","metaKey","stopImmediatePropagation","_copyDone","fromPaste","removedText","removeFrom","removeTo","nextText","charCount","nextCharCount","charDiff","textareaSelection","backDelete","copiedText","copiedTextStyle","compositionEnd","_getClipboardData","clipboardData","_getWidthBeforeCursor","widthBeforeCursor","getDownCursorOffset","isRight","selectionProp","_getSelectionForOffset","indexOnOtherLine","_getIndexOnLine","textAfterCursor","getUpCursorOffset","textBeforeCursor","charWidth","foundMatch","widthOfCharsOnLine","indexOnLine","leftEdge","rightEdge","offsetFromLeftEdge","offsetFromRightEdge","moveCursorDown","_moveCursorUpOrDown","moveCursorUp","moveCursorWithShift","moveCursorWithoutShift","moveCursorLeft","_moveCursorLeftOrRight","_move","_moveLeft","_moveRight","moveCursorLeftWithoutShift","change","moveCursorLeftWithShift","moveCursorRight","moveCursorRightWithShift","moveCursorRightWithoutShift","changed","removeChars","insertChars","multipleSpacesRegex","_getSVGLeftTopOffsets","textAndBg","_getSVGTextAndBg","textTop","textLeft","_wrapSVGTextAndBg","lineTop","noShadow","textSpans","textTopOffset","textLeftOffset","_setSVGTextLineBg","_setSVGTextLineText","_createTextCharSpan","styleDecl","shouldUseWhitespace","styleProps","fillStyles","dySpan","_pushTextBgRect","fillColor","_getSVGLineTopOffset","lastHeight","svgStyle","Textbox","minWidth","dynamicMinWidth","__cachedLines","_wordJoiners","splitByGrapheme","_styleMap","_generateStyleMap","textInfo","realLineCount","realLineCharCount","isWrapping","nextOffset","nextLineIndex","shouldLimit","mapNextLine","_wrapText","desiredWidth","wrapped","_wrapLine","_measureWord","word","charOffset","_line","reservedSpace","words","infix","wordWidth","infixWidth","largestWordWidth","lineJustStarted","additionalSpace","getMinWidth","linesToKeep","scaleSkewStyleHandler","scaleStyleHandler","objectControls","ml","mr","mb","mtr","textBoxControls","managers","newConnection","forceNew","multiplex","chars","arraybuffer","bytes","encoded1","encoded2","encoded3","encoded4","bufferLength","list","read","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","NaN","rt","LN2","_vm","_h","$createElement","_c","_self","ref","staticClass","_l","class","initIdx","$event","handleTools","_v","_s","uploadImage","staticStyle","_m","staticRenderFns","currentTool","fabricObj","toolsArr","mouseFrom","mouseTo","moveCount","doDrawing","fabricHistoryJson","mods","drawingObject","drawColor","imageBase64","socketLoaded","roomName","mounted","initCanvas","computed","innerWidth","innerHeight","methods","urlForSocket","hostName","sendCanvas","canvasData","canvasAsJSON","receiveCanvas","$route","params","room","fabricObjAddEvent","etCount","etindex","updateModifications","savehistory","undo","state","redo","transformMouse","resetObj","textboxObj","tools","imgInstance","videoElement","videoInstance","play","drawText","drawing","drawDoshedLine","drawRectangle","drawCircle","drawEllipse","drawTriangle","$nextTick","drawArrow","headlen","arrowX","topX","arrowY","topY","botX","botY","downLoadImage","formart","base64URl","reader","imgObj","files","component","byteArray","byteCount","byteIndex","stringFromCharCode","ucs2decode","extra","counter","ucs2encode","checkScalarValue","codePoint","createByte","encodeCodePoint","symbol","codePoints","byteString","readContinuationByte","continuationByte","decodeSymbol","byte1","byte2","byte3","byte4","withNativeBuffer","withNativeArrayBuffer","isView","DESCRIPTORS","defineProperty","f","FunctionPrototype","FunctionPrototypeToString","nameRE","NAME","configurable","ieee754","typedArraySupport","__proto__","foo","subarray","kMaxLength","TYPED_ARRAY_SUPPORT","RangeError","arg","encodingOrOffset","allocUnsafe","TypeError","fromArrayBuffer","fromString","assertSize","alloc","checked","isEncoding","actual","fromArrayLike","byteOffset","isnan","SlowBuffer","loweredCase","utf8ToBytes","base64ToBytes","slowToString","hexSlice","utf8Slice","asciiSlice","latin1Slice","base64Slice","utf16leSlice","bidirectionalIndexOf","arrayIndexOf","lastIndexOf","indexSize","arrLength","valLength","readUInt16BE","foundIndex","found","hexWrite","remaining","strLen","utf8Write","blitBuffer","asciiWrite","asciiToBytes","latin1Write","base64Write","ucs2Write","utf16leToBytes","res","secondByte","thirdByte","fourthByte","tempCodePoint","firstByte","bytesPerSequence","decodeCodePointsArray","INSPECT_MAX_BYTES","poolSize","_augment","Symbol","species","allocUnsafeSlow","_isBuffer","compare","swap16","swap32","swap64","equals","inspect","thisStart","thisEnd","thisCopy","targetCopy","includes","isFinite","_arr","MAX_ARGUMENTS_LENGTH","out","checkOffset","checkInt","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","writeDouble","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt8","readUInt16LE","readUInt32LE","readUInt32BE","readIntLE","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","maxBytes","writeUIntBE","writeUInt8","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","limit","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","targetStart","INVALID_BASE64_RE","base64clean","stringtrim","units","leadSurrogate","hi","lo","$","enumerable","URL","abv","ii","parseuri","href","count","err_cb","bail","proxy","requestTimeout","Request","create","req","sendXhr","pollXhr","setDisableHeaderCheck","hasXDR","onLoad","responseText","contentType","getResponseHeader","requestsCount","requests","onSuccess","fromError","response","unloadHandler","terminationEvent","BlobBuilder","WebKitBlobBuilder","MSBlobBuilder","MozBlobBuilder","blobSupported","blobSupportsArrayBufferView","blobBuilderSupported","append","getBlob","mapArrayBufferViews","BlobBuilderConstructor","bb","part","BlobConstructor","transports","transportOptions","writeBuffer","prevBufferLen","policyPort","rememberUpgrade","onlyBinaryUpgrades","product","upgrades","pingInterval","pingTimeout","pingIntervalTimer","pingTimeoutTimer","priorWebsocketSuccess","createTransport","EIO","transport","setTransport","onDrain","probe","failed","onTransportOpen","upgradeLosesBinary","upgrading","flush","freezeTransport","onTransportClose","onupgrade","onHandshake","setPing","filterUpgrades","onHeartbeat","sendPacket","waitForUpgrade","cleanupAndClose","filteredUpgrades","normalizeArray","allowAboveRoot","up","last","basename","matchedSlash","resolvedPath","resolvedAbsolute","isAbsolute","trailingSlash","paths","relative","fromParts","toParts","samePartsLength","outputParts","delimiter","dirname","hasRoot","extname","startDot","startPart","preDotState"],"mappings":"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","file":"js/chunk-14b72c8c.fa5c79fe.js","sourcesContent":["// browser shim for xmlhttprequest module\n\nvar hasCORS = require('has-cors');\nvar globalThis = require('./globalThis');\n\nmodule.exports = function (opts) {\n  var xdomain = opts.xdomain;\n\n  // scheme must be same when usign XDomainRequest\n  // http://blogs.msdn.com/b/ieinternals/archive/2010/05/13/xdomainrequest-restrictions-limitations-and-workarounds.aspx\n  var xscheme = opts.xscheme;\n\n  // XDomainRequest has a flow of not sending cookie, therefore it should be disabled as a default.\n  // https://github.com/Automattic/engine.io-client/pull/217\n  var enablesXDR = opts.enablesXDR;\n\n  // XMLHttpRequest can be disabled on IE\n  try {\n    if ('undefined' !== typeof XMLHttpRequest && (!xdomain || hasCORS)) {\n      return new XMLHttpRequest();\n    }\n  } catch (e) { }\n\n  // Use XDomainRequest for IE8 if enablesXDR is true\n  // because loading bar keeps flashing when using jsonp-polling\n  // https://github.com/yujiosaka/socke.io-ie8-loading-example\n  try {\n    if ('undefined' !== typeof XDomainRequest && !xscheme && enablesXDR) {\n      return new XDomainRequest();\n    }\n  } catch (e) { }\n\n  if (!xdomain) {\n    try {\n      return new globalThis[['Active'].concat('Object').join('X')]('Microsoft.XMLHTTP');\n    } catch (e) { }\n  }\n};\n","'use strict';\n\nvar alphabet = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_'.split('')\n  , length = 64\n  , map = {}\n  , seed = 0\n  , i = 0\n  , prev;\n\n/**\n * Return a string representing the specified number.\n *\n * @param {Number} num The number to convert.\n * @returns {String} The string representation of the number.\n * @api public\n */\nfunction encode(num) {\n  var encoded = '';\n\n  do {\n    encoded = alphabet[num % length] + encoded;\n    num = Math.floor(num / length);\n  } while (num > 0);\n\n  return encoded;\n}\n\n/**\n * Return the integer value specified by the given string.\n *\n * @param {String} str The string to convert.\n * @returns {Number} The integer value represented by the string.\n * @api public\n */\nfunction decode(str) {\n  var decoded = 0;\n\n  for (i = 0; i < str.length; i++) {\n    decoded = decoded * length + map[str.charAt(i)];\n  }\n\n  return decoded;\n}\n\n/**\n * Yeast: A tiny growing id generator.\n *\n * @returns {String} A unique id.\n * @api public\n */\nfunction yeast() {\n  var now = encode(+new Date());\n\n  if (now !== prev) return seed = 0, prev = now;\n  return now +'.'+ encode(seed++);\n}\n\n//\n// Map each character to its index.\n//\nfor (; i < length; i++) map[alphabet[i]] = i;\n\n//\n// Expose the `yeast`, `encode` and `decode` functions.\n//\nyeast.encode = encode;\nyeast.decode = decode;\nmodule.exports = yeast;\n","/**\n * Module dependencies.\n */\n\nvar Transport = require('../transport');\nvar parser = require('engine.io-parser');\nvar parseqs = require('parseqs');\nvar inherit = require('component-inherit');\nvar yeast = require('yeast');\nvar debug = require('debug')('engine.io-client:websocket');\n\nvar BrowserWebSocket, NodeWebSocket;\n\nif (typeof WebSocket !== 'undefined') {\n  BrowserWebSocket = WebSocket;\n} else if (typeof self !== 'undefined') {\n  BrowserWebSocket = self.WebSocket || self.MozWebSocket;\n}\n\nif (typeof window === 'undefined') {\n  try {\n    NodeWebSocket = require('ws');\n  } catch (e) { }\n}\n\n/**\n * Get either the `WebSocket` or `MozWebSocket` globals\n * in the browser or try to resolve WebSocket-compatible\n * interface exposed by `ws` for Node-like environment.\n */\n\nvar WebSocketImpl = BrowserWebSocket || NodeWebSocket;\n\n/**\n * Module exports.\n */\n\nmodule.exports = WS;\n\n/**\n * WebSocket transport constructor.\n *\n * @api {Object} connection options\n * @api public\n */\n\nfunction WS (opts) {\n  var forceBase64 = (opts && opts.forceBase64);\n  if (forceBase64) {\n    this.supportsBinary = false;\n  }\n  this.perMessageDeflate = opts.perMessageDeflate;\n  this.usingBrowserWebSocket = BrowserWebSocket && !opts.forceNode;\n  this.protocols = opts.protocols;\n  if (!this.usingBrowserWebSocket) {\n    WebSocketImpl = NodeWebSocket;\n  }\n  Transport.call(this, opts);\n}\n\n/**\n * Inherits from Transport.\n */\n\ninherit(WS, Transport);\n\n/**\n * Transport name.\n *\n * @api public\n */\n\nWS.prototype.name = 'websocket';\n\n/*\n * WebSockets support binary\n */\n\nWS.prototype.supportsBinary = true;\n\n/**\n * Opens socket.\n *\n * @api private\n */\n\nWS.prototype.doOpen = function () {\n  if (!this.check()) {\n    // let probe timeout\n    return;\n  }\n\n  var uri = this.uri();\n  var protocols = this.protocols;\n\n  var opts = {};\n\n  if (!this.isReactNative) {\n    opts.agent = this.agent;\n    opts.perMessageDeflate = this.perMessageDeflate;\n\n    // SSL options for Node.js client\n    opts.pfx = this.pfx;\n    opts.key = this.key;\n    opts.passphrase = this.passphrase;\n    opts.cert = this.cert;\n    opts.ca = this.ca;\n    opts.ciphers = this.ciphers;\n    opts.rejectUnauthorized = this.rejectUnauthorized;\n  }\n\n  if (this.extraHeaders) {\n    opts.headers = this.extraHeaders;\n  }\n  if (this.localAddress) {\n    opts.localAddress = this.localAddress;\n  }\n\n  try {\n    this.ws =\n      this.usingBrowserWebSocket && !this.isReactNative\n        ? protocols\n          ? new WebSocketImpl(uri, protocols)\n          : new WebSocketImpl(uri)\n        : new WebSocketImpl(uri, protocols, opts);\n  } catch (err) {\n    return this.emit('error', err);\n  }\n\n  if (this.ws.binaryType === undefined) {\n    this.supportsBinary = false;\n  }\n\n  if (this.ws.supports && this.ws.supports.binary) {\n    this.supportsBinary = true;\n    this.ws.binaryType = 'nodebuffer';\n  } else {\n    this.ws.binaryType = 'arraybuffer';\n  }\n\n  this.addEventListeners();\n};\n\n/**\n * Adds event listeners to the socket\n *\n * @api private\n */\n\nWS.prototype.addEventListeners = function () {\n  var self = this;\n\n  this.ws.onopen = function () {\n    self.onOpen();\n  };\n  this.ws.onclose = function () {\n    self.onClose();\n  };\n  this.ws.onmessage = function (ev) {\n    self.onData(ev.data);\n  };\n  this.ws.onerror = function (e) {\n    self.onError('websocket error', e);\n  };\n};\n\n/**\n * Writes data to socket.\n *\n * @param {Array} array of packets.\n * @api private\n */\n\nWS.prototype.write = function (packets) {\n  var self = this;\n  this.writable = false;\n\n  // encodePacket efficient as it uses WS framing\n  // no need for encodePayload\n  var total = packets.length;\n  for (var i = 0, l = total; i < l; i++) {\n    (function (packet) {\n      parser.encodePacket(packet, self.supportsBinary, function (data) {\n        if (!self.usingBrowserWebSocket) {\n          // always create a new object (GH-437)\n          var opts = {};\n          if (packet.options) {\n            opts.compress = packet.options.compress;\n          }\n\n          if (self.perMessageDeflate) {\n            var len = 'string' === typeof data ? Buffer.byteLength(data) : data.length;\n            if (len < self.perMessageDeflate.threshold) {\n              opts.compress = false;\n            }\n          }\n        }\n\n        // Sometimes the websocket has already been closed but the browser didn't\n        // have a chance of informing us about it yet, in that case send will\n        // throw an error\n        try {\n          if (self.usingBrowserWebSocket) {\n            // TypeError is thrown when passing the second argument on Safari\n            self.ws.send(data);\n          } else {\n            self.ws.send(data, opts);\n          }\n        } catch (e) {\n          debug('websocket closed before onclose event');\n        }\n\n        --total || done();\n      });\n    })(packets[i]);\n  }\n\n  function done () {\n    self.emit('flush');\n\n    // fake drain\n    // defer to next tick to allow Socket to clear writeBuffer\n    setTimeout(function () {\n      self.writable = true;\n      self.emit('drain');\n    }, 0);\n  }\n};\n\n/**\n * Called upon close\n *\n * @api private\n */\n\nWS.prototype.onClose = function () {\n  Transport.prototype.onClose.call(this);\n};\n\n/**\n * Closes socket.\n *\n * @api private\n */\n\nWS.prototype.doClose = function () {\n  if (typeof this.ws !== 'undefined') {\n    this.ws.close();\n  }\n};\n\n/**\n * Generates uri for connection.\n *\n * @api private\n */\n\nWS.prototype.uri = function () {\n  var query = this.query || {};\n  var schema = this.secure ? 'wss' : 'ws';\n  var port = '';\n\n  // avoid port if default for schema\n  if (this.port && (('wss' === schema && Number(this.port) !== 443) ||\n    ('ws' === schema && Number(this.port) !== 80))) {\n    port = ':' + this.port;\n  }\n\n  // append timestamp to URI\n  if (this.timestampRequests) {\n    query[this.timestampParam] = yeast();\n  }\n\n  // communicate binary support capabilities\n  if (!this.supportsBinary) {\n    query.b64 = 1;\n  }\n\n  query = parseqs.encode(query);\n\n  // prepend ? to query\n  if (query.length) {\n    query = '?' + query;\n  }\n\n  var ipv6 = this.hostname.indexOf(':') !== -1;\n  return schema + '://' + (ipv6 ? '[' + this.hostname + ']' : this.hostname) + port + this.path + query;\n};\n\n/**\n * Feature detection for WebSocket.\n *\n * @return {Boolean} whether this transport is available.\n * @api public\n */\n\nWS.prototype.check = function () {\n  return !!WebSocketImpl && !('__initialize' in WebSocketImpl && this.name === WS.prototype.name);\n};\n","/**\n * Module dependencies.\n */\n\nvar Transport = require('../transport');\nvar parseqs = require('parseqs');\nvar parser = require('engine.io-parser');\nvar inherit = require('component-inherit');\nvar yeast = require('yeast');\nvar debug = require('debug')('engine.io-client:polling');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Polling;\n\n/**\n * Is XHR2 supported?\n */\n\nvar hasXHR2 = (function () {\n  var XMLHttpRequest = require('xmlhttprequest-ssl');\n  var xhr = new XMLHttpRequest({ xdomain: false });\n  return null != xhr.responseType;\n})();\n\n/**\n * Polling interface.\n *\n * @param {Object} opts\n * @api private\n */\n\nfunction Polling (opts) {\n  var forceBase64 = (opts && opts.forceBase64);\n  if (!hasXHR2 || forceBase64) {\n    this.supportsBinary = false;\n  }\n  Transport.call(this, opts);\n}\n\n/**\n * Inherits from Transport.\n */\n\ninherit(Polling, Transport);\n\n/**\n * Transport name.\n */\n\nPolling.prototype.name = 'polling';\n\n/**\n * Opens the socket (triggers polling). We write a PING message to determine\n * when the transport is open.\n *\n * @api private\n */\n\nPolling.prototype.doOpen = function () {\n  this.poll();\n};\n\n/**\n * Pauses polling.\n *\n * @param {Function} callback upon buffers are flushed and transport is paused\n * @api private\n */\n\nPolling.prototype.pause = function (onPause) {\n  var self = this;\n\n  this.readyState = 'pausing';\n\n  function pause () {\n    debug('paused');\n    self.readyState = 'paused';\n    onPause();\n  }\n\n  if (this.polling || !this.writable) {\n    var total = 0;\n\n    if (this.polling) {\n      debug('we are currently polling - waiting to pause');\n      total++;\n      this.once('pollComplete', function () {\n        debug('pre-pause polling complete');\n        --total || pause();\n      });\n    }\n\n    if (!this.writable) {\n      debug('we are currently writing - waiting to pause');\n      total++;\n      this.once('drain', function () {\n        debug('pre-pause writing complete');\n        --total || pause();\n      });\n    }\n  } else {\n    pause();\n  }\n};\n\n/**\n * Starts polling cycle.\n *\n * @api public\n */\n\nPolling.prototype.poll = function () {\n  debug('polling');\n  this.polling = true;\n  this.doPoll();\n  this.emit('poll');\n};\n\n/**\n * Overloads onData to detect payloads.\n *\n * @api private\n */\n\nPolling.prototype.onData = function (data) {\n  var self = this;\n  debug('polling got data %s', data);\n  var callback = function (packet, index, total) {\n    // if its the first message we consider the transport open\n    if ('opening' === self.readyState && packet.type === 'open') {\n      self.onOpen();\n    }\n\n    // if its a close packet, we close the ongoing requests\n    if ('close' === packet.type) {\n      self.onClose();\n      return false;\n    }\n\n    // otherwise bypass onData and handle the message\n    self.onPacket(packet);\n  };\n\n  // decode payload\n  parser.decodePayload(data, this.socket.binaryType, callback);\n\n  // if an event did not trigger closing\n  if ('closed' !== this.readyState) {\n    // if we got data we're not polling\n    this.polling = false;\n    this.emit('pollComplete');\n\n    if ('open' === this.readyState) {\n      this.poll();\n    } else {\n      debug('ignoring poll - transport state \"%s\"', this.readyState);\n    }\n  }\n};\n\n/**\n * For polling, send a close packet.\n *\n * @api private\n */\n\nPolling.prototype.doClose = function () {\n  var self = this;\n\n  function close () {\n    debug('writing close packet');\n    self.write([{ type: 'close' }]);\n  }\n\n  if ('open' === this.readyState) {\n    debug('transport open - closing');\n    close();\n  } else {\n    // in case we're trying to close while\n    // handshaking is in progress (GH-164)\n    debug('transport not open - deferring close');\n    this.once('open', close);\n  }\n};\n\n/**\n * Writes a packets payload.\n *\n * @param {Array} data packets\n * @param {Function} drain callback\n * @api private\n */\n\nPolling.prototype.write = function (packets) {\n  var self = this;\n  this.writable = false;\n  var callbackfn = function () {\n    self.writable = true;\n    self.emit('drain');\n  };\n\n  parser.encodePayload(packets, this.supportsBinary, function (data) {\n    self.doWrite(data, callbackfn);\n  });\n};\n\n/**\n * Generates uri for connection.\n *\n * @api private\n */\n\nPolling.prototype.uri = function () {\n  var query = this.query || {};\n  var schema = this.secure ? 'https' : 'http';\n  var port = '';\n\n  // cache busting is forced\n  if (false !== this.timestampRequests) {\n    query[this.timestampParam] = yeast();\n  }\n\n  if (!this.supportsBinary && !query.sid) {\n    query.b64 = 1;\n  }\n\n  query = parseqs.encode(query);\n\n  // avoid port if default for schema\n  if (this.port && (('https' === schema && Number(this.port) !== 443) ||\n     ('http' === schema && Number(this.port) !== 80))) {\n    port = ':' + this.port;\n  }\n\n  // prepend ? to query\n  if (query.length) {\n    query = '?' + query;\n  }\n\n  var ipv6 = this.hostname.indexOf(':') !== -1;\n  return schema + '://' + (ipv6 ? '[' + this.hostname + ']' : this.hostname) + port + this.path + query;\n};\n","/**\n * Module requirements.\n */\n\nvar Polling = require('./polling');\nvar inherit = require('component-inherit');\nvar globalThis = require('../globalThis');\n\n/**\n * Module exports.\n */\n\nmodule.exports = JSONPPolling;\n\n/**\n * Cached regular expressions.\n */\n\nvar rNewline = /\\n/g;\nvar rEscapedNewline = /\\\\n/g;\n\n/**\n * Global JSONP callbacks.\n */\n\nvar callbacks;\n\n/**\n * Noop.\n */\n\nfunction empty () { }\n\n/**\n * JSONP Polling constructor.\n *\n * @param {Object} opts.\n * @api public\n */\n\nfunction JSONPPolling (opts) {\n  Polling.call(this, opts);\n\n  this.query = this.query || {};\n\n  // define global callbacks array if not present\n  // we do this here (lazily) to avoid unneeded global pollution\n  if (!callbacks) {\n    // we need to consider multiple engines in the same page\n    callbacks = globalThis.___eio = (globalThis.___eio || []);\n  }\n\n  // callback identifier\n  this.index = callbacks.length;\n\n  // add callback to jsonp global\n  var self = this;\n  callbacks.push(function (msg) {\n    self.onData(msg);\n  });\n\n  // append to query string\n  this.query.j = this.index;\n\n  // prevent spurious errors from being emitted when the window is unloaded\n  if (typeof addEventListener === 'function') {\n    addEventListener('beforeunload', function () {\n      if (self.script) self.script.onerror = empty;\n    }, false);\n  }\n}\n\n/**\n * Inherits from Polling.\n */\n\ninherit(JSONPPolling, Polling);\n\n/*\n * JSONP only supports binary as base64 encoded strings\n */\n\nJSONPPolling.prototype.supportsBinary = false;\n\n/**\n * Closes the socket.\n *\n * @api private\n */\n\nJSONPPolling.prototype.doClose = function () {\n  if (this.script) {\n    this.script.parentNode.removeChild(this.script);\n    this.script = null;\n  }\n\n  if (this.form) {\n    this.form.parentNode.removeChild(this.form);\n    this.form = null;\n    this.iframe = null;\n  }\n\n  Polling.prototype.doClose.call(this);\n};\n\n/**\n * Starts a poll cycle.\n *\n * @api private\n */\n\nJSONPPolling.prototype.doPoll = function () {\n  var self = this;\n  var script = document.createElement('script');\n\n  if (this.script) {\n    this.script.parentNode.removeChild(this.script);\n    this.script = null;\n  }\n\n  script.async = true;\n  script.src = this.uri();\n  script.onerror = function (e) {\n    self.onError('jsonp poll error', e);\n  };\n\n  var insertAt = document.getElementsByTagName('script')[0];\n  if (insertAt) {\n    insertAt.parentNode.insertBefore(script, insertAt);\n  } else {\n    (document.head || document.body).appendChild(script);\n  }\n  this.script = script;\n\n  var isUAgecko = 'undefined' !== typeof navigator && /gecko/i.test(navigator.userAgent);\n\n  if (isUAgecko) {\n    setTimeout(function () {\n      var iframe = document.createElement('iframe');\n      document.body.appendChild(iframe);\n      document.body.removeChild(iframe);\n    }, 100);\n  }\n};\n\n/**\n * Writes with a hidden iframe.\n *\n * @param {String} data to send\n * @param {Function} called upon flush.\n * @api private\n */\n\nJSONPPolling.prototype.doWrite = function (data, fn) {\n  var self = this;\n\n  if (!this.form) {\n    var form = document.createElement('form');\n    var area = document.createElement('textarea');\n    var id = this.iframeId = 'eio_iframe_' + this.index;\n    var iframe;\n\n    form.className = 'socketio';\n    form.style.position = 'absolute';\n    form.style.top = '-1000px';\n    form.style.left = '-1000px';\n    form.target = id;\n    form.method = 'POST';\n    form.setAttribute('accept-charset', 'utf-8');\n    area.name = 'd';\n    form.appendChild(area);\n    document.body.appendChild(form);\n\n    this.form = form;\n    this.area = area;\n  }\n\n  this.form.action = this.uri();\n\n  function complete () {\n    initIframe();\n    fn();\n  }\n\n  function initIframe () {\n    if (self.iframe) {\n      try {\n        self.form.removeChild(self.iframe);\n      } catch (e) {\n        self.onError('jsonp polling iframe removal error', e);\n      }\n    }\n\n    try {\n      // ie6 dynamic iframes with target=\"\" support (thanks Chris Lambacher)\n      var html = '<iframe src=\"javascript:0\" name=\"' + self.iframeId + '\">';\n      iframe = document.createElement(html);\n    } catch (e) {\n      iframe = document.createElement('iframe');\n      iframe.name = self.iframeId;\n      iframe.src = 'javascript:0';\n    }\n\n    iframe.id = self.iframeId;\n\n    self.form.appendChild(iframe);\n    self.iframe = iframe;\n  }\n\n  initIframe();\n\n  // escape \\n to prevent it from being converted into \\r\\n by some UAs\n  // double escaping is required for escaped new lines because unescaping of new lines can be done safely on server-side\n  data = data.replace(rEscapedNewline, '\\\\\\n');\n  this.area.value = data.replace(rNewline, '\\\\n');\n\n  try {\n    this.form.submit();\n  } catch (e) {}\n\n  if (this.iframe.attachEvent) {\n    this.iframe.onreadystatechange = function () {\n      if (self.iframe.readyState === 'complete') {\n        complete();\n      }\n    };\n  } else {\n    this.iframe.onload = complete;\n  }\n};\n","\n/**\n * Expose `Backoff`.\n */\n\nmodule.exports = Backoff;\n\n/**\n * Initialize backoff timer with `opts`.\n *\n * - `min` initial timeout in milliseconds [100]\n * - `max` max timeout [10000]\n * - `jitter` [0]\n * - `factor` [2]\n *\n * @param {Object} opts\n * @api public\n */\n\nfunction Backoff(opts) {\n  opts = opts || {};\n  this.ms = opts.min || 100;\n  this.max = opts.max || 10000;\n  this.factor = opts.factor || 2;\n  this.jitter = opts.jitter > 0 && opts.jitter <= 1 ? opts.jitter : 0;\n  this.attempts = 0;\n}\n\n/**\n * Return the backoff duration.\n *\n * @return {Number}\n * @api public\n */\n\nBackoff.prototype.duration = function(){\n  var ms = this.ms * Math.pow(this.factor, this.attempts++);\n  if (this.jitter) {\n    var rand =  Math.random();\n    var deviation = Math.floor(rand * this.jitter * ms);\n    ms = (Math.floor(rand * 10) & 1) == 0  ? ms - deviation : ms + deviation;\n  }\n  return Math.min(ms, this.max) | 0;\n};\n\n/**\n * Reset the number of attempts.\n *\n * @api public\n */\n\nBackoff.prototype.reset = function(){\n  this.attempts = 0;\n};\n\n/**\n * Set the minimum duration\n *\n * @api public\n */\n\nBackoff.prototype.setMin = function(min){\n  this.ms = min;\n};\n\n/**\n * Set the maximum duration\n *\n * @api public\n */\n\nBackoff.prototype.setMax = function(max){\n  this.max = max;\n};\n\n/**\n * Set the jitter\n *\n * @api public\n */\n\nBackoff.prototype.setJitter = function(jitter){\n  this.jitter = jitter;\n};\n\n","/**\n * Module dependencies.\n */\n\nvar parser = require('engine.io-parser');\nvar Emitter = require('component-emitter');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Transport;\n\n/**\n * Transport abstract constructor.\n *\n * @param {Object} options.\n * @api private\n */\n\nfunction Transport (opts) {\n  this.path = opts.path;\n  this.hostname = opts.hostname;\n  this.port = opts.port;\n  this.secure = opts.secure;\n  this.query = opts.query;\n  this.timestampParam = opts.timestampParam;\n  this.timestampRequests = opts.timestampRequests;\n  this.readyState = '';\n  this.agent = opts.agent || false;\n  this.socket = opts.socket;\n  this.enablesXDR = opts.enablesXDR;\n  this.withCredentials = opts.withCredentials;\n\n  // SSL options for Node.js client\n  this.pfx = opts.pfx;\n  this.key = opts.key;\n  this.passphrase = opts.passphrase;\n  this.cert = opts.cert;\n  this.ca = opts.ca;\n  this.ciphers = opts.ciphers;\n  this.rejectUnauthorized = opts.rejectUnauthorized;\n  this.forceNode = opts.forceNode;\n\n  // results of ReactNative environment detection\n  this.isReactNative = opts.isReactNative;\n\n  // other options for Node.js client\n  this.extraHeaders = opts.extraHeaders;\n  this.localAddress = opts.localAddress;\n}\n\n/**\n * Mix in `Emitter`.\n */\n\nEmitter(Transport.prototype);\n\n/**\n * Emits an error.\n *\n * @param {String} str\n * @return {Transport} for chaining\n * @api public\n */\n\nTransport.prototype.onError = function (msg, desc) {\n  var err = new Error(msg);\n  err.type = 'TransportError';\n  err.description = desc;\n  this.emit('error', err);\n  return this;\n};\n\n/**\n * Opens the transport.\n *\n * @api public\n */\n\nTransport.prototype.open = function () {\n  if ('closed' === this.readyState || '' === this.readyState) {\n    this.readyState = 'opening';\n    this.doOpen();\n  }\n\n  return this;\n};\n\n/**\n * Closes the transport.\n *\n * @api private\n */\n\nTransport.prototype.close = function () {\n  if ('opening' === this.readyState || 'open' === this.readyState) {\n    this.doClose();\n    this.onClose();\n  }\n\n  return this;\n};\n\n/**\n * Sends multiple packets.\n *\n * @param {Array} packets\n * @api private\n */\n\nTransport.prototype.send = function (packets) {\n  if ('open' === this.readyState) {\n    this.write(packets);\n  } else {\n    throw new Error('Transport not open');\n  }\n};\n\n/**\n * Called upon open\n *\n * @api private\n */\n\nTransport.prototype.onOpen = function () {\n  this.readyState = 'open';\n  this.writable = true;\n  this.emit('open');\n};\n\n/**\n * Called with data.\n *\n * @param {String} data\n * @api private\n */\n\nTransport.prototype.onData = function (data) {\n  var packet = parser.decodePacket(data, this.socket.binaryType);\n  this.onPacket(packet);\n};\n\n/**\n * Called with a decoded packet.\n */\n\nTransport.prototype.onPacket = function (packet) {\n  this.emit('packet', packet);\n};\n\n/**\n * Called upon close.\n *\n * @api private\n */\n\nTransport.prototype.onClose = function () {\n  this.readyState = 'closed';\n  this.emit('close');\n};\n","/**\n * This is the web browser implementation of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = require('./debug');\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = 'undefined' != typeof chrome\n               && 'undefined' != typeof chrome.storage\n                  ? chrome.storage.local\n                  : localstorage();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n  '#0000CC', '#0000FF', '#0033CC', '#0033FF', '#0066CC', '#0066FF', '#0099CC',\n  '#0099FF', '#00CC00', '#00CC33', '#00CC66', '#00CC99', '#00CCCC', '#00CCFF',\n  '#3300CC', '#3300FF', '#3333CC', '#3333FF', '#3366CC', '#3366FF', '#3399CC',\n  '#3399FF', '#33CC00', '#33CC33', '#33CC66', '#33CC99', '#33CCCC', '#33CCFF',\n  '#6600CC', '#6600FF', '#6633CC', '#6633FF', '#66CC00', '#66CC33', '#9900CC',\n  '#9900FF', '#9933CC', '#9933FF', '#99CC00', '#99CC33', '#CC0000', '#CC0033',\n  '#CC0066', '#CC0099', '#CC00CC', '#CC00FF', '#CC3300', '#CC3333', '#CC3366',\n  '#CC3399', '#CC33CC', '#CC33FF', '#CC6600', '#CC6633', '#CC9900', '#CC9933',\n  '#CCCC00', '#CCCC33', '#FF0000', '#FF0033', '#FF0066', '#FF0099', '#FF00CC',\n  '#FF00FF', '#FF3300', '#FF3333', '#FF3366', '#FF3399', '#FF33CC', '#FF33FF',\n  '#FF6600', '#FF6633', '#FF9900', '#FF9933', '#FFCC00', '#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\nfunction useColors() {\n  // NB: In an Electron preload script, document will be defined but not fully\n  // initialized. Since we know we're in Chrome, we'll just detect this case\n  // explicitly\n  if (typeof window !== 'undefined' && window.process && window.process.type === 'renderer') {\n    return true;\n  }\n\n  // Internet Explorer and Edge do not support colors.\n  if (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n    return false;\n  }\n\n  // is webkit? http://stackoverflow.com/a/16459606/376773\n  // document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n  return (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n    // is firebug? http://stackoverflow.com/a/398120/376773\n    (typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n    // is firefox >= v31?\n    // https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n    (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n    // double check webkit in userAgent just in case we are in a worker\n    (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nexports.formatters.j = function(v) {\n  try {\n    return JSON.stringify(v);\n  } catch (err) {\n    return '[UnexpectedJSONParseError]: ' + err.message;\n  }\n};\n\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n  var useColors = this.useColors;\n\n  args[0] = (useColors ? '%c' : '')\n    + this.namespace\n    + (useColors ? ' %c' : ' ')\n    + args[0]\n    + (useColors ? '%c ' : ' ')\n    + '+' + exports.humanize(this.diff);\n\n  if (!useColors) return;\n\n  var c = 'color: ' + this.color;\n  args.splice(1, 0, c, 'color: inherit')\n\n  // the final \"%c\" is somewhat tricky, because there could be other\n  // arguments passed either before or after the %c, so we need to\n  // figure out the correct index to insert the CSS into\n  var index = 0;\n  var lastC = 0;\n  args[0].replace(/%[a-zA-Z%]/g, function(match) {\n    if ('%%' === match) return;\n    index++;\n    if ('%c' === match) {\n      // we only are interested in the *last* %c\n      // (the user may have provided their own)\n      lastC = index;\n    }\n  });\n\n  args.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.log()` when available.\n * No-op when `console.log` is not a \"function\".\n *\n * @api public\n */\n\nfunction log() {\n  // this hackery is required for IE8/9, where\n  // the `console.log` function doesn't have 'apply'\n  return 'object' === typeof console\n    && console.log\n    && Function.prototype.apply.call(console.log, console, arguments);\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\n\nfunction save(namespaces) {\n  try {\n    if (null == namespaces) {\n      exports.storage.removeItem('debug');\n    } else {\n      exports.storage.debug = namespaces;\n    }\n  } catch(e) {}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n  var r;\n  try {\n    r = exports.storage.debug;\n  } catch(e) {}\n\n  // If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n  if (!r && typeof process !== 'undefined' && 'env' in process) {\n    r = process.env.DEBUG;\n  }\n\n  return r;\n}\n\n/**\n * Enable namespaces listed in `localStorage.debug` initially.\n */\n\nexports.enable(load());\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n  try {\n    return window.localStorage;\n  } catch (e) {}\n}\n","'use strict'\n\nexports.byteLength = byteLength\nexports.toByteArray = toByteArray\nexports.fromByteArray = fromByteArray\n\nvar lookup = []\nvar revLookup = []\nvar Arr = typeof Uint8Array !== 'undefined' ? Uint8Array : Array\n\nvar code = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'\nfor (var i = 0, len = code.length; i < len; ++i) {\n  lookup[i] = code[i]\n  revLookup[code.charCodeAt(i)] = i\n}\n\n// Support decoding URL-safe base64 strings, as Node.js does.\n// See: https://en.wikipedia.org/wiki/Base64#URL_applications\nrevLookup['-'.charCodeAt(0)] = 62\nrevLookup['_'.charCodeAt(0)] = 63\n\nfunction getLens (b64) {\n  var len = b64.length\n\n  if (len % 4 > 0) {\n    throw new Error('Invalid string. Length must be a multiple of 4')\n  }\n\n  // Trim off extra bytes after placeholder bytes are found\n  // See: https://github.com/beatgammit/base64-js/issues/42\n  var validLen = b64.indexOf('=')\n  if (validLen === -1) validLen = len\n\n  var placeHoldersLen = validLen === len\n    ? 0\n    : 4 - (validLen % 4)\n\n  return [validLen, placeHoldersLen]\n}\n\n// base64 is 4/3 + up to two characters of the original data\nfunction byteLength (b64) {\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction _byteLength (b64, validLen, placeHoldersLen) {\n  return ((validLen + placeHoldersLen) * 3 / 4) - placeHoldersLen\n}\n\nfunction toByteArray (b64) {\n  var tmp\n  var lens = getLens(b64)\n  var validLen = lens[0]\n  var placeHoldersLen = lens[1]\n\n  var arr = new Arr(_byteLength(b64, validLen, placeHoldersLen))\n\n  var curByte = 0\n\n  // if there are placeholders, only get up to the last complete 4 chars\n  var len = placeHoldersLen > 0\n    ? validLen - 4\n    : validLen\n\n  var i\n  for (i = 0; i < len; i += 4) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 18) |\n      (revLookup[b64.charCodeAt(i + 1)] << 12) |\n      (revLookup[b64.charCodeAt(i + 2)] << 6) |\n      revLookup[b64.charCodeAt(i + 3)]\n    arr[curByte++] = (tmp >> 16) & 0xFF\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 2) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 2) |\n      (revLookup[b64.charCodeAt(i + 1)] >> 4)\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  if (placeHoldersLen === 1) {\n    tmp =\n      (revLookup[b64.charCodeAt(i)] << 10) |\n      (revLookup[b64.charCodeAt(i + 1)] << 4) |\n      (revLookup[b64.charCodeAt(i + 2)] >> 2)\n    arr[curByte++] = (tmp >> 8) & 0xFF\n    arr[curByte++] = tmp & 0xFF\n  }\n\n  return arr\n}\n\nfunction tripletToBase64 (num) {\n  return lookup[num >> 18 & 0x3F] +\n    lookup[num >> 12 & 0x3F] +\n    lookup[num >> 6 & 0x3F] +\n    lookup[num & 0x3F]\n}\n\nfunction encodeChunk (uint8, start, end) {\n  var tmp\n  var output = []\n  for (var i = start; i < end; i += 3) {\n    tmp =\n      ((uint8[i] << 16) & 0xFF0000) +\n      ((uint8[i + 1] << 8) & 0xFF00) +\n      (uint8[i + 2] & 0xFF)\n    output.push(tripletToBase64(tmp))\n  }\n  return output.join('')\n}\n\nfunction fromByteArray (uint8) {\n  var tmp\n  var len = uint8.length\n  var extraBytes = len % 3 // if we have 1 byte left, pad 2 bytes\n  var parts = []\n  var maxChunkLength = 16383 // must be multiple of 3\n\n  // go through the array every three bytes, we'll deal with trailing stuff later\n  for (var i = 0, len2 = len - extraBytes; i < len2; i += maxChunkLength) {\n    parts.push(encodeChunk(uint8, i, (i + maxChunkLength) > len2 ? len2 : (i + maxChunkLength)))\n  }\n\n  // pad the end with zeros, but make sure to not forget the extra bytes\n  if (extraBytes === 1) {\n    tmp = uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 2] +\n      lookup[(tmp << 4) & 0x3F] +\n      '=='\n    )\n  } else if (extraBytes === 2) {\n    tmp = (uint8[len - 2] << 8) + uint8[len - 1]\n    parts.push(\n      lookup[tmp >> 10] +\n      lookup[(tmp >> 4) & 0x3F] +\n      lookup[(tmp << 2) & 0x3F] +\n      '='\n    )\n  }\n\n  return parts.join('')\n}\n","\n/**\n * Module dependencies.\n */\n\nvar parser = require('socket.io-parser');\nvar Emitter = require('component-emitter');\nvar toArray = require('to-array');\nvar on = require('./on');\nvar bind = require('component-bind');\nvar debug = require('debug')('socket.io-client:socket');\nvar parseqs = require('parseqs');\nvar hasBin = require('has-binary2');\n\n/**\n * Module exports.\n */\n\nmodule.exports = exports = Socket;\n\n/**\n * Internal events (blacklisted).\n * These events can't be emitted by the user.\n *\n * @api private\n */\n\nvar events = {\n  connect: 1,\n  connect_error: 1,\n  connect_timeout: 1,\n  connecting: 1,\n  disconnect: 1,\n  error: 1,\n  reconnect: 1,\n  reconnect_attempt: 1,\n  reconnect_failed: 1,\n  reconnect_error: 1,\n  reconnecting: 1,\n  ping: 1,\n  pong: 1\n};\n\n/**\n * Shortcut to `Emitter#emit`.\n */\n\nvar emit = Emitter.prototype.emit;\n\n/**\n * `Socket` constructor.\n *\n * @api public\n */\n\nfunction Socket (io, nsp, opts) {\n  this.io = io;\n  this.nsp = nsp;\n  this.json = this; // compat\n  this.ids = 0;\n  this.acks = {};\n  this.receiveBuffer = [];\n  this.sendBuffer = [];\n  this.connected = false;\n  this.disconnected = true;\n  this.flags = {};\n  if (opts && opts.query) {\n    this.query = opts.query;\n  }\n  if (this.io.autoConnect) this.open();\n}\n\n/**\n * Mix in `Emitter`.\n */\n\nEmitter(Socket.prototype);\n\n/**\n * Subscribe to open, close and packet events\n *\n * @api private\n */\n\nSocket.prototype.subEvents = function () {\n  if (this.subs) return;\n\n  var io = this.io;\n  this.subs = [\n    on(io, 'open', bind(this, 'onopen')),\n    on(io, 'packet', bind(this, 'onpacket')),\n    on(io, 'close', bind(this, 'onclose'))\n  ];\n};\n\n/**\n * \"Opens\" the socket.\n *\n * @api public\n */\n\nSocket.prototype.open =\nSocket.prototype.connect = function () {\n  if (this.connected) return this;\n\n  this.subEvents();\n  if (!this.io.reconnecting) this.io.open(); // ensure open\n  if ('open' === this.io.readyState) this.onopen();\n  this.emit('connecting');\n  return this;\n};\n\n/**\n * Sends a `message` event.\n *\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.send = function () {\n  var args = toArray(arguments);\n  args.unshift('message');\n  this.emit.apply(this, args);\n  return this;\n};\n\n/**\n * Override `emit`.\n * If the event is in `events`, it's emitted normally.\n *\n * @param {String} event name\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.emit = function (ev) {\n  if (events.hasOwnProperty(ev)) {\n    emit.apply(this, arguments);\n    return this;\n  }\n\n  var args = toArray(arguments);\n  var packet = {\n    type: (this.flags.binary !== undefined ? this.flags.binary : hasBin(args)) ? parser.BINARY_EVENT : parser.EVENT,\n    data: args\n  };\n\n  packet.options = {};\n  packet.options.compress = !this.flags || false !== this.flags.compress;\n\n  // event ack callback\n  if ('function' === typeof args[args.length - 1]) {\n    debug('emitting packet with ack id %d', this.ids);\n    this.acks[this.ids] = args.pop();\n    packet.id = this.ids++;\n  }\n\n  if (this.connected) {\n    this.packet(packet);\n  } else {\n    this.sendBuffer.push(packet);\n  }\n\n  this.flags = {};\n\n  return this;\n};\n\n/**\n * Sends a packet.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.packet = function (packet) {\n  packet.nsp = this.nsp;\n  this.io.packet(packet);\n};\n\n/**\n * Called upon engine `open`.\n *\n * @api private\n */\n\nSocket.prototype.onopen = function () {\n  debug('transport is open - connecting');\n\n  // write connect packet if necessary\n  if ('/' !== this.nsp) {\n    if (this.query) {\n      var query = typeof this.query === 'object' ? parseqs.encode(this.query) : this.query;\n      debug('sending connect packet with query %s', query);\n      this.packet({type: parser.CONNECT, query: query});\n    } else {\n      this.packet({type: parser.CONNECT});\n    }\n  }\n};\n\n/**\n * Called upon engine `close`.\n *\n * @param {String} reason\n * @api private\n */\n\nSocket.prototype.onclose = function (reason) {\n  debug('close (%s)', reason);\n  this.connected = false;\n  this.disconnected = true;\n  delete this.id;\n  this.emit('disconnect', reason);\n};\n\n/**\n * Called with socket packet.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.onpacket = function (packet) {\n  var sameNamespace = packet.nsp === this.nsp;\n  var rootNamespaceError = packet.type === parser.ERROR && packet.nsp === '/';\n\n  if (!sameNamespace && !rootNamespaceError) return;\n\n  switch (packet.type) {\n    case parser.CONNECT:\n      this.onconnect();\n      break;\n\n    case parser.EVENT:\n      this.onevent(packet);\n      break;\n\n    case parser.BINARY_EVENT:\n      this.onevent(packet);\n      break;\n\n    case parser.ACK:\n      this.onack(packet);\n      break;\n\n    case parser.BINARY_ACK:\n      this.onack(packet);\n      break;\n\n    case parser.DISCONNECT:\n      this.ondisconnect();\n      break;\n\n    case parser.ERROR:\n      this.emit('error', packet.data);\n      break;\n  }\n};\n\n/**\n * Called upon a server event.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.onevent = function (packet) {\n  var args = packet.data || [];\n  debug('emitting event %j', args);\n\n  if (null != packet.id) {\n    debug('attaching ack callback to event');\n    args.push(this.ack(packet.id));\n  }\n\n  if (this.connected) {\n    emit.apply(this, args);\n  } else {\n    this.receiveBuffer.push(args);\n  }\n};\n\n/**\n * Produces an ack callback to emit with an event.\n *\n * @api private\n */\n\nSocket.prototype.ack = function (id) {\n  var self = this;\n  var sent = false;\n  return function () {\n    // prevent double callbacks\n    if (sent) return;\n    sent = true;\n    var args = toArray(arguments);\n    debug('sending ack %j', args);\n\n    self.packet({\n      type: hasBin(args) ? parser.BINARY_ACK : parser.ACK,\n      id: id,\n      data: args\n    });\n  };\n};\n\n/**\n * Called upon a server acknowlegement.\n *\n * @param {Object} packet\n * @api private\n */\n\nSocket.prototype.onack = function (packet) {\n  var ack = this.acks[packet.id];\n  if ('function' === typeof ack) {\n    debug('calling ack %s with %j', packet.id, packet.data);\n    ack.apply(this, packet.data);\n    delete this.acks[packet.id];\n  } else {\n    debug('bad ack %s', packet.id);\n  }\n};\n\n/**\n * Called upon server connect.\n *\n * @api private\n */\n\nSocket.prototype.onconnect = function () {\n  this.connected = true;\n  this.disconnected = false;\n  this.emit('connect');\n  this.emitBuffered();\n};\n\n/**\n * Emit buffered events (received and emitted).\n *\n * @api private\n */\n\nSocket.prototype.emitBuffered = function () {\n  var i;\n  for (i = 0; i < this.receiveBuffer.length; i++) {\n    emit.apply(this, this.receiveBuffer[i]);\n  }\n  this.receiveBuffer = [];\n\n  for (i = 0; i < this.sendBuffer.length; i++) {\n    this.packet(this.sendBuffer[i]);\n  }\n  this.sendBuffer = [];\n};\n\n/**\n * Called upon server disconnect.\n *\n * @api private\n */\n\nSocket.prototype.ondisconnect = function () {\n  debug('server disconnect (%s)', this.nsp);\n  this.destroy();\n  this.onclose('io server disconnect');\n};\n\n/**\n * Called upon forced client/server side disconnections,\n * this method ensures the manager stops tracking us and\n * that reconnections don't get triggered for this.\n *\n * @api private.\n */\n\nSocket.prototype.destroy = function () {\n  if (this.subs) {\n    // clean subscriptions to avoid reconnections\n    for (var i = 0; i < this.subs.length; i++) {\n      this.subs[i].destroy();\n    }\n    this.subs = null;\n  }\n\n  this.io.destroy(this);\n};\n\n/**\n * Disconnects the socket manually.\n *\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.close =\nSocket.prototype.disconnect = function () {\n  if (this.connected) {\n    debug('performing disconnect (%s)', this.nsp);\n    this.packet({ type: parser.DISCONNECT });\n  }\n\n  // remove socket from pool\n  this.destroy();\n\n  if (this.connected) {\n    // fire events\n    this.onclose('io client disconnect');\n  }\n  return this;\n};\n\n/**\n * Sets the compress flag.\n *\n * @param {Boolean} if `true`, compresses the sending data\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.compress = function (compress) {\n  this.flags.compress = compress;\n  return this;\n};\n\n/**\n * Sets the binary flag\n *\n * @param {Boolean} whether the emitted data contains binary\n * @return {Socket} self\n * @api public\n */\n\nSocket.prototype.binary = function (binary) {\n  this.flags.binary = binary;\n  return this;\n};\n","module.exports = \"data:image/png;base64,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\"","/*global Blob,File*/\n\n/**\n * Module requirements\n */\n\nvar isArray = require('isarray');\nvar isBuf = require('./is-buffer');\nvar toString = Object.prototype.toString;\nvar withNativeBlob = typeof Blob === 'function' || (typeof Blob !== 'undefined' && toString.call(Blob) === '[object BlobConstructor]');\nvar withNativeFile = typeof File === 'function' || (typeof File !== 'undefined' && toString.call(File) === '[object FileConstructor]');\n\n/**\n * Replaces every Buffer | ArrayBuffer in packet with a numbered placeholder.\n * Anything with blobs or files should be fed through removeBlobs before coming\n * here.\n *\n * @param {Object} packet - socket.io event packet\n * @return {Object} with deconstructed packet and list of buffers\n * @api public\n */\n\nexports.deconstructPacket = function(packet) {\n  var buffers = [];\n  var packetData = packet.data;\n  var pack = packet;\n  pack.data = _deconstructPacket(packetData, buffers);\n  pack.attachments = buffers.length; // number of binary 'attachments'\n  return {packet: pack, buffers: buffers};\n};\n\nfunction _deconstructPacket(data, buffers) {\n  if (!data) return data;\n\n  if (isBuf(data)) {\n    var placeholder = { _placeholder: true, num: buffers.length };\n    buffers.push(data);\n    return placeholder;\n  } else if (isArray(data)) {\n    var newData = new Array(data.length);\n    for (var i = 0; i < data.length; i++) {\n      newData[i] = _deconstructPacket(data[i], buffers);\n    }\n    return newData;\n  } else if (typeof data === 'object' && !(data instanceof Date)) {\n    var newData = {};\n    for (var key in data) {\n      newData[key] = _deconstructPacket(data[key], buffers);\n    }\n    return newData;\n  }\n  return data;\n}\n\n/**\n * Reconstructs a binary packet from its placeholder packet and buffers\n *\n * @param {Object} packet - event packet with placeholders\n * @param {Array} buffers - binary buffers to put in placeholder positions\n * @return {Object} reconstructed packet\n * @api public\n */\n\nexports.reconstructPacket = function(packet, buffers) {\n  packet.data = _reconstructPacket(packet.data, buffers);\n  packet.attachments = undefined; // no longer useful\n  return packet;\n};\n\nfunction _reconstructPacket(data, buffers) {\n  if (!data) return data;\n\n  if (data && data._placeholder) {\n    return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n  } else if (isArray(data)) {\n    for (var i = 0; i < data.length; i++) {\n      data[i] = _reconstructPacket(data[i], buffers);\n    }\n  } else if (typeof data === 'object') {\n    for (var key in data) {\n      data[key] = _reconstructPacket(data[key], buffers);\n    }\n  }\n\n  return data;\n}\n\n/**\n * Asynchronously removes Blobs or Files from data via\n * FileReader's readAsArrayBuffer method. Used before encoding\n * data as msgpack. Calls callback with the blobless data.\n *\n * @param {Object} data\n * @param {Function} callback\n * @api private\n */\n\nexports.removeBlobs = function(data, callback) {\n  function _removeBlobs(obj, curKey, containingObject) {\n    if (!obj) return obj;\n\n    // convert any blob\n    if ((withNativeBlob && obj instanceof Blob) ||\n        (withNativeFile && obj instanceof File)) {\n      pendingBlobs++;\n\n      // async filereader\n      var fileReader = new FileReader();\n      fileReader.onload = function() { // this.result == arraybuffer\n        if (containingObject) {\n          containingObject[curKey] = this.result;\n        }\n        else {\n          bloblessData = this.result;\n        }\n\n        // if nothing pending its callback time\n        if(! --pendingBlobs) {\n          callback(bloblessData);\n        }\n      };\n\n      fileReader.readAsArrayBuffer(obj); // blob -> arraybuffer\n    } else if (isArray(obj)) { // handle array\n      for (var i = 0; i < obj.length; i++) {\n        _removeBlobs(obj[i], i, obj);\n      }\n    } else if (typeof obj === 'object' && !isBuf(obj)) { // and object\n      for (var key in obj) {\n        _removeBlobs(obj[key], key, obj);\n      }\n    }\n  }\n\n  var pendingBlobs = 0;\n  var bloblessData = data;\n  _removeBlobs(bloblessData);\n  if (!pendingBlobs) {\n    callback(bloblessData);\n  }\n};\n","/**\n * Slice reference.\n */\n\nvar slice = [].slice;\n\n/**\n * Bind `obj` to `fn`.\n *\n * @param {Object} obj\n * @param {Function|String} fn or string\n * @return {Function}\n * @api public\n */\n\nmodule.exports = function(obj, fn){\n  if ('string' == typeof fn) fn = obj[fn];\n  if ('function' != typeof fn) throw new Error('bind() requires a function');\n  var args = slice.call(arguments, 2);\n  return function(){\n    return fn.apply(obj, args.concat(slice.call(arguments)));\n  }\n};\n","exports.nextTick = function nextTick(fn) {\n    var args = Array.prototype.slice.call(arguments);\n    args.shift();\n    setTimeout(function () {\n        fn.apply(null, args);\n    }, 0);\n};\n\nexports.platform = exports.arch = \nexports.execPath = exports.title = 'browser';\nexports.pid = 1;\nexports.browser = true;\nexports.env = {};\nexports.argv = [];\n\nexports.binding = function (name) {\n\tthrow new Error('No such module. (Possibly not yet loaded)')\n};\n\n(function () {\n    var cwd = '/';\n    var path;\n    exports.cwd = function () { return cwd };\n    exports.chdir = function (dir) {\n        if (!path) path = require('path');\n        cwd = path.resolve(dir, cwd);\n    };\n})();\n\nexports.exit = exports.kill = \nexports.umask = exports.dlopen = \nexports.uptime = exports.memoryUsage = \nexports.uvCounters = function() {};\nexports.features = {};\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = createDebug.debug = createDebug['default'] = createDebug;\nexports.coerce = coerce;\nexports.disable = disable;\nexports.enable = enable;\nexports.enabled = enabled;\nexports.humanize = require('ms');\n\n/**\n * Active `debug` instances.\n */\nexports.instances = [];\n\n/**\n * The currently active debug mode names, and names to skip.\n */\n\nexports.names = [];\nexports.skips = [];\n\n/**\n * Map of special \"%n\" handling functions, for the debug \"format\" argument.\n *\n * Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n */\n\nexports.formatters = {};\n\n/**\n * Select a color.\n * @param {String} namespace\n * @return {Number}\n * @api private\n */\n\nfunction selectColor(namespace) {\n  var hash = 0, i;\n\n  for (i in namespace) {\n    hash  = ((hash << 5) - hash) + namespace.charCodeAt(i);\n    hash |= 0; // Convert to 32bit integer\n  }\n\n  return exports.colors[Math.abs(hash) % exports.colors.length];\n}\n\n/**\n * Create a debugger with the given `namespace`.\n *\n * @param {String} namespace\n * @return {Function}\n * @api public\n */\n\nfunction createDebug(namespace) {\n\n  var prevTime;\n\n  function debug() {\n    // disabled?\n    if (!debug.enabled) return;\n\n    var self = debug;\n\n    // set `diff` timestamp\n    var curr = +new Date();\n    var ms = curr - (prevTime || curr);\n    self.diff = ms;\n    self.prev = prevTime;\n    self.curr = curr;\n    prevTime = curr;\n\n    // turn the `arguments` into a proper Array\n    var args = new Array(arguments.length);\n    for (var i = 0; i < args.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    args[0] = exports.coerce(args[0]);\n\n    if ('string' !== typeof args[0]) {\n      // anything else let's inspect with %O\n      args.unshift('%O');\n    }\n\n    // apply any `formatters` transformations\n    var index = 0;\n    args[0] = args[0].replace(/%([a-zA-Z%])/g, function(match, format) {\n      // if we encounter an escaped % then don't increase the array index\n      if (match === '%%') return match;\n      index++;\n      var formatter = exports.formatters[format];\n      if ('function' === typeof formatter) {\n        var val = args[index];\n        match = formatter.call(self, val);\n\n        // now we need to remove `args[index]` since it's inlined in the `format`\n        args.splice(index, 1);\n        index--;\n      }\n      return match;\n    });\n\n    // apply env-specific formatting (colors, etc.)\n    exports.formatArgs.call(self, args);\n\n    var logFn = debug.log || exports.log || console.log.bind(console);\n    logFn.apply(self, args);\n  }\n\n  debug.namespace = namespace;\n  debug.enabled = exports.enabled(namespace);\n  debug.useColors = exports.useColors();\n  debug.color = selectColor(namespace);\n  debug.destroy = destroy;\n\n  // env-specific initialization logic for debug instances\n  if ('function' === typeof exports.init) {\n    exports.init(debug);\n  }\n\n  exports.instances.push(debug);\n\n  return debug;\n}\n\nfunction destroy () {\n  var index = exports.instances.indexOf(this);\n  if (index !== -1) {\n    exports.instances.splice(index, 1);\n    return true;\n  } else {\n    return false;\n  }\n}\n\n/**\n * Enables a debug mode by namespaces. This can include modes\n * separated by a colon and wildcards.\n *\n * @param {String} namespaces\n * @api public\n */\n\nfunction enable(namespaces) {\n  exports.save(namespaces);\n\n  exports.names = [];\n  exports.skips = [];\n\n  var i;\n  var split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n  var len = split.length;\n\n  for (i = 0; i < len; i++) {\n    if (!split[i]) continue; // ignore empty strings\n    namespaces = split[i].replace(/\\*/g, '.*?');\n    if (namespaces[0] === '-') {\n      exports.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n    } else {\n      exports.names.push(new RegExp('^' + namespaces + '$'));\n    }\n  }\n\n  for (i = 0; i < exports.instances.length; i++) {\n    var instance = exports.instances[i];\n    instance.enabled = exports.enabled(instance.namespace);\n  }\n}\n\n/**\n * Disable debug output.\n *\n * @api public\n */\n\nfunction disable() {\n  exports.enable('');\n}\n\n/**\n * Returns true if the given mode name is enabled, false otherwise.\n *\n * @param {String} name\n * @return {Boolean}\n * @api public\n */\n\nfunction enabled(name) {\n  if (name[name.length - 1] === '*') {\n    return true;\n  }\n  var i, len;\n  for (i = 0, len = exports.skips.length; i < len; i++) {\n    if (exports.skips[i].test(name)) {\n      return false;\n    }\n  }\n  for (i = 0, len = exports.names.length; i < len; i++) {\n    if (exports.names[i].test(name)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Coerce `val`.\n *\n * @param {Mixed} val\n * @return {Mixed}\n * @api private\n */\n\nfunction coerce(val) {\n  if (val instanceof Error) return val.stack || val.message;\n  return val;\n}\n","/**\n * Compiles a querystring\n * Returns string representation of the object\n *\n * @param {Object}\n * @api private\n */\n\nexports.encode = function (obj) {\n  var str = '';\n\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (str.length) str += '&';\n      str += encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]);\n    }\n  }\n\n  return str;\n};\n\n/**\n * Parses a simple querystring into an object\n *\n * @param {String} qs\n * @api private\n */\n\nexports.decode = function(qs){\n  var qry = {};\n  var pairs = qs.split('&');\n  for (var i = 0, l = pairs.length; i < l; i++) {\n    var pair = pairs[i].split('=');\n    qry[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n  }\n  return qry;\n};\n","\n/**\n * Module dependencies.\n */\n\nvar debug = require('debug')('socket.io-parser');\nvar Emitter = require('component-emitter');\nvar binary = require('./binary');\nvar isArray = require('isarray');\nvar isBuf = require('./is-buffer');\n\n/**\n * Protocol version.\n *\n * @api public\n */\n\nexports.protocol = 4;\n\n/**\n * Packet types.\n *\n * @api public\n */\n\nexports.types = [\n  'CONNECT',\n  'DISCONNECT',\n  'EVENT',\n  'ACK',\n  'ERROR',\n  'BINARY_EVENT',\n  'BINARY_ACK'\n];\n\n/**\n * Packet type `connect`.\n *\n * @api public\n */\n\nexports.CONNECT = 0;\n\n/**\n * Packet type `disconnect`.\n *\n * @api public\n */\n\nexports.DISCONNECT = 1;\n\n/**\n * Packet type `event`.\n *\n * @api public\n */\n\nexports.EVENT = 2;\n\n/**\n * Packet type `ack`.\n *\n * @api public\n */\n\nexports.ACK = 3;\n\n/**\n * Packet type `error`.\n *\n * @api public\n */\n\nexports.ERROR = 4;\n\n/**\n * Packet type 'binary event'\n *\n * @api public\n */\n\nexports.BINARY_EVENT = 5;\n\n/**\n * Packet type `binary ack`. For acks with binary arguments.\n *\n * @api public\n */\n\nexports.BINARY_ACK = 6;\n\n/**\n * Encoder constructor.\n *\n * @api public\n */\n\nexports.Encoder = Encoder;\n\n/**\n * Decoder constructor.\n *\n * @api public\n */\n\nexports.Decoder = Decoder;\n\n/**\n * A socket.io Encoder instance\n *\n * @api public\n */\n\nfunction Encoder() {}\n\nvar ERROR_PACKET = exports.ERROR + '\"encode error\"';\n\n/**\n * Encode a packet as a single string if non-binary, or as a\n * buffer sequence, depending on packet type.\n *\n * @param {Object} obj - packet object\n * @param {Function} callback - function to handle encodings (likely engine.write)\n * @return Calls callback with Array of encodings\n * @api public\n */\n\nEncoder.prototype.encode = function(obj, callback){\n  debug('encoding packet %j', obj);\n\n  if (exports.BINARY_EVENT === obj.type || exports.BINARY_ACK === obj.type) {\n    encodeAsBinary(obj, callback);\n  } else {\n    var encoding = encodeAsString(obj);\n    callback([encoding]);\n  }\n};\n\n/**\n * Encode packet as string.\n *\n * @param {Object} packet\n * @return {String} encoded\n * @api private\n */\n\nfunction encodeAsString(obj) {\n\n  // first is type\n  var str = '' + obj.type;\n\n  // attachments if we have them\n  if (exports.BINARY_EVENT === obj.type || exports.BINARY_ACK === obj.type) {\n    str += obj.attachments + '-';\n  }\n\n  // if we have a namespace other than `/`\n  // we append it followed by a comma `,`\n  if (obj.nsp && '/' !== obj.nsp) {\n    str += obj.nsp + ',';\n  }\n\n  // immediately followed by the id\n  if (null != obj.id) {\n    str += obj.id;\n  }\n\n  // json data\n  if (null != obj.data) {\n    var payload = tryStringify(obj.data);\n    if (payload !== false) {\n      str += payload;\n    } else {\n      return ERROR_PACKET;\n    }\n  }\n\n  debug('encoded %j as %s', obj, str);\n  return str;\n}\n\nfunction tryStringify(str) {\n  try {\n    return JSON.stringify(str);\n  } catch(e){\n    return false;\n  }\n}\n\n/**\n * Encode packet as 'buffer sequence' by removing blobs, and\n * deconstructing packet into object with placeholders and\n * a list of buffers.\n *\n * @param {Object} packet\n * @return {Buffer} encoded\n * @api private\n */\n\nfunction encodeAsBinary(obj, callback) {\n\n  function writeEncoding(bloblessData) {\n    var deconstruction = binary.deconstructPacket(bloblessData);\n    var pack = encodeAsString(deconstruction.packet);\n    var buffers = deconstruction.buffers;\n\n    buffers.unshift(pack); // add packet info to beginning of data list\n    callback(buffers); // write all the buffers\n  }\n\n  binary.removeBlobs(obj, writeEncoding);\n}\n\n/**\n * A socket.io Decoder instance\n *\n * @return {Object} decoder\n * @api public\n */\n\nfunction Decoder() {\n  this.reconstructor = null;\n}\n\n/**\n * Mix in `Emitter` with Decoder.\n */\n\nEmitter(Decoder.prototype);\n\n/**\n * Decodes an encoded packet string into packet JSON.\n *\n * @param {String} obj - encoded packet\n * @return {Object} packet\n * @api public\n */\n\nDecoder.prototype.add = function(obj) {\n  var packet;\n  if (typeof obj === 'string') {\n    packet = decodeString(obj);\n    if (exports.BINARY_EVENT === packet.type || exports.BINARY_ACK === packet.type) { // binary packet's json\n      this.reconstructor = new BinaryReconstructor(packet);\n\n      // no attachments, labeled binary but no binary data to follow\n      if (this.reconstructor.reconPack.attachments === 0) {\n        this.emit('decoded', packet);\n      }\n    } else { // non-binary full packet\n      this.emit('decoded', packet);\n    }\n  } else if (isBuf(obj) || obj.base64) { // raw binary data\n    if (!this.reconstructor) {\n      throw new Error('got binary data when not reconstructing a packet');\n    } else {\n      packet = this.reconstructor.takeBinaryData(obj);\n      if (packet) { // received final buffer\n        this.reconstructor = null;\n        this.emit('decoded', packet);\n      }\n    }\n  } else {\n    throw new Error('Unknown type: ' + obj);\n  }\n};\n\n/**\n * Decode a packet String (JSON data)\n *\n * @param {String} str\n * @return {Object} packet\n * @api private\n */\n\nfunction decodeString(str) {\n  var i = 0;\n  // look up type\n  var p = {\n    type: Number(str.charAt(0))\n  };\n\n  if (null == exports.types[p.type]) {\n    return error('unknown packet type ' + p.type);\n  }\n\n  // look up attachments if type binary\n  if (exports.BINARY_EVENT === p.type || exports.BINARY_ACK === p.type) {\n    var start = i + 1;\n    while (str.charAt(++i) !== '-' && i != str.length) {}\n    var buf = str.substring(start, i);\n    if (buf != Number(buf) || str.charAt(i) !== '-') {\n      throw new Error('Illegal attachments');\n    }\n    p.attachments = Number(buf);\n  }\n\n  // look up namespace (if any)\n  if ('/' === str.charAt(i + 1)) {\n    var start = i + 1;\n    while (++i) {\n      var c = str.charAt(i);\n      if (',' === c) break;\n      if (i === str.length) break;\n    }\n    p.nsp = str.substring(start, i);\n  } else {\n    p.nsp = '/';\n  }\n\n  // look up id\n  var next = str.charAt(i + 1);\n  if ('' !== next && Number(next) == next) {\n    var start = i + 1;\n    while (++i) {\n      var c = str.charAt(i);\n      if (null == c || Number(c) != c) {\n        --i;\n        break;\n      }\n      if (i === str.length) break;\n    }\n    p.id = Number(str.substring(start, i + 1));\n  }\n\n  // look up json data\n  if (str.charAt(++i)) {\n    var payload = tryParse(str.substr(i));\n    var isPayloadValid = payload !== false && (p.type === exports.ERROR || isArray(payload));\n    if (isPayloadValid) {\n      p.data = payload;\n    } else {\n      return error('invalid payload');\n    }\n  }\n\n  debug('decoded %s as %j', str, p);\n  return p;\n}\n\nfunction tryParse(str) {\n  try {\n    return JSON.parse(str);\n  } catch(e){\n    return false;\n  }\n}\n\n/**\n * Deallocates a parser's resources\n *\n * @api public\n */\n\nDecoder.prototype.destroy = function() {\n  if (this.reconstructor) {\n    this.reconstructor.finishedReconstruction();\n  }\n};\n\n/**\n * A manager of a binary event's 'buffer sequence'. Should\n * be constructed whenever a packet of type BINARY_EVENT is\n * decoded.\n *\n * @param {Object} packet\n * @return {BinaryReconstructor} initialized reconstructor\n * @api private\n */\n\nfunction BinaryReconstructor(packet) {\n  this.reconPack = packet;\n  this.buffers = [];\n}\n\n/**\n * Method to be called when binary data received from connection\n * after a BINARY_EVENT packet.\n *\n * @param {Buffer | ArrayBuffer} binData - the raw binary data received\n * @return {null | Object} returns null if more binary data is expected or\n *   a reconstructed packet object if all buffers have been received.\n * @api private\n */\n\nBinaryReconstructor.prototype.takeBinaryData = function(binData) {\n  this.buffers.push(binData);\n  if (this.buffers.length === this.reconPack.attachments) { // done with buffer list\n    var packet = binary.reconstructPacket(this.reconPack, this.buffers);\n    this.finishedReconstruction();\n    return packet;\n  }\n  return null;\n};\n\n/**\n * Cleans up binary packet reconstruction variables.\n *\n * @api private\n */\n\nBinaryReconstructor.prototype.finishedReconstruction = function() {\n  this.reconPack = null;\n  this.buffers = [];\n};\n\nfunction error(msg) {\n  return {\n    type: exports.ERROR,\n    data: 'parser error: ' + msg\n  };\n}\n","/**\n * Parses an URI\n *\n * @author Steven Levithan <stevenlevithan.com> (MIT license)\n * @api private\n */\n\nvar re = /^(?:(?![^:@]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\n\nvar parts = [\n    'source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'\n];\n\nmodule.exports = function parseuri(str) {\n    var src = str,\n        b = str.indexOf('['),\n        e = str.indexOf(']');\n\n    if (b != -1 && e != -1) {\n        str = str.substring(0, b) + str.substring(b, e).replace(/:/g, ';') + str.substring(e, str.length);\n    }\n\n    var m = re.exec(str || ''),\n        uri = {},\n        i = 14;\n\n    while (i--) {\n        uri[parts[i]] = m[i] || '';\n    }\n\n    if (b != -1 && e != -1) {\n        uri.source = src;\n        uri.host = uri.host.substring(1, uri.host.length - 1).replace(/;/g, ':');\n        uri.authority = uri.authority.replace('[', '').replace(']', '').replace(/;/g, ':');\n        uri.ipv6uri = true;\n    }\n\n    uri.pathNames = pathNames(uri, uri['path']);\n    uri.queryKey = queryKey(uri, uri['query']);\n\n    return uri;\n};\n\nfunction pathNames(obj, path) {\n    var regx = /\\/{2,9}/g,\n        names = path.replace(regx, \"/\").split(\"/\");\n\n    if (path.substr(0, 1) == '/' || path.length === 0) {\n        names.splice(0, 1);\n    }\n    if (path.substr(path.length - 1, 1) == '/') {\n        names.splice(names.length - 1, 1);\n    }\n\n    return names;\n}\n\nfunction queryKey(uri, query) {\n    var data = {};\n\n    query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g, function ($0, $1, $2) {\n        if ($1) {\n            data[$1] = $2;\n        }\n    });\n\n    return data;\n}\n","/* global Blob File */\n\n/*\n * Module requirements.\n */\n\nvar isArray = require('isarray');\n\nvar toString = Object.prototype.toString;\nvar withNativeBlob = typeof Blob === 'function' ||\n                        typeof Blob !== 'undefined' && toString.call(Blob) === '[object BlobConstructor]';\nvar withNativeFile = typeof File === 'function' ||\n                        typeof File !== 'undefined' && toString.call(File) === '[object FileConstructor]';\n\n/**\n * Module exports.\n */\n\nmodule.exports = hasBinary;\n\n/**\n * Checks for binary data.\n *\n * Supports Buffer, ArrayBuffer, Blob and File.\n *\n * @param {Object} anything\n * @api public\n */\n\nfunction hasBinary (obj) {\n  if (!obj || typeof obj !== 'object') {\n    return false;\n  }\n\n  if (isArray(obj)) {\n    for (var i = 0, l = obj.length; i < l; i++) {\n      if (hasBinary(obj[i])) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  if ((typeof Buffer === 'function' && Buffer.isBuffer && Buffer.isBuffer(obj)) ||\n    (typeof ArrayBuffer === 'function' && obj instanceof ArrayBuffer) ||\n    (withNativeBlob && obj instanceof Blob) ||\n    (withNativeFile && obj instanceof File)\n  ) {\n    return true;\n  }\n\n  // see: https://github.com/Automattic/has-binary/pull/4\n  if (obj.toJSON && typeof obj.toJSON === 'function' && arguments.length === 1) {\n    return hasBinary(obj.toJSON(), true);\n  }\n\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key) && hasBinary(obj[key])) {\n      return true;\n    }\n  }\n\n  return false;\n}\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isNaN(val) === false) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  if (ms >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (ms >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (ms >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (ms >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  return plural(ms, d, 'day') ||\n    plural(ms, h, 'hour') ||\n    plural(ms, m, 'minute') ||\n    plural(ms, s, 'second') ||\n    ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, n, name) {\n  if (ms < n) {\n    return;\n  }\n  if (ms < n * 1.5) {\n    return Math.floor(ms / n) + ' ' + name;\n  }\n  return Math.ceil(ms / n) + ' ' + name + 's';\n}\n","/**\n * Module dependencies.\n */\n\nvar keys = require('./keys');\nvar hasBinary = require('has-binary2');\nvar sliceBuffer = require('arraybuffer.slice');\nvar after = require('after');\nvar utf8 = require('./utf8');\n\nvar base64encoder;\nif (typeof ArrayBuffer !== 'undefined') {\n  base64encoder = require('base64-arraybuffer');\n}\n\n/**\n * Check if we are running an android browser. That requires us to use\n * ArrayBuffer with polling transports...\n *\n * http://ghinda.net/jpeg-blob-ajax-android/\n */\n\nvar isAndroid = typeof navigator !== 'undefined' && /Android/i.test(navigator.userAgent);\n\n/**\n * Check if we are running in PhantomJS.\n * Uploading a Blob with PhantomJS does not work correctly, as reported here:\n * https://github.com/ariya/phantomjs/issues/11395\n * @type boolean\n */\nvar isPhantomJS = typeof navigator !== 'undefined' && /PhantomJS/i.test(navigator.userAgent);\n\n/**\n * When true, avoids using Blobs to encode payloads.\n * @type boolean\n */\nvar dontSendBlobs = isAndroid || isPhantomJS;\n\n/**\n * Current protocol version.\n */\n\nexports.protocol = 3;\n\n/**\n * Packet types.\n */\n\nvar packets = exports.packets = {\n    open:     0    // non-ws\n  , close:    1    // non-ws\n  , ping:     2\n  , pong:     3\n  , message:  4\n  , upgrade:  5\n  , noop:     6\n};\n\nvar packetslist = keys(packets);\n\n/**\n * Premade error packet.\n */\n\nvar err = { type: 'error', data: 'parser error' };\n\n/**\n * Create a blob api even for blob builder when vendor prefixes exist\n */\n\nvar Blob = require('blob');\n\n/**\n * Encodes a packet.\n *\n *     <packet type id> [ <data> ]\n *\n * Example:\n *\n *     5hello world\n *     3\n *     4\n *\n * Binary is encoded in an identical principle\n *\n * @api private\n */\n\nexports.encodePacket = function (packet, supportsBinary, utf8encode, callback) {\n  if (typeof supportsBinary === 'function') {\n    callback = supportsBinary;\n    supportsBinary = false;\n  }\n\n  if (typeof utf8encode === 'function') {\n    callback = utf8encode;\n    utf8encode = null;\n  }\n\n  var data = (packet.data === undefined)\n    ? undefined\n    : packet.data.buffer || packet.data;\n\n  if (typeof ArrayBuffer !== 'undefined' && data instanceof ArrayBuffer) {\n    return encodeArrayBuffer(packet, supportsBinary, callback);\n  } else if (typeof Blob !== 'undefined' && data instanceof Blob) {\n    return encodeBlob(packet, supportsBinary, callback);\n  }\n\n  // might be an object with { base64: true, data: dataAsBase64String }\n  if (data && data.base64) {\n    return encodeBase64Object(packet, callback);\n  }\n\n  // Sending data as a utf-8 string\n  var encoded = packets[packet.type];\n\n  // data fragment is optional\n  if (undefined !== packet.data) {\n    encoded += utf8encode ? utf8.encode(String(packet.data), { strict: false }) : String(packet.data);\n  }\n\n  return callback('' + encoded);\n\n};\n\nfunction encodeBase64Object(packet, callback) {\n  // packet data is an object { base64: true, data: dataAsBase64String }\n  var message = 'b' + exports.packets[packet.type] + packet.data.data;\n  return callback(message);\n}\n\n/**\n * Encode packet helpers for binary types\n */\n\nfunction encodeArrayBuffer(packet, supportsBinary, callback) {\n  if (!supportsBinary) {\n    return exports.encodeBase64Packet(packet, callback);\n  }\n\n  var data = packet.data;\n  var contentArray = new Uint8Array(data);\n  var resultBuffer = new Uint8Array(1 + data.byteLength);\n\n  resultBuffer[0] = packets[packet.type];\n  for (var i = 0; i < contentArray.length; i++) {\n    resultBuffer[i+1] = contentArray[i];\n  }\n\n  return callback(resultBuffer.buffer);\n}\n\nfunction encodeBlobAsArrayBuffer(packet, supportsBinary, callback) {\n  if (!supportsBinary) {\n    return exports.encodeBase64Packet(packet, callback);\n  }\n\n  var fr = new FileReader();\n  fr.onload = function() {\n    exports.encodePacket({ type: packet.type, data: fr.result }, supportsBinary, true, callback);\n  };\n  return fr.readAsArrayBuffer(packet.data);\n}\n\nfunction encodeBlob(packet, supportsBinary, callback) {\n  if (!supportsBinary) {\n    return exports.encodeBase64Packet(packet, callback);\n  }\n\n  if (dontSendBlobs) {\n    return encodeBlobAsArrayBuffer(packet, supportsBinary, callback);\n  }\n\n  var length = new Uint8Array(1);\n  length[0] = packets[packet.type];\n  var blob = new Blob([length.buffer, packet.data]);\n\n  return callback(blob);\n}\n\n/**\n * Encodes a packet with binary data in a base64 string\n *\n * @param {Object} packet, has `type` and `data`\n * @return {String} base64 encoded message\n */\n\nexports.encodeBase64Packet = function(packet, callback) {\n  var message = 'b' + exports.packets[packet.type];\n  if (typeof Blob !== 'undefined' && packet.data instanceof Blob) {\n    var fr = new FileReader();\n    fr.onload = function() {\n      var b64 = fr.result.split(',')[1];\n      callback(message + b64);\n    };\n    return fr.readAsDataURL(packet.data);\n  }\n\n  var b64data;\n  try {\n    b64data = String.fromCharCode.apply(null, new Uint8Array(packet.data));\n  } catch (e) {\n    // iPhone Safari doesn't let you apply with typed arrays\n    var typed = new Uint8Array(packet.data);\n    var basic = new Array(typed.length);\n    for (var i = 0; i < typed.length; i++) {\n      basic[i] = typed[i];\n    }\n    b64data = String.fromCharCode.apply(null, basic);\n  }\n  message += btoa(b64data);\n  return callback(message);\n};\n\n/**\n * Decodes a packet. Changes format to Blob if requested.\n *\n * @return {Object} with `type` and `data` (if any)\n * @api private\n */\n\nexports.decodePacket = function (data, binaryType, utf8decode) {\n  if (data === undefined) {\n    return err;\n  }\n  // String data\n  if (typeof data === 'string') {\n    if (data.charAt(0) === 'b') {\n      return exports.decodeBase64Packet(data.substr(1), binaryType);\n    }\n\n    if (utf8decode) {\n      data = tryDecode(data);\n      if (data === false) {\n        return err;\n      }\n    }\n    var type = data.charAt(0);\n\n    if (Number(type) != type || !packetslist[type]) {\n      return err;\n    }\n\n    if (data.length > 1) {\n      return { type: packetslist[type], data: data.substring(1) };\n    } else {\n      return { type: packetslist[type] };\n    }\n  }\n\n  var asArray = new Uint8Array(data);\n  var type = asArray[0];\n  var rest = sliceBuffer(data, 1);\n  if (Blob && binaryType === 'blob') {\n    rest = new Blob([rest]);\n  }\n  return { type: packetslist[type], data: rest };\n};\n\nfunction tryDecode(data) {\n  try {\n    data = utf8.decode(data, { strict: false });\n  } catch (e) {\n    return false;\n  }\n  return data;\n}\n\n/**\n * Decodes a packet encoded in a base64 string\n *\n * @param {String} base64 encoded message\n * @return {Object} with `type` and `data` (if any)\n */\n\nexports.decodeBase64Packet = function(msg, binaryType) {\n  var type = packetslist[msg.charAt(0)];\n  if (!base64encoder) {\n    return { type: type, data: { base64: true, data: msg.substr(1) } };\n  }\n\n  var data = base64encoder.decode(msg.substr(1));\n\n  if (binaryType === 'blob' && Blob) {\n    data = new Blob([data]);\n  }\n\n  return { type: type, data: data };\n};\n\n/**\n * Encodes multiple messages (payload).\n *\n *     <length>:data\n *\n * Example:\n *\n *     11:hello world2:hi\n *\n * If any contents are binary, they will be encoded as base64 strings. Base64\n * encoded strings are marked with a b before the length specifier\n *\n * @param {Array} packets\n * @api private\n */\n\nexports.encodePayload = function (packets, supportsBinary, callback) {\n  if (typeof supportsBinary === 'function') {\n    callback = supportsBinary;\n    supportsBinary = null;\n  }\n\n  var isBinary = hasBinary(packets);\n\n  if (supportsBinary && isBinary) {\n    if (Blob && !dontSendBlobs) {\n      return exports.encodePayloadAsBlob(packets, callback);\n    }\n\n    return exports.encodePayloadAsArrayBuffer(packets, callback);\n  }\n\n  if (!packets.length) {\n    return callback('0:');\n  }\n\n  function setLengthHeader(message) {\n    return message.length + ':' + message;\n  }\n\n  function encodeOne(packet, doneCallback) {\n    exports.encodePacket(packet, !isBinary ? false : supportsBinary, false, function(message) {\n      doneCallback(null, setLengthHeader(message));\n    });\n  }\n\n  map(packets, encodeOne, function(err, results) {\n    return callback(results.join(''));\n  });\n};\n\n/**\n * Async array map using after\n */\n\nfunction map(ary, each, done) {\n  var result = new Array(ary.length);\n  var next = after(ary.length, done);\n\n  var eachWithIndex = function(i, el, cb) {\n    each(el, function(error, msg) {\n      result[i] = msg;\n      cb(error, result);\n    });\n  };\n\n  for (var i = 0; i < ary.length; i++) {\n    eachWithIndex(i, ary[i], next);\n  }\n}\n\n/*\n * Decodes data when a payload is maybe expected. Possible binary contents are\n * decoded from their base64 representation\n *\n * @param {String} data, callback method\n * @api public\n */\n\nexports.decodePayload = function (data, binaryType, callback) {\n  if (typeof data !== 'string') {\n    return exports.decodePayloadAsBinary(data, binaryType, callback);\n  }\n\n  if (typeof binaryType === 'function') {\n    callback = binaryType;\n    binaryType = null;\n  }\n\n  var packet;\n  if (data === '') {\n    // parser error - ignoring payload\n    return callback(err, 0, 1);\n  }\n\n  var length = '', n, msg;\n\n  for (var i = 0, l = data.length; i < l; i++) {\n    var chr = data.charAt(i);\n\n    if (chr !== ':') {\n      length += chr;\n      continue;\n    }\n\n    if (length === '' || (length != (n = Number(length)))) {\n      // parser error - ignoring payload\n      return callback(err, 0, 1);\n    }\n\n    msg = data.substr(i + 1, n);\n\n    if (length != msg.length) {\n      // parser error - ignoring payload\n      return callback(err, 0, 1);\n    }\n\n    if (msg.length) {\n      packet = exports.decodePacket(msg, binaryType, false);\n\n      if (err.type === packet.type && err.data === packet.data) {\n        // parser error in individual packet - ignoring payload\n        return callback(err, 0, 1);\n      }\n\n      var ret = callback(packet, i + n, l);\n      if (false === ret) return;\n    }\n\n    // advance cursor\n    i += n;\n    length = '';\n  }\n\n  if (length !== '') {\n    // parser error - ignoring payload\n    return callback(err, 0, 1);\n  }\n\n};\n\n/**\n * Encodes multiple messages (payload) as binary.\n *\n * <1 = binary, 0 = string><number from 0-9><number from 0-9>[...]<number\n * 255><data>\n *\n * Example:\n * 1 3 255 1 2 3, if the binary contents are interpreted as 8 bit integers\n *\n * @param {Array} packets\n * @return {ArrayBuffer} encoded payload\n * @api private\n */\n\nexports.encodePayloadAsArrayBuffer = function(packets, callback) {\n  if (!packets.length) {\n    return callback(new ArrayBuffer(0));\n  }\n\n  function encodeOne(packet, doneCallback) {\n    exports.encodePacket(packet, true, true, function(data) {\n      return doneCallback(null, data);\n    });\n  }\n\n  map(packets, encodeOne, function(err, encodedPackets) {\n    var totalLength = encodedPackets.reduce(function(acc, p) {\n      var len;\n      if (typeof p === 'string'){\n        len = p.length;\n      } else {\n        len = p.byteLength;\n      }\n      return acc + len.toString().length + len + 2; // string/binary identifier + separator = 2\n    }, 0);\n\n    var resultArray = new Uint8Array(totalLength);\n\n    var bufferIndex = 0;\n    encodedPackets.forEach(function(p) {\n      var isString = typeof p === 'string';\n      var ab = p;\n      if (isString) {\n        var view = new Uint8Array(p.length);\n        for (var i = 0; i < p.length; i++) {\n          view[i] = p.charCodeAt(i);\n        }\n        ab = view.buffer;\n      }\n\n      if (isString) { // not true binary\n        resultArray[bufferIndex++] = 0;\n      } else { // true binary\n        resultArray[bufferIndex++] = 1;\n      }\n\n      var lenStr = ab.byteLength.toString();\n      for (var i = 0; i < lenStr.length; i++) {\n        resultArray[bufferIndex++] = parseInt(lenStr[i]);\n      }\n      resultArray[bufferIndex++] = 255;\n\n      var view = new Uint8Array(ab);\n      for (var i = 0; i < view.length; i++) {\n        resultArray[bufferIndex++] = view[i];\n      }\n    });\n\n    return callback(resultArray.buffer);\n  });\n};\n\n/**\n * Encode as Blob\n */\n\nexports.encodePayloadAsBlob = function(packets, callback) {\n  function encodeOne(packet, doneCallback) {\n    exports.encodePacket(packet, true, true, function(encoded) {\n      var binaryIdentifier = new Uint8Array(1);\n      binaryIdentifier[0] = 1;\n      if (typeof encoded === 'string') {\n        var view = new Uint8Array(encoded.length);\n        for (var i = 0; i < encoded.length; i++) {\n          view[i] = encoded.charCodeAt(i);\n        }\n        encoded = view.buffer;\n        binaryIdentifier[0] = 0;\n      }\n\n      var len = (encoded instanceof ArrayBuffer)\n        ? encoded.byteLength\n        : encoded.size;\n\n      var lenStr = len.toString();\n      var lengthAry = new Uint8Array(lenStr.length + 1);\n      for (var i = 0; i < lenStr.length; i++) {\n        lengthAry[i] = parseInt(lenStr[i]);\n      }\n      lengthAry[lenStr.length] = 255;\n\n      if (Blob) {\n        var blob = new Blob([binaryIdentifier.buffer, lengthAry.buffer, encoded]);\n        doneCallback(null, blob);\n      }\n    });\n  }\n\n  map(packets, encodeOne, function(err, results) {\n    return callback(new Blob(results));\n  });\n};\n\n/*\n * Decodes data when a payload is maybe expected. Strings are decoded by\n * interpreting each byte as a key code for entries marked to start with 0. See\n * description of encodePayloadAsBinary\n *\n * @param {ArrayBuffer} data, callback method\n * @api public\n */\n\nexports.decodePayloadAsBinary = function (data, binaryType, callback) {\n  if (typeof binaryType === 'function') {\n    callback = binaryType;\n    binaryType = null;\n  }\n\n  var bufferTail = data;\n  var buffers = [];\n\n  while (bufferTail.byteLength > 0) {\n    var tailArray = new Uint8Array(bufferTail);\n    var isString = tailArray[0] === 0;\n    var msgLength = '';\n\n    for (var i = 1; ; i++) {\n      if (tailArray[i] === 255) break;\n\n      // 310 = char length of Number.MAX_VALUE\n      if (msgLength.length > 310) {\n        return callback(err, 0, 1);\n      }\n\n      msgLength += tailArray[i];\n    }\n\n    bufferTail = sliceBuffer(bufferTail, 2 + msgLength.length);\n    msgLength = parseInt(msgLength);\n\n    var msg = sliceBuffer(bufferTail, 0, msgLength);\n    if (isString) {\n      try {\n        msg = String.fromCharCode.apply(null, new Uint8Array(msg));\n      } catch (e) {\n        // iPhone Safari doesn't let you apply to typed arrays\n        var typed = new Uint8Array(msg);\n        msg = '';\n        for (var i = 0; i < typed.length; i++) {\n          msg += String.fromCharCode(typed[i]);\n        }\n      }\n    }\n\n    buffers.push(msg);\n    bufferTail = sliceBuffer(bufferTail, msgLength);\n  }\n\n  var total = buffers.length;\n  buffers.forEach(function(buffer, i) {\n    callback(exports.decodePacket(buffer, binaryType, true), i, total);\n  });\n};\n","\nmodule.exports = function(a, b){\n  var fn = function(){};\n  fn.prototype = b.prototype;\n  a.prototype = new fn;\n  a.prototype.constructor = a;\n};","/**\n * Module dependencies\n */\n\nvar XMLHttpRequest = require('xmlhttprequest-ssl');\nvar XHR = require('./polling-xhr');\nvar JSONP = require('./polling-jsonp');\nvar websocket = require('./websocket');\n\n/**\n * Export transports.\n */\n\nexports.polling = polling;\nexports.websocket = websocket;\n\n/**\n * Polling transport polymorphic constructor.\n * Decides on xhr vs jsonp based on feature detection.\n *\n * @api private\n */\n\nfunction polling (opts) {\n  var xhr;\n  var xd = false;\n  var xs = false;\n  var jsonp = false !== opts.jsonp;\n\n  if (typeof location !== 'undefined') {\n    var isSSL = 'https:' === location.protocol;\n    var port = location.port;\n\n    // some user agents have empty `location.port`\n    if (!port) {\n      port = isSSL ? 443 : 80;\n    }\n\n    xd = opts.hostname !== location.hostname || port !== opts.port;\n    xs = opts.secure !== isSSL;\n  }\n\n  opts.xdomain = xd;\n  opts.xscheme = xs;\n  xhr = new XMLHttpRequest(opts);\n\n  if ('open' in xhr && !opts.forceJSONP) {\n    return new XHR(opts);\n  } else {\n    if (!jsonp) throw new Error('JSONP disabled');\n    return new JSONP(opts);\n  }\n}\n","\r\n/**\r\n * Expose `Emitter`.\r\n */\r\n\r\nif (typeof module !== 'undefined') {\r\n  module.exports = Emitter;\r\n}\r\n\r\n/**\r\n * Initialize a new `Emitter`.\r\n *\r\n * @api public\r\n */\r\n\r\nfunction Emitter(obj) {\r\n  if (obj) return mixin(obj);\r\n};\r\n\r\n/**\r\n * Mixin the emitter properties.\r\n *\r\n * @param {Object} obj\r\n * @return {Object}\r\n * @api private\r\n */\r\n\r\nfunction mixin(obj) {\r\n  for (var key in Emitter.prototype) {\r\n    obj[key] = Emitter.prototype[key];\r\n  }\r\n  return obj;\r\n}\r\n\r\n/**\r\n * Listen on the given `event` with `fn`.\r\n *\r\n * @param {String} event\r\n * @param {Function} fn\r\n * @return {Emitter}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.on =\r\nEmitter.prototype.addEventListener = function(event, fn){\r\n  this._callbacks = this._callbacks || {};\r\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\r\n    .push(fn);\r\n  return this;\r\n};\r\n\r\n/**\r\n * Adds an `event` listener that will be invoked a single\r\n * time then automatically removed.\r\n *\r\n * @param {String} event\r\n * @param {Function} fn\r\n * @return {Emitter}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.once = function(event, fn){\r\n  function on() {\r\n    this.off(event, on);\r\n    fn.apply(this, arguments);\r\n  }\r\n\r\n  on.fn = fn;\r\n  this.on(event, on);\r\n  return this;\r\n};\r\n\r\n/**\r\n * Remove the given callback for `event` or all\r\n * registered callbacks.\r\n *\r\n * @param {String} event\r\n * @param {Function} fn\r\n * @return {Emitter}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.off =\r\nEmitter.prototype.removeListener =\r\nEmitter.prototype.removeAllListeners =\r\nEmitter.prototype.removeEventListener = function(event, fn){\r\n  this._callbacks = this._callbacks || {};\r\n\r\n  // all\r\n  if (0 == arguments.length) {\r\n    this._callbacks = {};\r\n    return this;\r\n  }\r\n\r\n  // specific event\r\n  var callbacks = this._callbacks['$' + event];\r\n  if (!callbacks) return this;\r\n\r\n  // remove all handlers\r\n  if (1 == arguments.length) {\r\n    delete this._callbacks['$' + event];\r\n    return this;\r\n  }\r\n\r\n  // remove specific handler\r\n  var cb;\r\n  for (var i = 0; i < callbacks.length; i++) {\r\n    cb = callbacks[i];\r\n    if (cb === fn || cb.fn === fn) {\r\n      callbacks.splice(i, 1);\r\n      break;\r\n    }\r\n  }\r\n\r\n  // Remove event specific arrays for event types that no\r\n  // one is subscribed for to avoid memory leak.\r\n  if (callbacks.length === 0) {\r\n    delete this._callbacks['$' + event];\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\n/**\r\n * Emit `event` with the given args.\r\n *\r\n * @param {String} event\r\n * @param {Mixed} ...\r\n * @return {Emitter}\r\n */\r\n\r\nEmitter.prototype.emit = function(event){\r\n  this._callbacks = this._callbacks || {};\r\n\r\n  var args = new Array(arguments.length - 1)\r\n    , callbacks = this._callbacks['$' + event];\r\n\r\n  for (var i = 1; i < arguments.length; i++) {\r\n    args[i - 1] = arguments[i];\r\n  }\r\n\r\n  if (callbacks) {\r\n    callbacks = callbacks.slice(0);\r\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\r\n      callbacks[i].apply(this, args);\r\n    }\r\n  }\r\n\r\n  return this;\r\n};\r\n\r\n/**\r\n * Return array of callbacks for `event`.\r\n *\r\n * @param {String} event\r\n * @return {Array}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.listeners = function(event){\r\n  this._callbacks = this._callbacks || {};\r\n  return this._callbacks['$' + event] || [];\r\n};\r\n\r\n/**\r\n * Check if this emitter has `event` handlers.\r\n *\r\n * @param {String} event\r\n * @return {Boolean}\r\n * @api public\r\n */\r\n\r\nEmitter.prototype.hasListeners = function(event){\r\n  return !! this.listeners(event).length;\r\n};\r\n","\n/**\n * Gets the keys for an object.\n *\n * @return {Array} keys\n * @api private\n */\n\nmodule.exports = Object.keys || function keys (obj){\n  var arr = [];\n  var has = Object.prototype.hasOwnProperty;\n\n  for (var i in obj) {\n    if (has.call(obj, i)) {\n      arr.push(i);\n    }\n  }\n  return arr;\n};\n","\n/**\n * Module dependencies.\n */\n\nvar eio = require('engine.io-client');\nvar Socket = require('./socket');\nvar Emitter = require('component-emitter');\nvar parser = require('socket.io-parser');\nvar on = require('./on');\nvar bind = require('component-bind');\nvar debug = require('debug')('socket.io-client:manager');\nvar indexOf = require('indexof');\nvar Backoff = require('backo2');\n\n/**\n * IE6+ hasOwnProperty\n */\n\nvar has = Object.prototype.hasOwnProperty;\n\n/**\n * Module exports\n */\n\nmodule.exports = Manager;\n\n/**\n * `Manager` constructor.\n *\n * @param {String} engine instance or engine uri/opts\n * @param {Object} options\n * @api public\n */\n\nfunction Manager (uri, opts) {\n  if (!(this instanceof Manager)) return new Manager(uri, opts);\n  if (uri && ('object' === typeof uri)) {\n    opts = uri;\n    uri = undefined;\n  }\n  opts = opts || {};\n\n  opts.path = opts.path || '/socket.io';\n  this.nsps = {};\n  this.subs = [];\n  this.opts = opts;\n  this.reconnection(opts.reconnection !== false);\n  this.reconnectionAttempts(opts.reconnectionAttempts || Infinity);\n  this.reconnectionDelay(opts.reconnectionDelay || 1000);\n  this.reconnectionDelayMax(opts.reconnectionDelayMax || 5000);\n  this.randomizationFactor(opts.randomizationFactor || 0.5);\n  this.backoff = new Backoff({\n    min: this.reconnectionDelay(),\n    max: this.reconnectionDelayMax(),\n    jitter: this.randomizationFactor()\n  });\n  this.timeout(null == opts.timeout ? 20000 : opts.timeout);\n  this.readyState = 'closed';\n  this.uri = uri;\n  this.connecting = [];\n  this.lastPing = null;\n  this.encoding = false;\n  this.packetBuffer = [];\n  var _parser = opts.parser || parser;\n  this.encoder = new _parser.Encoder();\n  this.decoder = new _parser.Decoder();\n  this.autoConnect = opts.autoConnect !== false;\n  if (this.autoConnect) this.open();\n}\n\n/**\n * Propagate given event to sockets and emit on `this`\n *\n * @api private\n */\n\nManager.prototype.emitAll = function () {\n  this.emit.apply(this, arguments);\n  for (var nsp in this.nsps) {\n    if (has.call(this.nsps, nsp)) {\n      this.nsps[nsp].emit.apply(this.nsps[nsp], arguments);\n    }\n  }\n};\n\n/**\n * Update `socket.id` of all sockets\n *\n * @api private\n */\n\nManager.prototype.updateSocketIds = function () {\n  for (var nsp in this.nsps) {\n    if (has.call(this.nsps, nsp)) {\n      this.nsps[nsp].id = this.generateId(nsp);\n    }\n  }\n};\n\n/**\n * generate `socket.id` for the given `nsp`\n *\n * @param {String} nsp\n * @return {String}\n * @api private\n */\n\nManager.prototype.generateId = function (nsp) {\n  return (nsp === '/' ? '' : (nsp + '#')) + this.engine.id;\n};\n\n/**\n * Mix in `Emitter`.\n */\n\nEmitter(Manager.prototype);\n\n/**\n * Sets the `reconnection` config.\n *\n * @param {Boolean} true/false if it should automatically reconnect\n * @return {Manager} self or value\n * @api public\n */\n\nManager.prototype.reconnection = function (v) {\n  if (!arguments.length) return this._reconnection;\n  this._reconnection = !!v;\n  return this;\n};\n\n/**\n * Sets the reconnection attempts config.\n *\n * @param {Number} max reconnection attempts before giving up\n * @return {Manager} self or value\n * @api public\n */\n\nManager.prototype.reconnectionAttempts = function (v) {\n  if (!arguments.length) return this._reconnectionAttempts;\n  this._reconnectionAttempts = v;\n  return this;\n};\n\n/**\n * Sets the delay between reconnections.\n *\n * @param {Number} delay\n * @return {Manager} self or value\n * @api public\n */\n\nManager.prototype.reconnectionDelay = function (v) {\n  if (!arguments.length) return this._reconnectionDelay;\n  this._reconnectionDelay = v;\n  this.backoff && this.backoff.setMin(v);\n  return this;\n};\n\nManager.prototype.randomizationFactor = function (v) {\n  if (!arguments.length) return this._randomizationFactor;\n  this._randomizationFactor = v;\n  this.backoff && this.backoff.setJitter(v);\n  return this;\n};\n\n/**\n * Sets the maximum delay between reconnections.\n *\n * @param {Number} delay\n * @return {Manager} self or value\n * @api public\n */\n\nManager.prototype.reconnectionDelayMax = function (v) {\n  if (!arguments.length) return this._reconnectionDelayMax;\n  this._reconnectionDelayMax = v;\n  this.backoff && this.backoff.setMax(v);\n  return this;\n};\n\n/**\n * Sets the connection timeout. `false` to disable\n *\n * @return {Manager} self or value\n * @api public\n */\n\nManager.prototype.timeout = function (v) {\n  if (!arguments.length) return this._timeout;\n  this._timeout = v;\n  return this;\n};\n\n/**\n * Starts trying to reconnect if reconnection is enabled and we have not\n * started reconnecting yet\n *\n * @api private\n */\n\nManager.prototype.maybeReconnectOnOpen = function () {\n  // Only try to reconnect if it's the first time we're connecting\n  if (!this.reconnecting && this._reconnection && this.backoff.attempts === 0) {\n    // keeps reconnection from firing twice for the same reconnection loop\n    this.reconnect();\n  }\n};\n\n/**\n * Sets the current transport `socket`.\n *\n * @param {Function} optional, callback\n * @return {Manager} self\n * @api public\n */\n\nManager.prototype.open =\nManager.prototype.connect = function (fn, opts) {\n  debug('readyState %s', this.readyState);\n  if (~this.readyState.indexOf('open')) return this;\n\n  debug('opening %s', this.uri);\n  this.engine = eio(this.uri, this.opts);\n  var socket = this.engine;\n  var self = this;\n  this.readyState = 'opening';\n  this.skipReconnect = false;\n\n  // emit `open`\n  var openSub = on(socket, 'open', function () {\n    self.onopen();\n    fn && fn();\n  });\n\n  // emit `connect_error`\n  var errorSub = on(socket, 'error', function (data) {\n    debug('connect_error');\n    self.cleanup();\n    self.readyState = 'closed';\n    self.emitAll('connect_error', data);\n    if (fn) {\n      var err = new Error('Connection error');\n      err.data = data;\n      fn(err);\n    } else {\n      // Only do this if there is no fn to handle the error\n      self.maybeReconnectOnOpen();\n    }\n  });\n\n  // emit `connect_timeout`\n  if (false !== this._timeout) {\n    var timeout = this._timeout;\n    debug('connect attempt will timeout after %d', timeout);\n\n    if (timeout === 0) {\n      openSub.destroy(); // prevents a race condition with the 'open' event\n    }\n\n    // set timer\n    var timer = setTimeout(function () {\n      debug('connect attempt timed out after %d', timeout);\n      openSub.destroy();\n      socket.close();\n      socket.emit('error', 'timeout');\n      self.emitAll('connect_timeout', timeout);\n    }, timeout);\n\n    this.subs.push({\n      destroy: function () {\n        clearTimeout(timer);\n      }\n    });\n  }\n\n  this.subs.push(openSub);\n  this.subs.push(errorSub);\n\n  return this;\n};\n\n/**\n * Called upon transport open.\n *\n * @api private\n */\n\nManager.prototype.onopen = function () {\n  debug('open');\n\n  // clear old subs\n  this.cleanup();\n\n  // mark as open\n  this.readyState = 'open';\n  this.emit('open');\n\n  // add new subs\n  var socket = this.engine;\n  this.subs.push(on(socket, 'data', bind(this, 'ondata')));\n  this.subs.push(on(socket, 'ping', bind(this, 'onping')));\n  this.subs.push(on(socket, 'pong', bind(this, 'onpong')));\n  this.subs.push(on(socket, 'error', bind(this, 'onerror')));\n  this.subs.push(on(socket, 'close', bind(this, 'onclose')));\n  this.subs.push(on(this.decoder, 'decoded', bind(this, 'ondecoded')));\n};\n\n/**\n * Called upon a ping.\n *\n * @api private\n */\n\nManager.prototype.onping = function () {\n  this.lastPing = new Date();\n  this.emitAll('ping');\n};\n\n/**\n * Called upon a packet.\n *\n * @api private\n */\n\nManager.prototype.onpong = function () {\n  this.emitAll('pong', new Date() - this.lastPing);\n};\n\n/**\n * Called with data.\n *\n * @api private\n */\n\nManager.prototype.ondata = function (data) {\n  this.decoder.add(data);\n};\n\n/**\n * Called when parser fully decodes a packet.\n *\n * @api private\n */\n\nManager.prototype.ondecoded = function (packet) {\n  this.emit('packet', packet);\n};\n\n/**\n * Called upon socket error.\n *\n * @api private\n */\n\nManager.prototype.onerror = function (err) {\n  debug('error', err);\n  this.emitAll('error', err);\n};\n\n/**\n * Creates a new socket for the given `nsp`.\n *\n * @return {Socket}\n * @api public\n */\n\nManager.prototype.socket = function (nsp, opts) {\n  var socket = this.nsps[nsp];\n  if (!socket) {\n    socket = new Socket(this, nsp, opts);\n    this.nsps[nsp] = socket;\n    var self = this;\n    socket.on('connecting', onConnecting);\n    socket.on('connect', function () {\n      socket.id = self.generateId(nsp);\n    });\n\n    if (this.autoConnect) {\n      // manually call here since connecting event is fired before listening\n      onConnecting();\n    }\n  }\n\n  function onConnecting () {\n    if (!~indexOf(self.connecting, socket)) {\n      self.connecting.push(socket);\n    }\n  }\n\n  return socket;\n};\n\n/**\n * Called upon a socket close.\n *\n * @param {Socket} socket\n */\n\nManager.prototype.destroy = function (socket) {\n  var index = indexOf(this.connecting, socket);\n  if (~index) this.connecting.splice(index, 1);\n  if (this.connecting.length) return;\n\n  this.close();\n};\n\n/**\n * Writes a packet.\n *\n * @param {Object} packet\n * @api private\n */\n\nManager.prototype.packet = function (packet) {\n  debug('writing packet %j', packet);\n  var self = this;\n  if (packet.query && packet.type === 0) packet.nsp += '?' + packet.query;\n\n  if (!self.encoding) {\n    // encode, then write to engine with result\n    self.encoding = true;\n    this.encoder.encode(packet, function (encodedPackets) {\n      for (var i = 0; i < encodedPackets.length; i++) {\n        self.engine.write(encodedPackets[i], packet.options);\n      }\n      self.encoding = false;\n      self.processPacketQueue();\n    });\n  } else { // add packet to the queue\n    self.packetBuffer.push(packet);\n  }\n};\n\n/**\n * If packet buffer is non-empty, begins encoding the\n * next packet in line.\n *\n * @api private\n */\n\nManager.prototype.processPacketQueue = function () {\n  if (this.packetBuffer.length > 0 && !this.encoding) {\n    var pack = this.packetBuffer.shift();\n    this.packet(pack);\n  }\n};\n\n/**\n * Clean up transport subscriptions and packet buffer.\n *\n * @api private\n */\n\nManager.prototype.cleanup = function () {\n  debug('cleanup');\n\n  var subsLength = this.subs.length;\n  for (var i = 0; i < subsLength; i++) {\n    var sub = this.subs.shift();\n    sub.destroy();\n  }\n\n  this.packetBuffer = [];\n  this.encoding = false;\n  this.lastPing = null;\n\n  this.decoder.destroy();\n};\n\n/**\n * Close the current socket.\n *\n * @api private\n */\n\nManager.prototype.close =\nManager.prototype.disconnect = function () {\n  debug('disconnect');\n  this.skipReconnect = true;\n  this.reconnecting = false;\n  if ('opening' === this.readyState) {\n    // `onclose` will not fire because\n    // an open event never happened\n    this.cleanup();\n  }\n  this.backoff.reset();\n  this.readyState = 'closed';\n  if (this.engine) this.engine.close();\n};\n\n/**\n * Called upon engine close.\n *\n * @api private\n */\n\nManager.prototype.onclose = function (reason) {\n  debug('onclose');\n\n  this.cleanup();\n  this.backoff.reset();\n  this.readyState = 'closed';\n  this.emit('close', reason);\n\n  if (this._reconnection && !this.skipReconnect) {\n    this.reconnect();\n  }\n};\n\n/**\n * Attempt a reconnection.\n *\n * @api private\n */\n\nManager.prototype.reconnect = function () {\n  if (this.reconnecting || this.skipReconnect) return this;\n\n  var self = this;\n\n  if (this.backoff.attempts >= this._reconnectionAttempts) {\n    debug('reconnect failed');\n    this.backoff.reset();\n    this.emitAll('reconnect_failed');\n    this.reconnecting = false;\n  } else {\n    var delay = this.backoff.duration();\n    debug('will wait %dms before reconnect attempt', delay);\n\n    this.reconnecting = true;\n    var timer = setTimeout(function () {\n      if (self.skipReconnect) return;\n\n      debug('attempting reconnect');\n      self.emitAll('reconnect_attempt', self.backoff.attempts);\n      self.emitAll('reconnecting', self.backoff.attempts);\n\n      // check again for the case socket closed in above events\n      if (self.skipReconnect) return;\n\n      self.open(function (err) {\n        if (err) {\n          debug('reconnect attempt error');\n          self.reconnecting = false;\n          self.reconnect();\n          self.emitAll('reconnect_error', err.data);\n        } else {\n          debug('reconnect success');\n          self.onreconnect();\n        }\n      });\n    }, delay);\n\n    this.subs.push({\n      destroy: function () {\n        clearTimeout(timer);\n      }\n    });\n  }\n};\n\n/**\n * Called upon successful reconnect.\n *\n * @api private\n */\n\nManager.prototype.onreconnect = function () {\n  var attempt = this.backoff.attempts;\n  this.reconnecting = false;\n  this.backoff.reset();\n  this.updateSocketIds();\n  this.emitAll('reconnect', attempt);\n};\n","/* build: `node build.js modules=ALL exclude=gestures,accessors,erasing requirejs minifier=uglifyjs` */\n/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */\n\nvar fabric = fabric || { version: '4.5.1' };\nif (typeof exports !== 'undefined') {\n  exports.fabric = fabric;\n}\n/* _AMD_START_ */\nelse if (typeof define === 'function' && define.amd) {\n  define([], function() { return fabric; });\n}\n/* _AMD_END_ */\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  if (document instanceof (typeof HTMLDocument !== 'undefined' ? HTMLDocument : Document)) {\n    fabric.document = document;\n  }\n  else {\n    fabric.document = document.implementation.createHTMLDocument('');\n  }\n  fabric.window = window;\n}\nelse {\n  // assume we're running under node.js when document/window are not present\n  var jsdom = require('jsdom');\n  var virtualWindow = new jsdom.JSDOM(\n    decodeURIComponent('%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E'),\n    {\n      features: {\n        FetchExternalResources: ['img']\n      },\n      resources: 'usable'\n    }).window;\n  fabric.document = virtualWindow.document;\n  fabric.jsdomImplForWrapper = require('jsdom/lib/jsdom/living/generated/utils').implForWrapper;\n  fabric.nodeCanvas = require('jsdom/lib/jsdom/utils').Canvas;\n  fabric.window = virtualWindow;\n  DOMParser = fabric.window.DOMParser;\n}\n\n/**\n * True when in environment that supports touch events\n * @type boolean\n */\nfabric.isTouchSupported = 'ontouchstart' in fabric.window || 'ontouchstart' in fabric.document ||\n  (fabric.window && fabric.window.navigator && fabric.window.navigator.maxTouchPoints > 0);\n\n/**\n * True when in environment that's probably Node.js\n * @type boolean\n */\nfabric.isLikelyNode = typeof Buffer !== 'undefined' &&\n                      typeof window === 'undefined';\n\n/* _FROM_SVG_START_ */\n/**\n * Attributes parsed from all SVG elements\n * @type array\n */\nfabric.SHARED_ATTRIBUTES = [\n  'display',\n  'transform',\n  'fill', 'fill-opacity', 'fill-rule',\n  'opacity',\n  'stroke', 'stroke-dasharray', 'stroke-linecap', 'stroke-dashoffset',\n  'stroke-linejoin', 'stroke-miterlimit',\n  'stroke-opacity', 'stroke-width',\n  'id', 'paint-order', 'vector-effect',\n  'instantiated_by_use', 'clip-path',\n];\n/* _FROM_SVG_END_ */\n\n/**\n * Pixel per Inch as a default value set to 96. Can be changed for more realistic conversion.\n */\nfabric.DPI = 96;\nfabric.reNum = '(?:[-+]?(?:\\\\d+|\\\\d*\\\\.\\\\d+)(?:[eE][-+]?\\\\d+)?)';\nfabric.commaWsp = '(?:\\\\s+,?\\\\s*|,\\\\s*)';\nfabric.rePathCommand = /([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:[eE][-+]?\\d+)?)/ig;\nfabric.reNonWord = /[ \\n\\.,;!\\?\\-]/;\nfabric.fontPaths = { };\nfabric.iMatrix = [1, 0, 0, 1, 0, 0];\nfabric.svgNS = 'http://www.w3.org/2000/svg';\n\n/**\n * Pixel limit for cache canvases. 1Mpx , 4Mpx should be fine.\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.perfLimitSizeTotal = 2097152;\n\n/**\n * Pixel limit for cache canvases width or height. IE fixes the maximum at 5000\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.maxCacheSideLimit = 4096;\n\n/**\n * Lowest pixel limit for cache canvases, set at 256PX\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.minCacheSideLimit = 256;\n\n/**\n * Cache Object for widths of chars in text rendering.\n */\nfabric.charWidthsCache = { };\n\n/**\n * if webgl is enabled and available, textureSize will determine the size\n * of the canvas backend\n * @since 2.0.0\n * @type Number\n * @default\n */\nfabric.textureSize = 2048;\n\n/**\n * When 'true', style information is not retained when copy/pasting text, making\n * pasted text use destination style.\n * Defaults to 'false'.\n * @type Boolean\n * @default\n */\nfabric.disableStyleCopyPaste = false;\n\n/**\n * Enable webgl for filtering picture is available\n * A filtering backend will be initialized, this will both take memory and\n * time since a default 2048x2048 canvas will be created for the gl context\n * @since 2.0.0\n * @type Boolean\n * @default\n */\nfabric.enableGLFiltering = true;\n\n/**\n * Device Pixel Ratio\n * @see https://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/HTML-canvas-guide/SettingUptheCanvas/SettingUptheCanvas.html\n */\nfabric.devicePixelRatio = fabric.window.devicePixelRatio ||\n                          fabric.window.webkitDevicePixelRatio ||\n                          fabric.window.mozDevicePixelRatio ||\n                          1;\n/**\n * Browser-specific constant to adjust CanvasRenderingContext2D.shadowBlur value,\n * which is unitless and not rendered equally across browsers.\n *\n * Values that work quite well (as of October 2017) are:\n * - Chrome: 1.5\n * - Edge: 1.75\n * - Firefox: 0.9\n * - Safari: 0.95\n *\n * @since 2.0.0\n * @type Number\n * @default 1\n */\nfabric.browserShadowBlurConstant = 1;\n\n/**\n * This object contains the result of arc to bezier conversion for faster retrieving if the same arc needs to be converted again.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.arcToSegmentsCache = { };\n\n/**\n * This object keeps the results of the boundsOfCurve calculation mapped by the joined arguments necessary to calculate it.\n * It does speed up calculation, if you parse and add always the same paths, but in case of heavy usage of freedrawing\n * you do not get any speed benefit and you get a big object in memory.\n * The object was a private variable before, while now is appended to the lib so that you have access to it and you\n * can eventually clear it.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.boundsOfCurveCache = { };\n\n/**\n * If disabled boundsOfCurveCache is not used. For apps that make heavy usage of pencil drawing probably disabling it is better\n * @default true\n */\nfabric.cachesBoundsOfCurve = true;\n\n/**\n * Skip performance testing of setupGLContext and force the use of putImageData that seems to be the one that works best on\n * Chrome + old hardware. if your users are experiencing empty images after filtering you may try to force this to true\n * this has to be set before instantiating the filtering backend ( before filtering the first image )\n * @type Boolean\n * @default false\n */\nfabric.forceGLPutImageData = false;\n\nfabric.initFilterBackend = function() {\n  if (fabric.enableGLFiltering && fabric.isWebglSupported && fabric.isWebglSupported(fabric.textureSize)) {\n    console.log('max texture size: ' + fabric.maxTextureSize);\n    return (new fabric.WebglFilterBackend({ tileSize: fabric.textureSize }));\n  }\n  else if (fabric.Canvas2dFilterBackend) {\n    return (new fabric.Canvas2dFilterBackend());\n  }\n};\n\n\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  // ensure globality even if entire library were function wrapped (as in Meteor.js packaging system)\n  window.fabric = fabric;\n}\n\n\n(function() {\n\n  /**\n   * @private\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  function _removeEventListener(eventName, handler) {\n    if (!this.__eventListeners[eventName]) {\n      return;\n    }\n    var eventListener = this.__eventListeners[eventName];\n    if (handler) {\n      eventListener[eventListener.indexOf(handler)] = false;\n    }\n    else {\n      fabric.util.array.fill(eventListener, false);\n    }\n  }\n\n  /**\n   * Observes specified event\n   * @memberOf fabric.Observable\n   * @alias on\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function that receives a notification when an event of the specified type occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function on(eventName, handler) {\n    if (!this.__eventListeners) {\n      this.__eventListeners = { };\n    }\n    // one object with key/value pairs was passed\n    if (arguments.length === 1) {\n      for (var prop in eventName) {\n        this.on(prop, eventName[prop]);\n      }\n    }\n    else {\n      if (!this.__eventListeners[eventName]) {\n        this.__eventListeners[eventName] = [];\n      }\n      this.__eventListeners[eventName].push(handler);\n    }\n    return this;\n  }\n\n  /**\n   * Stops event observing for a particular event handler. Calling this method\n   * without arguments removes all handlers for all events\n   * @memberOf fabric.Observable\n   * @alias off\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function to be deleted from EventListeners\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function off(eventName, handler) {\n    if (!this.__eventListeners) {\n      return this;\n    }\n\n    // remove all key/value pairs (event name -> event handler)\n    if (arguments.length === 0) {\n      for (eventName in this.__eventListeners) {\n        _removeEventListener.call(this, eventName);\n      }\n    }\n    // one object with key/value pairs was passed\n    else if (arguments.length === 1 && typeof arguments[0] === 'object') {\n      for (var prop in eventName) {\n        _removeEventListener.call(this, prop, eventName[prop]);\n      }\n    }\n    else {\n      _removeEventListener.call(this, eventName, handler);\n    }\n    return this;\n  }\n\n  /**\n   * Fires event with an optional options object\n   * @memberOf fabric.Observable\n   * @param {String} eventName Event name to fire\n   * @param {Object} [options] Options object\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function fire(eventName, options) {\n    if (!this.__eventListeners) {\n      return this;\n    }\n\n    var listenersForEvent = this.__eventListeners[eventName];\n    if (!listenersForEvent) {\n      return this;\n    }\n\n    for (var i = 0, len = listenersForEvent.length; i < len; i++) {\n      listenersForEvent[i] && listenersForEvent[i].call(this, options || { });\n    }\n    this.__eventListeners[eventName] = listenersForEvent.filter(function(value) {\n      return value !== false;\n    });\n    return this;\n  }\n\n  /**\n   * @namespace fabric.Observable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#events}\n   * @see {@link http://fabricjs.com/events|Events demo}\n   */\n  fabric.Observable = {\n    fire: fire,\n    on: on,\n    off: off,\n  };\n})();\n\n\n/**\n * @namespace fabric.Collection\n */\nfabric.Collection = {\n\n  _objects: [],\n\n  /**\n   * Adds objects to collection, Canvas or Group, then renders canvas\n   * (if `renderOnAddRemove` is not `false`).\n   * in case of Group no changes to bounding box are made.\n   * Objects should be instances of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the add method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  add: function () {\n    this._objects.push.apply(this._objects, arguments);\n    if (this._onObjectAdded) {\n      for (var i = 0, length = arguments.length; i < length; i++) {\n        this._onObjectAdded(arguments[i]);\n      }\n    }\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Inserts an object into collection at specified index, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * An object should be an instance of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the insertAt method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {Object} object Object to insert\n   * @param {Number} index Index to insert object at\n   * @param {Boolean} nonSplicing When `true`, no splicing (shifting) of objects occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  insertAt: function (object, index, nonSplicing) {\n    var objects = this._objects;\n    if (nonSplicing) {\n      objects[index] = object;\n    }\n    else {\n      objects.splice(index, 0, object);\n    }\n    this._onObjectAdded && this._onObjectAdded(object);\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Removes objects from a collection, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  remove: function() {\n    var objects = this._objects,\n        index, somethingRemoved = false;\n\n    for (var i = 0, length = arguments.length; i < length; i++) {\n      index = objects.indexOf(arguments[i]);\n\n      // only call onObjectRemoved if an object was actually removed\n      if (index !== -1) {\n        somethingRemoved = true;\n        objects.splice(index, 1);\n        this._onObjectRemoved && this._onObjectRemoved(arguments[i]);\n      }\n    }\n\n    this.renderOnAddRemove && somethingRemoved && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Executes given function for each object in this group\n   * @param {Function} callback\n   *                   Callback invoked with current object as first argument,\n   *                   index - as second and an array of all objects - as third.\n   *                   Callback is invoked in a context of Global Object (e.g. `window`)\n   *                   when no `context` argument is given\n   *\n   * @param {Object} context Context (aka thisObject)\n   * @return {Self} thisArg\n   * @chainable\n   */\n  forEachObject: function(callback, context) {\n    var objects = this.getObjects();\n    for (var i = 0, len = objects.length; i < len; i++) {\n      callback.call(context, objects[i], i, objects);\n    }\n    return this;\n  },\n\n  /**\n   * Returns an array of children objects of this instance\n   * Type parameter introduced in 1.3.10\n   * since 2.3.5 this method return always a COPY of the array;\n   * @param {String} [type] When specified, only objects of this type are returned\n   * @return {Array}\n   */\n  getObjects: function(type) {\n    if (typeof type === 'undefined') {\n      return this._objects.concat();\n    }\n    return this._objects.filter(function(o) {\n      return o.type === type;\n    });\n  },\n\n  /**\n   * Returns object at specified index\n   * @param {Number} index\n   * @return {Self} thisArg\n   */\n  item: function (index) {\n    return this._objects[index];\n  },\n\n  /**\n   * Returns true if collection contains no objects\n   * @return {Boolean} true if collection is empty\n   */\n  isEmpty: function () {\n    return this._objects.length === 0;\n  },\n\n  /**\n   * Returns a size of a collection (i.e: length of an array containing its objects)\n   * @return {Number} Collection size\n   */\n  size: function() {\n    return this._objects.length;\n  },\n\n  /**\n   * Returns true if collection contains an object\n   * @param {Object} object Object to check against\n   * @return {Boolean} `true` if collection contains an object\n   */\n  contains: function(object) {\n    return this._objects.indexOf(object) > -1;\n  },\n\n  /**\n   * Returns number representation of a collection complexity\n   * @return {Number} complexity\n   */\n  complexity: function () {\n    return this._objects.reduce(function (memo, current) {\n      memo += current.complexity ? current.complexity() : 0;\n      return memo;\n    }, 0);\n  }\n};\n\n\n/**\n * @namespace fabric.CommonMethods\n */\nfabric.CommonMethods = {\n\n  /**\n   * Sets object's properties from options\n   * @param {Object} [options] Options object\n   */\n  _setOptions: function(options) {\n    for (var prop in options) {\n      this.set(prop, options[prop]);\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Gradient to\n   */\n  _initGradient: function(filler, property) {\n    if (filler && filler.colorStops && !(filler instanceof fabric.Gradient)) {\n      this.set(property, new fabric.Gradient(filler));\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Pattern to\n   * @param {Function} [callback] callback to invoke after pattern load\n   */\n  _initPattern: function(filler, property, callback) {\n    if (filler && filler.source && !(filler instanceof fabric.Pattern)) {\n      this.set(property, new fabric.Pattern(filler, callback));\n    }\n    else {\n      callback && callback();\n    }\n  },\n\n  /**\n   * @private\n   */\n  _setObject: function(obj) {\n    for (var prop in obj) {\n      this._set(prop, obj[prop]);\n    }\n  },\n\n  /**\n   * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n   * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n   * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  set: function(key, value) {\n    if (typeof key === 'object') {\n      this._setObject(key);\n    }\n    else {\n      this._set(key, value);\n    }\n    return this;\n  },\n\n  _set: function(key, value) {\n    this[key] = value;\n  },\n\n  /**\n   * Toggles specified property from `true` to `false` or from `false` to `true`\n   * @param {String} property Property to toggle\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  toggle: function(property) {\n    var value = this.get(property);\n    if (typeof value === 'boolean') {\n      this.set(property, !value);\n    }\n    return this;\n  },\n\n  /**\n   * Basic getter\n   * @param {String} property Property name\n   * @return {*} value of a property\n   */\n  get: function(property) {\n    return this[property];\n  }\n};\n\n\n(function(global) {\n\n  var sqrt = Math.sqrt,\n      atan2 = Math.atan2,\n      pow = Math.pow,\n      PiBy180 = Math.PI / 180,\n      PiBy2 = Math.PI / 2;\n\n  /**\n   * @namespace fabric.util\n   */\n  fabric.util = {\n\n    /**\n     * Calculate the cos of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    cos: function(angle) {\n      if (angle === 0) { return 1; }\n      if (angle < 0) {\n        // cos(a) = cos(-a)\n        angle = -angle;\n      }\n      var angleSlice = angle / PiBy2;\n      switch (angleSlice) {\n        case 1: case 3: return 0;\n        case 2: return -1;\n      }\n      return Math.cos(angle);\n    },\n\n    /**\n     * Calculate the sin of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    sin: function(angle) {\n      if (angle === 0) { return 0; }\n      var angleSlice = angle / PiBy2, sign = 1;\n      if (angle < 0) {\n        // sin(-a) = -sin(a)\n        sign = -1;\n      }\n      switch (angleSlice) {\n        case 1: return sign;\n        case 2: return 0;\n        case 3: return -sign;\n      }\n      return Math.sin(angle);\n    },\n\n    /**\n     * Removes value from an array.\n     * Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} array\n     * @param {*} value\n     * @return {Array} original array\n     */\n    removeFromArray: function(array, value) {\n      var idx = array.indexOf(value);\n      if (idx !== -1) {\n        array.splice(idx, 1);\n      }\n      return array;\n    },\n\n    /**\n     * Returns random number between 2 specified ones.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} min lower limit\n     * @param {Number} max upper limit\n     * @return {Number} random value (between min and max)\n     */\n    getRandomInt: function(min, max) {\n      return Math.floor(Math.random() * (max - min + 1)) + min;\n    },\n\n    /**\n     * Transforms degrees to radians.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} degrees value in degrees\n     * @return {Number} value in radians\n     */\n    degreesToRadians: function(degrees) {\n      return degrees * PiBy180;\n    },\n\n    /**\n     * Transforms radians to degrees.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} radians value in radians\n     * @return {Number} value in degrees\n     */\n    radiansToDegrees: function(radians) {\n      return radians / PiBy180;\n    },\n\n    /**\n     * Rotates `point` around `origin` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {fabric.Point} point The point to rotate\n     * @param {fabric.Point} origin The origin of the rotation\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {fabric.Point} The new rotated point\n     */\n    rotatePoint: function(point, origin, radians) {\n      var newPoint = new fabric.Point(point.x - origin.x, point.y - origin.y),\n          v = fabric.util.rotateVector(newPoint, radians);\n      return new fabric.Point(v.x, v.y).addEquals(origin);\n    },\n\n    /**\n     * Rotates `vector` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} vector The vector to rotate (x and y)\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {Object} The new rotated point\n     */\n    rotateVector: function(vector, radians) {\n      var sin = fabric.util.sin(radians),\n          cos = fabric.util.cos(radians),\n          rx = vector.x * cos - vector.y * sin,\n          ry = vector.x * sin + vector.y * cos;\n      return {\n        x: rx,\n        y: ry\n      };\n    },\n\n    /**\n     * Apply transform t to point p\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Point} p The point to transform\n     * @param  {Array} t The transform\n     * @param  {Boolean} [ignoreOffset] Indicates that the offset should not be applied\n     * @return {fabric.Point} The transformed point\n     */\n    transformPoint: function(p, t, ignoreOffset) {\n      if (ignoreOffset) {\n        return new fabric.Point(\n          t[0] * p.x + t[2] * p.y,\n          t[1] * p.x + t[3] * p.y\n        );\n      }\n      return new fabric.Point(\n        t[0] * p.x + t[2] * p.y + t[4],\n        t[1] * p.x + t[3] * p.y + t[5]\n      );\n    },\n\n    /**\n     * Returns coordinates of points's bounding rectangle (left, top, width, height)\n     * @param {Array} points 4 points array\n     * @param {Array} [transform] an array of 6 numbers representing a 2x3 transform matrix\n     * @return {Object} Object with left, top, width, height properties\n     */\n    makeBoundingBoxFromPoints: function(points, transform) {\n      if (transform) {\n        for (var i = 0; i < points.length; i++) {\n          points[i] = fabric.util.transformPoint(points[i], transform);\n        }\n      }\n      var xPoints = [points[0].x, points[1].x, points[2].x, points[3].x],\n          minX = fabric.util.array.min(xPoints),\n          maxX = fabric.util.array.max(xPoints),\n          width = maxX - minX,\n          yPoints = [points[0].y, points[1].y, points[2].y, points[3].y],\n          minY = fabric.util.array.min(yPoints),\n          maxY = fabric.util.array.max(yPoints),\n          height = maxY - minY;\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height\n      };\n    },\n\n    /**\n     * Invert transformation t\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} t The transform\n     * @return {Array} The inverted transform\n     */\n    invertTransform: function(t) {\n      var a = 1 / (t[0] * t[3] - t[1] * t[2]),\n          r = [a * t[3], -a * t[1], -a * t[2], a * t[0]],\n          o = fabric.util.transformPoint({ x: t[4], y: t[5] }, r, true);\n      r[4] = -o.x;\n      r[5] = -o.y;\n      return r;\n    },\n\n    /**\n     * A wrapper around Number#toFixed, which contrary to native method returns number, not string.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number|String} number number to operate on\n     * @param {Number} fractionDigits number of fraction digits to \"leave\"\n     * @return {Number}\n     */\n    toFixed: function(number, fractionDigits) {\n      return parseFloat(Number(number).toFixed(fractionDigits));\n    },\n\n    /**\n     * Converts from attribute value to pixel value if applicable.\n     * Returns converted pixels or original value not converted.\n     * @param {Number|String} value number to operate on\n     * @param {Number} fontSize\n     * @return {Number|String}\n     */\n    parseUnit: function(value, fontSize) {\n      var unit = /\\D{0,2}$/.exec(value),\n          number = parseFloat(value);\n      if (!fontSize) {\n        fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      }\n      switch (unit[0]) {\n        case 'mm':\n          return number * fabric.DPI / 25.4;\n\n        case 'cm':\n          return number * fabric.DPI / 2.54;\n\n        case 'in':\n          return number * fabric.DPI;\n\n        case 'pt':\n          return number * fabric.DPI / 72; // or * 4 / 3\n\n        case 'pc':\n          return number * fabric.DPI / 72 * 12; // or * 16\n\n        case 'em':\n          return number * fontSize;\n\n        default:\n          return number;\n      }\n    },\n\n    /**\n     * Function which always returns `false`.\n     * @static\n     * @memberOf fabric.util\n     * @return {Boolean}\n     */\n    falseFunction: function() {\n      return false;\n    },\n\n    /**\n     * Returns klass \"Class\" object of given namespace\n     * @memberOf fabric.util\n     * @param {String} type Type of object (eg. 'circle')\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @return {Object} klass \"Class\"\n     */\n    getKlass: function(type, namespace) {\n      // capitalize first letter only\n      type = fabric.util.string.camelize(type.charAt(0).toUpperCase() + type.slice(1));\n      return fabric.util.resolveNamespace(namespace)[type];\n    },\n\n    /**\n     * Returns array of attributes for given svg that fabric parses\n     * @memberOf fabric.util\n     * @param {String} type Type of svg element (eg. 'circle')\n     * @return {Array} string names of supported attributes\n     */\n    getSvgAttributes: function(type) {\n      var attributes = [\n        'instantiated_by_use',\n        'style',\n        'id',\n        'class'\n      ];\n      switch (type) {\n        case 'linearGradient':\n          attributes = attributes.concat(['x1', 'y1', 'x2', 'y2', 'gradientUnits', 'gradientTransform']);\n          break;\n        case 'radialGradient':\n          attributes = attributes.concat(['gradientUnits', 'gradientTransform', 'cx', 'cy', 'r', 'fx', 'fy', 'fr']);\n          break;\n        case 'stop':\n          attributes = attributes.concat(['offset', 'stop-color', 'stop-opacity']);\n          break;\n      }\n      return attributes;\n    },\n\n    /**\n     * Returns object of given namespace\n     * @memberOf fabric.util\n     * @param {String} namespace Namespace string e.g. 'fabric.Image.filter' or 'fabric'\n     * @return {Object} Object for given namespace (default fabric)\n     */\n    resolveNamespace: function(namespace) {\n      if (!namespace) {\n        return fabric;\n      }\n\n      var parts = namespace.split('.'),\n          len = parts.length, i,\n          obj = global || fabric.window;\n\n      for (i = 0; i < len; ++i) {\n        obj = obj[parts[i]];\n      }\n\n      return obj;\n    },\n\n    /**\n     * Loads image element from given url and passes it to a callback\n     * @memberOf fabric.util\n     * @param {String} url URL representing an image\n     * @param {Function} callback Callback; invoked with loaded image\n     * @param {*} [context] Context to invoke callback in\n     * @param {Object} [crossOrigin] crossOrigin value to set image element to\n     */\n    loadImage: function(url, callback, context, crossOrigin) {\n      if (!url) {\n        callback && callback.call(context, url);\n        return;\n      }\n\n      var img = fabric.util.createImage();\n\n      /** @ignore */\n      var onLoadCallback = function () {\n        callback && callback.call(context, img, false);\n        img = img.onload = img.onerror = null;\n      };\n\n      img.onload = onLoadCallback;\n      /** @ignore */\n      img.onerror = function() {\n        fabric.log('Error loading ' + img.src);\n        callback && callback.call(context, null, true);\n        img = img.onload = img.onerror = null;\n      };\n\n      // data-urls appear to be buggy with crossOrigin\n      // https://github.com/kangax/fabric.js/commit/d0abb90f1cd5c5ef9d2a94d3fb21a22330da3e0a#commitcomment-4513767\n      // see https://code.google.com/p/chromium/issues/detail?id=315152\n      //     https://bugzilla.mozilla.org/show_bug.cgi?id=935069\n      // crossOrigin null is the same as not set.\n      if (url.indexOf('data') !== 0 &&\n        crossOrigin !== undefined &&\n        crossOrigin !== null) {\n        img.crossOrigin = crossOrigin;\n      }\n\n      // IE10 / IE11-Fix: SVG contents from data: URI\n      // will only be available if the IMG is present\n      // in the DOM (and visible)\n      if (url.substring(0,14) === 'data:image/svg') {\n        img.onload = null;\n        fabric.util.loadImageInDom(img, onLoadCallback);\n      }\n\n      img.src = url;\n    },\n\n    /**\n     * Attaches SVG image with data: URL to the dom\n     * @memberOf fabric.util\n     * @param {Object} img Image object with data:image/svg src\n     * @param {Function} callback Callback; invoked with loaded image\n     * @return {Object} DOM element (div containing the SVG image)\n     */\n    loadImageInDom: function(img, onLoadCallback) {\n      var div = fabric.document.createElement('div');\n      div.style.width = div.style.height = '1px';\n      div.style.left = div.style.top = '-100%';\n      div.style.position = 'absolute';\n      div.appendChild(img);\n      fabric.document.querySelector('body').appendChild(div);\n      /**\n       * Wrap in function to:\n       *   1. Call existing callback\n       *   2. Cleanup DOM\n       */\n      img.onload = function () {\n        onLoadCallback();\n        div.parentNode.removeChild(div);\n        div = null;\n      };\n    },\n\n    /**\n     * Creates corresponding fabric instances from their object representations\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} objects Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @param {Function} reviver Method for further parsing of object elements,\n     * called after each fabric object created.\n     */\n    enlivenObjects: function(objects, callback, namespace, reviver) {\n      objects = objects || [];\n\n      var enlivenedObjects = [],\n          numLoadedObjects = 0,\n          numTotalObjects = objects.length;\n\n      function onLoaded() {\n        if (++numLoadedObjects === numTotalObjects) {\n          callback && callback(enlivenedObjects.filter(function(obj) {\n            // filter out undefined objects (objects that gave error)\n            return obj;\n          }));\n        }\n      }\n\n      if (!numTotalObjects) {\n        callback && callback(enlivenedObjects);\n        return;\n      }\n\n      objects.forEach(function (o, index) {\n        // if sparse array\n        if (!o || !o.type) {\n          onLoaded();\n          return;\n        }\n        var klass = fabric.util.getKlass(o.type, namespace);\n        klass.fromObject(o, function (obj, error) {\n          error || (enlivenedObjects[index] = obj);\n          reviver && reviver(o, obj, error);\n          onLoaded();\n        });\n      });\n    },\n\n    /**\n     * Create and wait for loading of patterns\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} patterns Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * called after each fabric object created.\n     */\n    enlivenPatterns: function(patterns, callback) {\n      patterns = patterns || [];\n\n      function onLoaded() {\n        if (++numLoadedPatterns === numPatterns) {\n          callback && callback(enlivenedPatterns);\n        }\n      }\n\n      var enlivenedPatterns = [],\n          numLoadedPatterns = 0,\n          numPatterns = patterns.length;\n\n      if (!numPatterns) {\n        callback && callback(enlivenedPatterns);\n        return;\n      }\n\n      patterns.forEach(function (p, index) {\n        if (p && p.source) {\n          new fabric.Pattern(p, function(pattern) {\n            enlivenedPatterns[index] = pattern;\n            onLoaded();\n          });\n        }\n        else {\n          enlivenedPatterns[index] = p;\n          onLoaded();\n        }\n      });\n    },\n\n    /**\n     * Groups SVG elements (usually those retrieved from SVG document)\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} elements SVG elements to group\n     * @param {Object} [options] Options object\n     * @param {String} path Value to set sourcePath to\n     * @return {fabric.Object|fabric.Group}\n     */\n    groupSVGElements: function(elements, options, path) {\n      var object;\n      if (elements && elements.length === 1) {\n        return elements[0];\n      }\n      if (options) {\n        if (options.width && options.height) {\n          options.centerPoint = {\n            x: options.width / 2,\n            y: options.height / 2\n          };\n        }\n        else {\n          delete options.width;\n          delete options.height;\n        }\n      }\n      object = new fabric.Group(elements, options);\n      if (typeof path !== 'undefined') {\n        object.sourcePath = path;\n      }\n      return object;\n    },\n\n    /**\n     * Populates an object with properties of another object\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} source Source object\n     * @param {Object} destination Destination object\n     * @return {Array} properties Properties names to include\n     */\n    populateWithProperties: function(source, destination, properties) {\n      if (properties && Object.prototype.toString.call(properties) === '[object Array]') {\n        for (var i = 0, len = properties.length; i < len; i++) {\n          if (properties[i] in source) {\n            destination[properties[i]] = source[properties[i]];\n          }\n        }\n      }\n    },\n\n    /**\n     * Draws a dashed line between two points\n     *\n     * This method is used to draw dashed line around selection area.\n     * See <a href=\"http://stackoverflow.com/questions/4576724/dotted-stroke-in-canvas\">dotted stroke in canvas</a>\n     *\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x  start x coordinate\n     * @param {Number} y start y coordinate\n     * @param {Number} x2 end x coordinate\n     * @param {Number} y2 end y coordinate\n     * @param {Array} da dash array pattern\n     */\n    drawDashedLine: function(ctx, x, y, x2, y2, da) {\n      var dx = x2 - x,\n          dy = y2 - y,\n          len = sqrt(dx * dx + dy * dy),\n          rot = atan2(dy, dx),\n          dc = da.length,\n          di = 0,\n          draw = true;\n\n      ctx.save();\n      ctx.translate(x, y);\n      ctx.moveTo(0, 0);\n      ctx.rotate(rot);\n\n      x = 0;\n      while (len > x) {\n        x += da[di++ % dc];\n        if (x > len) {\n          x = len;\n        }\n        ctx[draw ? 'lineTo' : 'moveTo'](x, 0);\n        draw = !draw;\n      }\n\n      ctx.restore();\n    },\n\n    /**\n     * Creates canvas element\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    createCanvasElement: function() {\n      return fabric.document.createElement('canvas');\n    },\n\n    /**\n     * Creates a canvas element that is a copy of another and is also painted\n     * @param {CanvasElement} canvas to copy size and content of\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    copyCanvasElement: function(canvas) {\n      var newCanvas = fabric.util.createCanvasElement();\n      newCanvas.width = canvas.width;\n      newCanvas.height = canvas.height;\n      newCanvas.getContext('2d').drawImage(canvas, 0, 0);\n      return newCanvas;\n    },\n\n    /**\n     * since 2.6.0 moved from canvas instance to utility.\n     * @param {CanvasElement} canvasEl to copy size and content of\n     * @param {String} format 'jpeg' or 'png', in some browsers 'webp' is ok too\n     * @param {Number} quality <= 1 and > 0\n     * @static\n     * @memberOf fabric.util\n     * @return {String} data url\n     */\n    toDataURL: function(canvasEl, format, quality) {\n      return canvasEl.toDataURL('image/' + format, quality);\n    },\n\n    /**\n     * Creates image element (works on client and node)\n     * @static\n     * @memberOf fabric.util\n     * @return {HTMLImageElement} HTML image element\n     */\n    createImage: function() {\n      return fabric.document.createElement('img');\n    },\n\n    /**\n     * Multiply matrix A by matrix B to nest transformations\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a First transformMatrix\n     * @param  {Array} b Second transformMatrix\n     * @param  {Boolean} is2x2 flag to multiply matrices as 2x2 matrices\n     * @return {Array} The product of the two transform matrices\n     */\n    multiplyTransformMatrices: function(a, b, is2x2) {\n      // Matrix multiply a * b\n      return [\n        a[0] * b[0] + a[2] * b[1],\n        a[1] * b[0] + a[3] * b[1],\n        a[0] * b[2] + a[2] * b[3],\n        a[1] * b[2] + a[3] * b[3],\n        is2x2 ? 0 : a[0] * b[4] + a[2] * b[5] + a[4],\n        is2x2 ? 0 : a[1] * b[4] + a[3] * b[5] + a[5]\n      ];\n    },\n\n    /**\n     * Decomposes standard 2x3 matrix into transform components\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a transformMatrix\n     * @return {Object} Components of transform\n     */\n    qrDecompose: function(a) {\n      var angle = atan2(a[1], a[0]),\n          denom = pow(a[0], 2) + pow(a[1], 2),\n          scaleX = sqrt(denom),\n          scaleY = (a[0] * a[3] - a[2] * a[1]) / scaleX,\n          skewX = atan2(a[0] * a[2] + a[1] * a [3], denom);\n      return {\n        angle: angle / PiBy180,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        skewX: skewX / PiBy180,\n        skewY: 0,\n        translateX: a[4],\n        translateY: a[5]\n      };\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle] angle in degrees\n     * @return {Number[]} transform matrix\n     */\n    calcRotateMatrix: function(options) {\n      if (!options.angle) {\n        return fabric.iMatrix.concat();\n      }\n      var theta = fabric.util.degreesToRadians(options.angle),\n          cos = fabric.util.cos(theta),\n          sin = fabric.util.sin(theta);\n      return [cos, sin, -sin, cos, 0, 0];\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet.\n     * is called DimensionsTransformMatrix because those properties are the one that influence\n     * the size of the resulting box of the object.\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewX]\n     * @return {Number[]} transform matrix\n     */\n    calcDimensionsMatrix: function(options) {\n      var scaleX = typeof options.scaleX === 'undefined' ? 1 : options.scaleX,\n          scaleY = typeof options.scaleY === 'undefined' ? 1 : options.scaleY,\n          scaleMatrix = [\n            options.flipX ? -scaleX : scaleX,\n            0,\n            0,\n            options.flipY ? -scaleY : scaleY,\n            0,\n            0],\n          multiply = fabric.util.multiplyTransformMatrices,\n          degreesToRadians = fabric.util.degreesToRadians;\n      if (options.skewX) {\n        scaleMatrix = multiply(\n          scaleMatrix,\n          [1, 0, Math.tan(degreesToRadians(options.skewX)), 1],\n          true);\n      }\n      if (options.skewY) {\n        scaleMatrix = multiply(\n          scaleMatrix,\n          [1, Math.tan(degreesToRadians(options.skewY)), 0, 1],\n          true);\n      }\n      return scaleMatrix;\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle]\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.translateX]\n     * @param  {Number} [options.translateY]\n     * @return {Number[]} transform matrix\n     */\n    composeMatrix: function(options) {\n      var matrix = [1, 0, 0, 1, options.translateX || 0, options.translateY || 0],\n          multiply = fabric.util.multiplyTransformMatrices;\n      if (options.angle) {\n        matrix = multiply(matrix, fabric.util.calcRotateMatrix(options));\n      }\n      if (options.scaleX !== 1 || options.scaleY !== 1 ||\n          options.skewX || options.skewY || options.flipX || options.flipY) {\n        matrix = multiply(matrix, fabric.util.calcDimensionsMatrix(options));\n      }\n      return matrix;\n    },\n\n    /**\n     * reset an object transform state to neutral. Top and left are not accounted for\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to transform\n     */\n    resetObjectTransform: function (target) {\n      target.scaleX = 1;\n      target.scaleY = 1;\n      target.skewX = 0;\n      target.skewY = 0;\n      target.flipX = false;\n      target.flipY = false;\n      target.rotate(0);\n    },\n\n    /**\n     * Extract Object transform values\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to read from\n     * @return {Object} Components of transform\n     */\n    saveObjectTransform: function (target) {\n      return {\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        skewX: target.skewX,\n        skewY: target.skewY,\n        angle: target.angle,\n        left: target.left,\n        flipX: target.flipX,\n        flipY: target.flipY,\n        top: target.top\n      };\n    },\n\n    /**\n     * Returns true if context has transparent pixel\n     * at specified location (taking tolerance into account)\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x x coordinate\n     * @param {Number} y y coordinate\n     * @param {Number} tolerance Tolerance\n     */\n    isTransparent: function(ctx, x, y, tolerance) {\n\n      // If tolerance is > 0 adjust start coords to take into account.\n      // If moves off Canvas fix to 0\n      if (tolerance > 0) {\n        if (x > tolerance) {\n          x -= tolerance;\n        }\n        else {\n          x = 0;\n        }\n        if (y > tolerance) {\n          y -= tolerance;\n        }\n        else {\n          y = 0;\n        }\n      }\n\n      var _isTransparent = true, i, temp,\n          imageData = ctx.getImageData(x, y, (tolerance * 2) || 1, (tolerance * 2) || 1),\n          l = imageData.data.length;\n\n      // Split image data - for tolerance > 1, pixelDataSize = 4;\n      for (i = 3; i < l; i += 4) {\n        temp = imageData.data[i];\n        _isTransparent = temp <= 0;\n        if (_isTransparent === false) {\n          break; // Stop if colour found\n        }\n      }\n\n      imageData = null;\n\n      return _isTransparent;\n    },\n\n    /**\n     * Parse preserveAspectRatio attribute from element\n     * @param {string} attribute to be parsed\n     * @return {Object} an object containing align and meetOrSlice attribute\n     */\n    parsePreserveAspectRatioAttribute: function(attribute) {\n      var meetOrSlice = 'meet', alignX = 'Mid', alignY = 'Mid',\n          aspectRatioAttrs = attribute.split(' '), align;\n\n      if (aspectRatioAttrs && aspectRatioAttrs.length) {\n        meetOrSlice = aspectRatioAttrs.pop();\n        if (meetOrSlice !== 'meet' && meetOrSlice !== 'slice') {\n          align = meetOrSlice;\n          meetOrSlice = 'meet';\n        }\n        else if (aspectRatioAttrs.length) {\n          align = aspectRatioAttrs.pop();\n        }\n      }\n      //divide align in alignX and alignY\n      alignX = align !== 'none' ? align.slice(1, 4) : 'none';\n      alignY = align !== 'none' ? align.slice(5, 8) : 'none';\n      return {\n        meetOrSlice: meetOrSlice,\n        alignX: alignX,\n        alignY: alignY\n      };\n    },\n\n    /**\n     * Clear char widths cache for the given font family or all the cache if no\n     * fontFamily is specified.\n     * Use it if you know you are loading fonts in a lazy way and you are not waiting\n     * for custom fonts to load properly when adding text objects to the canvas.\n     * If a text object is added when its own font is not loaded yet, you will get wrong\n     * measurement and so wrong bounding boxes.\n     * After the font cache is cleared, either change the textObject text content or call\n     * initDimensions() to trigger a recalculation\n     * @memberOf fabric.util\n     * @param {String} [fontFamily] font family to clear\n     */\n    clearFabricFontCache: function(fontFamily) {\n      fontFamily = (fontFamily || '').toLowerCase();\n      if (!fontFamily) {\n        fabric.charWidthsCache = { };\n      }\n      else if (fabric.charWidthsCache[fontFamily]) {\n        delete fabric.charWidthsCache[fontFamily];\n      }\n    },\n\n    /**\n     * Given current aspect ratio, determines the max width and height that can\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Number} ar aspect ratio\n     * @param {Number} maximumArea Maximum area you want to achieve\n     * @return {Object.x} Limited dimensions by X\n     * @return {Object.y} Limited dimensions by Y\n     */\n    limitDimsByArea: function(ar, maximumArea) {\n      var roughWidth = Math.sqrt(maximumArea * ar),\n          perfLimitSizeY = Math.floor(maximumArea / roughWidth);\n      return { x: Math.floor(roughWidth), y: perfLimitSizeY };\n    },\n\n    capValue: function(min, value, max) {\n      return Math.max(min, Math.min(value, max));\n    },\n\n    /**\n     * Finds the scale for the object source to fit inside the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to fit into destination\n     */\n    findScaleToFit: function(source, destination) {\n      return Math.min(destination.width / source.width, destination.height / source.height);\n    },\n\n    /**\n     * Finds the scale for the object source to cover entirely the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to cover destination\n     */\n    findScaleToCover: function(source, destination) {\n      return Math.max(destination.width / source.width, destination.height / source.height);\n    },\n\n    /**\n     * given an array of 6 number returns something like `\"matrix(...numbers)\"`\n     * @memberOf fabric.util\n     * @param {Array} transform an array with 6 numbers\n     * @return {String} transform matrix for svg\n     * @return {Object.y} Limited dimensions by Y\n     */\n    matrixToSVG: function(transform) {\n      return 'matrix(' + transform.map(function(value) {\n        return fabric.util.toFixed(value, fabric.Object.NUM_FRACTION_DIGITS);\n      }).join(' ') + ')';\n    },\n\n    /**\n     * given an object and a transform, apply the inverse transform to the object,\n     * this is equivalent to remove from that object that transformation, so that\n     * added in a space with the removed transform, the object will be the same as before.\n     * Removing from an object a transform that scale by 2 is like scaling it by 1/2.\n     * Removing from an object a transfrom that rotate by 30deg is like rotating by 30deg\n     * in the opposite direction.\n     * This util is used to add objects inside transformed groups or nested groups.\n     * @memberOf fabric.util\n     * @param {fabric.Object} object the object you want to transform\n     * @param {Array} transform the destination transform\n     */\n    removeTransformFromObject: function(object, transform) {\n      var inverted = fabric.util.invertTransform(transform),\n          finalTransform = fabric.util.multiplyTransformMatrices(inverted, object.calcOwnMatrix());\n      fabric.util.applyTransformToObject(object, finalTransform);\n    },\n\n    /**\n     * given an object and a transform, apply the transform to the object.\n     * this is equivalent to change the space where the object is drawn.\n     * Adding to an object a transform that scale by 2 is like scaling it by 2.\n     * This is used when removing an object from an active selection for example.\n     * @memberOf fabric.util\n     * @param {fabric.Object} object the object you want to transform\n     * @param {Array} transform the destination transform\n     */\n    addTransformToObject: function(object, transform) {\n      fabric.util.applyTransformToObject(\n        object,\n        fabric.util.multiplyTransformMatrices(transform, object.calcOwnMatrix())\n      );\n    },\n\n    /**\n     * discard an object transform state and apply the one from the matrix.\n     * @memberOf fabric.util\n     * @param {fabric.Object} object the object you want to transform\n     * @param {Array} transform the destination transform\n     */\n    applyTransformToObject: function(object, transform) {\n      var options = fabric.util.qrDecompose(transform),\n          center = new fabric.Point(options.translateX, options.translateY);\n      object.flipX = false;\n      object.flipY = false;\n      object.set('scaleX', options.scaleX);\n      object.set('scaleY', options.scaleY);\n      object.skewX = options.skewX;\n      object.skewY = options.skewY;\n      object.angle = options.angle;\n      object.setPositionByOrigin(center, 'center', 'center');\n    },\n\n    /**\n     * given a width and height, return the size of the bounding box\n     * that can contains the box with width/height with applied transform\n     * described in options.\n     * Use to calculate the boxes around objects for controls.\n     * @memberOf fabric.util\n     * @param {Number} width\n     * @param {Number} height\n     * @param {Object} options\n     * @param {Number} options.scaleX\n     * @param {Number} options.scaleY\n     * @param {Number} options.skewX\n     * @param {Number} options.skewY\n     * @return {Object.x} width of containing\n     * @return {Object.y} height of containing\n     */\n    sizeAfterTransform: function(width, height, options) {\n      var dimX = width / 2, dimY = height / 2,\n          points = [\n            {\n              x: -dimX,\n              y: -dimY\n            },\n            {\n              x: dimX,\n              y: -dimY\n            },\n            {\n              x: -dimX,\n              y: dimY\n            },\n            {\n              x: dimX,\n              y: dimY\n            }],\n          transformMatrix = fabric.util.calcDimensionsMatrix(options),\n          bbox = fabric.util.makeBoundingBoxFromPoints(points, transformMatrix);\n      return {\n        x: bbox.width,\n        y: bbox.height,\n      };\n    }\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n  var _join = Array.prototype.join,\n      commandLengths = {\n        m: 2,\n        l: 2,\n        h: 1,\n        v: 1,\n        c: 6,\n        s: 4,\n        q: 4,\n        t: 2,\n        a: 7\n      },\n      repeatedCommands = {\n        m: 'l',\n        M: 'L'\n      };\n  function segmentToBezier(th2, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY) {\n    var costh2 = fabric.util.cos(th2),\n        sinth2 = fabric.util.sin(th2),\n        costh3 = fabric.util.cos(th3),\n        sinth3 = fabric.util.sin(th3),\n        toX = cosTh * rx * costh3 - sinTh * ry * sinth3 + cx1,\n        toY = sinTh * rx * costh3 + cosTh * ry * sinth3 + cy1,\n        cp1X = fromX + mT * ( -cosTh * rx * sinth2 - sinTh * ry * costh2),\n        cp1Y = fromY + mT * ( -sinTh * rx * sinth2 + cosTh * ry * costh2),\n        cp2X = toX + mT * ( cosTh * rx * sinth3 + sinTh * ry * costh3),\n        cp2Y = toY + mT * ( sinTh * rx * sinth3 - cosTh * ry * costh3);\n\n    return ['C',\n      cp1X, cp1Y,\n      cp2X, cp2Y,\n      toX, toY\n    ];\n  }\n\n  /* Adapted from http://dxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGPathDataParser.cpp\n   * by Andrea Bogazzi code is under MPL. if you don't have a copy of the license you can take it here\n   * http://mozilla.org/MPL/2.0/\n   */\n  function arcToSegments(toX, toY, rx, ry, large, sweep, rotateX) {\n    var PI = Math.PI, th = rotateX * PI / 180,\n        sinTh = fabric.util.sin(th),\n        cosTh = fabric.util.cos(th),\n        fromX = 0, fromY = 0;\n\n    rx = Math.abs(rx);\n    ry = Math.abs(ry);\n\n    var px = -cosTh * toX * 0.5 - sinTh * toY * 0.5,\n        py = -cosTh * toY * 0.5 + sinTh * toX * 0.5,\n        rx2 = rx * rx, ry2 = ry * ry, py2 = py * py, px2 = px * px,\n        pl = rx2 * ry2 - rx2 * py2 - ry2 * px2,\n        root = 0;\n\n    if (pl < 0) {\n      var s = Math.sqrt(1 - pl / (rx2 * ry2));\n      rx *= s;\n      ry *= s;\n    }\n    else {\n      root = (large === sweep ? -1.0 : 1.0) *\n              Math.sqrt( pl / (rx2 * py2 + ry2 * px2));\n    }\n\n    var cx = root * rx * py / ry,\n        cy = -root * ry * px / rx,\n        cx1 = cosTh * cx - sinTh * cy + toX * 0.5,\n        cy1 = sinTh * cx + cosTh * cy + toY * 0.5,\n        mTheta = calcVectorAngle(1, 0, (px - cx) / rx, (py - cy) / ry),\n        dtheta = calcVectorAngle((px - cx) / rx, (py - cy) / ry, (-px - cx) / rx, (-py - cy) / ry);\n\n    if (sweep === 0 && dtheta > 0) {\n      dtheta -= 2 * PI;\n    }\n    else if (sweep === 1 && dtheta < 0) {\n      dtheta += 2 * PI;\n    }\n\n    // Convert into cubic bezier segments <= 90deg\n    var segments = Math.ceil(Math.abs(dtheta / PI * 2)),\n        result = [], mDelta = dtheta / segments,\n        mT = 8 / 3 * Math.sin(mDelta / 4) * Math.sin(mDelta / 4) / Math.sin(mDelta / 2),\n        th3 = mTheta + mDelta;\n\n    for (var i = 0; i < segments; i++) {\n      result[i] = segmentToBezier(mTheta, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY);\n      fromX = result[i][5];\n      fromY = result[i][6];\n      mTheta = th3;\n      th3 += mDelta;\n    }\n    return result;\n  }\n\n  /*\n   * Private\n   */\n  function calcVectorAngle(ux, uy, vx, vy) {\n    var ta = Math.atan2(uy, ux),\n        tb = Math.atan2(vy, vx);\n    if (tb >= ta) {\n      return tb - ta;\n    }\n    else {\n      return 2 * Math.PI - (ta - tb);\n    }\n  }\n\n  /**\n   * Calculate bounding box of a beziercurve\n   * @param {Number} x0 starting point\n   * @param {Number} y0\n   * @param {Number} x1 first control point\n   * @param {Number} y1\n   * @param {Number} x2 secondo control point\n   * @param {Number} y2\n   * @param {Number} x3 end of bezier\n   * @param {Number} y3\n   */\n  // taken from http://jsbin.com/ivomiq/56/edit  no credits available for that.\n  // TODO: can we normalize this with the starting points set at 0 and then translated the bbox?\n  function getBoundsOfCurve(x0, y0, x1, y1, x2, y2, x3, y3) {\n    var argsString;\n    if (fabric.cachesBoundsOfCurve) {\n      argsString = _join.call(arguments);\n      if (fabric.boundsOfCurveCache[argsString]) {\n        return fabric.boundsOfCurveCache[argsString];\n      }\n    }\n\n    var sqrt = Math.sqrt,\n        min = Math.min, max = Math.max,\n        abs = Math.abs, tvalues = [],\n        bounds = [[], []],\n        a, b, c, t, t1, t2, b2ac, sqrtb2ac;\n\n    b = 6 * x0 - 12 * x1 + 6 * x2;\n    a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n    c = 3 * x1 - 3 * x0;\n\n    for (var i = 0; i < 2; ++i) {\n      if (i > 0) {\n        b = 6 * y0 - 12 * y1 + 6 * y2;\n        a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n        c = 3 * y1 - 3 * y0;\n      }\n\n      if (abs(a) < 1e-12) {\n        if (abs(b) < 1e-12) {\n          continue;\n        }\n        t = -c / b;\n        if (0 < t && t < 1) {\n          tvalues.push(t);\n        }\n        continue;\n      }\n      b2ac = b * b - 4 * c * a;\n      if (b2ac < 0) {\n        continue;\n      }\n      sqrtb2ac = sqrt(b2ac);\n      t1 = (-b + sqrtb2ac) / (2 * a);\n      if (0 < t1 && t1 < 1) {\n        tvalues.push(t1);\n      }\n      t2 = (-b - sqrtb2ac) / (2 * a);\n      if (0 < t2 && t2 < 1) {\n        tvalues.push(t2);\n      }\n    }\n\n    var x, y, j = tvalues.length, jlen = j, mt;\n    while (j--) {\n      t = tvalues[j];\n      mt = 1 - t;\n      x = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\n      bounds[0][j] = x;\n\n      y = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\n      bounds[1][j] = y;\n    }\n\n    bounds[0][jlen] = x0;\n    bounds[1][jlen] = y0;\n    bounds[0][jlen + 1] = x3;\n    bounds[1][jlen + 1] = y3;\n    var result = [\n      {\n        x: min.apply(null, bounds[0]),\n        y: min.apply(null, bounds[1])\n      },\n      {\n        x: max.apply(null, bounds[0]),\n        y: max.apply(null, bounds[1])\n      }\n    ];\n    if (fabric.cachesBoundsOfCurve) {\n      fabric.boundsOfCurveCache[argsString] = result;\n    }\n    return result;\n  }\n\n  /**\n   * Converts arc to a bunch of bezier curves\n   * @param {Number} fx starting point x\n   * @param {Number} fy starting point y\n   * @param {Array} coords Arc command\n   */\n  function fromArcToBeziers(fx, fy, coords) {\n    var rx = coords[1],\n        ry = coords[2],\n        rot = coords[3],\n        large = coords[4],\n        sweep = coords[5],\n        tx = coords[6],\n        ty = coords[7],\n        segsNorm = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segsNorm.length; i < len; i++) {\n      segsNorm[i][1] += fx;\n      segsNorm[i][2] += fy;\n      segsNorm[i][3] += fx;\n      segsNorm[i][4] += fy;\n      segsNorm[i][5] += fx;\n      segsNorm[i][6] += fy;\n    }\n    return segsNorm;\n  };\n\n  /**\n   * This function take a parsed SVG path and make it simpler for fabricJS logic.\n   * simplification consist of: only UPPERCASE absolute commands ( relative converted to absolute )\n   * S converted in C, T converted in Q, A converted in C.\n   * @param {Array} path the array of commands of a parsed svg path for fabric.Path\n   * @return {Array} the simplified array of commands of a parsed svg path for fabric.Path\n   */\n  function makePathSimpler(path) {\n    // x and y represent the last point of the path. the previous command point.\n    // we add them to each relative command to make it an absolute comment.\n    // we also swap the v V h H with L, because are easier to transform.\n    var x = 0, y = 0, len = path.length,\n        // x1 and y1 represent the last point of the subpath. the subpath is started with\n        // m or M command. When a z or Z command is drawn, x and y need to be resetted to\n        // the last x1 and y1.\n        x1 = 0, y1 = 0, current, i, converted,\n        // previous will host the letter of the previous command, to handle S and T.\n        // controlX and controlY will host the previous reflected control point\n        destinationPath = [], previous, controlX, controlY;\n    for (i = 0; i < len; ++i) {\n      converted = false;\n      current = path[i].slice(0);\n      switch (current[0]) { // first letter\n        case 'l': // lineto, relative\n          current[0] = 'L';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'L':\n          x = current[1];\n          y = current[2];\n          break;\n        case 'h': // horizontal lineto, relative\n          current[1] += x;\n          // falls through\n        case 'H':\n          current[0] = 'L';\n          current[2] = y;\n          x = current[1];\n          break;\n        case 'v': // vertical lineto, relative\n          current[1] += y;\n          // falls through\n        case 'V':\n          current[0] = 'L';\n          y = current[1];\n          current[1] = x;\n          current[2] = y;\n          break;\n        case 'm': // moveTo, relative\n          current[0] = 'M';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'M':\n          x = current[1];\n          y = current[2];\n          x1 = current[1];\n          y1 = current[2];\n          break;\n        case 'c': // bezierCurveTo, relative\n          current[0] = 'C';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          current[5] += x;\n          current[6] += y;\n          // falls through\n        case 'C':\n          controlX = current[3];\n          controlY = current[4];\n          x = current[5];\n          y = current[6];\n          break;\n        case 's': // shorthand cubic bezierCurveTo, relative\n          current[0] = 'S';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          // falls through\n        case 'S':\n          // would be sScC but since we are swapping sSc for C, we check just that.\n          if (previous === 'C') {\n            // calculate reflection of previous control points\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n          else {\n            // If there is no previous command or if the previous command was not a C, c, S, or s,\n            // the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          x = current[3];\n          y = current[4];\n          current[0] = 'C';\n          current[5] = current[3];\n          current[6] = current[4];\n          current[3] = current[1];\n          current[4] = current[2];\n          current[1] = controlX;\n          current[2] = controlY;\n          // current[3] and current[4] are NOW the second control point.\n          // we keep it for the next reflection.\n          controlX = current[3];\n          controlY = current[4];\n          break;\n        case 'q': // quadraticCurveTo, relative\n          current[0] = 'Q';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          // falls through\n        case 'Q':\n          controlX = current[1];\n          controlY = current[2];\n          x = current[3];\n          y = current[4];\n          break;\n        case 't': // shorthand quadraticCurveTo, relative\n          current[0] = 'T';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'T':\n          if (previous === 'Q') {\n            // calculate reflection of previous control point\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n          else {\n            // If there is no previous command or if the previous command was not a Q, q, T or t,\n            // assume the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          current[0] = 'Q';\n          x = current[1];\n          y = current[2];\n          current[1] = controlX;\n          current[2] = controlY;\n          current[3] = x;\n          current[4] = y;\n          break;\n        case 'a':\n          current[0] = 'A';\n          current[6] += x;\n          current[7] += y;\n          // falls through\n        case 'A':\n          converted = true;\n          destinationPath = destinationPath.concat(fromArcToBeziers(x, y, current));\n          x = current[6];\n          y = current[7];\n          break;\n        case 'z':\n        case 'Z':\n          x = x1;\n          y = y1;\n          break;\n        default:\n      }\n      if (!converted) {\n        destinationPath.push(current);\n      }\n      previous = current[0];\n    }\n    return destinationPath;\n  };\n\n  /**\n   * Calc length from point x1,y1 to x2,y2\n   * @param {Number} x1 starting point x\n   * @param {Number} y1 starting point y\n   * @param {Number} x2 starting point x\n   * @param {Number} y2 starting point y\n   * @return {Number} length of segment\n   */\n  function calcLineLength(x1, y1, x2, y2) {\n    return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  }\n\n  // functions for the Cubic beizer\n  // taken from: https://github.com/konvajs/konva/blob/7.0.5/src/shapes/Path.ts#L350\n  function CB1(t) {\n    return t * t * t;\n  }\n  function CB2(t) {\n    return 3 * t * t * (1 - t);\n  }\n  function CB3(t) {\n    return 3 * t * (1 - t) * (1 - t);\n  }\n  function CB4(t) {\n    return (1 - t) * (1 - t) * (1 - t);\n  }\n\n  function getPointOnCubicBezierIterator(p1x, p1y, p2x, p2y, p3x, p3y, p4x, p4y) {\n    return function(pct) {\n      var c1 = CB1(pct), c2 = CB2(pct), c3 = CB3(pct), c4 = CB4(pct);\n      return {\n        x: p4x * c1 + p3x * c2 + p2x * c3 + p1x * c4,\n        y: p4y * c1 + p3y * c2 + p2y * c3 + p1y * c4\n      };\n    };\n  }\n\n  function getTangentCubicIterator(p1x, p1y, p2x, p2y, p3x, p3y, p4x, p4y) {\n    return function (pct) {\n      var invT = 1 - pct,\n          tangentX = (3 * invT * invT * (p2x - p1x)) + (6 * invT * pct * (p3x - p2x)) +\n          (3 * pct * pct * (p4x - p3x)),\n          tangentY = (3 * invT * invT * (p2y - p1y)) + (6 * invT * pct * (p3y - p2y)) +\n          (3 * pct * pct * (p4y - p3y));\n      return Math.atan2(tangentY, tangentX);\n    };\n  }\n\n  function QB1(t) {\n    return t * t;\n  }\n\n  function QB2(t) {\n    return 2 * t * (1 - t);\n  }\n\n  function QB3(t) {\n    return (1 - t) * (1 - t);\n  }\n\n  function getPointOnQuadraticBezierIterator(p1x, p1y, p2x, p2y, p3x, p3y) {\n    return function(pct) {\n      var c1 = QB1(pct), c2 = QB2(pct), c3 = QB3(pct);\n      return {\n        x: p3x * c1 + p2x * c2 + p1x * c3,\n        y: p3y * c1 + p2y * c2 + p1y * c3\n      };\n    };\n  }\n\n  function getTangentQuadraticIterator(p1x, p1y, p2x, p2y, p3x, p3y) {\n    return function (pct) {\n      var invT = 1 - pct,\n          tangentX = (2 * invT * (p2x - p1x)) + (2 * pct * (p3x - p2x)),\n          tangentY = (2 * invT * (p2y - p1y)) + (2 * pct * (p3y - p2y));\n      return Math.atan2(tangentY, tangentX);\n    };\n  }\n\n\n  // this will run over a path segment ( a cubic or quadratic segment) and approximate it\n  // with 100 segemnts. This will good enough to calculate the length of the curve\n  function pathIterator(iterator, x1, y1) {\n    var tempP = { x: x1, y: y1 }, p, tmpLen = 0, perc;\n    for (perc = 0.01; perc <= 1; perc += 0.01) {\n      p = iterator(perc);\n      tmpLen += calcLineLength(tempP.x, tempP.y, p.x, p.y);\n      tempP = p;\n    }\n    return tmpLen;\n  }\n\n  /**\n   * Given a pathInfo, and a distance in pixels, find the percentage from 0 to 1\n   * that correspond to that pixels run over the path.\n   * The percentage will be then used to find the correct point on the canvas for the path.\n   * @param {Array} segInfo fabricJS collection of information on a parsed path\n   * @param {Number} distance from starting point, in pixels.\n   * @return {Object} info object with x and y ( the point on canvas ) and angle, the tangent on that point;\n   */\n  function findPercentageForDistance(segInfo, distance) {\n    var perc = 0, tmpLen = 0, iterator = segInfo.iterator, tempP = { x: segInfo.x, y: segInfo.y },\n        p, nextLen, nextStep = 0.01, angleFinder = segInfo.angleFinder, lastPerc;\n    // nextStep > 0.0001 covers 0.00015625 that 1/64th of 1/100\n    // the path\n    while (tmpLen < distance && perc <= 1 && nextStep > 0.0001) {\n      p = iterator(perc);\n      lastPerc = perc;\n      nextLen = calcLineLength(tempP.x, tempP.y, p.x, p.y);\n      // compare tmpLen each cycle with distance, decide next perc to test.\n      if ((nextLen + tmpLen) > distance) {\n        // we discard this step and we make smaller steps.\n        nextStep /= 2;\n        perc -= nextStep;\n      }\n      else {\n        tempP = p;\n        perc += nextStep;\n        tmpLen += nextLen;\n      }\n    }\n    p.angle = angleFinder(lastPerc);\n    return p;\n  }\n\n  /**\n   * Run over a parsed and simplifed path and extrac some informations.\n   * informations are length of each command and starting point\n   * @param {Array} path fabricJS parsed path commands\n   * @return {Array} path commands informations\n   */\n  function getPathSegmentsInfo(path) {\n    var totalLength = 0, len = path.length, current,\n        //x2 and y2 are the coords of segment start\n        //x1 and y1 are the coords of the current point\n        x1 = 0, y1 = 0, x2 = 0, y2 = 0, info = [], iterator, tempInfo, angleFinder;\n    for (var i = 0; i < len; i++) {\n      current = path[i];\n      tempInfo = {\n        x: x1,\n        y: y1,\n        command: current[0],\n      };\n      switch (current[0]) { //first letter\n        case 'M':\n          tempInfo.length = 0;\n          x2 = x1 = current[1];\n          y2 = y1 = current[2];\n          break;\n        case 'L':\n          tempInfo.length = calcLineLength(x1, y1, current[1], current[2]);\n          x1 = current[1];\n          y1 = current[2];\n          break;\n        case 'C':\n          iterator = getPointOnCubicBezierIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6]\n          );\n          angleFinder = getTangentCubicIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6]\n          );\n          tempInfo.iterator = iterator;\n          tempInfo.angleFinder = angleFinder;\n          tempInfo.length = pathIterator(iterator, x1, y1);\n          x1 = current[5];\n          y1 = current[6];\n          break;\n        case 'Q':\n          iterator = getPointOnQuadraticBezierIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4]\n          );\n          angleFinder = getTangentQuadraticIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4]\n          );\n          tempInfo.iterator = iterator;\n          tempInfo.angleFinder = angleFinder;\n          tempInfo.length = pathIterator(iterator, x1, y1);\n          x1 = current[3];\n          y1 = current[4];\n          break;\n        case 'Z':\n        case 'z':\n          // we add those in order to ease calculations later\n          tempInfo.destX = x2;\n          tempInfo.destY = y2;\n          tempInfo.length = calcLineLength(x1, y1, x2, y2);\n          x1 = x2;\n          y1 = y2;\n          break;\n      }\n      totalLength += tempInfo.length;\n      info.push(tempInfo);\n    }\n    info.push({ length: totalLength, x: x1, y: y1 });\n    return info;\n  }\n\n  function getPointOnPath(path, distance, infos) {\n    if (!infos) {\n      infos = getPathSegmentsInfo(path);\n    }\n    var i = 0;\n    while ((distance - infos[i].length > 0) && i < (infos.length - 2)) {\n      distance -= infos[i].length;\n      i++;\n    }\n    // var distance = infos[infos.length - 1] * perc;\n    var segInfo = infos[i], segPercent = distance / segInfo.length,\n        command = segInfo.command, segment = path[i], info;\n\n    switch (command) {\n      case 'M':\n        return { x: segInfo.x, y: segInfo.y, angle: 0 };\n      case 'Z':\n      case 'z':\n        info = new fabric.Point(segInfo.x, segInfo.y).lerp(\n          new fabric.Point(segInfo.destX, segInfo.destY),\n          segPercent\n        );\n        info.angle = Math.atan2(segInfo.destY - segInfo.y, segInfo.destX - segInfo.x);\n        return info;\n      case 'L':\n        info = new fabric.Point(segInfo.x, segInfo.y).lerp(\n          new fabric.Point(segment[1], segment[2]),\n          segPercent\n        );\n        info.angle = Math.atan2(segment[2] - segInfo.y, segment[1] - segInfo.x);\n        return info;\n      case 'C':\n        return findPercentageForDistance(segInfo, distance);\n      case 'Q':\n        return findPercentageForDistance(segInfo, distance);\n    }\n  }\n\n  function parsePath(pathString) {\n    var result = [],\n        coords = [],\n        currentPath,\n        parsed,\n        re = fabric.rePathCommand,\n        rNumber = '[-+]?(?:\\\\d*\\\\.\\\\d+|\\\\d+\\\\.?)(?:[eE][-+]?\\\\d+)?\\\\s*',\n        rNumberCommaWsp = '(' + rNumber + ')' + fabric.commaWsp,\n        rFlagCommaWsp = '([01])' + fabric.commaWsp + '?',\n        rArcSeq = rNumberCommaWsp + '?' + rNumberCommaWsp + '?' + rNumberCommaWsp + rFlagCommaWsp + rFlagCommaWsp +\n          rNumberCommaWsp + '?(' + rNumber + ')',\n        regArcArgumentSequence = new RegExp(rArcSeq, 'g'),\n        match,\n        coordsStr,\n        // one of commands (m,M,l,L,q,Q,c,C,etc.) followed by non-command characters (i.e. command values)\n        path;\n    if (!pathString || !pathString.match) {\n      return result;\n    }\n    path = pathString.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);\n\n    for (var i = 0, coordsParsed, len = path.length; i < len; i++) {\n      currentPath = path[i];\n\n      coordsStr = currentPath.slice(1).trim();\n      coords.length = 0;\n\n      var command = currentPath.charAt(0);\n      coordsParsed = [command];\n\n      if (command.toLowerCase() === 'a') {\n        // arcs have special flags that apparently don't require spaces so handle special\n        for (var args; (args = regArcArgumentSequence.exec(coordsStr));) {\n          for (var j = 1; j < args.length; j++) {\n            coords.push(args[j]);\n          }\n        }\n      }\n      else {\n        while ((match = re.exec(coordsStr))) {\n          coords.push(match[0]);\n        }\n      }\n\n      for (var j = 0, jlen = coords.length; j < jlen; j++) {\n        parsed = parseFloat(coords[j]);\n        if (!isNaN(parsed)) {\n          coordsParsed.push(parsed);\n        }\n      }\n\n      var commandLength = commandLengths[command.toLowerCase()],\n          repeatedCommand = repeatedCommands[command] || command;\n\n      if (coordsParsed.length - 1 > commandLength) {\n        for (var k = 1, klen = coordsParsed.length; k < klen; k += commandLength) {\n          result.push([command].concat(coordsParsed.slice(k, k + commandLength)));\n          command = repeatedCommand;\n        }\n      }\n      else {\n        result.push(coordsParsed);\n      }\n    }\n\n    return result;\n  };\n\n  /**\n   * Calculate bounding box of a elliptic-arc\n   * @deprecated\n   * @param {Number} fx start point of arc\n   * @param {Number} fy\n   * @param {Number} rx horizontal radius\n   * @param {Number} ry vertical radius\n   * @param {Number} rot angle of horizontal axis\n   * @param {Number} large 1 or 0, whatever the arc is the big or the small on the 2 points\n   * @param {Number} sweep 1 or 0, 1 clockwise or counterclockwise direction\n   * @param {Number} tx end point of arc\n   * @param {Number} ty\n   */\n  function getBoundsOfArc(fx, fy, rx, ry, rot, large, sweep, tx, ty) {\n\n    var fromX = 0, fromY = 0, bound, bounds = [],\n        segs = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segs.length; i < len; i++) {\n      bound = getBoundsOfCurve(fromX, fromY, segs[i][1], segs[i][2], segs[i][3], segs[i][4], segs[i][5], segs[i][6]);\n      bounds.push({ x: bound[0].x + fx, y: bound[0].y + fy });\n      bounds.push({ x: bound[1].x + fx, y: bound[1].y + fy });\n      fromX = segs[i][5];\n      fromY = segs[i][6];\n    }\n    return bounds;\n  };\n\n  /**\n   * Draws arc\n   * @deprecated\n   * @param {CanvasRenderingContext2D} ctx\n   * @param {Number} fx\n   * @param {Number} fy\n   * @param {Array} coords coords of the arc, without the front 'A/a'\n   */\n  function drawArc(ctx, fx, fy, coords) {\n    coords = coords.slice(0).unshift('X'); // command A or a does not matter\n    var beziers = fromArcToBeziers(fx, fy, coords);\n    beziers.forEach(function(bezier) {\n      ctx.bezierCurveTo.apply(ctx, bezier.slice(1));\n    });\n  };\n\n  fabric.util.parsePath = parsePath;\n  fabric.util.makePathSimpler = makePathSimpler;\n  fabric.util.getPathSegmentsInfo = getPathSegmentsInfo;\n  fabric.util.fromArcToBeziers = fromArcToBeziers;\n  /**\n   * Typo of `fromArcToBeziers` kept for not breaking the api once corrected.\n   * Will be removed in fabric 5.0\n   * @deprecated\n   */\n  fabric.util.fromArcToBeizers = fromArcToBeziers;\n  fabric.util.getBoundsOfCurve = getBoundsOfCurve;\n  fabric.util.getPointOnPath = getPointOnPath;\n  // kept because we do not want to make breaking changes.\n  // but useless and deprecated.\n  fabric.util.getBoundsOfArc = getBoundsOfArc;\n  fabric.util.drawArc = drawArc;\n})();\n\n\n(function() {\n\n  var slice = Array.prototype.slice;\n\n  /**\n   * Invokes method on all items in a given array\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} method Name of a method to invoke\n   * @return {Array}\n   */\n  function invoke(array, method) {\n    var args = slice.call(arguments, 2), result = [];\n    for (var i = 0, len = array.length; i < len; i++) {\n      result[i] = args.length ? array[i][method].apply(array[i], args) : array[i][method].call(array[i]);\n    }\n    return result;\n  }\n\n  /**\n   * Finds maximum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function max(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 >= value2;\n    });\n  }\n\n  /**\n   * Finds minimum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function min(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 < value2;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function fill(array, value) {\n    var k = array.length;\n    while (k--) {\n      array[k] = value;\n    }\n    return array;\n  }\n\n  /**\n   * @private\n   */\n  function find(array, byProperty, condition) {\n    if (!array || array.length === 0) {\n      return;\n    }\n\n    var i = array.length - 1,\n        result = byProperty ? array[i][byProperty] : array[i];\n    if (byProperty) {\n      while (i--) {\n        if (condition(array[i][byProperty], result)) {\n          result = array[i][byProperty];\n        }\n      }\n    }\n    else {\n      while (i--) {\n        if (condition(array[i], result)) {\n          result = array[i];\n        }\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @namespace fabric.util.array\n   */\n  fabric.util.array = {\n    fill: fill,\n    invoke: invoke,\n    min: min,\n    max: max\n  };\n\n})();\n\n\n(function() {\n  /**\n   * Copies all enumerable properties of one js object to another\n   * this does not and cannot compete with generic utils.\n   * Does not clone or extend fabric.Object subclasses.\n   * This is mostly for internal use and has extra handling for fabricJS objects\n   * it skips the canvas and group properties in deep cloning.\n   * @memberOf fabric.util.object\n   * @param {Object} destination Where to copy to\n   * @param {Object} source Where to copy from\n   * @return {Object}\n   */\n\n  function extend(destination, source, deep) {\n    // JScript DontEnum bug is not taken care of\n    // the deep clone is for internal use, is not meant to avoid\n    // javascript traps or cloning html element or self referenced objects.\n    if (deep) {\n      if (!fabric.isLikelyNode && source instanceof Element) {\n        // avoid cloning deep images, canvases,\n        destination = source;\n      }\n      else if (source instanceof Array) {\n        destination = [];\n        for (var i = 0, len = source.length; i < len; i++) {\n          destination[i] = extend({ }, source[i], deep);\n        }\n      }\n      else if (source && typeof source === 'object') {\n        for (var property in source) {\n          if (property === 'canvas' || property === 'group') {\n            // we do not want to clone this props at all.\n            // we want to keep the keys in the copy\n            destination[property] = null;\n          }\n          else if (source.hasOwnProperty(property)) {\n            destination[property] = extend({ }, source[property], deep);\n          }\n        }\n      }\n      else {\n        // this sounds odd for an extend but is ok for recursive use\n        destination = source;\n      }\n    }\n    else {\n      for (var property in source) {\n        destination[property] = source[property];\n      }\n    }\n    return destination;\n  }\n\n  /**\n   * Creates an empty object and copies all enumerable properties of another object to it\n   * @memberOf fabric.util.object\n   * TODO: this function return an empty object if you try to clone null\n   * @param {Object} object Object to clone\n   * @return {Object}\n   */\n  function clone(object, deep) {\n    return extend({ }, object, deep);\n  }\n\n  /** @namespace fabric.util.object */\n  fabric.util.object = {\n    extend: extend,\n    clone: clone\n  };\n  fabric.util.object.extend(fabric.util, fabric.Observable);\n})();\n\n\n(function() {\n\n  /**\n   * Camelizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to camelize\n   * @return {String} Camelized version of a string\n   */\n  function camelize(string) {\n    return string.replace(/-+(.)?/g, function(match, character) {\n      return character ? character.toUpperCase() : '';\n    });\n  }\n\n  /**\n   * Capitalizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to capitalize\n   * @param {Boolean} [firstLetterOnly] If true only first letter is capitalized\n   * and other letters stay untouched, if false first letter is capitalized\n   * and other letters are converted to lowercase.\n   * @return {String} Capitalized version of a string\n   */\n  function capitalize(string, firstLetterOnly) {\n    return string.charAt(0).toUpperCase() +\n      (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());\n  }\n\n  /**\n   * Escapes XML in a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to escape\n   * @return {String} Escaped version of a string\n   */\n  function escapeXml(string) {\n    return string.replace(/&/g, '&amp;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&apos;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;');\n  }\n\n  /**\n   * Divide a string in the user perceived single units\n   * @memberOf fabric.util.string\n   * @param {String} textstring String to escape\n   * @return {Array} array containing the graphemes\n   */\n  function graphemeSplit(textstring) {\n    var i = 0, chr, graphemes = [];\n    for (i = 0, chr; i < textstring.length; i++) {\n      if ((chr = getWholeChar(textstring, i)) === false) {\n        continue;\n      }\n      graphemes.push(chr);\n    }\n    return graphemes;\n  }\n\n  // taken from mdn in the charAt doc page.\n  function getWholeChar(str, i) {\n    var code = str.charCodeAt(i);\n\n    if (isNaN(code)) {\n      return ''; // Position not found\n    }\n    if (code < 0xD800 || code > 0xDFFF) {\n      return str.charAt(i);\n    }\n\n    // High surrogate (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xD800 <= code && code <= 0xDBFF) {\n      if (str.length <= (i + 1)) {\n        throw 'High surrogate without following low surrogate';\n      }\n      var next = str.charCodeAt(i + 1);\n      if (0xDC00 > next || next > 0xDFFF) {\n        throw 'High surrogate without following low surrogate';\n      }\n      return str.charAt(i) + str.charAt(i + 1);\n    }\n    // Low surrogate (0xDC00 <= code && code <= 0xDFFF)\n    if (i === 0) {\n      throw 'Low surrogate without preceding high surrogate';\n    }\n    var prev = str.charCodeAt(i - 1);\n\n    // (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xD800 > prev || prev > 0xDBFF) {\n      throw 'Low surrogate without preceding high surrogate';\n    }\n    // We can pass over low surrogates now as the second component\n    // in a pair which we have already processed\n    return false;\n  }\n\n\n  /**\n   * String utilities\n   * @namespace fabric.util.string\n   */\n  fabric.util.string = {\n    camelize: camelize,\n    capitalize: capitalize,\n    escapeXml: escapeXml,\n    graphemeSplit: graphemeSplit\n  };\n})();\n\n\n(function() {\n\n  var slice = Array.prototype.slice, emptyFunction = function() { },\n\n      IS_DONTENUM_BUGGY = (function() {\n        for (var p in { toString: 1 }) {\n          if (p === 'toString') {\n            return false;\n          }\n        }\n        return true;\n      })(),\n\n      /** @ignore */\n      addMethods = function(klass, source, parent) {\n        for (var property in source) {\n\n          if (property in klass.prototype &&\n              typeof klass.prototype[property] === 'function' &&\n              (source[property] + '').indexOf('callSuper') > -1) {\n\n            klass.prototype[property] = (function(property) {\n              return function() {\n\n                var superclass = this.constructor.superclass;\n                this.constructor.superclass = parent;\n                var returnValue = source[property].apply(this, arguments);\n                this.constructor.superclass = superclass;\n\n                if (property !== 'initialize') {\n                  return returnValue;\n                }\n              };\n            })(property);\n          }\n          else {\n            klass.prototype[property] = source[property];\n          }\n\n          if (IS_DONTENUM_BUGGY) {\n            if (source.toString !== Object.prototype.toString) {\n              klass.prototype.toString = source.toString;\n            }\n            if (source.valueOf !== Object.prototype.valueOf) {\n              klass.prototype.valueOf = source.valueOf;\n            }\n          }\n        }\n      };\n\n  function Subclass() { }\n\n  function callSuper(methodName) {\n    var parentMethod = null,\n        _this = this;\n\n    // climb prototype chain to find method not equal to callee's method\n    while (_this.constructor.superclass) {\n      var superClassMethod = _this.constructor.superclass.prototype[methodName];\n      if (_this[methodName] !== superClassMethod) {\n        parentMethod = superClassMethod;\n        break;\n      }\n      // eslint-disable-next-line\n      _this = _this.constructor.superclass.prototype;\n    }\n\n    if (!parentMethod) {\n      return console.log('tried to callSuper ' + methodName + ', method not found in prototype chain', this);\n    }\n\n    return (arguments.length > 1)\n      ? parentMethod.apply(this, slice.call(arguments, 1))\n      : parentMethod.call(this);\n  }\n\n  /**\n   * Helper for creation of \"classes\".\n   * @memberOf fabric.util\n   * @param {Function} [parent] optional \"Class\" to inherit from\n   * @param {Object} [properties] Properties shared by all instances of this class\n   *                  (be careful modifying objects defined here as this would affect all instances)\n   */\n  function createClass() {\n    var parent = null,\n        properties = slice.call(arguments, 0);\n\n    if (typeof properties[0] === 'function') {\n      parent = properties.shift();\n    }\n    function klass() {\n      this.initialize.apply(this, arguments);\n    }\n\n    klass.superclass = parent;\n    klass.subclasses = [];\n\n    if (parent) {\n      Subclass.prototype = parent.prototype;\n      klass.prototype = new Subclass();\n      parent.subclasses.push(klass);\n    }\n    for (var i = 0, length = properties.length; i < length; i++) {\n      addMethods(klass, properties[i], parent);\n    }\n    if (!klass.prototype.initialize) {\n      klass.prototype.initialize = emptyFunction;\n    }\n    klass.prototype.constructor = klass;\n    klass.prototype.callSuper = callSuper;\n    return klass;\n  }\n\n  fabric.util.createClass = createClass;\n})();\n\n\n(function () {\n  // since ie11 can use addEventListener but they do not support options, i need to check\n  var couldUseAttachEvent = !!fabric.document.createElement('div').attachEvent,\n      touchEvents = ['touchstart', 'touchmove', 'touchend'];\n  /**\n   * Adds an event listener to an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.addListener = function(element, eventName, handler, options) {\n    element && element.addEventListener(eventName, handler, couldUseAttachEvent ? false : options);\n  };\n\n  /**\n   * Removes an event listener from an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.removeListener = function(element, eventName, handler, options) {\n    element && element.removeEventListener(eventName, handler, couldUseAttachEvent ? false : options);\n  };\n\n  function getTouchInfo(event) {\n    var touchProp = event.changedTouches;\n    if (touchProp && touchProp[0]) {\n      return touchProp[0];\n    }\n    return event;\n  }\n\n  fabric.util.getPointer = function(event) {\n    var element = event.target,\n        scroll = fabric.util.getScrollLeftTop(element),\n        _evt = getTouchInfo(event);\n    return {\n      x: _evt.clientX + scroll.left,\n      y: _evt.clientY + scroll.top\n    };\n  };\n\n  fabric.util.isTouchEvent = function(event) {\n    return touchEvents.indexOf(event.type) > -1 || event.pointerType === 'touch';\n  };\n})();\n\n\n(function () {\n\n  /**\n   * Cross-browser wrapper for setting element's style\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   * @return {HTMLElement} Element that was passed as a first argument\n   */\n  function setStyle(element, styles) {\n    var elementStyle = element.style;\n    if (!elementStyle) {\n      return element;\n    }\n    if (typeof styles === 'string') {\n      element.style.cssText += ';' + styles;\n      return styles.indexOf('opacity') > -1\n        ? setOpacity(element, styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1])\n        : element;\n    }\n    for (var property in styles) {\n      if (property === 'opacity') {\n        setOpacity(element, styles[property]);\n      }\n      else {\n        var normalizedProperty = (property === 'float' || property === 'cssFloat')\n          ? (typeof elementStyle.styleFloat === 'undefined' ? 'cssFloat' : 'styleFloat')\n          : property;\n        elementStyle[normalizedProperty] = styles[property];\n      }\n    }\n    return element;\n  }\n\n  var parseEl = fabric.document.createElement('div'),\n      supportsOpacity = typeof parseEl.style.opacity === 'string',\n      supportsFilters = typeof parseEl.style.filter === 'string',\n      reOpacity = /alpha\\s*\\(\\s*opacity\\s*=\\s*([^\\)]+)\\)/,\n\n      /** @ignore */\n      setOpacity = function (element) { return element; };\n\n  if (supportsOpacity) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      element.style.opacity = value;\n      return element;\n    };\n  }\n  else if (supportsFilters) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      var es = element.style;\n      if (element.currentStyle && !element.currentStyle.hasLayout) {\n        es.zoom = 1;\n      }\n      if (reOpacity.test(es.filter)) {\n        value = value >= 0.9999 ? '' : ('alpha(opacity=' + (value * 100) + ')');\n        es.filter = es.filter.replace(reOpacity, value);\n      }\n      else {\n        es.filter += ' alpha(opacity=' + (value * 100) + ')';\n      }\n      return element;\n    };\n  }\n\n  fabric.util.setStyle = setStyle;\n\n})();\n\n\n(function() {\n\n  var _slice = Array.prototype.slice;\n\n  /**\n   * Takes id and returns an element with that id (if one exists in a document)\n   * @memberOf fabric.util\n   * @param {String|HTMLElement} id\n   * @return {HTMLElement|null}\n   */\n  function getById(id) {\n    return typeof id === 'string' ? fabric.document.getElementById(id) : id;\n  }\n\n  var sliceCanConvertNodelists,\n      /**\n       * Converts an array-like object (e.g. arguments or NodeList) to an array\n       * @memberOf fabric.util\n       * @param {Object} arrayLike\n       * @return {Array}\n       */\n      toArray = function(arrayLike) {\n        return _slice.call(arrayLike, 0);\n      };\n\n  try {\n    sliceCanConvertNodelists = toArray(fabric.document.childNodes) instanceof Array;\n  }\n  catch (err) { }\n\n  if (!sliceCanConvertNodelists) {\n    toArray = function(arrayLike) {\n      var arr = new Array(arrayLike.length), i = arrayLike.length;\n      while (i--) {\n        arr[i] = arrayLike[i];\n      }\n      return arr;\n    };\n  }\n\n  /**\n   * Creates specified element with specified attributes\n   * @memberOf fabric.util\n   * @param {String} tagName Type of an element to create\n   * @param {Object} [attributes] Attributes to set on an element\n   * @return {HTMLElement} Newly created element\n   */\n  function makeElement(tagName, attributes) {\n    var el = fabric.document.createElement(tagName);\n    for (var prop in attributes) {\n      if (prop === 'class') {\n        el.className = attributes[prop];\n      }\n      else if (prop === 'for') {\n        el.htmlFor = attributes[prop];\n      }\n      else {\n        el.setAttribute(prop, attributes[prop]);\n      }\n    }\n    return el;\n  }\n\n  /**\n   * Adds class to an element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to add class to\n   * @param {String} className Class to add to an element\n   */\n  function addClass(element, className) {\n    if (element && (' ' + element.className + ' ').indexOf(' ' + className + ' ') === -1) {\n      element.className += (element.className ? ' ' : '') + className;\n    }\n  }\n\n  /**\n   * Wraps element with another element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to wrap\n   * @param {HTMLElement|String} wrapper Element to wrap with\n   * @param {Object} [attributes] Attributes to set on a wrapper\n   * @return {HTMLElement} wrapper\n   */\n  function wrapElement(element, wrapper, attributes) {\n    if (typeof wrapper === 'string') {\n      wrapper = makeElement(wrapper, attributes);\n    }\n    if (element.parentNode) {\n      element.parentNode.replaceChild(wrapper, element);\n    }\n    wrapper.appendChild(element);\n    return wrapper;\n  }\n\n  /**\n   * Returns element scroll offsets\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to operate on\n   * @return {Object} Object with left/top values\n   */\n  function getScrollLeftTop(element) {\n\n    var left = 0,\n        top = 0,\n        docElement = fabric.document.documentElement,\n        body = fabric.document.body || {\n          scrollLeft: 0, scrollTop: 0\n        };\n\n    // While loop checks (and then sets element to) .parentNode OR .host\n    //  to account for ShadowDOM. We still want to traverse up out of ShadowDOM,\n    //  but the .parentNode of a root ShadowDOM node will always be null, instead\n    //  it should be accessed through .host. See http://stackoverflow.com/a/24765528/4383938\n    while (element && (element.parentNode || element.host)) {\n\n      // Set element to element parent, or 'host' in case of ShadowDOM\n      element = element.parentNode || element.host;\n\n      if (element === fabric.document) {\n        left = body.scrollLeft || docElement.scrollLeft || 0;\n        top = body.scrollTop ||  docElement.scrollTop || 0;\n      }\n      else {\n        left += element.scrollLeft || 0;\n        top += element.scrollTop || 0;\n      }\n\n      if (element.nodeType === 1 && element.style.position === 'fixed') {\n        break;\n      }\n    }\n\n    return { left: left, top: top };\n  }\n\n  /**\n   * Returns offset for a given element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get offset for\n   * @return {Object} Object with \"left\" and \"top\" properties\n   */\n  function getElementOffset(element) {\n    var docElem,\n        doc = element && element.ownerDocument,\n        box = { left: 0, top: 0 },\n        offset = { left: 0, top: 0 },\n        scrollLeftTop,\n        offsetAttributes = {\n          borderLeftWidth: 'left',\n          borderTopWidth:  'top',\n          paddingLeft:     'left',\n          paddingTop:      'top'\n        };\n\n    if (!doc) {\n      return offset;\n    }\n\n    for (var attr in offsetAttributes) {\n      offset[offsetAttributes[attr]] += parseInt(getElementStyle(element, attr), 10) || 0;\n    }\n\n    docElem = doc.documentElement;\n    if ( typeof element.getBoundingClientRect !== 'undefined' ) {\n      box = element.getBoundingClientRect();\n    }\n\n    scrollLeftTop = getScrollLeftTop(element);\n\n    return {\n      left: box.left + scrollLeftTop.left - (docElem.clientLeft || 0) + offset.left,\n      top: box.top + scrollLeftTop.top - (docElem.clientTop || 0)  + offset.top\n    };\n  }\n\n  /**\n   * Returns style attribute value of a given element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get style attribute for\n   * @param {String} attr Style attribute to get for element\n   * @return {String} Style attribute value of the given element.\n   */\n  var getElementStyle;\n  if (fabric.document.defaultView && fabric.document.defaultView.getComputedStyle) {\n    getElementStyle = function(element, attr) {\n      var style = fabric.document.defaultView.getComputedStyle(element, null);\n      return style ? style[attr] : undefined;\n    };\n  }\n  else {\n    getElementStyle = function(element, attr) {\n      var value = element.style[attr];\n      if (!value && element.currentStyle) {\n        value = element.currentStyle[attr];\n      }\n      return value;\n    };\n  }\n\n  (function () {\n    var style = fabric.document.documentElement.style,\n        selectProp = 'userSelect' in style\n          ? 'userSelect'\n          : 'MozUserSelect' in style\n            ? 'MozUserSelect'\n            : 'WebkitUserSelect' in style\n              ? 'WebkitUserSelect'\n              : 'KhtmlUserSelect' in style\n                ? 'KhtmlUserSelect'\n                : '';\n\n    /**\n     * Makes element unselectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make unselectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementUnselectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = fabric.util.falseFunction;\n      }\n      if (selectProp) {\n        element.style[selectProp] = 'none';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = 'on';\n      }\n      return element;\n    }\n\n    /**\n     * Makes element selectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make selectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementSelectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = null;\n      }\n      if (selectProp) {\n        element.style[selectProp] = '';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = '';\n      }\n      return element;\n    }\n\n    fabric.util.makeElementUnselectable = makeElementUnselectable;\n    fabric.util.makeElementSelectable = makeElementSelectable;\n  })();\n\n  function getNodeCanvas(element) {\n    var impl = fabric.jsdomImplForWrapper(element);\n    return impl._canvas || impl._image;\n  };\n\n  function cleanUpJsdomNode(element) {\n    if (!fabric.isLikelyNode) {\n      return;\n    }\n    var impl = fabric.jsdomImplForWrapper(element);\n    if (impl) {\n      impl._image = null;\n      impl._canvas = null;\n      // unsure if necessary\n      impl._currentSrc = null;\n      impl._attributes = null;\n      impl._classList = null;\n    }\n  }\n\n  function setImageSmoothing(ctx, value) {\n    ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled || ctx.webkitImageSmoothingEnabled\n      || ctx.mozImageSmoothingEnabled || ctx.msImageSmoothingEnabled || ctx.oImageSmoothingEnabled;\n    ctx.imageSmoothingEnabled = value;\n  }\n\n  /**\n   * setImageSmoothing sets the context imageSmoothingEnabled property.\n   * Used by canvas and by ImageObject.\n   * @memberOf fabric.util\n   * @since 4.0.0\n   * @param {HTMLRenderingContext2D} ctx to set on\n   * @param {Boolean} value true or false\n   */\n  fabric.util.setImageSmoothing = setImageSmoothing;\n  fabric.util.getById = getById;\n  fabric.util.toArray = toArray;\n  fabric.util.addClass = addClass;\n  fabric.util.makeElement = makeElement;\n  fabric.util.wrapElement = wrapElement;\n  fabric.util.getScrollLeftTop = getScrollLeftTop;\n  fabric.util.getElementOffset = getElementOffset;\n  fabric.util.getNodeCanvas = getNodeCanvas;\n  fabric.util.cleanUpJsdomNode = cleanUpJsdomNode;\n\n})();\n\n\n(function() {\n\n  function addParamToUrl(url, param) {\n    return url + (/\\?/.test(url) ? '&' : '?') + param;\n  }\n\n  function emptyFn() { }\n\n  /**\n   * Cross-browser abstraction for sending XMLHttpRequest\n   * @memberOf fabric.util\n   * @param {String} url URL to send XMLHttpRequest to\n   * @param {Object} [options] Options object\n   * @param {String} [options.method=\"GET\"]\n   * @param {String} [options.parameters] parameters to append to url in GET or in body\n   * @param {String} [options.body] body to send with POST or PUT request\n   * @param {Function} options.onComplete Callback to invoke when request is completed\n   * @return {XMLHttpRequest} request\n   */\n  function request(url, options) {\n    options || (options = { });\n\n    var method = options.method ? options.method.toUpperCase() : 'GET',\n        onComplete = options.onComplete || function() { },\n        xhr = new fabric.window.XMLHttpRequest(),\n        body = options.body || options.parameters;\n\n    /** @ignore */\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState === 4) {\n        onComplete(xhr);\n        xhr.onreadystatechange = emptyFn;\n      }\n    };\n\n    if (method === 'GET') {\n      body = null;\n      if (typeof options.parameters === 'string') {\n        url = addParamToUrl(url, options.parameters);\n      }\n    }\n\n    xhr.open(method, url, true);\n\n    if (method === 'POST' || method === 'PUT') {\n      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    }\n\n    xhr.send(body);\n    return xhr;\n  }\n\n  fabric.util.request = request;\n})();\n\n\n/**\n * Wrapper around `console.log` (when available)\n * @param {*} [values] Values to log\n */\nfabric.log = console.log;\n\n/**\n * Wrapper around `console.warn` (when available)\n * @param {*} [values] Values to log as a warning\n */\nfabric.warn = console.warn;\n\n\n(function() {\n\n  function noop() {\n    return false;\n  }\n\n  function defaultEasing(t, b, c, d) {\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Changes value from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Number} [options.startValue=0] Starting value\n   * @param {Number} [options.endValue=100] Ending value\n   * @param {Number} [options.byValue=100] Value to modify the property by\n   * @param {Function} [options.easing] Easing function\n   * @param {Number} [options.duration=500] Duration of change (in ms)\n   * @param {Function} [options.abort] Additional function with logic. If returns true, onComplete is called.\n   */\n  function animate(options) {\n\n    requestAnimFrame(function(timestamp) {\n      options || (options = { });\n\n      var start = timestamp || +new Date(),\n          duration = options.duration || 500,\n          finish = start + duration, time,\n          onChange = options.onChange || noop,\n          abort = options.abort || noop,\n          onComplete = options.onComplete || noop,\n          easing = options.easing || defaultEasing,\n          startValue = 'startValue' in options ? options.startValue : 0,\n          endValue = 'endValue' in options ? options.endValue : 100,\n          byValue = options.byValue || endValue - startValue;\n\n      options.onStart && options.onStart();\n\n      (function tick(ticktime) {\n        // TODO: move abort call after calculation\n        // and pass (current,valuePerc, timePerc) as arguments\n        time = ticktime || +new Date();\n        var currentTime = time > finish ? duration : (time - start),\n            timePerc = currentTime / duration,\n            current = easing(currentTime, startValue, byValue, duration),\n            valuePerc = Math.abs((current - startValue) / byValue);\n        if (abort()) {\n          onComplete(endValue, 1, 1);\n          return;\n        }\n        if (time > finish) {\n          onChange(endValue, 1, 1);\n          onComplete(endValue, 1, 1);\n          return;\n        }\n        else {\n          onChange(current, valuePerc, timePerc);\n          requestAnimFrame(tick);\n        }\n      })(start);\n    });\n  }\n\n  var _requestAnimFrame = fabric.window.requestAnimationFrame       ||\n                          fabric.window.webkitRequestAnimationFrame ||\n                          fabric.window.mozRequestAnimationFrame    ||\n                          fabric.window.oRequestAnimationFrame      ||\n                          fabric.window.msRequestAnimationFrame     ||\n                          function(callback) {\n                            return fabric.window.setTimeout(callback, 1000 / 60);\n                          };\n\n  var _cancelAnimFrame = fabric.window.cancelAnimationFrame || fabric.window.clearTimeout;\n\n  /**\n   * requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n   * In order to get a precise start time, `requestAnimFrame` should be called as an entry into the method\n   * @memberOf fabric.util\n   * @param {Function} callback Callback to invoke\n   * @param {DOMElement} element optional Element to associate with animation\n   */\n  function requestAnimFrame() {\n    return _requestAnimFrame.apply(fabric.window, arguments);\n  }\n\n  function cancelAnimFrame() {\n    return _cancelAnimFrame.apply(fabric.window, arguments);\n  }\n\n  fabric.util.animate = animate;\n  fabric.util.requestAnimFrame = requestAnimFrame;\n  fabric.util.cancelAnimFrame = cancelAnimFrame;\n})();\n\n\n(function() {\n  // Calculate an in-between color. Returns a \"rgba()\" string.\n  // Credit: Edwin Martin <edwin@bitstorm.org>\n  //         http://www.bitstorm.org/jquery/color-animation/jquery.animate-colors.js\n  function calculateColor(begin, end, pos) {\n    var color = 'rgba('\n        + parseInt((begin[0] + pos * (end[0] - begin[0])), 10) + ','\n        + parseInt((begin[1] + pos * (end[1] - begin[1])), 10) + ','\n        + parseInt((begin[2] + pos * (end[2] - begin[2])), 10);\n\n    color += ',' + (begin && end ? parseFloat(begin[3] + pos * (end[3] - begin[3])) : 1);\n    color += ')';\n    return color;\n  }\n\n  /**\n   * Changes the color from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {String} fromColor The starting color in hex or rgb(a) format.\n   * @param {String} toColor The starting color in hex or rgb(a) format.\n   * @param {Number} [duration] Duration of change (in ms).\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Function} [options.colorEasing] Easing function. Note that this function only take two arguments (currentTime, duration). Thus the regular animation easing functions cannot be used.\n   * @param {Function} [options.abort] Additional function with logic. If returns true, onComplete is called.\n   */\n  function animateColor(fromColor, toColor, duration, options) {\n    var startColor = new fabric.Color(fromColor).getSource(),\n        endColor = new fabric.Color(toColor).getSource(),\n        originalOnComplete = options.onComplete,\n        originalOnChange = options.onChange;\n    options = options || {};\n\n    fabric.util.animate(fabric.util.object.extend(options, {\n      duration: duration || 500,\n      startValue: startColor,\n      endValue: endColor,\n      byValue: endColor,\n      easing: function (currentTime, startValue, byValue, duration) {\n        var posValue = options.colorEasing\n          ? options.colorEasing(currentTime, duration)\n          : 1 - Math.cos(currentTime / duration * (Math.PI / 2));\n        return calculateColor(startValue, byValue, posValue);\n      },\n      // has to take in account for color restoring;\n      onComplete: function(current, valuePerc, timePerc) {\n        if (originalOnComplete) {\n          return originalOnComplete(\n            calculateColor(endColor, endColor, 0),\n            valuePerc,\n            timePerc\n          );\n        }\n      },\n      onChange: function(current, valuePerc, timePerc) {\n        if (originalOnChange) {\n          if (Array.isArray(current)) {\n            return originalOnChange(\n              calculateColor(current, current, 0),\n              valuePerc,\n              timePerc\n            );\n          }\n          originalOnChange(current, valuePerc, timePerc);\n        }\n      }\n    }));\n  }\n\n  fabric.util.animateColor = animateColor;\n\n})();\n\n\n(function() {\n\n  function normalize(a, c, p, s) {\n    if (a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    }\n    else {\n      //handle the 0/0 case:\n      if (c === 0 && a === 0) {\n        s = p / (2 * Math.PI) * Math.asin(1);\n      }\n      else {\n        s = p / (2 * Math.PI) * Math.asin(c / a);\n      }\n    }\n    return { a: a, c: c, p: p, s: s };\n  }\n\n  function elastic(opts, t, d) {\n    return opts.a *\n      Math.pow(2, 10 * (t -= 1)) *\n      Math.sin( (t * d - opts.s) * (2 * Math.PI) / opts.p );\n  }\n\n  /**\n   * Cubic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCubic(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t + 1) + b;\n  }\n\n  /**\n   * Cubic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCubic(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t + 2) + b;\n  }\n\n  /**\n   * Quartic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuart(t, b, c, d) {\n    return c * (t /= d) * t * t * t + b;\n  }\n\n  /**\n   * Quartic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuart(t, b, c, d) {\n    return -c * ((t = t / d - 1) * t * t * t - 1) + b;\n  }\n\n  /**\n   * Quartic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuart(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t + b;\n    }\n    return -c / 2 * ((t -= 2) * t * t * t - 2) + b;\n  }\n\n  /**\n   * Quintic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuint(t, b, c, d) {\n    return c * (t /= d) * t * t * t * t + b;\n  }\n\n  /**\n   * Quintic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuint(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n  }\n\n  /**\n   * Quintic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuint(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n  }\n\n  /**\n   * Sinusoidal easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInSine(t, b, c, d) {\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Sinusoidal easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutSine(t, b, c, d) {\n    return c * Math.sin(t / d * (Math.PI / 2)) + b;\n  }\n\n  /**\n   * Sinusoidal easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutSine(t, b, c, d) {\n    return -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n  }\n\n  /**\n   * Exponential easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInExpo(t, b, c, d) {\n    return (t === 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n  }\n\n  /**\n   * Exponential easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutExpo(t, b, c, d) {\n    return (t === d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n  }\n\n  /**\n   * Exponential easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutExpo(t, b, c, d) {\n    if (t === 0) {\n      return b;\n    }\n    if (t === d) {\n      return b + c;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\n    }\n    return c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\n  }\n\n  /**\n   * Circular easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInCirc(t, b, c, d) {\n    return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n  }\n\n  /**\n   * Circular easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCirc(t, b, c, d) {\n    return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n  }\n\n  /**\n   * Circular easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCirc(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\n    }\n    return c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n  }\n\n  /**\n   * Elastic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return -elastic(opts, t, d) + b;\n  }\n\n  /**\n   * Elastic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return opts.a * Math.pow(2, -10 * t) * Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) + opts.c + b;\n  }\n\n  /**\n   * Elastic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d / 2;\n    if (t === 2) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * (0.3 * 1.5);\n    }\n    var opts = normalize(a, c, p, s);\n    if (t < 1) {\n      return -0.5 * elastic(opts, t, d) + b;\n    }\n    return opts.a * Math.pow(2, -10 * (t -= 1)) *\n      Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) * 0.5 + opts.c + b;\n  }\n\n  /**\n   * Backwards easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * (t /= d) * t * ((s + 1) * t - s) + b;\n  }\n\n  /**\n   * Backwards easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n  }\n\n  /**\n   * Backwards easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\n    }\n    return c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\n  }\n\n  /**\n   * Bouncing easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBounce(t, b, c, d) {\n    return c - easeOutBounce (d - t, 0, c, d) + b;\n  }\n\n  /**\n   * Bouncing easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBounce(t, b, c, d) {\n    if ((t /= d) < (1 / 2.75)) {\n      return c * (7.5625 * t * t) + b;\n    }\n    else if (t < (2 / 2.75)) {\n      return c * (7.5625 * (t -= (1.5 / 2.75)) * t + 0.75) + b;\n    }\n    else if (t < (2.5 / 2.75)) {\n      return c * (7.5625 * (t -= (2.25 / 2.75)) * t + 0.9375) + b;\n    }\n    else {\n      return c * (7.5625 * (t -= (2.625 / 2.75)) * t + 0.984375) + b;\n    }\n  }\n\n  /**\n   * Bouncing easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBounce(t, b, c, d) {\n    if (t < d / 2) {\n      return easeInBounce (t * 2, 0, c, d) * 0.5 + b;\n    }\n    return easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n  }\n\n  /**\n   * Easing functions\n   * See <a href=\"http://gizma.com/easing/\">Easing Equations by Robert Penner</a>\n   * @namespace fabric.util.ease\n   */\n  fabric.util.ease = {\n\n    /**\n     * Quadratic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInQuad: function(t, b, c, d) {\n      return c * (t /= d) * t + b;\n    },\n\n    /**\n     * Quadratic easing out\n     * @memberOf fabric.util.ease\n     */\n    easeOutQuad: function(t, b, c, d) {\n      return -c * (t /= d) * (t - 2) + b;\n    },\n\n    /**\n     * Quadratic easing in and out\n     * @memberOf fabric.util.ease\n     */\n    easeInOutQuad: function(t, b, c, d) {\n      t /= (d / 2);\n      if (t < 1) {\n        return c / 2 * t * t + b;\n      }\n      return -c / 2 * ((--t) * (t - 2) - 1) + b;\n    },\n\n    /**\n     * Cubic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInCubic: function(t, b, c, d) {\n      return c * (t /= d) * t * t + b;\n    },\n\n    easeOutCubic: easeOutCubic,\n    easeInOutCubic: easeInOutCubic,\n    easeInQuart: easeInQuart,\n    easeOutQuart: easeOutQuart,\n    easeInOutQuart: easeInOutQuart,\n    easeInQuint: easeInQuint,\n    easeOutQuint: easeOutQuint,\n    easeInOutQuint: easeInOutQuint,\n    easeInSine: easeInSine,\n    easeOutSine: easeOutSine,\n    easeInOutSine: easeInOutSine,\n    easeInExpo: easeInExpo,\n    easeOutExpo: easeOutExpo,\n    easeInOutExpo: easeInOutExpo,\n    easeInCirc: easeInCirc,\n    easeOutCirc: easeOutCirc,\n    easeInOutCirc: easeInOutCirc,\n    easeInElastic: easeInElastic,\n    easeOutElastic: easeOutElastic,\n    easeInOutElastic: easeInOutElastic,\n    easeInBack: easeInBack,\n    easeOutBack: easeOutBack,\n    easeInOutBack: easeInOutBack,\n    easeInBounce: easeInBounce,\n    easeOutBounce: easeOutBounce,\n    easeInOutBounce: easeInOutBounce\n  };\n\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  /**\n   * @name fabric\n   * @namespace\n   */\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      parseUnit = fabric.util.parseUnit,\n      multiplyTransformMatrices = fabric.util.multiplyTransformMatrices,\n\n      svgValidTagNames = ['path', 'circle', 'polygon', 'polyline', 'ellipse', 'rect', 'line',\n        'image', 'text'],\n      svgViewBoxElements = ['symbol', 'image', 'marker', 'pattern', 'view', 'svg'],\n      svgInvalidAncestors = ['pattern', 'defs', 'symbol', 'metadata', 'clipPath', 'mask', 'desc'],\n      svgValidParents = ['symbol', 'g', 'a', 'svg', 'clipPath', 'defs'],\n\n      attributesMap = {\n        cx:                   'left',\n        x:                    'left',\n        r:                    'radius',\n        cy:                   'top',\n        y:                    'top',\n        display:              'visible',\n        visibility:           'visible',\n        transform:            'transformMatrix',\n        'fill-opacity':       'fillOpacity',\n        'fill-rule':          'fillRule',\n        'font-family':        'fontFamily',\n        'font-size':          'fontSize',\n        'font-style':         'fontStyle',\n        'font-weight':        'fontWeight',\n        'letter-spacing':     'charSpacing',\n        'paint-order':        'paintFirst',\n        'stroke-dasharray':   'strokeDashArray',\n        'stroke-dashoffset':  'strokeDashOffset',\n        'stroke-linecap':     'strokeLineCap',\n        'stroke-linejoin':    'strokeLineJoin',\n        'stroke-miterlimit':  'strokeMiterLimit',\n        'stroke-opacity':     'strokeOpacity',\n        'stroke-width':       'strokeWidth',\n        'text-decoration':    'textDecoration',\n        'text-anchor':        'textAnchor',\n        opacity:              'opacity',\n        'clip-path':          'clipPath',\n        'clip-rule':          'clipRule',\n        'vector-effect':      'strokeUniform',\n        'image-rendering':    'imageSmoothing',\n      },\n\n      colorAttributes = {\n        stroke: 'strokeOpacity',\n        fill:   'fillOpacity'\n      },\n\n      fSize = 'font-size', cPath = 'clip-path';\n\n  fabric.svgValidTagNamesRegEx = getSvgRegex(svgValidTagNames);\n  fabric.svgViewBoxElementsRegEx = getSvgRegex(svgViewBoxElements);\n  fabric.svgInvalidAncestorsRegEx = getSvgRegex(svgInvalidAncestors);\n  fabric.svgValidParentsRegEx = getSvgRegex(svgValidParents);\n\n  fabric.cssRules = { };\n  fabric.gradientDefs = { };\n  fabric.clipPaths = { };\n\n  function normalizeAttr(attr) {\n    // transform attribute names\n    if (attr in attributesMap) {\n      return attributesMap[attr];\n    }\n    return attr;\n  }\n\n  function normalizeValue(attr, value, parentAttributes, fontSize) {\n    var isArray = Object.prototype.toString.call(value) === '[object Array]',\n        parsed;\n\n    if ((attr === 'fill' || attr === 'stroke') && value === 'none') {\n      value = '';\n    }\n    else if (attr === 'strokeUniform') {\n      return (value === 'non-scaling-stroke');\n    }\n    else if (attr === 'strokeDashArray') {\n      if (value === 'none') {\n        value = null;\n      }\n      else {\n        value = value.replace(/,/g, ' ').split(/\\s+/).map(parseFloat);\n      }\n    }\n    else if (attr === 'transformMatrix') {\n      if (parentAttributes && parentAttributes.transformMatrix) {\n        value = multiplyTransformMatrices(\n          parentAttributes.transformMatrix, fabric.parseTransformAttribute(value));\n      }\n      else {\n        value = fabric.parseTransformAttribute(value);\n      }\n    }\n    else if (attr === 'visible') {\n      value = value !== 'none' && value !== 'hidden';\n      // display=none on parent element always takes precedence over child element\n      if (parentAttributes && parentAttributes.visible === false) {\n        value = false;\n      }\n    }\n    else if (attr === 'opacity') {\n      value = parseFloat(value);\n      if (parentAttributes && typeof parentAttributes.opacity !== 'undefined') {\n        value *= parentAttributes.opacity;\n      }\n    }\n    else if (attr === 'textAnchor' /* text-anchor */) {\n      value = value === 'start' ? 'left' : value === 'end' ? 'right' : 'center';\n    }\n    else if (attr === 'charSpacing') {\n      // parseUnit returns px and we convert it to em\n      parsed = parseUnit(value, fontSize) / fontSize * 1000;\n    }\n    else if (attr === 'paintFirst') {\n      var fillIndex = value.indexOf('fill');\n      var strokeIndex = value.indexOf('stroke');\n      var value = 'fill';\n      if (fillIndex > -1 && strokeIndex > -1 && strokeIndex < fillIndex) {\n        value = 'stroke';\n      }\n      else if (fillIndex === -1 && strokeIndex > -1) {\n        value = 'stroke';\n      }\n    }\n    else if (attr === 'href' || attr === 'xlink:href' || attr === 'font') {\n      return value;\n    }\n    else if (attr === 'imageSmoothing') {\n      return (value === 'optimizeQuality');\n    }\n    else {\n      parsed = isArray ? value.map(parseUnit) : parseUnit(value, fontSize);\n    }\n\n    return (!isArray && isNaN(parsed) ? value : parsed);\n  }\n\n  /**\n    * @private\n    */\n  function getSvgRegex(arr) {\n    return new RegExp('^(' + arr.join('|') + ')\\\\b', 'i');\n  }\n\n  /**\n   * @private\n   * @param {Object} attributes Array of attributes to parse\n   */\n  function _setStrokeFillOpacity(attributes) {\n    for (var attr in colorAttributes) {\n\n      if (typeof attributes[colorAttributes[attr]] === 'undefined' || attributes[attr] === '') {\n        continue;\n      }\n\n      if (typeof attributes[attr] === 'undefined') {\n        if (!fabric.Object.prototype[attr]) {\n          continue;\n        }\n        attributes[attr] = fabric.Object.prototype[attr];\n      }\n\n      if (attributes[attr].indexOf('url(') === 0) {\n        continue;\n      }\n\n      var color = new fabric.Color(attributes[attr]);\n      attributes[attr] = color.setAlpha(toFixed(color.getAlpha() * attributes[colorAttributes[attr]], 2)).toRgba();\n    }\n    return attributes;\n  }\n\n  /**\n   * @private\n   */\n  function _getMultipleNodes(doc, nodeNames) {\n    var nodeName, nodeArray = [], nodeList, i, len;\n    for (i = 0, len = nodeNames.length; i < len; i++) {\n      nodeName = nodeNames[i];\n      nodeList = doc.getElementsByTagName(nodeName);\n      nodeArray = nodeArray.concat(Array.prototype.slice.call(nodeList));\n    }\n    return nodeArray;\n  }\n\n  /**\n   * Parses \"transform\" attribute, returning an array of values\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {String} attributeValue String containing attribute value\n   * @return {Array} Array of 6 elements representing transformation matrix\n   */\n  fabric.parseTransformAttribute = (function() {\n    function rotateMatrix(matrix, args) {\n      var cos = fabric.util.cos(args[0]), sin = fabric.util.sin(args[0]),\n          x = 0, y = 0;\n      if (args.length === 3) {\n        x = args[1];\n        y = args[2];\n      }\n\n      matrix[0] = cos;\n      matrix[1] = sin;\n      matrix[2] = -sin;\n      matrix[3] = cos;\n      matrix[4] = x - (cos * x - sin * y);\n      matrix[5] = y - (sin * x + cos * y);\n    }\n\n    function scaleMatrix(matrix, args) {\n      var multiplierX = args[0],\n          multiplierY = (args.length === 2) ? args[1] : args[0];\n\n      matrix[0] = multiplierX;\n      matrix[3] = multiplierY;\n    }\n\n    function skewMatrix(matrix, args, pos) {\n      matrix[pos] = Math.tan(fabric.util.degreesToRadians(args[0]));\n    }\n\n    function translateMatrix(matrix, args) {\n      matrix[4] = args[0];\n      if (args.length === 2) {\n        matrix[5] = args[1];\n      }\n    }\n\n    // identity matrix\n    var iMatrix = fabric.iMatrix,\n\n        // == begin transform regexp\n        number = fabric.reNum,\n\n        commaWsp = fabric.commaWsp,\n\n        skewX = '(?:(skewX)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        skewY = '(?:(skewY)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        rotate = '(?:(rotate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + ')' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        scale = '(?:(scale)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        translate = '(?:(translate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        matrix = '(?:(matrix)\\\\s*\\\\(\\\\s*' +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' +\n                  '\\\\s*\\\\))',\n\n        transform = '(?:' +\n                    matrix + '|' +\n                    translate + '|' +\n                    scale + '|' +\n                    rotate + '|' +\n                    skewX + '|' +\n                    skewY +\n                    ')',\n\n        transforms = '(?:' + transform + '(?:' + commaWsp + '*' + transform + ')*' + ')',\n\n        transformList = '^\\\\s*(?:' + transforms + '?)\\\\s*$',\n\n        // http://www.w3.org/TR/SVG/coords.html#TransformAttribute\n        reTransformList = new RegExp(transformList),\n        // == end transform regexp\n\n        reTransform = new RegExp(transform, 'g');\n\n    return function(attributeValue) {\n\n      // start with identity matrix\n      var matrix = iMatrix.concat(),\n          matrices = [];\n\n      // return if no argument was given or\n      // an argument does not match transform attribute regexp\n      if (!attributeValue || (attributeValue && !reTransformList.test(attributeValue))) {\n        return matrix;\n      }\n\n      attributeValue.replace(reTransform, function(match) {\n\n        var m = new RegExp(transform).exec(match).filter(function (match) {\n              // match !== '' && match != null\n              return (!!match);\n            }),\n            operation = m[1],\n            args = m.slice(2).map(parseFloat);\n\n        switch (operation) {\n          case 'translate':\n            translateMatrix(matrix, args);\n            break;\n          case 'rotate':\n            args[0] = fabric.util.degreesToRadians(args[0]);\n            rotateMatrix(matrix, args);\n            break;\n          case 'scale':\n            scaleMatrix(matrix, args);\n            break;\n          case 'skewX':\n            skewMatrix(matrix, args, 2);\n            break;\n          case 'skewY':\n            skewMatrix(matrix, args, 1);\n            break;\n          case 'matrix':\n            matrix = args;\n            break;\n        }\n\n        // snapshot current matrix into matrices array\n        matrices.push(matrix.concat());\n        // reset\n        matrix = iMatrix.concat();\n      });\n\n      var combinedMatrix = matrices[0];\n      while (matrices.length > 1) {\n        matrices.shift();\n        combinedMatrix = fabric.util.multiplyTransformMatrices(combinedMatrix, matrices[0]);\n      }\n      return combinedMatrix;\n    };\n  })();\n\n  /**\n   * @private\n   */\n  function parseStyleString(style, oStyle) {\n    var attr, value;\n    style.replace(/;\\s*$/, '').split(';').forEach(function (chunk) {\n      var pair = chunk.split(':');\n\n      attr = pair[0].trim().toLowerCase();\n      value =  pair[1].trim();\n\n      oStyle[attr] = value;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function parseStyleObject(style, oStyle) {\n    var attr, value;\n    for (var prop in style) {\n      if (typeof style[prop] === 'undefined') {\n        continue;\n      }\n\n      attr = prop.toLowerCase();\n      value = style[prop];\n\n      oStyle[attr] = value;\n    }\n  }\n\n  /**\n   * @private\n   */\n  function getGlobalStylesForElement(element, svgUid) {\n    var styles = { };\n    for (var rule in fabric.cssRules[svgUid]) {\n      if (elementMatchesRule(element, rule.split(' '))) {\n        for (var property in fabric.cssRules[svgUid][rule]) {\n          styles[property] = fabric.cssRules[svgUid][rule][property];\n        }\n      }\n    }\n    return styles;\n  }\n\n  /**\n   * @private\n   */\n  function elementMatchesRule(element, selectors) {\n    var firstMatching, parentMatching = true;\n    //start from rightmost selector.\n    firstMatching = selectorMatches(element, selectors.pop());\n    if (firstMatching && selectors.length) {\n      parentMatching = doesSomeParentMatch(element, selectors);\n    }\n    return firstMatching && parentMatching && (selectors.length === 0);\n  }\n\n  function doesSomeParentMatch(element, selectors) {\n    var selector, parentMatching = true;\n    while (element.parentNode && element.parentNode.nodeType === 1 && selectors.length) {\n      if (parentMatching) {\n        selector = selectors.pop();\n      }\n      element = element.parentNode;\n      parentMatching = selectorMatches(element, selector);\n    }\n    return selectors.length === 0;\n  }\n\n  /**\n   * @private\n   */\n  function selectorMatches(element, selector) {\n    var nodeName = element.nodeName,\n        classNames = element.getAttribute('class'),\n        id = element.getAttribute('id'), matcher, i;\n    // i check if a selector matches slicing away part from it.\n    // if i get empty string i should match\n    matcher = new RegExp('^' + nodeName, 'i');\n    selector = selector.replace(matcher, '');\n    if (id && selector.length) {\n      matcher = new RegExp('#' + id + '(?![a-zA-Z\\\\-]+)', 'i');\n      selector = selector.replace(matcher, '');\n    }\n    if (classNames && selector.length) {\n      classNames = classNames.split(' ');\n      for (i = classNames.length; i--;) {\n        matcher = new RegExp('\\\\.' + classNames[i] + '(?![a-zA-Z\\\\-]+)', 'i');\n        selector = selector.replace(matcher, '');\n      }\n    }\n    return selector.length === 0;\n  }\n\n  /**\n   * @private\n   * to support IE8 missing getElementById on SVGdocument and on node xmlDOM\n   */\n  function elementById(doc, id) {\n    var el;\n    doc.getElementById && (el = doc.getElementById(id));\n    if (el) {\n      return el;\n    }\n    var node, i, len, nodelist = doc.getElementsByTagName('*');\n    for (i = 0, len = nodelist.length; i < len; i++) {\n      node = nodelist[i];\n      if (id === node.getAttribute('id')) {\n        return node;\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  function parseUseDirectives(doc) {\n    var nodelist = _getMultipleNodes(doc, ['use', 'svg:use']), i = 0;\n    while (nodelist.length && i < nodelist.length) {\n      var el = nodelist[i],\n          xlinkAttribute = el.getAttribute('xlink:href') || el.getAttribute('href');\n\n      if (xlinkAttribute === null) {\n        return;\n      }\n\n      var xlink = xlinkAttribute.substr(1),\n          x = el.getAttribute('x') || 0,\n          y = el.getAttribute('y') || 0,\n          el2 = elementById(doc, xlink).cloneNode(true),\n          currentTrans = (el2.getAttribute('transform') || '') + ' translate(' + x + ', ' + y + ')',\n          parentNode,\n          oldLength = nodelist.length, attr,\n          j,\n          attrs,\n          len,\n          namespace = fabric.svgNS;\n\n      applyViewboxTransform(el2);\n      if (/^svg$/i.test(el2.nodeName)) {\n        var el3 = el2.ownerDocument.createElementNS(namespace, 'g');\n        for (j = 0, attrs = el2.attributes, len = attrs.length; j < len; j++) {\n          attr = attrs.item(j);\n          el3.setAttributeNS(namespace, attr.nodeName, attr.nodeValue);\n        }\n        // el2.firstChild != null\n        while (el2.firstChild) {\n          el3.appendChild(el2.firstChild);\n        }\n        el2 = el3;\n      }\n\n      for (j = 0, attrs = el.attributes, len = attrs.length; j < len; j++) {\n        attr = attrs.item(j);\n        if (attr.nodeName === 'x' || attr.nodeName === 'y' ||\n          attr.nodeName === 'xlink:href' || attr.nodeName === 'href') {\n          continue;\n        }\n\n        if (attr.nodeName === 'transform') {\n          currentTrans = attr.nodeValue + ' ' + currentTrans;\n        }\n        else {\n          el2.setAttribute(attr.nodeName, attr.nodeValue);\n        }\n      }\n\n      el2.setAttribute('transform', currentTrans);\n      el2.setAttribute('instantiated_by_use', '1');\n      el2.removeAttribute('id');\n      parentNode = el.parentNode;\n      parentNode.replaceChild(el2, el);\n      // some browsers do not shorten nodelist after replaceChild (IE8)\n      if (nodelist.length === oldLength) {\n        i++;\n      }\n    }\n  }\n\n  // http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute\n  // matches, e.g.: +14.56e-12, etc.\n  var reViewBoxAttrValue = new RegExp(\n    '^' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*' +\n    '$'\n  );\n\n  /**\n   * Add a <g> element that envelop all child elements and makes the viewbox transformMatrix descend on all elements\n   */\n  function applyViewboxTransform(element) {\n    if (!fabric.svgViewBoxElementsRegEx.test(element.nodeName)) {\n      return {};\n    }\n    var viewBoxAttr = element.getAttribute('viewBox'),\n        scaleX = 1,\n        scaleY = 1,\n        minX = 0,\n        minY = 0,\n        viewBoxWidth, viewBoxHeight, matrix, el,\n        widthAttr = element.getAttribute('width'),\n        heightAttr = element.getAttribute('height'),\n        x = element.getAttribute('x') || 0,\n        y = element.getAttribute('y') || 0,\n        preserveAspectRatio = element.getAttribute('preserveAspectRatio') || '',\n        missingViewBox = (!viewBoxAttr || !(viewBoxAttr = viewBoxAttr.match(reViewBoxAttrValue))),\n        missingDimAttr = (!widthAttr || !heightAttr || widthAttr === '100%' || heightAttr === '100%'),\n        toBeParsed = missingViewBox && missingDimAttr,\n        parsedDim = { }, translateMatrix = '', widthDiff = 0, heightDiff = 0;\n\n    parsedDim.width = 0;\n    parsedDim.height = 0;\n    parsedDim.toBeParsed = toBeParsed;\n\n    if (missingViewBox) {\n      if (((x || y) && element.parentNode && element.parentNode.nodeName !== '#document')) {\n        translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\n        matrix = (element.getAttribute('transform') || '') + translateMatrix;\n        element.setAttribute('transform', matrix);\n        element.removeAttribute('x');\n        element.removeAttribute('y');\n      }\n    }\n\n    if (toBeParsed) {\n      return parsedDim;\n    }\n\n    if (missingViewBox) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      // set a transform for elements that have x y and are inner(only) SVGs\n      return parsedDim;\n    }\n    minX = -parseFloat(viewBoxAttr[1]);\n    minY = -parseFloat(viewBoxAttr[2]);\n    viewBoxWidth = parseFloat(viewBoxAttr[3]);\n    viewBoxHeight = parseFloat(viewBoxAttr[4]);\n    parsedDim.minX = minX;\n    parsedDim.minY = minY;\n    parsedDim.viewBoxWidth = viewBoxWidth;\n    parsedDim.viewBoxHeight = viewBoxHeight;\n    if (!missingDimAttr) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      scaleX = parsedDim.width / viewBoxWidth;\n      scaleY = parsedDim.height / viewBoxHeight;\n    }\n    else {\n      parsedDim.width = viewBoxWidth;\n      parsedDim.height = viewBoxHeight;\n    }\n\n    // default is to preserve aspect ratio\n    preserveAspectRatio = fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);\n    if (preserveAspectRatio.alignX !== 'none') {\n      //translate all container for the effect of Mid, Min, Max\n      if (preserveAspectRatio.meetOrSlice === 'meet') {\n        scaleY = scaleX = (scaleX > scaleY ? scaleY : scaleX);\n        // calculate additional translation to move the viewbox\n      }\n      if (preserveAspectRatio.meetOrSlice === 'slice') {\n        scaleY = scaleX = (scaleX > scaleY ? scaleX : scaleY);\n        // calculate additional translation to move the viewbox\n      }\n      widthDiff = parsedDim.width - viewBoxWidth * scaleX;\n      heightDiff = parsedDim.height - viewBoxHeight * scaleX;\n      if (preserveAspectRatio.alignX === 'Mid') {\n        widthDiff /= 2;\n      }\n      if (preserveAspectRatio.alignY === 'Mid') {\n        heightDiff /= 2;\n      }\n      if (preserveAspectRatio.alignX === 'Min') {\n        widthDiff = 0;\n      }\n      if (preserveAspectRatio.alignY === 'Min') {\n        heightDiff = 0;\n      }\n    }\n\n    if (scaleX === 1 && scaleY === 1 && minX === 0 && minY === 0 && x === 0 && y === 0) {\n      return parsedDim;\n    }\n    if ((x || y) && element.parentNode.nodeName !== '#document') {\n      translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\n    }\n\n    matrix = translateMatrix + ' matrix(' + scaleX +\n                  ' 0' +\n                  ' 0 ' +\n                  scaleY + ' ' +\n                  (minX * scaleX + widthDiff) + ' ' +\n                  (minY * scaleY + heightDiff) + ') ';\n    // seems unused.\n    // parsedDim.viewboxTransform = fabric.parseTransformAttribute(matrix);\n    if (element.nodeName === 'svg') {\n      el = element.ownerDocument.createElementNS(fabric.svgNS, 'g');\n      // element.firstChild != null\n      while (element.firstChild) {\n        el.appendChild(element.firstChild);\n      }\n      element.appendChild(el);\n    }\n    else {\n      el = element;\n      el.removeAttribute('x');\n      el.removeAttribute('y');\n      matrix = el.getAttribute('transform') + matrix;\n    }\n    el.setAttribute('transform', matrix);\n    return parsedDim;\n  }\n\n  function hasAncestorWithNodeName(element, nodeName) {\n    while (element && (element = element.parentNode)) {\n      if (element.nodeName && nodeName.test(element.nodeName.replace('svg:', ''))\n        && !element.getAttribute('instantiated_by_use')) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {SVGDocument} doc SVG document to parse\n   * @param {Function} callback Callback to call when parsing is finished;\n   * It's being passed an array of elements (parsed from a document).\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n   * @param {Object} [parsingOptions] options for parsing document\n   * @param {String} [parsingOptions.crossOrigin] crossOrigin settings\n   */\n  fabric.parseSVGDocument = function(doc, callback, reviver, parsingOptions) {\n    if (!doc) {\n      return;\n    }\n\n    parseUseDirectives(doc);\n\n    var svgUid =  fabric.Object.__uid++, i, len,\n        options = applyViewboxTransform(doc),\n        descendants = fabric.util.toArray(doc.getElementsByTagName('*'));\n    options.crossOrigin = parsingOptions && parsingOptions.crossOrigin;\n    options.svgUid = svgUid;\n\n    if (descendants.length === 0 && fabric.isLikelyNode) {\n      // we're likely in node, where \"o3-xml\" library fails to gEBTN(\"*\")\n      // https://github.com/ajaxorg/node-o3-xml/issues/21\n      descendants = doc.selectNodes('//*[name(.)!=\"svg\"]');\n      var arr = [];\n      for (i = 0, len = descendants.length; i < len; i++) {\n        arr[i] = descendants[i];\n      }\n      descendants = arr;\n    }\n\n    var elements = descendants.filter(function(el) {\n      applyViewboxTransform(el);\n      return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', '')) &&\n            !hasAncestorWithNodeName(el, fabric.svgInvalidAncestorsRegEx); // http://www.w3.org/TR/SVG/struct.html#DefsElement\n    });\n    if (!elements || (elements && !elements.length)) {\n      callback && callback([], {});\n      return;\n    }\n    var clipPaths = { };\n    descendants.filter(function(el) {\n      return el.nodeName.replace('svg:', '') === 'clipPath';\n    }).forEach(function(el) {\n      var id = el.getAttribute('id');\n      clipPaths[id] = fabric.util.toArray(el.getElementsByTagName('*')).filter(function(el) {\n        return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', ''));\n      });\n    });\n    fabric.gradientDefs[svgUid] = fabric.getGradientDefs(doc);\n    fabric.cssRules[svgUid] = fabric.getCSSRules(doc);\n    fabric.clipPaths[svgUid] = clipPaths;\n    // Precedence of rules:   style > class > attribute\n    fabric.parseElements(elements, function(instances, elements) {\n      if (callback) {\n        callback(instances, options, elements, descendants);\n        delete fabric.gradientDefs[svgUid];\n        delete fabric.cssRules[svgUid];\n        delete fabric.clipPaths[svgUid];\n      }\n    }, clone(options), reviver, parsingOptions);\n  };\n\n  function recursivelyParseGradientsXlink(doc, gradient) {\n    var gradientsAttrs = ['gradientTransform', 'x1', 'x2', 'y1', 'y2', 'gradientUnits', 'cx', 'cy', 'r', 'fx', 'fy'],\n        xlinkAttr = 'xlink:href',\n        xLink = gradient.getAttribute(xlinkAttr).substr(1),\n        referencedGradient = elementById(doc, xLink);\n    if (referencedGradient && referencedGradient.getAttribute(xlinkAttr)) {\n      recursivelyParseGradientsXlink(doc, referencedGradient);\n    }\n    gradientsAttrs.forEach(function(attr) {\n      if (referencedGradient && !gradient.hasAttribute(attr) && referencedGradient.hasAttribute(attr)) {\n        gradient.setAttribute(attr, referencedGradient.getAttribute(attr));\n      }\n    });\n    if (!gradient.children.length) {\n      var referenceClone = referencedGradient.cloneNode(true);\n      while (referenceClone.firstChild) {\n        gradient.appendChild(referenceClone.firstChild);\n      }\n    }\n    gradient.removeAttribute(xlinkAttr);\n  }\n\n  var reFontDeclaration = new RegExp(\n    '(normal|italic)?\\\\s*(normal|small-caps)?\\\\s*' +\n    '(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\\\s*(' +\n      fabric.reNum +\n    '(?:px|cm|mm|em|pt|pc|in)*)(?:\\\\/(normal|' + fabric.reNum + '))?\\\\s+(.*)');\n\n  extend(fabric, {\n    /**\n     * Parses a short font declaration, building adding its properties to a style object\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {String} value font declaration\n     * @param {Object} oStyle definition\n     */\n    parseFontDeclaration: function(value, oStyle) {\n      var match = value.match(reFontDeclaration);\n\n      if (!match) {\n        return;\n      }\n      var fontStyle = match[1],\n          // font variant is not used\n          // fontVariant = match[2],\n          fontWeight = match[3],\n          fontSize = match[4],\n          lineHeight = match[5],\n          fontFamily = match[6];\n\n      if (fontStyle) {\n        oStyle.fontStyle = fontStyle;\n      }\n      if (fontWeight) {\n        oStyle.fontWeight = isNaN(parseFloat(fontWeight)) ? fontWeight : parseFloat(fontWeight);\n      }\n      if (fontSize) {\n        oStyle.fontSize = parseUnit(fontSize);\n      }\n      if (fontFamily) {\n        oStyle.fontFamily = fontFamily;\n      }\n      if (lineHeight) {\n        oStyle.lineHeight = lineHeight === 'normal' ? 1 : lineHeight;\n      }\n    },\n\n    /**\n     * Parses an SVG document, returning all of the gradient declarations found in it\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element\n     */\n    getGradientDefs: function(doc) {\n      var tagArray = [\n            'linearGradient',\n            'radialGradient',\n            'svg:linearGradient',\n            'svg:radialGradient'],\n          elList = _getMultipleNodes(doc, tagArray),\n          el, j = 0, gradientDefs = { };\n      j = elList.length;\n      while (j--) {\n        el = elList[j];\n        if (el.getAttribute('xlink:href')) {\n          recursivelyParseGradientsXlink(doc, el);\n        }\n        gradientDefs[el.getAttribute('id')] = el;\n      }\n      return gradientDefs;\n    },\n\n    /**\n     * Returns an object of attributes' name/value, given element and an array of attribute names;\n     * Parses parent \"g\" nodes recursively upwards.\n     * @static\n     * @memberOf fabric\n     * @param {DOMElement} element Element to parse\n     * @param {Array} attributes Array of attributes to parse\n     * @return {Object} object containing parsed attributes' names/values\n     */\n    parseAttributes: function(element, attributes, svgUid) {\n\n      if (!element) {\n        return;\n      }\n\n      var value,\n          parentAttributes = { },\n          fontSize, parentFontSize;\n\n      if (typeof svgUid === 'undefined') {\n        svgUid = element.getAttribute('svgUid');\n      }\n      // if there's a parent container (`g` or `a` or `symbol` node), parse its attributes recursively upwards\n      if (element.parentNode && fabric.svgValidParentsRegEx.test(element.parentNode.nodeName)) {\n        parentAttributes = fabric.parseAttributes(element.parentNode, attributes, svgUid);\n      }\n\n      var ownAttributes = attributes.reduce(function(memo, attr) {\n        value = element.getAttribute(attr);\n        if (value) { // eslint-disable-line\n          memo[attr] = value;\n        }\n        return memo;\n      }, { });\n      // add values parsed from style, which take precedence over attributes\n      // (see: http://www.w3.org/TR/SVG/styling.html#UsingPresentationAttributes)\n      var cssAttrs = extend(\n        getGlobalStylesForElement(element, svgUid),\n        fabric.parseStyleAttribute(element)\n      );\n      ownAttributes = extend(\n        ownAttributes,\n        cssAttrs\n      );\n      if (cssAttrs[cPath]) {\n        element.setAttribute(cPath, cssAttrs[cPath]);\n      }\n      fontSize = parentFontSize = parentAttributes.fontSize || fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      if (ownAttributes[fSize]) {\n        // looks like the minimum should be 9px when dealing with ems. this is what looks like in browsers.\n        ownAttributes[fSize] = fontSize = parseUnit(ownAttributes[fSize], parentFontSize);\n      }\n\n      var normalizedAttr, normalizedValue, normalizedStyle = {};\n      for (var attr in ownAttributes) {\n        normalizedAttr = normalizeAttr(attr);\n        normalizedValue = normalizeValue(normalizedAttr, ownAttributes[attr], parentAttributes, fontSize);\n        normalizedStyle[normalizedAttr] = normalizedValue;\n      }\n      if (normalizedStyle && normalizedStyle.font) {\n        fabric.parseFontDeclaration(normalizedStyle.font, normalizedStyle);\n      }\n      var mergedAttrs = extend(parentAttributes, normalizedStyle);\n      return fabric.svgValidParentsRegEx.test(element.nodeName) ? mergedAttrs : _setStrokeFillOpacity(mergedAttrs);\n    },\n\n    /**\n     * Transforms an array of svg elements to corresponding fabric.* instances\n     * @static\n     * @memberOf fabric\n     * @param {Array} elements Array of elements to parse\n     * @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)\n     * @param {Object} [options] Options object\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     */\n    parseElements: function(elements, callback, options, reviver, parsingOptions) {\n      new fabric.ElementsParser(elements, callback, options, reviver, parsingOptions).parse();\n    },\n\n    /**\n     * Parses \"style\" attribute, retuning an object with values\n     * @static\n     * @memberOf fabric\n     * @param {SVGElement} element Element to parse\n     * @return {Object} Objects with values parsed from style attribute of an element\n     */\n    parseStyleAttribute: function(element) {\n      var oStyle = { },\n          style = element.getAttribute('style');\n\n      if (!style) {\n        return oStyle;\n      }\n\n      if (typeof style === 'string') {\n        parseStyleString(style, oStyle);\n      }\n      else {\n        parseStyleObject(style, oStyle);\n      }\n\n      return oStyle;\n    },\n\n    /**\n     * Parses \"points\" attribute, returning an array of values\n     * @static\n     * @memberOf fabric\n     * @param {String} points points attribute string\n     * @return {Array} array of points\n     */\n    parsePointsAttribute: function(points) {\n\n      // points attribute is required and must not be empty\n      if (!points) {\n        return null;\n      }\n\n      // replace commas with whitespace and remove bookending whitespace\n      points = points.replace(/,/g, ' ').trim();\n\n      points = points.split(/\\s+/);\n      var parsedPoints = [], i, len;\n\n      for (i = 0, len = points.length; i < len; i += 2) {\n        parsedPoints.push({\n          x: parseFloat(points[i]),\n          y: parseFloat(points[i + 1])\n        });\n      }\n\n      // odd number of points is an error\n      // if (parsedPoints.length % 2 !== 0) {\n      //   return null;\n      // }\n\n      return parsedPoints;\n    },\n\n    /**\n     * Returns CSS rules for a given SVG document\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} CSS rules of this document\n     */\n    getCSSRules: function(doc) {\n      var styles = doc.getElementsByTagName('style'), i, len,\n          allRules = { }, rules;\n\n      // very crude parsing of style contents\n      for (i = 0, len = styles.length; i < len; i++) {\n        var styleContents = styles[i].textContent;\n\n        // remove comments\n        styleContents = styleContents.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\n        if (styleContents.trim() === '') {\n          continue;\n        }\n        rules = styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);\n        rules = rules.map(function(rule) { return rule.trim(); });\n        // eslint-disable-next-line no-loop-func\n        rules.forEach(function(rule) {\n\n          var match = rule.match(/([\\s\\S]*?)\\s*\\{([^}]*)\\}/),\n              ruleObj = { }, declaration = match[2].trim(),\n              propertyValuePairs = declaration.replace(/;$/, '').split(/\\s*;\\s*/);\n\n          for (i = 0, len = propertyValuePairs.length; i < len; i++) {\n            var pair = propertyValuePairs[i].split(/\\s*:\\s*/),\n                property = pair[0],\n                value = pair[1];\n            ruleObj[property] = value;\n          }\n          rule = match[1];\n          rule.split(',').forEach(function(_rule) {\n            _rule = _rule.replace(/^svg/i, '').trim();\n            if (_rule === '') {\n              return;\n            }\n            if (allRules[_rule]) {\n              fabric.util.object.extend(allRules[_rule], ruleObj);\n            }\n            else {\n              allRules[_rule] = fabric.util.object.clone(ruleObj);\n            }\n          });\n        });\n      }\n      return allRules;\n    },\n\n    /**\n     * Takes url corresponding to an SVG document, and parses it into a set of fabric objects.\n     * Note that SVG is fetched via XMLHttpRequest, so it needs to conform to SOP (Same Origin Policy)\n     * @memberOf fabric\n     * @param {String} url\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromURL: function(url, callback, reviver, options) {\n\n      url = url.replace(/^\\n\\s*/, '').trim();\n      new fabric.util.request(url, {\n        method: 'get',\n        onComplete: onComplete\n      });\n\n      function onComplete(r) {\n\n        var xml = r.responseXML;\n        if (!xml || !xml.documentElement) {\n          callback && callback(null);\n          return false;\n        }\n\n        fabric.parseSVGDocument(xml.documentElement, function (results, _options, elements, allElements) {\n          callback && callback(results, _options, elements, allElements);\n        }, reviver, options);\n      }\n    },\n\n    /**\n     * Takes string corresponding to an SVG document, and parses it into a set of fabric objects\n     * @memberOf fabric\n     * @param {String} string\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromString: function(string, callback, reviver, options) {\n      var parser = new fabric.window.DOMParser(),\n          doc = parser.parseFromString(string.trim(), 'text/xml');\n      fabric.parseSVGDocument(doc.documentElement, function (results, _options, elements, allElements) {\n        callback(results, _options, elements, allElements);\n      }, reviver, options);\n    }\n  });\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.ElementsParser = function(elements, callback, options, reviver, parsingOptions, doc) {\n  this.elements = elements;\n  this.callback = callback;\n  this.options = options;\n  this.reviver = reviver;\n  this.svgUid = (options && options.svgUid) || 0;\n  this.parsingOptions = parsingOptions;\n  this.regexUrl = /^url\\(['\"]?#([^'\"]+)['\"]?\\)/g;\n  this.doc = doc;\n};\n\n(function(proto) {\n  proto.parse = function() {\n    this.instances = new Array(this.elements.length);\n    this.numElements = this.elements.length;\n    this.createObjects();\n  };\n\n  proto.createObjects = function() {\n    var _this = this;\n    this.elements.forEach(function(element, i) {\n      element.setAttribute('svgUid', _this.svgUid);\n      _this.createObject(element, i);\n    });\n  };\n\n  proto.findTag = function(el) {\n    return fabric[fabric.util.string.capitalize(el.tagName.replace('svg:', ''))];\n  };\n\n  proto.createObject = function(el, index) {\n    var klass = this.findTag(el);\n    if (klass && klass.fromElement) {\n      try {\n        klass.fromElement(el, this.createCallback(index, el), this.options);\n      }\n      catch (err) {\n        fabric.log(err);\n      }\n    }\n    else {\n      this.checkIfDone();\n    }\n  };\n\n  proto.createCallback = function(index, el) {\n    var _this = this;\n    return function(obj) {\n      var _options;\n      _this.resolveGradient(obj, el, 'fill');\n      _this.resolveGradient(obj, el, 'stroke');\n      if (obj instanceof fabric.Image && obj._originalElement) {\n        _options = obj.parsePreserveAspectRatioAttribute(el);\n      }\n      obj._removeTransformMatrix(_options);\n      _this.resolveClipPath(obj, el);\n      _this.reviver && _this.reviver(el, obj);\n      _this.instances[index] = obj;\n      _this.checkIfDone();\n    };\n  };\n\n  proto.extractPropertyDefinition = function(obj, property, storage) {\n    var value = obj[property], regex = this.regexUrl;\n    if (!regex.test(value)) {\n      return;\n    }\n    regex.lastIndex = 0;\n    var id = regex.exec(value)[1];\n    regex.lastIndex = 0;\n    return fabric[storage][this.svgUid][id];\n  };\n\n  proto.resolveGradient = function(obj, el, property) {\n    var gradientDef = this.extractPropertyDefinition(obj, property, 'gradientDefs');\n    if (gradientDef) {\n      var opacityAttr = el.getAttribute(property + '-opacity');\n      var gradient = fabric.Gradient.fromElement(gradientDef, obj, opacityAttr, this.options);\n      obj.set(property, gradient);\n    }\n  };\n\n  proto.createClipPathCallback = function(obj, container) {\n    return function(_newObj) {\n      _newObj._removeTransformMatrix();\n      _newObj.fillRule = _newObj.clipRule;\n      container.push(_newObj);\n    };\n  };\n\n  proto.resolveClipPath = function(obj, usingElement) {\n    var clipPath = this.extractPropertyDefinition(obj, 'clipPath', 'clipPaths'),\n        element, klass, objTransformInv, container, gTransform, options;\n    if (clipPath) {\n      container = [];\n      objTransformInv = fabric.util.invertTransform(obj.calcTransformMatrix());\n      // move the clipPath tag as sibling to the real element that is using it\n      var clipPathTag = clipPath[0].parentNode;\n      var clipPathOwner = usingElement;\n      while (clipPathOwner.parentNode && clipPathOwner.getAttribute('clip-path') !== obj.clipPath) {\n        clipPathOwner = clipPathOwner.parentNode;\n      }\n      clipPathOwner.parentNode.appendChild(clipPathTag);\n      for (var i = 0; i < clipPath.length; i++) {\n        element = clipPath[i];\n        klass = this.findTag(element);\n        klass.fromElement(\n          element,\n          this.createClipPathCallback(obj, container),\n          this.options\n        );\n      }\n      if (container.length === 1) {\n        clipPath = container[0];\n      }\n      else {\n        clipPath = new fabric.Group(container);\n      }\n      gTransform = fabric.util.multiplyTransformMatrices(\n        objTransformInv,\n        clipPath.calcTransformMatrix()\n      );\n      if (clipPath.clipPath) {\n        this.resolveClipPath(clipPath, clipPathOwner);\n      }\n      var options = fabric.util.qrDecompose(gTransform);\n      clipPath.flipX = false;\n      clipPath.flipY = false;\n      clipPath.set('scaleX', options.scaleX);\n      clipPath.set('scaleY', options.scaleY);\n      clipPath.angle = options.angle;\n      clipPath.skewX = options.skewX;\n      clipPath.skewY = 0;\n      clipPath.setPositionByOrigin({ x: options.translateX, y: options.translateY }, 'center', 'center');\n      obj.clipPath = clipPath;\n    }\n    else {\n      // if clip-path does not resolve to any element, delete the property.\n      delete obj.clipPath;\n    }\n  };\n\n  proto.checkIfDone = function() {\n    if (--this.numElements === 0) {\n      this.instances = this.instances.filter(function(el) {\n        // eslint-disable-next-line no-eq-null, eqeqeq\n        return el != null;\n      });\n      this.callback(this.instances, this.elements);\n    }\n  };\n})(fabric.ElementsParser.prototype);\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Point) {\n    fabric.warn('fabric.Point is already defined');\n    return;\n  }\n\n  fabric.Point = Point;\n\n  /**\n   * Point class\n   * @class fabric.Point\n   * @memberOf fabric\n   * @constructor\n   * @param {Number} x\n   * @param {Number} y\n   * @return {fabric.Point} thisArg\n   */\n  function Point(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  Point.prototype = /** @lends fabric.Point.prototype */ {\n\n    type: 'point',\n\n    constructor: Point,\n\n    /**\n     * Adds another point to this one and returns another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point instance with added values\n     */\n    add: function (that) {\n      return new Point(this.x + that.x, this.y + that.y);\n    },\n\n    /**\n     * Adds another point to this one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    addEquals: function (that) {\n      this.x += that.x;\n      this.y += that.y;\n      return this;\n    },\n\n    /**\n     * Adds value to this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point} new Point with added value\n     */\n    scalarAdd: function (scalar) {\n      return new Point(this.x + scalar, this.y + scalar);\n    },\n\n    /**\n     * Adds value to this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarAddEquals: function (scalar) {\n      this.x += scalar;\n      this.y += scalar;\n      return this;\n    },\n\n    /**\n     * Subtracts another point from this point and returns a new one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point object with subtracted values\n     */\n    subtract: function (that) {\n      return new Point(this.x - that.x, this.y - that.y);\n    },\n\n    /**\n     * Subtracts another point from this point\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    subtractEquals: function (that) {\n      this.x -= that.x;\n      this.y -= that.y;\n      return this;\n    },\n\n    /**\n     * Subtracts value from this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    scalarSubtract: function (scalar) {\n      return new Point(this.x - scalar, this.y - scalar);\n    },\n\n    /**\n     * Subtracts value from this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarSubtractEquals: function (scalar) {\n      this.x -= scalar;\n      this.y -= scalar;\n      return this;\n    },\n\n    /**\n     * Multiplies this point by a value and returns a new one\n     * TODO: rename in scalarMultiply in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    multiply: function (scalar) {\n      return new Point(this.x * scalar, this.y * scalar);\n    },\n\n    /**\n     * Multiplies this point by a value\n     * TODO: rename in scalarMultiplyEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    multiplyEquals: function (scalar) {\n      this.x *= scalar;\n      this.y *= scalar;\n      return this;\n    },\n\n    /**\n     * Divides this point by a value and returns a new one\n     * TODO: rename in scalarDivide in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    divide: function (scalar) {\n      return new Point(this.x / scalar, this.y / scalar);\n    },\n\n    /**\n     * Divides this point by a value\n     * TODO: rename in scalarDivideEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    divideEquals: function (scalar) {\n      this.x /= scalar;\n      this.y /= scalar;\n      return this;\n    },\n\n    /**\n     * Returns true if this point is equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    eq: function (that) {\n      return (this.x === that.x && this.y === that.y);\n    },\n\n    /**\n     * Returns true if this point is less than another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lt: function (that) {\n      return (this.x < that.x && this.y < that.y);\n    },\n\n    /**\n     * Returns true if this point is less than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lte: function (that) {\n      return (this.x <= that.x && this.y <= that.y);\n    },\n\n    /**\n\n     * Returns true if this point is greater another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gt: function (that) {\n      return (this.x > that.x && this.y > that.y);\n    },\n\n    /**\n     * Returns true if this point is greater than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gte: function (that) {\n      return (this.x >= that.x && this.y >= that.y);\n    },\n\n    /**\n     * Returns new point which is the result of linear interpolation with this one and another one\n     * @param {fabric.Point} that\n     * @param {Number} t , position of interpolation, between 0 and 1 default 0.5\n     * @return {fabric.Point}\n     */\n    lerp: function (that, t) {\n      if (typeof t === 'undefined') {\n        t = 0.5;\n      }\n      t = Math.max(Math.min(1, t), 0);\n      return new Point(this.x + (that.x - this.x) * t, this.y + (that.y - this.y) * t);\n    },\n\n    /**\n     * Returns distance from this point and another one\n     * @param {fabric.Point} that\n     * @return {Number}\n     */\n    distanceFrom: function (that) {\n      var dx = this.x - that.x,\n          dy = this.y - that.y;\n      return Math.sqrt(dx * dx + dy * dy);\n    },\n\n    /**\n     * Returns the point between this point and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    midPointFrom: function (that) {\n      return this.lerp(that);\n    },\n\n    /**\n     * Returns a new point which is the min of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    min: function (that) {\n      return new Point(Math.min(this.x, that.x), Math.min(this.y, that.y));\n    },\n\n    /**\n     * Returns a new point which is the max of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    max: function (that) {\n      return new Point(Math.max(this.x, that.x), Math.max(this.y, that.y));\n    },\n\n    /**\n     * Returns string representation of this point\n     * @return {String}\n     */\n    toString: function () {\n      return this.x + ',' + this.y;\n    },\n\n    /**\n     * Sets x/y of this point\n     * @param {Number} x\n     * @param {Number} y\n     * @chainable\n     */\n    setXY: function (x, y) {\n      this.x = x;\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x of this point\n     * @param {Number} x\n     * @chainable\n     */\n    setX: function (x) {\n      this.x = x;\n      return this;\n    },\n\n    /**\n     * Sets y of this point\n     * @param {Number} y\n     * @chainable\n     */\n    setY: function (y) {\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x/y of this point from another point\n     * @param {fabric.Point} that\n     * @chainable\n     */\n    setFromPoint: function (that) {\n      this.x = that.x;\n      this.y = that.y;\n      return this;\n    },\n\n    /**\n     * Swaps x/y of this point and another point\n     * @param {fabric.Point} that\n     */\n    swap: function (that) {\n      var x = this.x,\n          y = this.y;\n      this.x = that.x;\n      this.y = that.y;\n      that.x = x;\n      that.y = y;\n    },\n\n    /**\n     * return a cloned instance of the point\n     * @return {fabric.Point}\n     */\n    clone: function () {\n      return new Point(this.x, this.y);\n    }\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Intersection) {\n    fabric.warn('fabric.Intersection is already defined');\n    return;\n  }\n\n  /**\n   * Intersection class\n   * @class fabric.Intersection\n   * @memberOf fabric\n   * @constructor\n   */\n  function Intersection(status) {\n    this.status = status;\n    this.points = [];\n  }\n\n  fabric.Intersection = Intersection;\n\n  fabric.Intersection.prototype = /** @lends fabric.Intersection.prototype */ {\n\n    constructor: Intersection,\n\n    /**\n     * Appends a point to intersection\n     * @param {fabric.Point} point\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoint: function (point) {\n      this.points.push(point);\n      return this;\n    },\n\n    /**\n     * Appends points to intersection\n     * @param {Array} points\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoints: function (points) {\n      this.points = this.points.concat(points);\n      return this;\n    }\n  };\n\n  /**\n   * Checks if one line intersects another\n   * TODO: rename in intersectSegmentSegment\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {fabric.Point} b1\n   * @param {fabric.Point} b2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLineLine = function (a1, a2, b1, b2) {\n    var result,\n        uaT = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x),\n        ubT = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x),\n        uB = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);\n    if (uB !== 0) {\n      var ua = uaT / uB,\n          ub = ubT / uB;\n      if (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {\n        result = new Intersection('Intersection');\n        result.appendPoint(new fabric.Point(a1.x + ua * (a2.x - a1.x), a1.y + ua * (a2.y - a1.y)));\n      }\n      else {\n        result = new Intersection();\n      }\n    }\n    else {\n      if (uaT === 0 || ubT === 0) {\n        result = new Intersection('Coincident');\n      }\n      else {\n        result = new Intersection('Parallel');\n      }\n    }\n    return result;\n  };\n\n  /**\n   * Checks if line intersects polygon\n   * TODO: rename in intersectSegmentPolygon\n   * fix detection of coincident\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {Array} points\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLinePolygon = function(a1, a2, points) {\n    var result = new Intersection(),\n        length = points.length,\n        b1, b2, inter, i;\n\n    for (i = 0; i < length; i++) {\n      b1 = points[i];\n      b2 = points[(i + 1) % length];\n      inter = Intersection.intersectLineLine(a1, a2, b1, b2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects another polygon\n   * @static\n   * @param {Array} points1\n   * @param {Array} points2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonPolygon = function (points1, points2) {\n    var result = new Intersection(),\n        length = points1.length, i;\n\n    for (i = 0; i < length; i++) {\n      var a1 = points1[i],\n          a2 = points1[(i + 1) % length],\n          inter = Intersection.intersectLinePolygon(a1, a2, points2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects rectangle\n   * @static\n   * @param {Array} points\n   * @param {fabric.Point} r1\n   * @param {fabric.Point} r2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonRectangle = function (points, r1, r2) {\n    var min = r1.min(r2),\n        max = r1.max(r2),\n        topRight = new fabric.Point(max.x, min.y),\n        bottomLeft = new fabric.Point(min.x, max.y),\n        inter1 = Intersection.intersectLinePolygon(min, topRight, points),\n        inter2 = Intersection.intersectLinePolygon(topRight, max, points),\n        inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points),\n        inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points),\n        result = new Intersection();\n\n    result.appendPoints(inter1.points);\n    result.appendPoints(inter2.points);\n    result.appendPoints(inter3.points);\n    result.appendPoints(inter4.points);\n\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Color) {\n    fabric.warn('fabric.Color is already defined.');\n    return;\n  }\n\n  /**\n   * Color class\n   * The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;\n   * {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.\n   *\n   * @class fabric.Color\n   * @param {String} color optional in hex or rgb(a) or hsl format or from known color list\n   * @return {fabric.Color} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#colors}\n   */\n  function Color(color) {\n    if (!color) {\n      this.setSource([0, 0, 0, 1]);\n    }\n    else {\n      this._tryParsingColor(color);\n    }\n  }\n\n  fabric.Color = Color;\n\n  fabric.Color.prototype = /** @lends fabric.Color.prototype */ {\n\n    /**\n     * @private\n     * @param {String|Array} color Color value to parse\n     */\n    _tryParsingColor: function(color) {\n      var source;\n\n      if (color in Color.colorNameMap) {\n        color = Color.colorNameMap[color];\n      }\n\n      if (color === 'transparent') {\n        source = [255, 255, 255, 0];\n      }\n\n      if (!source) {\n        source = Color.sourceFromHex(color);\n      }\n      if (!source) {\n        source = Color.sourceFromRgb(color);\n      }\n      if (!source) {\n        source = Color.sourceFromHsl(color);\n      }\n      if (!source) {\n        //if color is not recognize let's make black as canvas does\n        source = [0, 0, 0, 1];\n      }\n      if (source) {\n        this.setSource(source);\n      }\n    },\n\n    /**\n     * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n     * @private\n     * @param {Number} r Red color value\n     * @param {Number} g Green color value\n     * @param {Number} b Blue color value\n     * @return {Array} Hsl color\n     */\n    _rgbToHsl: function(r, g, b) {\n      r /= 255; g /= 255; b /= 255;\n\n      var h, s, l,\n          max = fabric.util.array.max([r, g, b]),\n          min = fabric.util.array.min([r, g, b]);\n\n      l = (max + min) / 2;\n\n      if (max === min) {\n        h = s = 0; // achromatic\n      }\n      else {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n          case r:\n            h = (g - b) / d + (g < b ? 6 : 0);\n            break;\n          case g:\n            h = (b - r) / d + 2;\n            break;\n          case b:\n            h = (r - g) / d + 4;\n            break;\n        }\n        h /= 6;\n      }\n\n      return [\n        Math.round(h * 360),\n        Math.round(s * 100),\n        Math.round(l * 100)\n      ];\n    },\n\n    /**\n     * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @return {Array}\n     */\n    getSource: function() {\n      return this._source;\n    },\n\n    /**\n     * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @param {Array} source\n     */\n    setSource: function(source) {\n      this._source = source;\n    },\n\n    /**\n     * Returns color representation in RGB format\n     * @return {String} ex: rgb(0-255,0-255,0-255)\n     */\n    toRgb: function() {\n      var source = this.getSource();\n      return 'rgb(' + source[0] + ',' + source[1] + ',' + source[2] + ')';\n    },\n\n    /**\n     * Returns color representation in RGBA format\n     * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\n     */\n    toRgba: function() {\n      var source = this.getSource();\n      return 'rgba(' + source[0] + ',' + source[1] + ',' + source[2] + ',' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HSL format\n     * @return {String} ex: hsl(0-360,0%-100%,0%-100%)\n     */\n    toHsl: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsl(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%)';\n    },\n\n    /**\n     * Returns color representation in HSLA format\n     * @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)\n     */\n    toHsla: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsla(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%,' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HEX format\n     * @return {String} ex: FF5555\n     */\n    toHex: function() {\n      var source = this.getSource(), r, g, b;\n\n      r = source[0].toString(16);\n      r = (r.length === 1) ? ('0' + r) : r;\n\n      g = source[1].toString(16);\n      g = (g.length === 1) ? ('0' + g) : g;\n\n      b = source[2].toString(16);\n      b = (b.length === 1) ? ('0' + b) : b;\n\n      return r.toUpperCase() + g.toUpperCase() + b.toUpperCase();\n    },\n\n    /**\n     * Returns color representation in HEXA format\n     * @return {String} ex: FF5555CC\n     */\n    toHexa: function() {\n      var source = this.getSource(), a;\n\n      a = Math.round(source[3] * 255);\n      a = a.toString(16);\n      a = (a.length === 1) ? ('0' + a) : a;\n\n      return this.toHex() + a.toUpperCase();\n    },\n\n    /**\n     * Gets value of alpha channel for this color\n     * @return {Number} 0-1\n     */\n    getAlpha: function() {\n      return this.getSource()[3];\n    },\n\n    /**\n     * Sets value of alpha channel for this color\n     * @param {Number} alpha Alpha value 0-1\n     * @return {fabric.Color} thisArg\n     */\n    setAlpha: function(alpha) {\n      var source = this.getSource();\n      source[3] = alpha;\n      this.setSource(source);\n      return this;\n    },\n\n    /**\n     * Transforms color to its grayscale representation\n     * @return {fabric.Color} thisArg\n     */\n    toGrayscale: function() {\n      var source = this.getSource(),\n          average = parseInt((source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0), 10),\n          currentAlpha = source[3];\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Transforms color to its black and white representation\n     * @param {Number} threshold\n     * @return {fabric.Color} thisArg\n     */\n    toBlackWhite: function(threshold) {\n      var source = this.getSource(),\n          average = (source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0),\n          currentAlpha = source[3];\n\n      threshold = threshold || 127;\n\n      average = (Number(average) < Number(threshold)) ? 0 : 255;\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Overlays color with another color\n     * @param {String|fabric.Color} otherColor\n     * @return {fabric.Color} thisArg\n     */\n    overlayWith: function(otherColor) {\n      if (!(otherColor instanceof Color)) {\n        otherColor = new Color(otherColor);\n      }\n\n      var result = [],\n          alpha = this.getAlpha(),\n          otherAlpha = 0.5,\n          source = this.getSource(),\n          otherSource = otherColor.getSource(), i;\n\n      for (i = 0; i < 3; i++) {\n        result.push(Math.round((source[i] * (1 - otherAlpha)) + (otherSource[i] * otherAlpha)));\n      }\n\n      result[3] = alpha;\n      this.setSource(result);\n      return this;\n    }\n  };\n\n  /**\n   * Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgba(255, 100, 10, 0.5), rgba( 255 , 100 , 10 , 0.5 ), rgb(1,1,1), rgba(100%, 60%, 10%, 0.5))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  // eslint-disable-next-line max-len\n  fabric.Color.reRGBa = /^rgba?\\(\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*(?:\\s*,\\s*((?:\\d*\\.?\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HSL or HSLA formats (ex: hsl(200, 80%, 10%), hsla(300, 50%, 80%, 0.5), hsla( 300 , 50% , 80% , 0.5 ))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHSLa = /^hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3}\\%)\\s*,\\s*(\\d{1,3}\\%)\\s*(?:\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HEX format (ex: #FF5544CC, #FF5555, 010155, aff)\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHex = /^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;\n\n  /**\n   * Map of the 148 color names with HEX code\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   * @see: https://www.w3.org/TR/css3-color/#svg-color\n   */\n  fabric.Color.colorNameMap = {\n    aliceblue:            '#F0F8FF',\n    antiquewhite:         '#FAEBD7',\n    aqua:                 '#00FFFF',\n    aquamarine:           '#7FFFD4',\n    azure:                '#F0FFFF',\n    beige:                '#F5F5DC',\n    bisque:               '#FFE4C4',\n    black:                '#000000',\n    blanchedalmond:       '#FFEBCD',\n    blue:                 '#0000FF',\n    blueviolet:           '#8A2BE2',\n    brown:                '#A52A2A',\n    burlywood:            '#DEB887',\n    cadetblue:            '#5F9EA0',\n    chartreuse:           '#7FFF00',\n    chocolate:            '#D2691E',\n    coral:                '#FF7F50',\n    cornflowerblue:       '#6495ED',\n    cornsilk:             '#FFF8DC',\n    crimson:              '#DC143C',\n    cyan:                 '#00FFFF',\n    darkblue:             '#00008B',\n    darkcyan:             '#008B8B',\n    darkgoldenrod:        '#B8860B',\n    darkgray:             '#A9A9A9',\n    darkgrey:             '#A9A9A9',\n    darkgreen:            '#006400',\n    darkkhaki:            '#BDB76B',\n    darkmagenta:          '#8B008B',\n    darkolivegreen:       '#556B2F',\n    darkorange:           '#FF8C00',\n    darkorchid:           '#9932CC',\n    darkred:              '#8B0000',\n    darksalmon:           '#E9967A',\n    darkseagreen:         '#8FBC8F',\n    darkslateblue:        '#483D8B',\n    darkslategray:        '#2F4F4F',\n    darkslategrey:        '#2F4F4F',\n    darkturquoise:        '#00CED1',\n    darkviolet:           '#9400D3',\n    deeppink:             '#FF1493',\n    deepskyblue:          '#00BFFF',\n    dimgray:              '#696969',\n    dimgrey:              '#696969',\n    dodgerblue:           '#1E90FF',\n    firebrick:            '#B22222',\n    floralwhite:          '#FFFAF0',\n    forestgreen:          '#228B22',\n    fuchsia:              '#FF00FF',\n    gainsboro:            '#DCDCDC',\n    ghostwhite:           '#F8F8FF',\n    gold:                 '#FFD700',\n    goldenrod:            '#DAA520',\n    gray:                 '#808080',\n    grey:                 '#808080',\n    green:                '#008000',\n    greenyellow:          '#ADFF2F',\n    honeydew:             '#F0FFF0',\n    hotpink:              '#FF69B4',\n    indianred:            '#CD5C5C',\n    indigo:               '#4B0082',\n    ivory:                '#FFFFF0',\n    khaki:                '#F0E68C',\n    lavender:             '#E6E6FA',\n    lavenderblush:        '#FFF0F5',\n    lawngreen:            '#7CFC00',\n    lemonchiffon:         '#FFFACD',\n    lightblue:            '#ADD8E6',\n    lightcoral:           '#F08080',\n    lightcyan:            '#E0FFFF',\n    lightgoldenrodyellow: '#FAFAD2',\n    lightgray:            '#D3D3D3',\n    lightgrey:            '#D3D3D3',\n    lightgreen:           '#90EE90',\n    lightpink:            '#FFB6C1',\n    lightsalmon:          '#FFA07A',\n    lightseagreen:        '#20B2AA',\n    lightskyblue:         '#87CEFA',\n    lightslategray:       '#778899',\n    lightslategrey:       '#778899',\n    lightsteelblue:       '#B0C4DE',\n    lightyellow:          '#FFFFE0',\n    lime:                 '#00FF00',\n    limegreen:            '#32CD32',\n    linen:                '#FAF0E6',\n    magenta:              '#FF00FF',\n    maroon:               '#800000',\n    mediumaquamarine:     '#66CDAA',\n    mediumblue:           '#0000CD',\n    mediumorchid:         '#BA55D3',\n    mediumpurple:         '#9370DB',\n    mediumseagreen:       '#3CB371',\n    mediumslateblue:      '#7B68EE',\n    mediumspringgreen:    '#00FA9A',\n    mediumturquoise:      '#48D1CC',\n    mediumvioletred:      '#C71585',\n    midnightblue:         '#191970',\n    mintcream:            '#F5FFFA',\n    mistyrose:            '#FFE4E1',\n    moccasin:             '#FFE4B5',\n    navajowhite:          '#FFDEAD',\n    navy:                 '#000080',\n    oldlace:              '#FDF5E6',\n    olive:                '#808000',\n    olivedrab:            '#6B8E23',\n    orange:               '#FFA500',\n    orangered:            '#FF4500',\n    orchid:               '#DA70D6',\n    palegoldenrod:        '#EEE8AA',\n    palegreen:            '#98FB98',\n    paleturquoise:        '#AFEEEE',\n    palevioletred:        '#DB7093',\n    papayawhip:           '#FFEFD5',\n    peachpuff:            '#FFDAB9',\n    peru:                 '#CD853F',\n    pink:                 '#FFC0CB',\n    plum:                 '#DDA0DD',\n    powderblue:           '#B0E0E6',\n    purple:               '#800080',\n    rebeccapurple:        '#663399',\n    red:                  '#FF0000',\n    rosybrown:            '#BC8F8F',\n    royalblue:            '#4169E1',\n    saddlebrown:          '#8B4513',\n    salmon:               '#FA8072',\n    sandybrown:           '#F4A460',\n    seagreen:             '#2E8B57',\n    seashell:             '#FFF5EE',\n    sienna:               '#A0522D',\n    silver:               '#C0C0C0',\n    skyblue:              '#87CEEB',\n    slateblue:            '#6A5ACD',\n    slategray:            '#708090',\n    slategrey:            '#708090',\n    snow:                 '#FFFAFA',\n    springgreen:          '#00FF7F',\n    steelblue:            '#4682B4',\n    tan:                  '#D2B48C',\n    teal:                 '#008080',\n    thistle:              '#D8BFD8',\n    tomato:               '#FF6347',\n    turquoise:            '#40E0D0',\n    violet:               '#EE82EE',\n    wheat:                '#F5DEB3',\n    white:                '#FFFFFF',\n    whitesmoke:           '#F5F5F5',\n    yellow:               '#FFFF00',\n    yellowgreen:          '#9ACD32'\n  };\n\n  /**\n   * @private\n   * @param {Number} p\n   * @param {Number} q\n   * @param {Number} t\n   * @return {Number}\n   */\n  function hue2rgb(p, q, t) {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  /**\n   * Returns new color object, when given a color in RGB format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255)\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgb = function(color) {\n    return Color.fromSource(Color.sourceFromRgb(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromRgb = function(color) {\n    var match = color.match(Color.reRGBa);\n    if (match) {\n      var r = parseInt(match[1], 10) / (/%$/.test(match[1]) ? 100 : 1) * (/%$/.test(match[1]) ? 255 : 1),\n          g = parseInt(match[2], 10) / (/%$/.test(match[2]) ? 100 : 1) * (/%$/.test(match[2]) ? 255 : 1),\n          b = parseInt(match[3], 10) / (/%$/.test(match[3]) ? 100 : 1) * (/%$/.test(match[3]) ? 255 : 1);\n\n      return [\n        parseInt(r, 10),\n        parseInt(g, 10),\n        parseInt(b, 10),\n        match[4] ? parseFloat(match[4]) : 1\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given a color in RGBA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgba = Color.fromRgb;\n\n  /**\n   * Returns new color object, when given a color in HSL format\n   * @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)\n   * @memberOf fabric.Color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsl = function(color) {\n    return Color.fromSource(Color.sourceFromHsl(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.\n   * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)\n   * @return {Array} source\n   * @see http://http://www.w3.org/TR/css3-color/#hsl-color\n   */\n  fabric.Color.sourceFromHsl = function(color) {\n    var match = color.match(Color.reHSLa);\n    if (!match) {\n      return;\n    }\n\n    var h = (((parseFloat(match[1]) % 360) + 360) % 360) / 360,\n        s = parseFloat(match[2]) / (/%$/.test(match[2]) ? 100 : 1),\n        l = parseFloat(match[3]) / (/%$/.test(match[3]) ? 100 : 1),\n        r, g, b;\n\n    if (s === 0) {\n      r = g = b = l;\n    }\n    else {\n      var q = l <= 0.5 ? l * (s + 1) : l + s - l * s,\n          p = l * 2 - q;\n\n      r = hue2rgb(p, q, h + 1 / 3);\n      g = hue2rgb(p, q, h);\n      b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return [\n      Math.round(r * 255),\n      Math.round(g * 255),\n      Math.round(b * 255),\n      match[4] ? parseFloat(match[4]) : 1\n    ];\n  };\n\n  /**\n   * Returns new color object, when given a color in HSLA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsla = Color.fromHsl;\n\n  /**\n   * Returns new color object, when given a color in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: FF5555\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHex = function(color) {\n    return Color.fromSource(Color.sourceFromHex(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color ex: FF5555 or FF5544CC (RGBa)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromHex = function(color) {\n    if (color.match(Color.reHex)) {\n      var value = color.slice(color.indexOf('#') + 1),\n          isShortNotation = (value.length === 3 || value.length === 4),\n          isRGBa = (value.length === 8 || value.length === 4),\n          r = isShortNotation ? (value.charAt(0) + value.charAt(0)) : value.substring(0, 2),\n          g = isShortNotation ? (value.charAt(1) + value.charAt(1)) : value.substring(2, 4),\n          b = isShortNotation ? (value.charAt(2) + value.charAt(2)) : value.substring(4, 6),\n          a = isRGBa ? (isShortNotation ? (value.charAt(3) + value.charAt(3)) : value.substring(6, 8)) : 'FF';\n\n      return [\n        parseInt(r, 16),\n        parseInt(g, 16),\n        parseInt(b, 16),\n        parseFloat((parseInt(a, 16) / 255).toFixed(2))\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])\n   * @static\n   * @memberOf fabric.Color\n   * @param {Array} source\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromSource = function(source) {\n    var oColor = new Color();\n    oColor.setSource(source);\n    return oColor;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      scaleMap = ['e', 'se', 's', 'sw', 'w', 'nw', 'n', 'ne', 'e'],\n      skewMap = ['ns', 'nesw', 'ew', 'nwse'],\n      controls = {},\n      LEFT = 'left', TOP = 'top', RIGHT = 'right', BOTTOM = 'bottom', CENTER = 'center',\n      opposite = {\n        top: BOTTOM,\n        bottom: TOP,\n        left: RIGHT,\n        right: LEFT,\n        center: CENTER,\n      }, radiansToDegrees = fabric.util.radiansToDegrees,\n      sign = (Math.sign || function(x) { return ((x > 0) - (x < 0)) || +x; });\n\n  /**\n   * Combine control position and object angle to find the control direction compared\n   * to the object center.\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   * @param {fabric.Control} control the control class\n   * @return {Number} 0 - 7 a quadrant number\n   */\n  function findCornerQuadrant(fabricObject, control) {\n    var cornerAngle = fabricObject.angle + radiansToDegrees(Math.atan2(control.y, control.x)) + 360;\n    return Math.round((cornerAngle % 360) / 45);\n  }\n\n  function fireEvent(eventName, options) {\n    var target = options.transform.target,\n        canvas = target.canvas,\n        canvasOptions = fabric.util.object.clone(options);\n    canvasOptions.target = target;\n    canvas && canvas.fire('object:' + eventName, canvasOptions);\n    target.fire(eventName, options);\n  }\n\n  /**\n   * Inspect event and fabricObject properties to understand if the scaling action\n   * @param {Event} eventData from the user action\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @return {Boolean} true if scale is proportional\n   */\n  function scaleIsProportional(eventData, fabricObject) {\n    var canvas = fabricObject.canvas, uniScaleKey = canvas.uniScaleKey,\n        uniformIsToggled = eventData[uniScaleKey];\n    return (canvas.uniformScaling && !uniformIsToggled) ||\n    (!canvas.uniformScaling && uniformIsToggled);\n  }\n\n  /**\n   * Checks if transform is centered\n   * @param {Object} transform transform data\n   * @return {Boolean} true if transform is centered\n   */\n  function isTransformCentered(transform) {\n    return transform.originX === CENTER && transform.originY === CENTER;\n  }\n\n  /**\n   * Inspect fabricObject to understand if the current scaling action is allowed\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @param {String} by 'x' or 'y' or ''\n   * @param {Boolean} scaleProportionally true if we are trying to scale proportionally\n   * @return {Boolean} true if scaling is not allowed at current conditions\n   */\n  function scalingIsForbidden(fabricObject, by, scaleProportionally) {\n    var lockX = fabricObject.lockScalingX, lockY = fabricObject.lockScalingY;\n    if (lockX && lockY) {\n      return true;\n    }\n    if (!by && (lockX || lockY) && scaleProportionally) {\n      return true;\n    }\n    if (lockX && by === 'x') {\n      return true;\n    }\n    if (lockY && by === 'y') {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * return the correct cursor style for the scale action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function scaleCursorStyleHandler(eventData, control, fabricObject) {\n    var notAllowed = 'not-allowed',\n        scaleProportionally = scaleIsProportional(eventData, fabricObject),\n        by = '';\n    if (control.x !== 0 && control.y === 0) {\n      by = 'x';\n    }\n    else if (control.x === 0 && control.y !== 0) {\n      by = 'y';\n    }\n    if (scalingIsForbidden(fabricObject, by, scaleProportionally)) {\n      return notAllowed;\n    }\n    var n = findCornerQuadrant(fabricObject, control);\n    return scaleMap[n] + '-resize';\n  }\n\n  /**\n   * return the correct cursor style for the skew action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function skewCursorStyleHandler(eventData, control, fabricObject) {\n    var notAllowed = 'not-allowed';\n    if (control.x !== 0 && fabricObject.lockSkewingY) {\n      return notAllowed;\n    }\n    if (control.y !== 0 && fabricObject.lockSkewingX) {\n      return notAllowed;\n    }\n    var n = findCornerQuadrant(fabricObject, control) % 4;\n    return skewMap[n] + '-resize';\n  }\n\n  /**\n   * Combine skew and scale style handlers to cover fabric standard use case\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function scaleSkewCursorStyleHandler(eventData, control, fabricObject) {\n    if (eventData[fabricObject.canvas.altActionKey]) {\n      return controls.skewCursorStyleHandler(eventData, control, fabricObject);\n    }\n    return controls.scaleCursorStyleHandler(eventData, control, fabricObject);\n  }\n\n  /**\n   * Inspect event, control and fabricObject to return the correct action name\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} an action name\n   */\n  function scaleOrSkewActionName(eventData, control, fabricObject) {\n    var isAlternative = eventData[fabricObject.canvas.altActionKey];\n    if (control.x === 0) {\n      // then is scaleY or skewX\n      return isAlternative ? 'skewX' : 'scaleY';\n    }\n    if (control.y === 0) {\n      // then is scaleY or skewX\n      return isAlternative ? 'skewY' : 'scaleX';\n    }\n  }\n\n  /**\n   * Find the correct style for the control that is used for rotation.\n   * this function is very simple and it just take care of not-allowed or standard cursor\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function rotationStyleHandler(eventData, control, fabricObject) {\n    if (fabricObject.lockRotation) {\n      return 'not-allowed';\n    }\n    return control.cursorStyle;\n  }\n\n  function commonEventInfo(eventData, transform, x, y) {\n    return {\n      e: eventData,\n      transform: transform,\n      pointer: {\n        x: x,\n        y: y,\n      }\n    };\n  }\n\n  /**\n   * Wrap an action handler with saving/restoring object position on the transform.\n   * this is the code that permits to objects to keep their position while transforming.\n   * @param {Function} actionHandler the function to wrap\n   * @return {Function} a function with an action handler signature\n   */\n  function wrapWithFixedAnchor(actionHandler) {\n    return function(eventData, transform, x, y) {\n      var target = transform.target, centerPoint = target.getCenterPoint(),\n          constraint = target.translateToOriginPoint(centerPoint, transform.originX, transform.originY),\n          actionPerformed = actionHandler(eventData, transform, x, y);\n      target.setPositionByOrigin(constraint, transform.originX, transform.originY);\n      return actionPerformed;\n    };\n  }\n\n  /**\n   * Wrap an action handler with firing an event if the action is performed\n   * @param {Function} actionHandler the function to wrap\n   * @return {Function} a function with an action handler signature\n   */\n  function wrapWithFireEvent(eventName, actionHandler) {\n    return function(eventData, transform, x, y) {\n      var actionPerformed = actionHandler(eventData, transform, x, y);\n      if (actionPerformed) {\n        fireEvent(eventName, commonEventInfo(eventData, transform, x, y));\n      }\n      return actionPerformed;\n    };\n  }\n\n  /**\n   * Transforms a point described by x and y in a distance from the top left corner of the object\n   * bounding box.\n   * @param {Object} transform\n   * @param {String} originX\n   * @param {String} originY\n   * @param {number} x\n   * @param {number} y\n   * @return {Fabric.Point} the normalized point\n   */\n  function getLocalPoint(transform, originX, originY, x, y) {\n    var target = transform.target,\n        control = target.controls[transform.corner],\n        zoom = target.canvas.getZoom(),\n        padding = target.padding / zoom,\n        localPoint = target.toLocalPoint(new fabric.Point(x, y), originX, originY);\n    if (localPoint.x >= padding) {\n      localPoint.x -= padding;\n    }\n    if (localPoint.x <= -padding) {\n      localPoint.x += padding;\n    }\n    if (localPoint.y >= padding) {\n      localPoint.y -= padding;\n    }\n    if (localPoint.y <= padding) {\n      localPoint.y += padding;\n    }\n    localPoint.x -= control.offsetX;\n    localPoint.y -= control.offsetY;\n    return localPoint;\n  }\n\n  /**\n   * Detect if the fabric object is flipped on one side.\n   * @param {fabric.Object} target\n   * @return {Boolean} true if one flip, but not two.\n   */\n  function targetHasOneFlip(target) {\n    return target.flipX !== target.flipY;\n  }\n\n  /**\n   * Utility function to compensate the scale factor when skew is applied on both axes\n   * @private\n   */\n  function compensateScaleForSkew(target, oppositeSkew, scaleToCompensate, axis, reference) {\n    if (target[oppositeSkew] !== 0) {\n      var newDim = target._getTransformedDimensions()[axis];\n      var newValue = reference / newDim * target[scaleToCompensate];\n      target.set(scaleToCompensate, newValue);\n    }\n  }\n\n  /**\n   * Action handler for skewing on the X axis\n   * @private\n   */\n  function skewObjectX(eventData, transform, x, y) {\n    var target = transform.target,\n        // find how big the object would be, if there was no skewX. takes in account scaling\n        dimNoSkew = target._getTransformedDimensions(0, target.skewY),\n        localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        // the mouse is in the center of the object, and we want it to stay there.\n        // so the object will grow twice as much as the mouse.\n        // this makes the skew growth to localPoint * 2 - dimNoSkew.\n        totalSkewSize = Math.abs(localPoint.x * 2) - dimNoSkew.x,\n        currentSkew = target.skewX, newSkew;\n    if (totalSkewSize < 2) {\n      // let's make it easy to go back to position 0.\n      newSkew = 0;\n    }\n    else {\n      newSkew = radiansToDegrees(\n        Math.atan2((totalSkewSize / target.scaleX), (dimNoSkew.y / target.scaleY))\n      );\n      // now we have to find the sign of the skew.\n      // it mostly depend on the origin of transformation.\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\n        newSkew = -newSkew;\n      }\n      if (transform.originX === RIGHT && transform.originY === TOP) {\n        newSkew = -newSkew;\n      }\n      if (targetHasOneFlip(target)) {\n        newSkew = -newSkew;\n      }\n    }\n    var hasSkewed = currentSkew !== newSkew;\n    if (hasSkewed) {\n      var dimBeforeSkewing = target._getTransformedDimensions().y;\n      target.set('skewX', newSkew);\n      compensateScaleForSkew(target, 'skewY', 'scaleY', 'y', dimBeforeSkewing);\n    }\n    return hasSkewed;\n  }\n\n  /**\n   * Action handler for skewing on the Y axis\n   * @private\n   */\n  function skewObjectY(eventData, transform, x, y) {\n    var target = transform.target,\n        // find how big the object would be, if there was no skewX. takes in account scaling\n        dimNoSkew = target._getTransformedDimensions(target.skewX, 0),\n        localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        // the mouse is in the center of the object, and we want it to stay there.\n        // so the object will grow twice as much as the mouse.\n        // this makes the skew growth to localPoint * 2 - dimNoSkew.\n        totalSkewSize = Math.abs(localPoint.y * 2) - dimNoSkew.y,\n        currentSkew = target.skewY, newSkew;\n    if (totalSkewSize < 2) {\n      // let's make it easy to go back to position 0.\n      newSkew = 0;\n    }\n    else {\n      newSkew = radiansToDegrees(\n        Math.atan2((totalSkewSize / target.scaleY), (dimNoSkew.x / target.scaleX))\n      );\n      // now we have to find the sign of the skew.\n      // it mostly depend on the origin of transformation.\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\n        newSkew = -newSkew;\n      }\n      if (transform.originX === RIGHT && transform.originY === TOP) {\n        newSkew = -newSkew;\n      }\n      if (targetHasOneFlip(target)) {\n        newSkew = -newSkew;\n      }\n    }\n    var hasSkewed = currentSkew !== newSkew;\n    if (hasSkewed) {\n      var dimBeforeSkewing = target._getTransformedDimensions().x;\n      target.set('skewY', newSkew);\n      compensateScaleForSkew(target, 'skewX', 'scaleX', 'x', dimBeforeSkewing);\n    }\n    return hasSkewed;\n  }\n\n  /**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function skewHandlerX(eventData, transform, x, y) {\n    // step1 figure out and change transform origin.\n    // if skewX > 0 and originY bottom we anchor on right\n    // if skewX > 0 and originY top we anchor on left\n    // if skewX < 0 and originY bottom we anchor on left\n    // if skewX < 0 and originY top we anchor on right\n    // if skewX is 0, we look for mouse position to understand where are we going.\n    var target = transform.target, currentSkew = target.skewX, originX, originY = transform.originY;\n    if (target.lockSkewingX) {\n      return false;\n    }\n    if (currentSkew === 0) {\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\n      if (localPointFromCenter.x > 0) {\n        // we are pulling right, anchor left;\n        originX = LEFT;\n      }\n      else {\n        // we are pulling right, anchor right\n        originX = RIGHT;\n      }\n    }\n    else {\n      if (currentSkew > 0) {\n        originX = originY === TOP ? LEFT : RIGHT;\n      }\n      if (currentSkew < 0) {\n        originX = originY === TOP ? RIGHT : LEFT;\n      }\n      // is the object flipped on one side only? swap the origin.\n      if (targetHasOneFlip(target)) {\n        originX = originX === LEFT ? RIGHT : LEFT;\n      }\n    }\n\n    // once we have the origin, we find the anchor point\n    transform.originX = originX;\n    var finalHandler = wrapWithFireEvent('skewing', wrapWithFixedAnchor(skewObjectX));\n    return finalHandler(eventData, transform, x, y);\n  }\n\n  /**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function skewHandlerY(eventData, transform, x, y) {\n    // step1 figure out and change transform origin.\n    // if skewY > 0 and originX left we anchor on top\n    // if skewY > 0 and originX right we anchor on bottom\n    // if skewY < 0 and originX left we anchor on bottom\n    // if skewY < 0 and originX right we anchor on top\n    // if skewY is 0, we look for mouse position to understand where are we going.\n    var target = transform.target, currentSkew = target.skewY, originY, originX = transform.originX;\n    if (target.lockSkewingY) {\n      return false;\n    }\n    if (currentSkew === 0) {\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\n      if (localPointFromCenter.y > 0) {\n        // we are pulling down, anchor up;\n        originY = TOP;\n      }\n      else {\n        // we are pulling up, anchor down\n        originY = BOTTOM;\n      }\n    }\n    else {\n      if (currentSkew > 0) {\n        originY = originX === LEFT ? TOP : BOTTOM;\n      }\n      if (currentSkew < 0) {\n        originY = originX === LEFT ? BOTTOM : TOP;\n      }\n      // is the object flipped on one side only? swap the origin.\n      if (targetHasOneFlip(target)) {\n        originY = originY === TOP ? BOTTOM : TOP;\n      }\n    }\n\n    // once we have the origin, we find the anchor point\n    transform.originY = originY;\n    var finalHandler = wrapWithFireEvent('skewing', wrapWithFixedAnchor(skewObjectY));\n    return finalHandler(eventData, transform, x, y);\n  }\n\n  /**\n   * Action handler for rotation and snapping, without anchor point.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   * @private\n   */\n  function rotationWithSnapping(eventData, transform, x, y) {\n    var t = transform,\n        target = t.target,\n        pivotPoint = target.translateToOriginPoint(target.getCenterPoint(), t.originX, t.originY);\n\n    if (target.lockRotation) {\n      return false;\n    }\n\n    var lastAngle = Math.atan2(t.ey - pivotPoint.y, t.ex - pivotPoint.x),\n        curAngle = Math.atan2(y - pivotPoint.y, x - pivotPoint.x),\n        angle = radiansToDegrees(curAngle - lastAngle + t.theta),\n        hasRotated = true;\n\n    if (target.snapAngle > 0) {\n      var snapAngle  = target.snapAngle,\n          snapThreshold  = target.snapThreshold || snapAngle,\n          rightAngleLocked = Math.ceil(angle / snapAngle) * snapAngle,\n          leftAngleLocked = Math.floor(angle / snapAngle) * snapAngle;\n\n      if (Math.abs(angle - leftAngleLocked) < snapThreshold) {\n        angle = leftAngleLocked;\n      }\n      else if (Math.abs(angle - rightAngleLocked) < snapThreshold) {\n        angle = rightAngleLocked;\n      }\n    }\n\n    // normalize angle to positive value\n    if (angle < 0) {\n      angle = 360 + angle;\n    }\n    angle %= 360;\n\n    hasRotated = target.angle !== angle;\n    target.angle = angle;\n    return hasRotated;\n  }\n\n  /**\n   * Basic scaling logic, reused with different constrain for scaling X,Y, freely or equally.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @param {Object} options additional information for scaling\n   * @param {String} options.by 'x', 'y', 'equally' or '' to indicate type of scaling\n   * @return {Boolean} true if some change happened\n   * @private\n   */\n  function scaleObject(eventData, transform, x, y, options) {\n    options = options || {};\n    var target = transform.target,\n        lockScalingX = target.lockScalingX, lockScalingY = target.lockScalingY,\n        by = options.by, newPoint, scaleX, scaleY, dim,\n        scaleProportionally = scaleIsProportional(eventData, target),\n        forbidScaling = scalingIsForbidden(target, by, scaleProportionally),\n        signX, signY, gestureScale = transform.gestureScale;\n\n    if (forbidScaling) {\n      return false;\n    }\n    if (gestureScale) {\n      scaleX = transform.scaleX * gestureScale;\n      scaleY = transform.scaleY * gestureScale;\n    }\n    else {\n      newPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y);\n      // use of sign: We use sign to detect change of direction of an action. sign usually change when\n      // we cross the origin point with the mouse. So a scale flip for example. There is an issue when scaling\n      // by center and scaling using one middle control ( default: mr, mt, ml, mb), the mouse movement can easily\n      // cross many time the origin point and flip the object. so we need a way to filter out the noise.\n      // This ternary here should be ok to filter out X scaling when we want Y only and vice versa.\n      signX = by !== 'y' ? sign(newPoint.x) : 1;\n      signY = by !== 'x' ? sign(newPoint.y) : 1;\n      if (!transform.signX) {\n        transform.signX = signX;\n      }\n      if (!transform.signY) {\n        transform.signY = signY;\n      }\n\n      if (target.lockScalingFlip &&\n        (transform.signX !== signX || transform.signY !== signY)\n      ) {\n        return false;\n      }\n\n      dim = target._getTransformedDimensions();\n      // missing detection of flip and logic to switch the origin\n      if (scaleProportionally && !by) {\n        // uniform scaling\n        var distance = Math.abs(newPoint.x) + Math.abs(newPoint.y),\n            original = transform.original,\n            originalDistance = Math.abs(dim.x * original.scaleX / target.scaleX) +\n              Math.abs(dim.y * original.scaleY / target.scaleY),\n            scale = distance / originalDistance;\n        scaleX = original.scaleX * scale;\n        scaleY = original.scaleY * scale;\n      }\n      else {\n        scaleX = Math.abs(newPoint.x * target.scaleX / dim.x);\n        scaleY = Math.abs(newPoint.y * target.scaleY / dim.y);\n      }\n      // if we are scaling by center, we need to double the scale\n      if (isTransformCentered(transform)) {\n        scaleX *= 2;\n        scaleY *= 2;\n      }\n      if (transform.signX !== signX && by !== 'y') {\n        transform.originX = opposite[transform.originX];\n        scaleX *= -1;\n        transform.signX = signX;\n      }\n      if (transform.signY !== signY && by !== 'x') {\n        transform.originY = opposite[transform.originY];\n        scaleY *= -1;\n        transform.signY = signY;\n      }\n    }\n    // minScale is taken are in the setter.\n    var oldScaleX = target.scaleX, oldScaleY = target.scaleY;\n    if (!by) {\n      !lockScalingX && target.set('scaleX', scaleX);\n      !lockScalingY && target.set('scaleY', scaleY);\n    }\n    else {\n      // forbidden cases already handled on top here.\n      by === 'x' && target.set('scaleX', scaleX);\n      by === 'y' && target.set('scaleY', scaleY);\n    }\n    return oldScaleX !== target.scaleX || oldScaleY !== target.scaleY;\n  }\n\n  /**\n   * Generic scaling logic, to scale from corners either equally or freely.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectFromCorner(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y);\n  }\n\n  /**\n   * Scaling logic for the X axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectX(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y , { by: 'x' });\n  }\n\n  /**\n   * Scaling logic for the Y axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectY(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y , { by: 'y' });\n  }\n\n  /**\n   * Composed action handler to either scale Y or skew X\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scalingYOrSkewingX(eventData, transform, x, y) {\n    // ok some safety needed here.\n    if (eventData[transform.target.canvas.altActionKey]) {\n      return controls.skewHandlerX(eventData, transform, x, y);\n    }\n    return controls.scalingY(eventData, transform, x, y);\n  }\n\n  /**\n   * Composed action handler to either scale X or skew Y\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scalingXOrSkewingY(eventData, transform, x, y) {\n    // ok some safety needed here.\n    if (eventData[transform.target.canvas.altActionKey]) {\n      return controls.skewHandlerY(eventData, transform, x, y);\n    }\n    return controls.scalingX(eventData, transform, x, y);\n  }\n\n  /**\n   * Action handler to change textbox width\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function changeWidth(eventData, transform, x, y) {\n    var target = transform.target, localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        strokePadding = target.strokeWidth / (target.strokeUniform ? target.scaleX : 1),\n        multiplier = isTransformCentered(transform) ? 2 : 1,\n        oldWidth = target.width,\n        newWidth = Math.abs(localPoint.x * multiplier / target.scaleX) - strokePadding;\n    target.set('width', Math.max(newWidth, 0));\n    return oldWidth !== newWidth;\n  }\n\n  /**\n   * Action handler\n   * @private\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if the translation occurred\n   */\n  function dragHandler(eventData, transform, x, y) {\n    var target = transform.target,\n        newLeft = x - transform.offsetX,\n        newTop = y - transform.offsetY,\n        moveX = !target.get('lockMovementX') && target.left !== newLeft,\n        moveY = !target.get('lockMovementY') && target.top !== newTop;\n    moveX && target.set('left', newLeft);\n    moveY && target.set('top', newTop);\n    if (moveX || moveY) {\n      fireEvent('moving', commonEventInfo(eventData, transform, x, y));\n    }\n    return moveX || moveY;\n  }\n\n  controls.scaleCursorStyleHandler = scaleCursorStyleHandler;\n  controls.skewCursorStyleHandler = skewCursorStyleHandler;\n  controls.scaleSkewCursorStyleHandler = scaleSkewCursorStyleHandler;\n  controls.rotationWithSnapping = wrapWithFireEvent('rotating', wrapWithFixedAnchor(rotationWithSnapping));\n  controls.scalingEqually = wrapWithFireEvent('scaling', wrapWithFixedAnchor( scaleObjectFromCorner));\n  controls.scalingX = wrapWithFireEvent('scaling', wrapWithFixedAnchor(scaleObjectX));\n  controls.scalingY = wrapWithFireEvent('scaling', wrapWithFixedAnchor(scaleObjectY));\n  controls.scalingYOrSkewingX = scalingYOrSkewingX;\n  controls.scalingXOrSkewingY = scalingXOrSkewingY;\n  controls.changeWidth = wrapWithFireEvent('resizing', wrapWithFixedAnchor(changeWidth));\n  controls.skewHandlerX = skewHandlerX;\n  controls.skewHandlerY = skewHandlerY;\n  controls.dragHandler = dragHandler;\n  controls.scaleOrSkewActionName = scaleOrSkewActionName;\n  controls.rotationStyleHandler = rotationStyleHandler;\n  controls.fireEvent = fireEvent;\n  controls.wrapWithFixedAnchor = wrapWithFixedAnchor;\n  controls.wrapWithFireEvent = wrapWithFireEvent;\n  controls.getLocalPoint = getLocalPoint;\n  fabric.controlsUtils = controls;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      degreesToRadians = fabric.util.degreesToRadians,\n      controls = fabric.controlsUtils;\n\n  /**\n   * Render a round control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */\n  function renderCircleControl (ctx, left, top, styleOverride, fabricObject) {\n    styleOverride = styleOverride || {};\n    var xSize = this.sizeX || styleOverride.cornerSize || fabricObject.cornerSize,\n        ySize = this.sizeY || styleOverride.cornerSize || fabricObject.cornerSize,\n        transparentCorners = typeof styleOverride.transparentCorners !== 'undefined' ?\n          styleOverride.transparentCorners : fabricObject.transparentCorners,\n        methodName = transparentCorners ? 'stroke' : 'fill',\n        stroke = !transparentCorners && (styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor),\n        myLeft = left,\n        myTop = top, size;\n    ctx.save();\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\n    ctx.strokeStyle = styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor;\n    // as soon as fabric react v5, remove ie11, use proper ellipse code.\n    if (xSize > ySize) {\n      size = xSize;\n      ctx.scale(1.0, ySize / xSize);\n      myTop = top * xSize / ySize;\n    }\n    else if (ySize > xSize) {\n      size = ySize;\n      ctx.scale(xSize / ySize, 1.0);\n      myLeft = left * ySize / xSize;\n    }\n    else {\n      size = xSize;\n    }\n    // this is still wrong\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.arc(myLeft, myTop, size / 2, 0, 2 * Math.PI, false);\n    ctx[methodName]();\n    if (stroke) {\n      ctx.stroke();\n    }\n    ctx.restore();\n  }\n\n  /**\n   * Render a square control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */\n  function renderSquareControl(ctx, left, top, styleOverride, fabricObject) {\n    styleOverride = styleOverride || {};\n    var xSize = this.sizeX || styleOverride.cornerSize || fabricObject.cornerSize,\n        ySize = this.sizeY || styleOverride.cornerSize || fabricObject.cornerSize,\n        transparentCorners = typeof styleOverride.transparentCorners !== 'undefined' ?\n          styleOverride.transparentCorners : fabricObject.transparentCorners,\n        methodName = transparentCorners ? 'stroke' : 'fill',\n        stroke = !transparentCorners && (\n          styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor\n        ), xSizeBy2 = xSize / 2, ySizeBy2 = ySize / 2;\n    ctx.save();\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\n    ctx.strokeStyle = styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor;\n    // this is still wrong\n    ctx.lineWidth = 1;\n    ctx.translate(left, top);\n    ctx.rotate(degreesToRadians(fabricObject.angle));\n    // this does not work, and fixed with ( && ) does not make sense.\n    // to have real transparent corners we need the controls on upperCanvas\n    // transparentCorners || ctx.clearRect(-xSizeBy2, -ySizeBy2, xSize, ySize);\n    ctx[methodName + 'Rect'](-xSizeBy2, -ySizeBy2, xSize, ySize);\n    if (stroke) {\n      ctx.strokeRect(-xSizeBy2, -ySizeBy2, xSize, ySize);\n    }\n    ctx.restore();\n  }\n\n  controls.renderCircleControl = renderCircleControl;\n  controls.renderSquareControl = renderSquareControl;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  function Control(options) {\n    for (var i in options) {\n      this[i] = options[i];\n    }\n  }\n\n  fabric.Control = Control;\n\n  fabric.Control.prototype = /** @lends fabric.Control.prototype */ {\n\n    /**\n     * keep track of control visibility.\n     * mainly for backward compatibility.\n     * if you do not want to see a control, you can remove it\n     * from the controlset.\n     * @type {Boolean}\n     * @default true\n     */\n    visible: true,\n\n    /**\n     * Name of the action that the control will likely execute.\n     * This is optional. FabricJS uses to identify what the user is doing for some\n     * extra optimizations. If you are writing a custom control and you want to know\n     * somewhere else in the code what is going on, you can use this string here.\n     * you can also provide a custom getActionName if your control run multiple actions\n     * depending on some external state.\n     * default to scale since is the most common, used on 4 corners by default\n     * @type {String}\n     * @default 'scale'\n     */\n    actionName: 'scale',\n\n    /**\n     * Drawing angle of the control.\n     * NOT used for now, but name marked as needed for internal logic\n     * example: to reuse the same drawing function for different rotated controls\n     * @type {Number}\n     * @default 0\n     */\n    angle: 0,\n\n    /**\n     * Relative position of the control. X\n     * 0,0 is the center of the Object, while -0.5 (left) or 0.5 (right) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    x: 0,\n\n    /**\n     * Relative position of the control. Y\n     * 0,0 is the center of the Object, while -0.5 (top) or 0.5 (bottom) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    y: 0,\n\n    /**\n     * Horizontal offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the right, negative to the left.\n     * It used when you want to have position of control that does not scale with\n     * the bounding box. Example: rotation control is placed at x:0, y: 0.5 on\n     * the boundindbox, with an offset of 30 pixels vertically. Those 30 pixels will\n     * stay 30 pixels no matter how the object is big. Another example is having 2\n     * controls in the corner, that stay in the same position when the object scale.\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the bottom, negative to the top.\n     * @type {Number}\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * Sets the length of the control. If null, defaults to object's cornerSize.\n     * Expects both sizeX and sizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    sizeX: null,\n\n    /**\n     * Sets the height of the control. If null, defaults to object's cornerSize.\n     * Expects both sizeX and sizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    sizeY: null,\n\n    /**\n     * Sets the length of the touch area of the control. If null, defaults to object's touchCornerSize.\n     * Expects both touchSizeX and touchSizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    touchSizeX: null,\n\n    /**\n     * Sets the height of the touch area of the control. If null, defaults to object's touchCornerSize.\n     * Expects both touchSizeX and touchSizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    touchSizeY: null,\n\n    /**\n     * Css cursor style to display when the control is hovered.\n     * if the method `cursorStyleHandler` is provided, this property is ignored.\n     * @type {String}\n     * @default 'crosshair'\n     */\n    cursorStyle: 'crosshair',\n\n    /**\n     * If controls has an offsetY or offsetX, draw a line that connects\n     * the control to the bounding box\n     * @type {Boolean}\n     * @default false\n     */\n    withConnection: false,\n\n    /**\n     * The control actionHandler, provide one to handle action ( control being moved )\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {Number} x x position of the cursor\n     * @param {Number} y y position of the cursor\n     * @return {Boolean} true if the action/event modified the object\n     */\n    actionHandler: function(/* eventData, transformData, x, y */) { },\n\n    /**\n     * The control handler for mouse down, provide one to handle mouse down on control\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {Number} x x position of the cursor\n     * @param {Number} y y position of the cursor\n     * @return {Boolean} true if the action/event modified the object\n     */\n    mouseDownHandler: function(/* eventData, transformData, x, y */) { },\n\n    /**\n     * The control mouseUpHandler, provide one to handle an effect on mouse up.\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {Number} x x position of the cursor\n     * @param {Number} y y position of the cursor\n     * @return {Boolean} true if the action/event modified the object\n     */\n    mouseUpHandler: function(/* eventData, transformData, x, y */) { },\n\n    /**\n     * Returns control actionHandler\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Object} fabricObject on which the control is displayed\n     * @param {fabric.Control} control control for which the action handler is being asked\n     * @return {Function} the action handler\n     */\n    getActionHandler: function(/* eventData, fabricObject, control */) {\n      return this.actionHandler;\n    },\n\n    /**\n     * Returns control mouseDown handler\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Object} fabricObject on which the control is displayed\n     * @param {fabric.Control} control control for which the action handler is being asked\n     * @return {Function} the action handler\n     */\n    getMouseDownHandler: function(/* eventData, fabricObject, control */) {\n      return this.mouseDownHandler;\n    },\n\n    /**\n     * Returns control mouseUp handler\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Object} fabricObject on which the control is displayed\n     * @param {fabric.Control} control control for which the action handler is being asked\n     * @return {Function} the action handler\n     */\n    getMouseUpHandler: function(/* eventData, fabricObject, control */) {\n      return this.mouseUpHandler;\n    },\n\n    /**\n     * Returns control cursorStyle for css using cursorStyle. If you need a more elaborate\n     * function you can pass one in the constructor\n     * the cursorStyle property\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */\n    cursorStyleHandler: function(eventData, control /* fabricObject */) {\n      return control.cursorStyle;\n    },\n\n    /**\n     * Returns the action name. The basic implementation just return the actionName property.\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */\n    getActionName: function(eventData, control /* fabricObject */) {\n      return control.actionName;\n    },\n\n    /**\n     * Returns controls visibility\n     * @param {fabric.Object} object on which the control is displayed\n     * @param {String} controlKey key where the control is memorized on the\n     * @return {Boolean}\n     */\n    getVisibility: function(fabricObject, controlKey) {\n      var objectVisibility = fabricObject._controlsVisibility;\n      if (objectVisibility && typeof objectVisibility[controlKey] !== 'undefined') {\n        return objectVisibility[controlKey];\n      }\n      return this.visible;\n    },\n\n    /**\n     * Sets controls visibility\n     * @param {Boolean} visibility for the object\n     * @return {Void}\n     */\n    setVisibility: function(visibility /* name, fabricObject */) {\n      this.visible = visibility;\n    },\n\n\n    positionHandler: function(dim, finalMatrix /*, fabricObject, currentControl */) {\n      var point = fabric.util.transformPoint({\n        x: this.x * dim.x + this.offsetX,\n        y: this.y * dim.y + this.offsetY }, finalMatrix);\n      return point;\n    },\n\n    /**\n     * Returns the coords for this control based on object values.\n     * @param {Number} objectAngle angle from the fabric object holding the control\n     * @param {Number} objectCornerSize cornerSize from the fabric object holding the control (or touchCornerSize if\n     *   isTouch is true)\n     * @param {Number} centerX x coordinate where the control center should be\n     * @param {Number} centerY y coordinate where the control center should be\n     * @param {boolean} isTouch true if touch corner, false if normal corner\n     */\n    calcCornerCoords: function(objectAngle, objectCornerSize, centerX, centerY, isTouch) {\n      var cosHalfOffset,\n          sinHalfOffset,\n          cosHalfOffsetComp,\n          sinHalfOffsetComp,\n          xSize = (isTouch) ? this.touchSizeX : this.sizeX,\n          ySize = (isTouch) ? this.touchSizeY : this.sizeY;\n      if (xSize && ySize && xSize !== ySize) {\n        // handle rectangular corners\n        var controlTriangleAngle = Math.atan2(ySize, xSize);\n        var cornerHypotenuse = Math.sqrt(xSize * xSize + ySize * ySize) / 2;\n        var newTheta = controlTriangleAngle - fabric.util.degreesToRadians(objectAngle);\n        var newThetaComp = Math.PI / 2 - controlTriangleAngle - fabric.util.degreesToRadians(objectAngle);\n        cosHalfOffset = cornerHypotenuse * fabric.util.cos(newTheta);\n        sinHalfOffset = cornerHypotenuse * fabric.util.sin(newTheta);\n        // use complementary angle for two corners\n        cosHalfOffsetComp = cornerHypotenuse * fabric.util.cos(newThetaComp);\n        sinHalfOffsetComp = cornerHypotenuse * fabric.util.sin(newThetaComp);\n      }\n      else {\n        // handle square corners\n        // use default object corner size unless size is defined\n        var cornerSize = (xSize && ySize) ? xSize : objectCornerSize;\n        /* 0.7071067812 stands for sqrt(2)/2 */\n        cornerHypotenuse = cornerSize * 0.7071067812;\n        // complementary angles are equal since they're both 45 degrees\n        var newTheta = fabric.util.degreesToRadians(45 - objectAngle);\n        cosHalfOffset = cosHalfOffsetComp = cornerHypotenuse * fabric.util.cos(newTheta);\n        sinHalfOffset = sinHalfOffsetComp = cornerHypotenuse * fabric.util.sin(newTheta);\n      }\n\n      return {\n        tl: {\n          x: centerX - sinHalfOffsetComp,\n          y: centerY - cosHalfOffsetComp,\n        },\n        tr: {\n          x: centerX + cosHalfOffset,\n          y: centerY - sinHalfOffset,\n        },\n        bl: {\n          x: centerX - cosHalfOffset,\n          y: centerY + sinHalfOffset,\n        },\n        br: {\n          x: centerX + sinHalfOffsetComp,\n          y: centerY + cosHalfOffsetComp,\n        },\n      };\n    },\n\n    /**\n    * Render function for the control.\n    * When this function runs the context is unscaled. unrotate. Just retina scaled.\n    * all the functions will have to translate to the point left,top before starting Drawing\n    * if they want to draw a control where the position is detected.\n    * left and top are the result of the positionHandler function\n    * @param {RenderingContext2D} ctx the context where the control will be drawn\n    * @param {Number} left position of the canvas where we are about to render the control.\n    * @param {Number} top position of the canvas where we are about to render the control.\n    * @param {Object} styleOverride\n    * @param {fabric.Object} fabricObject the object where the control is about to be rendered\n    */\n    render: function(ctx, left, top, styleOverride, fabricObject) {\n      styleOverride = styleOverride || {};\n      switch (styleOverride.cornerStyle || fabricObject.cornerStyle) {\n        case 'circle':\n          fabric.controlsUtils.renderCircleControl.call(this, ctx, left, top, styleOverride, fabricObject);\n          break;\n        default:\n          fabric.controlsUtils.renderSquareControl.call(this, ctx, left, top, styleOverride, fabricObject);\n      }\n    },\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  /* _FROM_SVG_START_ */\n  function getColorStop(el, multiplier) {\n    var style = el.getAttribute('style'),\n        offset = el.getAttribute('offset') || 0,\n        color, colorAlpha, opacity, i;\n\n    // convert percents to absolute values\n    offset = parseFloat(offset) / (/%$/.test(offset) ? 100 : 1);\n    offset = offset < 0 ? 0 : offset > 1 ? 1 : offset;\n    if (style) {\n      var keyValuePairs = style.split(/\\s*;\\s*/);\n\n      if (keyValuePairs[keyValuePairs.length - 1] === '') {\n        keyValuePairs.pop();\n      }\n\n      for (i = keyValuePairs.length; i--; ) {\n\n        var split = keyValuePairs[i].split(/\\s*:\\s*/),\n            key = split[0].trim(),\n            value = split[1].trim();\n\n        if (key === 'stop-color') {\n          color = value;\n        }\n        else if (key === 'stop-opacity') {\n          opacity = value;\n        }\n      }\n    }\n\n    if (!color) {\n      color = el.getAttribute('stop-color') || 'rgb(0,0,0)';\n    }\n    if (!opacity) {\n      opacity = el.getAttribute('stop-opacity');\n    }\n\n    color = new fabric.Color(color);\n    colorAlpha = color.getAlpha();\n    opacity = isNaN(parseFloat(opacity)) ? 1 : parseFloat(opacity);\n    opacity *= colorAlpha * multiplier;\n\n    return {\n      offset: offset,\n      color: color.toRgb(),\n      opacity: opacity\n    };\n  }\n\n  function getLinearCoords(el) {\n    return {\n      x1: el.getAttribute('x1') || 0,\n      y1: el.getAttribute('y1') || 0,\n      x2: el.getAttribute('x2') || '100%',\n      y2: el.getAttribute('y2') || 0\n    };\n  }\n\n  function getRadialCoords(el) {\n    return {\n      x1: el.getAttribute('fx') || el.getAttribute('cx') || '50%',\n      y1: el.getAttribute('fy') || el.getAttribute('cy') || '50%',\n      r1: 0,\n      x2: el.getAttribute('cx') || '50%',\n      y2: el.getAttribute('cy') || '50%',\n      r2: el.getAttribute('r') || '50%'\n    };\n  }\n  /* _FROM_SVG_END_ */\n\n  var clone = fabric.util.object.clone;\n\n  /**\n   * Gradient class\n   * @class fabric.Gradient\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#gradients}\n   * @see {@link fabric.Gradient#initialize} for constructor definition\n   */\n  fabric.Gradient = fabric.util.createClass(/** @lends fabric.Gradient.prototype */ {\n\n    /**\n     * Horizontal offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * A transform matrix to apply to the gradient before painting.\n     * Imported from svg gradients, is not applied with the current transform in the center.\n     * Before this transform is applied, the origin point is at the top left corner of the object\n     * plus the addition of offsetY and offsetX.\n     * @type Number[]\n     * @default null\n     */\n    gradientTransform: null,\n\n    /**\n     * coordinates units for coords.\n     * If `pixels`, the number of coords are in the same unit of width / height.\n     * If set as `percentage` the coords are still a number, but 1 means 100% of width\n     * for the X and 100% of the height for the y. It can be bigger than 1 and negative.\n     * allowed values pixels or percentage.\n     * @type String\n     * @default 'pixels'\n     */\n    gradientUnits: 'pixels',\n\n    /**\n     * Gradient type linear or radial\n     * @type String\n     * @default 'pixels'\n     */\n    type: 'linear',\n\n    /**\n     * Constructor\n     * @param {Object} options Options object with type, coords, gradientUnits and colorStops\n     * @param {Object} [options.type] gradient type linear or radial\n     * @param {Object} [options.gradientUnits] gradient units\n     * @param {Object} [options.offsetX] SVG import compatibility\n     * @param {Object} [options.offsetY] SVG import compatibility\n     * @param {Object[]} options.colorStops contains the colorstops.\n     * @param {Object} options.coords contains the coords of the gradient\n     * @param {Number} [options.coords.x1] X coordiante of the first point for linear or of the focal point for radial\n     * @param {Number} [options.coords.y1] Y coordiante of the first point for linear or of the focal point for radial\n     * @param {Number} [options.coords.x2] X coordiante of the second point for linear or of the center point for radial\n     * @param {Number} [options.coords.y2] Y coordiante of the second point for linear or of the center point for radial\n     * @param {Number} [options.coords.r1] only for radial gradient, radius of the inner circle\n     * @param {Number} [options.coords.r2] only for radial gradient, radius of the external circle\n     * @return {fabric.Gradient} thisArg\n     */\n    initialize: function(options) {\n      options || (options = { });\n      options.coords || (options.coords = { });\n\n      var coords, _this = this;\n\n      // sets everything, then coords and colorstops get sets again\n      Object.keys(options).forEach(function(option) {\n        _this[option] = options[option];\n      });\n\n      if (this.id) {\n        this.id += '_' + fabric.Object.__uid++;\n      }\n      else {\n        this.id = fabric.Object.__uid++;\n      }\n\n      coords = {\n        x1: options.coords.x1 || 0,\n        y1: options.coords.y1 || 0,\n        x2: options.coords.x2 || 0,\n        y2: options.coords.y2 || 0\n      };\n\n      if (this.type === 'radial') {\n        coords.r1 = options.coords.r1 || 0;\n        coords.r2 = options.coords.r2 || 0;\n      }\n\n      this.coords = coords;\n      this.colorStops = options.colorStops.slice();\n    },\n\n    /**\n     * Adds another colorStop\n     * @param {Object} colorStop Object with offset and color\n     * @return {fabric.Gradient} thisArg\n     */\n    addColorStop: function(colorStops) {\n      for (var position in colorStops) {\n        var color = new fabric.Color(colorStops[position]);\n        this.colorStops.push({\n          offset: parseFloat(position),\n          color: color.toRgb(),\n          opacity: color.getAlpha()\n        });\n      }\n      return this;\n    },\n\n    /**\n     * Returns object representation of a gradient\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object}\n     */\n    toObject: function(propertiesToInclude) {\n      var object = {\n        type: this.type,\n        coords: this.coords,\n        colorStops: this.colorStops,\n        offsetX: this.offsetX,\n        offsetY: this.offsetY,\n        gradientUnits: this.gradientUnits,\n        gradientTransform: this.gradientTransform ? this.gradientTransform.concat() : this.gradientTransform\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an gradient\n     * @param {Object} object Object to create a gradient for\n     * @return {String} SVG representation of an gradient (linear/radial)\n     */\n    toSVG: function(object, options) {\n      var coords = clone(this.coords, true), i, len, options = options || {},\n          markup, commonAttributes, colorStops = clone(this.colorStops, true),\n          needsSwap = coords.r1 > coords.r2,\n          transform = this.gradientTransform ? this.gradientTransform.concat() : fabric.iMatrix.concat(),\n          offsetX = -this.offsetX, offsetY = -this.offsetY,\n          withViewport = !!options.additionalTransform,\n          gradientUnits = this.gradientUnits === 'pixels' ? 'userSpaceOnUse' : 'objectBoundingBox';\n      // colorStops must be sorted ascending\n      colorStops.sort(function(a, b) {\n        return a.offset - b.offset;\n      });\n\n      if (gradientUnits === 'objectBoundingBox') {\n        offsetX /= object.width;\n        offsetY /= object.height;\n      }\n      else {\n        offsetX += object.width / 2;\n        offsetY += object.height / 2;\n      }\n      if (object.type === 'path' && this.gradientUnits !== 'percentage') {\n        offsetX -= object.pathOffset.x;\n        offsetY -= object.pathOffset.y;\n      }\n\n\n      transform[4] -= offsetX;\n      transform[5] -= offsetY;\n\n      commonAttributes = 'id=\"SVGID_' + this.id +\n                     '\" gradientUnits=\"' + gradientUnits + '\"';\n      commonAttributes += ' gradientTransform=\"' + (withViewport ?\n        options.additionalTransform + ' ' : '') + fabric.util.matrixToSVG(transform) + '\" ';\n\n      if (this.type === 'linear') {\n        markup = [\n          '<linearGradient ',\n          commonAttributes,\n          ' x1=\"', coords.x1,\n          '\" y1=\"', coords.y1,\n          '\" x2=\"', coords.x2,\n          '\" y2=\"', coords.y2,\n          '\">\\n'\n        ];\n      }\n      else if (this.type === 'radial') {\n        // svg radial gradient has just 1 radius. the biggest.\n        markup = [\n          '<radialGradient ',\n          commonAttributes,\n          ' cx=\"', needsSwap ? coords.x1 : coords.x2,\n          '\" cy=\"', needsSwap ? coords.y1 : coords.y2,\n          '\" r=\"', needsSwap ? coords.r1 : coords.r2,\n          '\" fx=\"', needsSwap ? coords.x2 : coords.x1,\n          '\" fy=\"', needsSwap ? coords.y2 : coords.y1,\n          '\">\\n'\n        ];\n      }\n\n      if (this.type === 'radial') {\n        if (needsSwap) {\n          // svg goes from internal to external radius. if radius are inverted, swap color stops.\n          colorStops = colorStops.concat();\n          colorStops.reverse();\n          for (i = 0, len = colorStops.length; i < len; i++) {\n            colorStops[i].offset = 1 - colorStops[i].offset;\n          }\n        }\n        var minRadius = Math.min(coords.r1, coords.r2);\n        if (minRadius > 0) {\n          // i have to shift all colorStops and add new one in 0.\n          var maxRadius = Math.max(coords.r1, coords.r2),\n              percentageShift = minRadius / maxRadius;\n          for (i = 0, len = colorStops.length; i < len; i++) {\n            colorStops[i].offset += percentageShift * (1 - colorStops[i].offset);\n          }\n        }\n      }\n\n      for (i = 0, len = colorStops.length; i < len; i++) {\n        var colorStop = colorStops[i];\n        markup.push(\n          '<stop ',\n          'offset=\"', (colorStop.offset * 100) + '%',\n          '\" style=\"stop-color:', colorStop.color,\n          (typeof colorStop.opacity !== 'undefined' ? ';stop-opacity: ' + colorStop.opacity : ';'),\n          '\"/>\\n'\n        );\n      }\n\n      markup.push((this.type === 'linear' ? '</linearGradient>\\n' : '</radialGradient>\\n'));\n\n      return markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns an instance of CanvasGradient\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {CanvasGradient}\n     */\n    toLive: function(ctx) {\n      var gradient, coords = fabric.util.object.clone(this.coords), i, len;\n\n      if (!this.type) {\n        return;\n      }\n\n      if (this.type === 'linear') {\n        gradient = ctx.createLinearGradient(\n          coords.x1, coords.y1, coords.x2, coords.y2);\n      }\n      else if (this.type === 'radial') {\n        gradient = ctx.createRadialGradient(\n          coords.x1, coords.y1, coords.r1, coords.x2, coords.y2, coords.r2);\n      }\n\n      for (i = 0, len = this.colorStops.length; i < len; i++) {\n        var color = this.colorStops[i].color,\n            opacity = this.colorStops[i].opacity,\n            offset = this.colorStops[i].offset;\n\n        if (typeof opacity !== 'undefined') {\n          color = new fabric.Color(color).setAlpha(opacity).toRgba();\n        }\n        gradient.addColorStop(offset, color);\n      }\n\n      return gradient;\n    }\n  });\n\n  fabric.util.object.extend(fabric.Gradient, {\n\n    /* _FROM_SVG_START_ */\n    /**\n     * Returns {@link fabric.Gradient} instance from an SVG element\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {SVGGradientElement} el SVG gradient element\n     * @param {fabric.Object} instance\n     * @param {String} opacityAttr A fill-opacity or stroke-opacity attribute to multiply to each stop's opacity.\n     * @param {Object} svgOptions an object containing the size of the SVG in order to parse correctly gradients\n     * that uses gradientUnits as 'userSpaceOnUse' and percentages.\n     * @param {Object.number} viewBoxWidth width part of the viewBox attribute on svg\n     * @param {Object.number} viewBoxHeight height part of the viewBox attribute on svg\n     * @param {Object.number} width width part of the svg tag if viewBox is not specified\n     * @param {Object.number} height height part of the svg tag if viewBox is not specified\n     * @return {fabric.Gradient} Gradient instance\n     * @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement\n     * @see http://www.w3.org/TR/SVG/pservers.html#RadialGradientElement\n     */\n    fromElement: function(el, instance, opacityAttr, svgOptions) {\n      /**\n       *  @example:\n       *\n       *  <linearGradient id=\"linearGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\"/>\n       *    <stop offset=\"100%\" stop-color=\"black\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <linearGradient id=\"linearGrad2\">\n       *    <stop offset=\"0\" style=\"stop-color:rgb(255,255,255)\"/>\n       *    <stop offset=\"1\" style=\"stop-color:rgb(0,0,0)\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *    <stop offset=\"50%\" stop-color=\"black\" stop-opacity=\"0.5\" />\n       *    <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *  </radialGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad2\">\n       *    <stop offset=\"0\" stop-color=\"rgb(255,255,255)\" />\n       *    <stop offset=\"0.5\" stop-color=\"rgb(0,0,0)\" />\n       *    <stop offset=\"1\" stop-color=\"rgb(255,255,255)\" />\n       *  </radialGradient>\n       *\n       */\n\n      var multiplier = parseFloat(opacityAttr) / (/%$/.test(opacityAttr) ? 100 : 1);\n      multiplier = multiplier < 0 ? 0 : multiplier > 1 ? 1 : multiplier;\n      if (isNaN(multiplier)) {\n        multiplier = 1;\n      }\n\n      var colorStopEls = el.getElementsByTagName('stop'),\n          type,\n          gradientUnits = el.getAttribute('gradientUnits') === 'userSpaceOnUse' ?\n            'pixels' : 'percentage',\n          gradientTransform = el.getAttribute('gradientTransform') || '',\n          colorStops = [],\n          coords, i, offsetX = 0, offsetY = 0,\n          transformMatrix;\n      if (el.nodeName === 'linearGradient' || el.nodeName === 'LINEARGRADIENT') {\n        type = 'linear';\n        coords = getLinearCoords(el);\n      }\n      else {\n        type = 'radial';\n        coords = getRadialCoords(el);\n      }\n\n      for (i = colorStopEls.length; i--; ) {\n        colorStops.push(getColorStop(colorStopEls[i], multiplier));\n      }\n\n      transformMatrix = fabric.parseTransformAttribute(gradientTransform);\n\n      __convertPercentUnitsToValues(instance, coords, svgOptions, gradientUnits);\n\n      if (gradientUnits === 'pixels') {\n        offsetX = -instance.left;\n        offsetY = -instance.top;\n      }\n\n      var gradient = new fabric.Gradient({\n        id: el.getAttribute('id'),\n        type: type,\n        coords: coords,\n        colorStops: colorStops,\n        gradientUnits: gradientUnits,\n        gradientTransform: transformMatrix,\n        offsetX: offsetX,\n        offsetY: offsetY,\n      });\n\n      return gradient;\n    }\n    /* _FROM_SVG_END_ */\n  });\n\n  /**\n   * @private\n   */\n  function __convertPercentUnitsToValues(instance, options, svgOptions, gradientUnits) {\n    var propValue, finalValue;\n    Object.keys(options).forEach(function(prop) {\n      propValue = options[prop];\n      if (propValue === 'Infinity') {\n        finalValue = 1;\n      }\n      else if (propValue === '-Infinity') {\n        finalValue = 0;\n      }\n      else {\n        finalValue = parseFloat(options[prop], 10);\n        if (typeof propValue === 'string' && /^(\\d+\\.\\d+)%|(\\d+)%$/.test(propValue)) {\n          finalValue *= 0.01;\n          if (gradientUnits === 'pixels') {\n            // then we need to fix those percentages here in svg parsing\n            if (prop === 'x1' || prop === 'x2' || prop === 'r2') {\n              finalValue *= svgOptions.viewBoxWidth || svgOptions.width;\n            }\n            if (prop === 'y1' || prop === 'y2') {\n              finalValue *= svgOptions.viewBoxHeight || svgOptions.height;\n            }\n          }\n        }\n      }\n      options[prop] = finalValue;\n    });\n  }\n})();\n\n\n(function() {\n\n  'use strict';\n\n  var toFixed = fabric.util.toFixed;\n\n  /**\n   * Pattern class\n   * @class fabric.Pattern\n   * @see {@link http://fabricjs.com/patterns|Pattern demo}\n   * @see {@link http://fabricjs.com/dynamic-patterns|DynamicPattern demo}\n   * @see {@link fabric.Pattern#initialize} for constructor definition\n   */\n\n\n  fabric.Pattern = fabric.util.createClass(/** @lends fabric.Pattern.prototype */ {\n\n    /**\n     * Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n     * @type String\n     * @default\n     */\n    repeat: 'repeat',\n\n    /**\n     * Pattern horizontal offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Pattern vertical offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @type String\n     * @default\n     */\n    crossOrigin: '',\n\n    /**\n     * transform matrix to change the pattern, imported from svgs.\n     * @type Array\n     * @default\n     */\n    patternTransform: null,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @param {Function} [callback] function to invoke after callback init.\n     * @return {fabric.Pattern} thisArg\n     */\n    initialize: function(options, callback) {\n      options || (options = { });\n\n      this.id = fabric.Object.__uid++;\n      this.setOptions(options);\n      if (!options.source || (options.source && typeof options.source !== 'string')) {\n        callback && callback(this);\n        return;\n      }\n      else {\n        // img src string\n        var _this = this;\n        this.source = fabric.util.createImage();\n        fabric.util.loadImage(options.source, function(img, isError) {\n          _this.source = img;\n          callback && callback(_this, isError);\n        }, null, this.crossOrigin);\n      }\n    },\n\n    /**\n     * Returns object representation of a pattern\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of a pattern instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          source, object;\n\n      // <img> element\n      if (typeof this.source.src === 'string') {\n        source = this.source.src;\n      }\n      // <canvas> element\n      else if (typeof this.source === 'object' && this.source.toDataURL) {\n        source = this.source.toDataURL();\n      }\n\n      object = {\n        type: 'pattern',\n        source: source,\n        repeat: this.repeat,\n        crossOrigin: this.crossOrigin,\n        offsetX: toFixed(this.offsetX, NUM_FRACTION_DIGITS),\n        offsetY: toFixed(this.offsetY, NUM_FRACTION_DIGITS),\n        patternTransform: this.patternTransform ? this.patternTransform.concat() : null\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a pattern\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a pattern\n     */\n    toSVG: function(object) {\n      var patternSource = typeof this.source === 'function' ? this.source() : this.source,\n          patternWidth = patternSource.width / object.width,\n          patternHeight = patternSource.height / object.height,\n          patternOffsetX = this.offsetX / object.width,\n          patternOffsetY = this.offsetY / object.height,\n          patternImgSrc = '';\n      if (this.repeat === 'repeat-x' || this.repeat === 'no-repeat') {\n        patternHeight = 1;\n        if (patternOffsetY) {\n          patternHeight += Math.abs(patternOffsetY);\n        }\n      }\n      if (this.repeat === 'repeat-y' || this.repeat === 'no-repeat') {\n        patternWidth = 1;\n        if (patternOffsetX) {\n          patternWidth += Math.abs(patternOffsetX);\n        }\n\n      }\n      if (patternSource.src) {\n        patternImgSrc = patternSource.src;\n      }\n      else if (patternSource.toDataURL) {\n        patternImgSrc = patternSource.toDataURL();\n      }\n\n      return '<pattern id=\"SVGID_' + this.id +\n                    '\" x=\"' + patternOffsetX +\n                    '\" y=\"' + patternOffsetY +\n                    '\" width=\"' + patternWidth +\n                    '\" height=\"' + patternHeight + '\">\\n' +\n               '<image x=\"0\" y=\"0\"' +\n                      ' width=\"' + patternSource.width +\n                      '\" height=\"' + patternSource.height +\n                      '\" xlink:href=\"' + patternImgSrc +\n               '\"></image>\\n' +\n             '</pattern>\\n';\n    },\n    /* _TO_SVG_END_ */\n\n    setOptions: function(options) {\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n    },\n\n    /**\n     * Returns an instance of CanvasPattern\n     * @param {CanvasRenderingContext2D} ctx Context to create pattern\n     * @return {CanvasPattern}\n     */\n    toLive: function(ctx) {\n      var source = this.source;\n      // if the image failed to load, return, and allow rest to continue loading\n      if (!source) {\n        return '';\n      }\n\n      // if an image\n      if (typeof source.src !== 'undefined') {\n        if (!source.complete) {\n          return '';\n        }\n        if (source.naturalWidth === 0 || source.naturalHeight === 0) {\n          return '';\n        }\n      }\n      return ctx.createPattern(source, this.repeat);\n    }\n  });\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Shadow) {\n    fabric.warn('fabric.Shadow is already defined.');\n    return;\n  }\n\n  /**\n   * Shadow class\n   * @class fabric.Shadow\n   * @see {@link http://fabricjs.com/shadows|Shadow demo}\n   * @see {@link fabric.Shadow#initialize} for constructor definition\n   */\n  fabric.Shadow = fabric.util.createClass(/** @lends fabric.Shadow.prototype */ {\n\n    /**\n     * Shadow color\n     * @type String\n     * @default\n     */\n    color: 'rgb(0,0,0)',\n\n    /**\n     * Shadow blur\n     * @type Number\n     */\n    blur: 0,\n\n    /**\n     * Shadow horizontal offset\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Shadow vertical offset\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * Whether the shadow should affect stroke operations\n     * @type Boolean\n     * @default\n     */\n    affectStroke: false,\n\n    /**\n     * Indicates whether toObject should include default values\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * When `false`, the shadow will scale with the object.\n     * When `true`, the shadow's offsetX, offsetY, and blur will not be affected by the object's scale.\n     * default to false\n     * @type Boolean\n     * @default\n     */\n    nonScaling: false,\n\n    /**\n     * Constructor\n     * @param {Object|String} [options] Options object with any of color, blur, offsetX, offsetY properties or string (e.g. \"rgba(0,0,0,0.2) 2px 2px 10px\")\n     * @return {fabric.Shadow} thisArg\n     */\n    initialize: function(options) {\n\n      if (typeof options === 'string') {\n        options = this._parseShadow(options);\n      }\n\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n\n      this.id = fabric.Object.__uid++;\n    },\n\n    /**\n     * @private\n     * @param {String} shadow Shadow value to parse\n     * @return {Object} Shadow object with color, offsetX, offsetY and blur\n     */\n    _parseShadow: function(shadow) {\n      var shadowStr = shadow.trim(),\n          offsetsAndBlur = fabric.Shadow.reOffsetsAndBlur.exec(shadowStr) || [],\n          color = shadowStr.replace(fabric.Shadow.reOffsetsAndBlur, '') || 'rgb(0,0,0)';\n\n      return {\n        color: color.trim(),\n        offsetX: parseFloat(offsetsAndBlur[1], 10) || 0,\n        offsetY: parseFloat(offsetsAndBlur[2], 10) || 0,\n        blur: parseFloat(offsetsAndBlur[3], 10) || 0\n      };\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @see http://www.w3.org/TR/css-text-decor-3/#text-shadow\n     * @return {String} Returns CSS3 text-shadow declaration\n     */\n    toString: function() {\n      return [this.offsetX, this.offsetY, this.blur, this.color].join('px ');\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a shadow\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a shadow\n     */\n    toSVG: function(object) {\n      var fBoxX = 40, fBoxY = 40, NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          offset = fabric.util.rotateVector(\n            { x: this.offsetX, y: this.offsetY },\n            fabric.util.degreesToRadians(-object.angle)),\n          BLUR_BOX = 20, color = new fabric.Color(this.color);\n\n      if (object.width && object.height) {\n        //http://www.w3.org/TR/SVG/filters.html#FilterEffectsRegion\n        // we add some extra space to filter box to contain the blur ( 20 )\n        fBoxX = toFixed((Math.abs(offset.x) + this.blur) / object.width, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n        fBoxY = toFixed((Math.abs(offset.y) + this.blur) / object.height, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n      }\n      if (object.flipX) {\n        offset.x *= -1;\n      }\n      if (object.flipY) {\n        offset.y *= -1;\n      }\n\n      return (\n        '<filter id=\"SVGID_' + this.id + '\" y=\"-' + fBoxY + '%\" height=\"' + (100 + 2 * fBoxY) + '%\" ' +\n          'x=\"-' + fBoxX + '%\" width=\"' + (100 + 2 * fBoxX) + '%\" ' + '>\\n' +\n          '\\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"' +\n            toFixed(this.blur ? this.blur / 2 : 0, NUM_FRACTION_DIGITS) + '\"></feGaussianBlur>\\n' +\n          '\\t<feOffset dx=\"' + toFixed(offset.x, NUM_FRACTION_DIGITS) +\n          '\" dy=\"' + toFixed(offset.y, NUM_FRACTION_DIGITS) + '\" result=\"oBlur\" ></feOffset>\\n' +\n          '\\t<feFlood flood-color=\"' + color.toRgb() + '\" flood-opacity=\"' + color.getAlpha() + '\"/>\\n' +\n          '\\t<feComposite in2=\"oBlur\" operator=\"in\" />\\n' +\n          '\\t<feMerge>\\n' +\n            '\\t\\t<feMergeNode></feMergeNode>\\n' +\n            '\\t\\t<feMergeNode in=\"SourceGraphic\"></feMergeNode>\\n' +\n          '\\t</feMerge>\\n' +\n        '</filter>\\n');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns object representation of a shadow\n     * @return {Object} Object representation of a shadow instance\n     */\n    toObject: function() {\n      if (this.includeDefaultValues) {\n        return {\n          color: this.color,\n          blur: this.blur,\n          offsetX: this.offsetX,\n          offsetY: this.offsetY,\n          affectStroke: this.affectStroke,\n          nonScaling: this.nonScaling\n        };\n      }\n      var obj = { }, proto = fabric.Shadow.prototype;\n\n      ['color', 'blur', 'offsetX', 'offsetY', 'affectStroke', 'nonScaling'].forEach(function(prop) {\n        if (this[prop] !== proto[prop]) {\n          obj[prop] = this[prop];\n        }\n      }, this);\n\n      return obj;\n    }\n  });\n\n  /**\n   * Regex matching shadow offsetX, offsetY and blur (ex: \"2px 2px 10px rgba(0,0,0,0.2)\", \"rgb(0,255,0) 2px 2px\")\n   * @static\n   * @field\n   * @memberOf fabric.Shadow\n   */\n  // eslint-disable-next-line max-len\n  fabric.Shadow.reOffsetsAndBlur = /(?:\\s|^)(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?(\\d+(?:\\.\\d*)?(?:px)?)?(?:\\s?|$)(?:$|\\s)/;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function () {\n\n  'use strict';\n\n  if (fabric.StaticCanvas) {\n    fabric.warn('fabric.StaticCanvas is already defined.');\n    return;\n  }\n\n  // aliases for faster resolution\n  var extend = fabric.util.object.extend,\n      getElementOffset = fabric.util.getElementOffset,\n      removeFromArray = fabric.util.removeFromArray,\n      toFixed = fabric.util.toFixed,\n      transformPoint = fabric.util.transformPoint,\n      invertTransform = fabric.util.invertTransform,\n      getNodeCanvas = fabric.util.getNodeCanvas,\n      createCanvasElement = fabric.util.createCanvasElement,\n\n      CANVAS_INIT_ERROR = new Error('Could not initialize `canvas` element');\n\n  /**\n   * Static canvas class\n   * @class fabric.StaticCanvas\n   * @mixes fabric.Collection\n   * @mixes fabric.Observable\n   * @see {@link http://fabricjs.com/static_canvas|StaticCanvas demo}\n   * @see {@link fabric.StaticCanvas#initialize} for constructor definition\n   * @fires before:render\n   * @fires after:render\n   * @fires canvas:cleared\n   * @fires object:added\n   * @fires object:removed\n   */\n  fabric.StaticCanvas = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n      this.renderAndResetBound = this.renderAndReset.bind(this);\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\n      this._initStatic(el, options);\n    },\n\n    /**\n     * Background color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setBackgroundColor}.\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    backgroundColor: '',\n\n    /**\n     * Background image of canvas instance.\n     * since 2.4.0 image caching is active, please when putting an image as background, add to the\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n     * vale. As an alternative you can disable image objectCaching\n     * @type fabric.Image\n     * @default\n     */\n    backgroundImage: null,\n\n    /**\n     * Overlay color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setOverlayColor}\n     * @since 1.3.9\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    overlayColor: '',\n\n    /**\n     * Overlay image of canvas instance.\n     * since 2.4.0 image caching is active, please when putting an image as overlay, add to the\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n     * vale. As an alternative you can disable image objectCaching\n     * @type fabric.Image\n     * @default\n     */\n    overlayImage: null,\n\n    /**\n     * Indicates whether toObject/toDatalessObject should include default values\n     * if set to false, takes precedence over the object value.\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * Indicates whether objects' state should be saved\n     * @type Boolean\n     * @default\n     */\n    stateful: false,\n\n    /**\n     * Indicates whether {@link fabric.Collection.add}, {@link fabric.Collection.insertAt} and {@link fabric.Collection.remove},\n     * {@link fabric.StaticCanvas.moveTo}, {@link fabric.StaticCanvas.clear} and many more, should also re-render canvas.\n     * Disabling this option will not give a performance boost when adding/removing a lot of objects to/from canvas at once\n     * since the renders are quequed and executed one per frame.\n     * Disabling is suggested anyway and managing the renders of the app manually is not a big effort ( canvas.requestRenderAll() )\n     * Left default to true to do not break documentation and old app, fiddles.\n     * @type Boolean\n     * @default\n     */\n    renderOnAddRemove: true,\n\n    /**\n     * Indicates whether object controls (borders/controls) are rendered above overlay image\n     * @type Boolean\n     * @default\n     */\n    controlsAboveOverlay: false,\n\n    /**\n     * Indicates whether the browser can be scrolled when using a touchscreen and dragging on the canvas\n     * @type Boolean\n     * @default\n     */\n    allowTouchScrolling: false,\n\n    /**\n     * Indicates whether this canvas will use image smoothing, this is on by default in browsers\n     * @type Boolean\n     * @default\n     */\n    imageSmoothingEnabled: true,\n\n    /**\n     * The transformation (in the format of Canvas transform) which focuses the viewport\n     * @type Array\n     * @default\n     */\n    viewportTransform: fabric.iMatrix.concat(),\n\n    /**\n     * if set to false background image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    backgroundVpt: true,\n\n    /**\n     * if set to false overlya image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    overlayVpt: true,\n\n    /**\n     * When true, canvas is scaled by devicePixelRatio for better rendering on retina screens\n     * @type Boolean\n     * @default\n     */\n    enableRetinaScaling: true,\n\n    /**\n     * Describe canvas element extension over design\n     * properties are tl,tr,bl,br.\n     * if canvas is not zoomed/panned those points are the four corner of canvas\n     * if canvas is viewportTransformed you those points indicate the extension\n     * of canvas element in plain untrasformed coordinates\n     * The coordinates get updated with @method calcViewportBoundaries.\n     * @memberOf fabric.StaticCanvas.prototype\n     */\n    vptCoords: { },\n\n    /**\n     * Based on vptCoords and object.aCoords, skip rendering of objects that\n     * are not included in current viewport.\n     * May greatly help in applications with crowded canvas and use of zoom/pan\n     * If One of the corner of the bounding box of the object is on the canvas\n     * the objects get rendered.\n     * @memberOf fabric.StaticCanvas.prototype\n     * @type Boolean\n     * @default\n     */\n    skipOffscreen: true,\n\n    /**\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n     * the clipPath object gets used when the canvas has rendered, and the context is placed in the\n     * top left corner of the canvas.\n     * clipPath will clip away controls, if you do not want this to happen use controlsAboveOverlay = true\n     * @type fabric.Object\n     */\n    clipPath: undefined,\n\n    /**\n     * @private\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     */\n    _initStatic: function(el, options) {\n      var cb = this.requestRenderAllBound;\n      this._objects = [];\n      this._createLowerCanvas(el);\n      this._initOptions(options);\n      // only initialize retina scaling once\n      if (!this.interactive) {\n        this._initRetinaScaling();\n      }\n\n      if (options.overlayImage) {\n        this.setOverlayImage(options.overlayImage, cb);\n      }\n      if (options.backgroundImage) {\n        this.setBackgroundImage(options.backgroundImage, cb);\n      }\n      if (options.backgroundColor) {\n        this.setBackgroundColor(options.backgroundColor, cb);\n      }\n      if (options.overlayColor) {\n        this.setOverlayColor(options.overlayColor, cb);\n      }\n      this.calcOffset();\n    },\n\n    /**\n     * @private\n     */\n    _isRetinaScaling: function() {\n      return (fabric.devicePixelRatio !== 1 && this.enableRetinaScaling);\n    },\n\n    /**\n     * @private\n     * @return {Number} retinaScaling if applied, otherwise 1;\n     */\n    getRetinaScaling: function() {\n      return this._isRetinaScaling() ? fabric.devicePixelRatio : 1;\n    },\n\n    /**\n     * @private\n     */\n    _initRetinaScaling: function() {\n      if (!this._isRetinaScaling()) {\n        return;\n      }\n      var scaleRatio = fabric.devicePixelRatio;\n      this.__initRetinaScaling(scaleRatio, this.lowerCanvasEl, this.contextContainer);\n      if (this.upperCanvasEl) {\n        this.__initRetinaScaling(scaleRatio, this.upperCanvasEl, this.contextTop);\n      }\n    },\n\n    __initRetinaScaling: function(scaleRatio, canvas, context) {\n      canvas.setAttribute('width', this.width * scaleRatio);\n      canvas.setAttribute('height', this.height * scaleRatio);\n      context.scale(scaleRatio, scaleRatio);\n    },\n\n\n    /**\n     * Calculates canvas element offset relative to the document\n     * This method is also attached as \"resize\" event handler of window\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    calcOffset: function () {\n      this._offset = getElementOffset(this.lowerCanvasEl);\n      return this;\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayImage|overlay image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set overlay to\n     * @param {Function} callback callback to invoke when image is loaded and set as an overlay\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|overlay image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/MnzHT/|jsFiddle demo}\n     * @example <caption>Normal overlayImage with left/top = 0</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage with different properties</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched overlayImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/jail_cell_bars.png', function(img, isError) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched overlayImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage loaded from cross-origin</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    setOverlayImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('overlayImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundImage|background image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|background image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/djnr8o7a/28/|jsFiddle demo}\n     * @example <caption>Normal backgroundImage with left/top = 0</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage with different properties</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched backgroundImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/honey_im_subtle.png', function(img, isError) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched backgroundImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage loaded from cross-origin</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    // TODO: fix stretched examples\n    setBackgroundImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('backgroundImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayColor|foreground color} for this canvas\n     * @param {(String|fabric.Pattern)} overlayColor Color or pattern to set foreground color to\n     * @param {Function} callback Callback to invoke when foreground color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/pB55h/|jsFiddle demo}\n     * @example <caption>Normal overlayColor - color value</caption>\n     * canvas.setOverlayColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor with repeat and offset</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setOverlayColor: function(overlayColor, callback) {\n      return this.__setBgOverlayColor('overlayColor', overlayColor, callback);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundColor|background color} for this canvas\n     * @param {(String|fabric.Pattern)} backgroundColor Color or pattern to set background color to\n     * @param {Function} callback Callback to invoke when background color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/hXzvk/|jsFiddle demo}\n     * @example <caption>Normal backgroundColor - color value</caption>\n     * canvas.setBackgroundColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor with repeat and offset</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setBackgroundColor: function(backgroundColor, callback) {\n      return this.__setBgOverlayColor('backgroundColor', backgroundColor, callback);\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundImage|backgroundImage}\n     * or {@link fabric.StaticCanvas#overlayImage|overlayImage})\n     * @param {(fabric.Image|String|null)} image fabric.Image instance, URL of an image or null to set background or overlay to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background or overlay. The first argument is the created image, the second argument is a flag indicating whether an error occurred or not.\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|image}.\n     */\n    __setBgOverlayImage: function(property, image, callback, options) {\n      if (typeof image === 'string') {\n        fabric.util.loadImage(image, function(img, isError) {\n          if (img) {\n            var instance = new fabric.Image(img, options);\n            this[property] = instance;\n            instance.canvas = this;\n          }\n          callback && callback(img, isError);\n        }, this, options && options.crossOrigin);\n      }\n      else {\n        options && image.setOptions(options);\n        this[property] = image;\n        image && (image.canvas = this);\n        callback && callback(image, false);\n      }\n\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundColor|backgroundColor}\n     * or {@link fabric.StaticCanvas#overlayColor|overlayColor})\n     * @param {(Object|String|null)} color Object with pattern information, color value or null\n     * @param {Function} [callback] Callback is invoked when color is set\n     */\n    __setBgOverlayColor: function(property, color, callback) {\n      this[property] = color;\n      this._initGradient(color, property);\n      this._initPattern(color, property, callback);\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _createCanvasElement: function() {\n      var element = createCanvasElement();\n      if (!element) {\n        throw CANVAS_INIT_ERROR;\n      }\n      if (!element.style) {\n        element.style = { };\n      }\n      if (typeof element.getContext === 'undefined') {\n        throw CANVAS_INIT_ERROR;\n      }\n      return element;\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initOptions: function (options) {\n      var lowerCanvasEl = this.lowerCanvasEl;\n      this._setOptions(options);\n\n      this.width = this.width || parseInt(lowerCanvasEl.width, 10) || 0;\n      this.height = this.height || parseInt(lowerCanvasEl.height, 10) || 0;\n\n      if (!this.lowerCanvasEl.style) {\n        return;\n      }\n\n      lowerCanvasEl.width = this.width;\n      lowerCanvasEl.height = this.height;\n\n      lowerCanvasEl.style.width = this.width + 'px';\n      lowerCanvasEl.style.height = this.height + 'px';\n\n      this.viewportTransform = this.viewportTransform.slice();\n    },\n\n    /**\n     * Creates a bottom canvas\n     * @private\n     * @param {HTMLElement} [canvasEl]\n     */\n    _createLowerCanvas: function (canvasEl) {\n      // canvasEl === 'HTMLCanvasElement' does not work on jsdom/node\n      if (canvasEl && canvasEl.getContext) {\n        this.lowerCanvasEl = canvasEl;\n      }\n      else {\n        this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();\n      }\n\n      fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');\n\n      if (this.interactive) {\n        this._applyCanvasStyle(this.lowerCanvasEl);\n      }\n\n      this.contextContainer = this.lowerCanvasEl.getContext('2d');\n    },\n\n    /**\n     * Returns canvas width (in px)\n     * @return {Number}\n     */\n    getWidth: function () {\n      return this.width;\n    },\n\n    /**\n     * Returns canvas height (in px)\n     * @return {Number}\n     */\n    getHeight: function () {\n      return this.height;\n    },\n\n    /**\n     * Sets width of this canvas instance\n     * @param {Number|String} value                         Value to set width to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setWidth: function (value, options) {\n      return this.setDimensions({ width: value }, options);\n    },\n\n    /**\n     * Sets height of this canvas instance\n     * @param {Number|String} value                         Value to set height to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setHeight: function (value, options) {\n      return this.setDimensions({ height: value }, options);\n    },\n\n    /**\n     * Sets dimensions (width, height) of this canvas instance. when options.cssOnly flag active you should also supply the unit of measure (px/%/em)\n     * @param {Object}        dimensions                    Object with width/height properties\n     * @param {Number|String} [dimensions.width]            Width of canvas element\n     * @param {Number|String} [dimensions.height]           Height of canvas element\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setDimensions: function (dimensions, options) {\n      var cssValue;\n\n      options = options || {};\n\n      for (var prop in dimensions) {\n        cssValue = dimensions[prop];\n\n        if (!options.cssOnly) {\n          this._setBackstoreDimension(prop, dimensions[prop]);\n          cssValue += 'px';\n          this.hasLostContext = true;\n        }\n\n        if (!options.backstoreOnly) {\n          this._setCssDimension(prop, cssValue);\n        }\n      }\n      if (this._isCurrentlyDrawing) {\n        this.freeDrawingBrush && this.freeDrawingBrush._setBrushStyles();\n      }\n      this._initRetinaScaling();\n      this.calcOffset();\n\n      if (!options.cssOnly) {\n        this.requestRenderAll();\n      }\n\n      return this;\n    },\n\n    /**\n     * Helper for setting width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {Number} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setBackstoreDimension: function (prop, value) {\n      this.lowerCanvasEl[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl[prop] = value;\n      }\n\n      if (this.cacheCanvasEl) {\n        this.cacheCanvasEl[prop] = value;\n      }\n\n      this[prop] = value;\n\n      return this;\n    },\n\n    /**\n     * Helper for setting css width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {String} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setCssDimension: function (prop, value) {\n      this.lowerCanvasEl.style[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl.style[prop] = value;\n      }\n\n      if (this.wrapperEl) {\n        this.wrapperEl.style[prop] = value;\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns canvas zoom level\n     * @return {Number}\n     */\n    getZoom: function () {\n      return this.viewportTransform[0];\n    },\n\n    /**\n     * Sets viewport transform of this canvas instance\n     * @param {Array} vpt the transform in the form of context.transform\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setViewportTransform: function (vpt) {\n      var activeObject = this._activeObject,\n          backgroundObject = this.backgroundImage,\n          overlayObject = this.overlayImage,\n          object, i, len;\n      this.viewportTransform = vpt;\n      for (i = 0, len = this._objects.length; i < len; i++) {\n        object = this._objects[i];\n        object.group || object.setCoords(true);\n      }\n      if (activeObject) {\n        activeObject.setCoords();\n      }\n      if (backgroundObject) {\n        backgroundObject.setCoords(true);\n      }\n      if (overlayObject) {\n        overlayObject.setCoords(true);\n      }\n      this.calcViewportBoundaries();\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Sets zoom level of this canvas instance, the zoom centered around point\n     * meaning that following zoom to point with the same point will have the visual\n     * effect of the zoom originating from that point. The point won't move.\n     * It has nothing to do with canvas center or visual center of the viewport.\n     * @param {fabric.Point} point to zoom with respect to\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    zoomToPoint: function (point, value) {\n      // TODO: just change the scale, preserve other transformations\n      var before = point, vpt = this.viewportTransform.slice(0);\n      point = transformPoint(point, invertTransform(this.viewportTransform));\n      vpt[0] = value;\n      vpt[3] = value;\n      var after = transformPoint(point, vpt);\n      vpt[4] += before.x - after.x;\n      vpt[5] += before.y - after.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Sets zoom level of this canvas instance\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setZoom: function (value) {\n      this.zoomToPoint(new fabric.Point(0, 0), value);\n      return this;\n    },\n\n    /**\n     * Pan viewport so as to place point at top left corner of canvas\n     * @param {fabric.Point} point to move to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    absolutePan: function (point) {\n      var vpt = this.viewportTransform.slice(0);\n      vpt[4] = -point.x;\n      vpt[5] = -point.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Pans viewpoint relatively\n     * @param {fabric.Point} point (position vector) to move by\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    relativePan: function (point) {\n      return this.absolutePan(new fabric.Point(\n        -point.x - this.viewportTransform[4],\n        -point.y - this.viewportTransform[5]\n      ));\n    },\n\n    /**\n     * Returns &lt;canvas> element corresponding to this instance\n     * @return {HTMLCanvasElement}\n     */\n    getElement: function () {\n      return this.lowerCanvasEl;\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was added\n     */\n    _onObjectAdded: function(obj) {\n      this.stateful && obj.setupState();\n      obj._set('canvas', this);\n      obj.setCoords();\n      this.fire('object:added', { target: obj });\n      obj.fire('added');\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      this.fire('object:removed', { target: obj });\n      obj.fire('removed');\n      delete obj.canvas;\n    },\n\n    /**\n     * Clears specified context of canvas element\n     * @param {CanvasRenderingContext2D} ctx Context to clear\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clearContext: function(ctx) {\n      ctx.clearRect(0, 0, this.width, this.height);\n      return this;\n    },\n\n    /**\n     * Returns context of canvas where objects are drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getContext: function () {\n      return this.contextContainer;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      this._objects.length = 0;\n      this.backgroundImage = null;\n      this.overlayImage = null;\n      this.backgroundColor = '';\n      this.overlayColor = '';\n      if (this._hasITextHandlers) {\n        this.off('mouse:up', this._mouseUpITextHandler);\n        this._iTextInstances = null;\n        this._hasITextHandlers = false;\n      }\n      this.clearContext(this.contextContainer);\n      this.fire('canvas:cleared');\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Renders the canvas\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._objects);\n      return this;\n    },\n\n    /**\n     * Function created to be instance bound at initialization\n     * used in requestAnimationFrame rendering\n     * Let the fabricJS call it. If you call it manually you could have more\n     * animationFrame stacking on to of each other\n     * for an imperative rendering, use canvas.renderAll\n     * @private\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAndReset: function() {\n      this.isRendering = 0;\n      this.renderAll();\n    },\n\n    /**\n     * Append a renderAll request to next animation frame.\n     * unless one is already in progress, in that case nothing is done\n     * a boolean flag will avoid appending more.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    requestRenderAll: function () {\n      if (!this.isRendering) {\n        this.isRendering = fabric.util.requestAnimFrame(this.renderAndResetBound);\n      }\n      return this;\n    },\n\n    /**\n     * Calculate the position of the 4 corner of canvas with current viewportTransform.\n     * helps to determinate when an object is in the current rendering viewport using\n     * object absolute coordinates ( aCoords )\n     * @return {Object} points.tl\n     * @chainable\n     */\n    calcViewportBoundaries: function() {\n      var points = { }, width = this.width, height = this.height,\n          iVpt = invertTransform(this.viewportTransform);\n      points.tl = transformPoint({ x: 0, y: 0 }, iVpt);\n      points.br = transformPoint({ x: width, y: height }, iVpt);\n      points.tr = new fabric.Point(points.br.x, points.tl.y);\n      points.bl = new fabric.Point(points.tl.x, points.br.y);\n      this.vptCoords = points;\n      return points;\n    },\n\n    cancelRequestedRender: function() {\n      if (this.isRendering) {\n        fabric.util.cancelAnimFrame(this.isRendering);\n        this.isRendering = 0;\n      }\n    },\n\n    /**\n     * Renders background, objects, overlay and controls.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {Array} objects to render\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderCanvas: function(ctx, objects) {\n      var v = this.viewportTransform, path = this.clipPath;\n      this.cancelRequestedRender();\n      this.calcViewportBoundaries();\n      this.clearContext(ctx);\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothingEnabled);\n      this.fire('before:render', { ctx: ctx, });\n      this._renderBackground(ctx);\n\n      ctx.save();\n      //apply viewport transform once for all rendering process\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      this._renderObjects(ctx, objects);\n      ctx.restore();\n      if (!this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      if (path) {\n        path.canvas = this;\n        // needed to setup a couple of variables\n        path.shouldCache();\n        path._transformDone = true;\n        path.renderCache({ forClipping: true });\n        this.drawClipPathOnCanvas(ctx);\n      }\n      this._renderOverlay(ctx);\n      if (this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      this.fire('after:render', { ctx: ctx, });\n    },\n\n    /**\n     * Paint the cached clipPath on the lowerCanvasEl\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawClipPathOnCanvas: function(ctx) {\n      var v = this.viewportTransform, path = this.clipPath;\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      // DEBUG: uncomment this line, comment the following\n      // ctx.globalAlpha = 0.4;\n      ctx.globalCompositeOperation = 'destination-in';\n      path.transform(ctx);\n      ctx.scale(1 / path.zoomX, 1 / path.zoomY);\n      ctx.drawImage(path._cacheCanvas, -path.cacheTranslationX, -path.cacheTranslationY);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Array} objects to render\n     */\n    _renderObjects: function(ctx, objects) {\n      var i, len;\n      for (i = 0, len = objects.length; i < len; ++i) {\n        objects[i] && objects[i].render(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {string} property 'background' or 'overlay'\n     */\n    _renderBackgroundOrOverlay: function(ctx, property) {\n      var fill = this[property + 'Color'], object = this[property + 'Image'],\n          v = this.viewportTransform, needsVpt = this[property + 'Vpt'];\n      if (!fill && !object) {\n        return;\n      }\n      if (fill) {\n        ctx.save();\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.lineTo(this.width, 0);\n        ctx.lineTo(this.width, this.height);\n        ctx.lineTo(0, this.height);\n        ctx.closePath();\n        ctx.fillStyle = fill.toLive\n          ? fill.toLive(ctx, this)\n          : fill;\n        if (needsVpt) {\n          ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        }\n        ctx.transform(1, 0, 0, 1, fill.offsetX || 0, fill.offsetY || 0);\n        var m = fill.gradientTransform || fill.patternTransform;\n        m && ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n        ctx.fill();\n        ctx.restore();\n      }\n      if (object) {\n        ctx.save();\n        if (needsVpt) {\n          ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        }\n        object.render(ctx);\n        ctx.restore();\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'background');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderOverlay: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'overlay');\n    },\n\n    /**\n     * Returns coordinates of a center of canvas.\n     * Returned value is an object with top and left properties\n     * @return {Object} object with \"top\" and \"left\" number values\n     */\n    getCenter: function () {\n      return {\n        top: this.height / 2,\n        left: this.width / 2\n      };\n    },\n\n    /**\n     * Centers object horizontally in the canvas\n     * @param {fabric.Object} object Object to center horizontally\n     * @return {fabric.Canvas} thisArg\n     */\n    centerObjectH: function (object) {\n      return this._centerObject(object, new fabric.Point(this.getCenter().left, object.getCenterPoint().y));\n    },\n\n    /**\n     * Centers object vertically in the canvas\n     * @param {fabric.Object} object Object to center vertically\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObjectV: function (object) {\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, this.getCenter().top));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the canvas\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObject: function(object) {\n      var center = this.getCenter();\n\n      return this._centerObject(object, new fabric.Point(center.left, center.top));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the viewport\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObject: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, vpCenter);\n    },\n\n    /**\n     * Centers object horizontally in the viewport, object.top is unchanged\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectH: function(object) {\n      var vpCenter = this.getVpCenter();\n      this._centerObject(object, new fabric.Point(vpCenter.x, object.getCenterPoint().y));\n      return this;\n    },\n\n    /**\n     * Centers object Vertically in the viewport, object.top is unchanged\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectV: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, vpCenter.y));\n    },\n\n    /**\n     * Calculate the point in canvas that correspond to the center of actual viewport.\n     * @return {fabric.Point} vpCenter, viewport center\n     * @chainable\n     */\n    getVpCenter: function() {\n      var center = this.getCenter(),\n          iVpt = invertTransform(this.viewportTransform);\n      return transformPoint({ x: center.left, y: center.top }, iVpt);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} object Object to center\n     * @param {fabric.Point} center Center point\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    _centerObject: function(object, center) {\n      object.setPositionByOrigin(center, 'center', 'center');\n      object.setCoords();\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Returns dataless JSON representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {String} json string\n     */\n    toDatalessJSON: function (propertiesToInclude) {\n      return this.toDatalessObject(propertiesToInclude);\n    },\n\n    /**\n     * Returns object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toObject', propertiesToInclude);\n    },\n\n    /**\n     * Returns dataless object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toDatalessObject', propertiesToInclude);\n    },\n\n    /**\n     * @private\n     */\n    _toObjectMethod: function (methodName, propertiesToInclude) {\n\n      var clipPath = this.clipPath, data = {\n        version: fabric.version,\n        objects: this._toObjects(methodName, propertiesToInclude),\n      };\n      if (clipPath) {\n        data.clipPath = this._toObject(this.clipPath, methodName, propertiesToInclude);\n      }\n      extend(data, this.__serializeBgOverlay(methodName, propertiesToInclude));\n\n      fabric.util.populateWithProperties(this, data, propertiesToInclude);\n\n      return data;\n    },\n\n    /**\n     * @private\n     */\n    _toObjects: function(methodName, propertiesToInclude) {\n      return this._objects.filter(function(object) {\n        return !object.excludeFromExport;\n      }).map(function(instance) {\n        return this._toObject(instance, methodName, propertiesToInclude);\n      }, this);\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      var originalValue;\n\n      if (!this.includeDefaultValues) {\n        originalValue = instance.includeDefaultValues;\n        instance.includeDefaultValues = false;\n      }\n\n      var object = instance[methodName](propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        instance.includeDefaultValues = originalValue;\n      }\n      return object;\n    },\n\n    /**\n     * @private\n     */\n    __serializeBgOverlay: function(methodName, propertiesToInclude) {\n      var data = { }, bgImage = this.backgroundImage, overlay = this.overlayImage;\n\n      if (this.backgroundColor) {\n        data.background = this.backgroundColor.toObject\n          ? this.backgroundColor.toObject(propertiesToInclude)\n          : this.backgroundColor;\n      }\n\n      if (this.overlayColor) {\n        data.overlay = this.overlayColor.toObject\n          ? this.overlayColor.toObject(propertiesToInclude)\n          : this.overlayColor;\n      }\n      if (bgImage && !bgImage.excludeFromExport) {\n        data.backgroundImage = this._toObject(bgImage, methodName, propertiesToInclude);\n      }\n      if (overlay && !overlay.excludeFromExport) {\n        data.overlayImage = this._toObject(overlay, methodName, propertiesToInclude);\n      }\n\n      return data;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * When true, getSvgTransform() will apply the StaticCanvas.viewportTransform to the SVG transformation. When true,\n     * a zoomed canvas will then produce zoomed SVG output.\n     * @type Boolean\n     * @default\n     */\n    svgViewportTransformation: true,\n\n    /**\n     * Returns SVG representation of canvas\n     * @function\n     * @param {Object} [options] Options object for SVG output\n     * @param {Boolean} [options.suppressPreamble=false] If true xml tag is not included\n     * @param {Object} [options.viewBox] SVG viewbox object\n     * @param {Number} [options.viewBox.x] x-coordinate of viewbox\n     * @param {Number} [options.viewBox.y] y-coordinate of viewbox\n     * @param {Number} [options.viewBox.width] Width of viewbox\n     * @param {Number} [options.viewBox.height] Height of viewbox\n     * @param {String} [options.encoding=UTF-8] Encoding of SVG output\n     * @param {String} [options.width] desired width of svg with or without units\n     * @param {String} [options.height] desired height of svg with or without units\n     * @param {Function} [reviver] Method for further parsing of svg elements, called after each fabric object converted into svg representation.\n     * @return {String} SVG string\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n     * @see {@link http://jsfiddle.net/fabricjs/jQ3ZZ/|jsFiddle demo}\n     * @example <caption>Normal SVG output</caption>\n     * var svg = canvas.toSVG();\n     * @example <caption>SVG output without preamble (without &lt;?xml ../>)</caption>\n     * var svg = canvas.toSVG({suppressPreamble: true});\n     * @example <caption>SVG output with viewBox attribute</caption>\n     * var svg = canvas.toSVG({\n     *   viewBox: {\n     *     x: 100,\n     *     y: 100,\n     *     width: 200,\n     *     height: 300\n     *   }\n     * });\n     * @example <caption>SVG output with different encoding (default: UTF-8)</caption>\n     * var svg = canvas.toSVG({encoding: 'ISO-8859-1'});\n     * @example <caption>Modify SVG output with reviver function</caption>\n     * var svg = canvas.toSVG(null, function(svg) {\n     *   return svg.replace('stroke-dasharray: ; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; ', '');\n     * });\n     */\n    toSVG: function(options, reviver) {\n      options || (options = { });\n      options.reviver = reviver;\n      var markup = [];\n\n      this._setSVGPreamble(markup, options);\n      this._setSVGHeader(markup, options);\n      if (this.clipPath) {\n        markup.push('<g clip-path=\"url(#' + this.clipPath.clipPathId + ')\" >\\n');\n      }\n      this._setSVGBgOverlayColor(markup, 'background');\n      this._setSVGBgOverlayImage(markup, 'backgroundImage', reviver);\n      this._setSVGObjects(markup, reviver);\n      if (this.clipPath) {\n        markup.push('</g>\\n');\n      }\n      this._setSVGBgOverlayColor(markup, 'overlay');\n      this._setSVGBgOverlayImage(markup, 'overlayImage', reviver);\n\n      markup.push('</svg>');\n\n      return markup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _setSVGPreamble: function(markup, options) {\n      if (options.suppressPreamble) {\n        return;\n      }\n      markup.push(\n        '<?xml version=\"1.0\" encoding=\"', (options.encoding || 'UTF-8'), '\" standalone=\"no\" ?>\\n',\n        '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" ',\n        '\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n'\n      );\n    },\n\n    /**\n     * @private\n     */\n    _setSVGHeader: function(markup, options) {\n      var width = options.width || this.width,\n          height = options.height || this.height,\n          vpt, viewBox = 'viewBox=\"0 0 ' + this.width + ' ' + this.height + '\" ',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      if (options.viewBox) {\n        viewBox = 'viewBox=\"' +\n                options.viewBox.x + ' ' +\n                options.viewBox.y + ' ' +\n                options.viewBox.width + ' ' +\n                options.viewBox.height + '\" ';\n      }\n      else {\n        if (this.svgViewportTransformation) {\n          vpt = this.viewportTransform;\n          viewBox = 'viewBox=\"' +\n                  toFixed(-vpt[4] / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(-vpt[5] / vpt[3], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.width / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.height / vpt[3], NUM_FRACTION_DIGITS) + '\" ';\n        }\n      }\n\n      markup.push(\n        '<svg ',\n        'xmlns=\"http://www.w3.org/2000/svg\" ',\n        'xmlns:xlink=\"http://www.w3.org/1999/xlink\" ',\n        'version=\"1.1\" ',\n        'width=\"', width, '\" ',\n        'height=\"', height, '\" ',\n        viewBox,\n        'xml:space=\"preserve\">\\n',\n        '<desc>Created with Fabric.js ', fabric.version, '</desc>\\n',\n        '<defs>\\n',\n        this.createSVGFontFacesMarkup(),\n        this.createSVGRefElementsMarkup(),\n        this.createSVGClipPathMarkup(options),\n        '</defs>\\n'\n      );\n    },\n\n    createSVGClipPathMarkup: function(options) {\n      var clipPath = this.clipPath;\n      if (clipPath) {\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\n        return  '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\n          this.clipPath.toClipPathSVG(options.reviver) +\n          '</clipPath>\\n';\n      }\n      return '';\n    },\n\n    /**\n     * Creates markup containing SVG referenced elements like patterns, gradients etc.\n     * @return {String}\n     */\n    createSVGRefElementsMarkup: function() {\n      var _this = this,\n          markup = ['background', 'overlay'].map(function(prop) {\n            var fill = _this[prop + 'Color'];\n            if (fill && fill.toLive) {\n              var shouldTransform = _this[prop + 'Vpt'], vpt = _this.viewportTransform,\n                  object = {\n                    width: _this.width / (shouldTransform ? vpt[0] : 1),\n                    height: _this.height / (shouldTransform ? vpt[3] : 1)\n                  };\n              return fill.toSVG(\n                object,\n                { additionalTransform: shouldTransform ? fabric.util.matrixToSVG(vpt) : '' }\n              );\n            }\n          });\n      return markup.join('');\n    },\n\n    /**\n     * Creates markup containing SVG font faces,\n     * font URLs for font faces must be collected by developers\n     * and are not extracted from the DOM by fabricjs\n     * @param {Array} objects Array of fabric objects\n     * @return {String}\n     */\n    createSVGFontFacesMarkup: function() {\n      var markup = '', fontList = { }, obj, fontFamily,\n          style, row, rowIndex, _char, charIndex, i, len,\n          fontPaths = fabric.fontPaths, objects = [];\n\n      this._objects.forEach(function add(object) {\n        objects.push(object);\n        if (object._objects) {\n          object._objects.forEach(add);\n        }\n      });\n\n      for (i = 0, len = objects.length; i < len; i++) {\n        obj = objects[i];\n        fontFamily = obj.fontFamily;\n        if (obj.type.indexOf('text') === -1 || fontList[fontFamily] || !fontPaths[fontFamily]) {\n          continue;\n        }\n        fontList[fontFamily] = true;\n        if (!obj.styles) {\n          continue;\n        }\n        style = obj.styles;\n        for (rowIndex in style) {\n          row = style[rowIndex];\n          for (charIndex in row) {\n            _char = row[charIndex];\n            fontFamily = _char.fontFamily;\n            if (!fontList[fontFamily] && fontPaths[fontFamily]) {\n              fontList[fontFamily] = true;\n            }\n          }\n        }\n      }\n\n      for (var j in fontList) {\n        markup += [\n          '\\t\\t@font-face {\\n',\n          '\\t\\t\\tfont-family: \\'', j, '\\';\\n',\n          '\\t\\t\\tsrc: url(\\'', fontPaths[j], '\\');\\n',\n          '\\t\\t}\\n'\n        ].join('');\n      }\n\n      if (markup) {\n        markup = [\n          '\\t<style type=\"text/css\">',\n          '<![CDATA[\\n',\n          markup,\n          ']]>',\n          '</style>\\n'\n        ].join('');\n      }\n\n      return markup;\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObjects: function(markup, reviver) {\n      var instance, i, len, objects = this._objects;\n      for (i = 0, len = objects.length; i < len; i++) {\n        instance = objects[i];\n        if (instance.excludeFromExport) {\n          continue;\n        }\n        this._setSVGObject(markup, instance, reviver);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      markup.push(instance.toSVG(reviver));\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayImage: function(markup, property, reviver) {\n      if (this[property] && !this[property].excludeFromExport && this[property].toSVG) {\n        markup.push(this[property].toSVG(reviver));\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayColor: function(markup, property) {\n      var filler = this[property + 'Color'], vpt = this.viewportTransform, finalWidth = this.width,\n          finalHeight = this.height;\n      if (!filler) {\n        return;\n      }\n      if (filler.toLive) {\n        var repeat = filler.repeat, iVpt = fabric.util.invertTransform(vpt), shouldInvert = this[property + 'Vpt'],\n            additionalTransform = shouldInvert ? fabric.util.matrixToSVG(iVpt) : '';\n        markup.push(\n          '<rect transform=\"' + additionalTransform + ' translate(', finalWidth / 2, ',', finalHeight / 2, ')\"',\n          ' x=\"', filler.offsetX - finalWidth / 2,\n          '\" y=\"', filler.offsetY - finalHeight / 2, '\" ',\n          'width=\"',\n          (repeat === 'repeat-y' || repeat === 'no-repeat'\n            ? filler.source.width\n            : finalWidth ),\n          '\" height=\"',\n          (repeat === 'repeat-x' || repeat === 'no-repeat'\n            ? filler.source.height\n            : finalHeight),\n          '\" fill=\"url(#SVGID_' + filler.id + ')\"',\n          '></rect>\\n'\n        );\n      }\n      else {\n        markup.push(\n          '<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" ',\n          'fill=\"', filler, '\"',\n          '></rect>\\n'\n        );\n      }\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the bottom of the stack of drawn objects\n     * @param {fabric.Object} object Object to send to back\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendToBack: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, objs;\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.unshift(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.unshift(object);\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the top of the stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringToFront: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, objs;\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.push(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.push(object);\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Moves an object or a selection down in stack of drawn objects\n     * An optional parameter, intersecting allows to move the object in behind\n     * the first intersecting object. Where intersection is calculated with\n     * bounding box. If no intersection is found, there will not be change in the\n     * stack.\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendBackwards: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx > 0 + objsMoved) {\n            newIdx = idx - 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== 0) {\n          // if object is not on the bottom of stack\n          newIdx = this._findNewLowerIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewLowerIndex: function(object, idx, intersecting) {\n      var newIdx, i;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse down the stack looking for the nearest intersecting object\n        for (i = idx - 1; i >= 0; --i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx - 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object or a selection up in stack of drawn objects\n     * An optional parameter, intersecting allows to move the object in front\n     * of the first intersecting object. Where intersection is calculated with\n     * bounding box. If no intersection is found, there will not be change in the\n     * stack.\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringForward: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx < this._objects.length - 1 - objsMoved) {\n            newIdx = idx + 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== this._objects.length - 1) {\n          // if object is not on top of stack (last item in an array)\n          newIdx = this._findNewUpperIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewUpperIndex: function(object, idx, intersecting) {\n      var newIdx, i, len;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse up the stack looking for the nearest intersecting object\n        for (i = idx + 1, len = this._objects.length; i < len; ++i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx + 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object to specified level in stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @param {Number} index Position to move to\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    moveTo: function (object, index) {\n      removeFromArray(this._objects, object);\n      this._objects.splice(index, 0, object);\n      return this.renderOnAddRemove && this.requestRenderAll();\n    },\n\n    /**\n     * Clears a canvas element and dispose objects\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      // cancel eventually ongoing renders\n      if (this.isRendering) {\n        fabric.util.cancelAnimFrame(this.isRendering);\n        this.isRendering = 0;\n      }\n      this.forEachObject(function(object) {\n        object.dispose && object.dispose();\n      });\n      this._objects = [];\n      if (this.backgroundImage && this.backgroundImage.dispose) {\n        this.backgroundImage.dispose();\n      }\n      this.backgroundImage = null;\n      if (this.overlayImage && this.overlayImage.dispose) {\n        this.overlayImage.dispose();\n      }\n      this.overlayImage = null;\n      this._iTextInstances = null;\n      this.contextContainer = null;\n      fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);\n      this.lowerCanvasEl = undefined;\n      return this;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function () {\n      return '#<fabric.Canvas (' + this.complexity() + '): ' +\n               '{ objects: ' + this._objects.length + ' }>';\n    }\n  });\n\n  extend(fabric.StaticCanvas.prototype, fabric.Observable);\n  extend(fabric.StaticCanvas.prototype, fabric.Collection);\n  extend(fabric.StaticCanvas.prototype, fabric.DataURLExporter);\n\n  extend(fabric.StaticCanvas, /** @lends fabric.StaticCanvas */ {\n\n    /**\n     * @static\n     * @type String\n     * @default\n     */\n    EMPTY_JSON: '{\"objects\": [], \"background\": \"white\"}',\n\n    /**\n     * Provides a way to check support of some of the canvas methods\n     * (either those of HTMLCanvasElement itself, or rendering context)\n     *\n     * @param {String} methodName Method to check support for;\n     *                            Could be one of \"setLineDash\"\n     * @return {Boolean | null} `true` if method is supported (or at least exists),\n     *                          `null` if canvas element or context can not be initialized\n     */\n    supports: function (methodName) {\n      var el = createCanvasElement();\n\n      if (!el || !el.getContext) {\n        return null;\n      }\n\n      var ctx = el.getContext('2d');\n      if (!ctx) {\n        return null;\n      }\n\n      switch (methodName) {\n\n        case 'setLineDash':\n          return typeof ctx.setLineDash !== 'undefined';\n\n        default:\n          return null;\n      }\n    }\n  });\n\n  /**\n   * Returns Object representation of canvas\n   * this alias is provided because if you call JSON.stringify on an instance,\n   * the toJSON object will be invoked if it exists.\n   * Having a toJSON method means you can do JSON.stringify(myCanvas)\n   * @function\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {Object} JSON compatible object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n   * @see {@link http://jsfiddle.net/fabricjs/pec86/|jsFiddle demo}\n   * @example <caption>JSON without additional properties</caption>\n   * var json = canvas.toJSON();\n   * @example <caption>JSON with additional properties included</caption>\n   * var json = canvas.toJSON(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY']);\n   * @example <caption>JSON without default values</caption>\n   * canvas.includeDefaultValues = false;\n   * var json = canvas.toJSON();\n   */\n  fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject;\n\n  if (fabric.isLikelyNode) {\n    fabric.StaticCanvas.prototype.createPNGStream = function() {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createPNGStream();\n    };\n    fabric.StaticCanvas.prototype.createJPEGStream = function(opts) {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createJPEGStream(opts);\n    };\n  }\n})();\n\n\n/**\n * BaseBrush class\n * @class fabric.BaseBrush\n * @see {@link http://fabricjs.com/freedrawing|Freedrawing demo}\n */\nfabric.BaseBrush = fabric.util.createClass(/** @lends fabric.BaseBrush.prototype */ {\n\n  /**\n   * Color of a brush\n   * @type String\n   * @default\n   */\n  color: 'rgb(0, 0, 0)',\n\n  /**\n   * Width of a brush, has to be a Number, no string literals\n   * @type Number\n   * @default\n   */\n  width: 1,\n\n  /**\n   * Shadow object representing shadow of this shape.\n   * <b>Backwards incompatibility note:</b> This property replaces \"shadowColor\" (String), \"shadowOffsetX\" (Number),\n   * \"shadowOffsetY\" (Number) and \"shadowBlur\" (Number) since v1.2.12\n   * @type fabric.Shadow\n   * @default\n   */\n  shadow: null,\n\n  /**\n   * Line endings style of a brush (one of \"butt\", \"round\", \"square\")\n   * @type String\n   * @default\n   */\n  strokeLineCap: 'round',\n\n  /**\n   * Corner style of a brush (one of \"bevel\", \"round\", \"miter\")\n   * @type String\n   * @default\n   */\n  strokeLineJoin: 'round',\n\n  /**\n   * Maximum miter length (used for strokeLineJoin = \"miter\") of a brush's\n   * @type Number\n   * @default\n   */\n  strokeMiterLimit:         10,\n\n  /**\n   * Stroke Dash Array.\n   * @type Array\n   * @default\n   */\n  strokeDashArray: null,\n\n  /**\n   * When `true`, the free drawing is limited to the whiteboard size. Default to false.\n   * @type Boolean\n   * @default false\n  */\n\n  limitedToCanvasSize: false,\n\n\n  /**\n   * Sets brush styles\n   * @private\n   */\n  _setBrushStyles: function() {\n    var ctx = this.canvas.contextTop;\n    ctx.strokeStyle = this.color;\n    ctx.lineWidth = this.width;\n    ctx.lineCap = this.strokeLineCap;\n    ctx.miterLimit = this.strokeMiterLimit;\n    ctx.lineJoin = this.strokeLineJoin;\n    if (fabric.StaticCanvas.supports('setLineDash')) {\n      ctx.setLineDash(this.strokeDashArray || []);\n    }\n  },\n\n  /**\n   * Sets the transformation on given context\n   * @param {RenderingContext2d} ctx context to render on\n   * @private\n   */\n  _saveAndTransform: function(ctx) {\n    var v = this.canvas.viewportTransform;\n    ctx.save();\n    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n  },\n\n  /**\n   * Sets brush shadow styles\n   * @private\n   */\n  _setShadow: function() {\n    if (!this.shadow) {\n      return;\n    }\n\n    var canvas = this.canvas,\n        shadow = this.shadow,\n        ctx = canvas.contextTop,\n        zoom = canvas.getZoom();\n    if (canvas && canvas._isRetinaScaling()) {\n      zoom *= fabric.devicePixelRatio;\n    }\n\n    ctx.shadowColor = shadow.color;\n    ctx.shadowBlur = shadow.blur * zoom;\n    ctx.shadowOffsetX = shadow.offsetX * zoom;\n    ctx.shadowOffsetY = shadow.offsetY * zoom;\n  },\n\n  needsFullRender: function() {\n    var color = new fabric.Color(this.color);\n    return color.getAlpha() < 1 || !!this.shadow;\n  },\n\n  /**\n   * Removes brush shadow styles\n   * @private\n   */\n  _resetShadow: function() {\n    var ctx = this.canvas.contextTop;\n\n    ctx.shadowColor = '';\n    ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n  },\n\n  /**\n   * Check is pointer is outside canvas boundaries\n   * @param {Object} pointer\n   * @private\n  */\n  _isOutSideCanvas: function(pointer) {\n    return pointer.x < 0 || pointer.x > this.canvas.getWidth() || pointer.y < 0 || pointer.y > this.canvas.getHeight();\n  }\n});\n\n\n(function() {\n  /**\n   * PencilBrush class\n   * @class fabric.PencilBrush\n   * @extends fabric.BaseBrush\n   */\n  fabric.PencilBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {\n\n    /**\n     * Discard points that are less than `decimate` pixel distant from each other\n     * @type Number\n     * @default 0.4\n     */\n    decimate: 0.4,\n\n    /**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @return {fabric.PencilBrush} Instance of a pencil brush\n     */\n    initialize: function(canvas) {\n      this.canvas = canvas;\n      this._points = [];\n    },\n\n    /**\n     * Invoked inside on mouse down and mouse move\n     * @param {Object} pointer\n     */\n    _drawSegment: function (ctx, p1, p2) {\n      var midPoint = p1.midPointFrom(p2);\n      ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);\n      return midPoint;\n    },\n\n    /**\n     * Invoked on mouse down\n     * @param {Object} pointer\n     */\n    onMouseDown: function(pointer, options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return;\n      }\n      this._prepareForDrawing(pointer);\n      // capture coordinates immediately\n      // this allows to draw dots (when movement never occurs)\n      this._captureDrawingPath(pointer);\n      this._render();\n    },\n\n    /**\n     * Invoked on mouse move\n     * @param {Object} pointer\n     */\n    onMouseMove: function(pointer, options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return;\n      }\n      if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\n        return;\n      }\n      if (this._captureDrawingPath(pointer) && this._points.length > 1) {\n        if (this.needsFullRender()) {\n          // redraw curve\n          // clear top canvas\n          this.canvas.clearContext(this.canvas.contextTop);\n          this._render();\n        }\n        else {\n          var points = this._points, length = points.length, ctx = this.canvas.contextTop;\n          // draw the curve update\n          this._saveAndTransform(ctx);\n          if (this.oldEnd) {\n            ctx.beginPath();\n            ctx.moveTo(this.oldEnd.x, this.oldEnd.y);\n          }\n          this.oldEnd = this._drawSegment(ctx, points[length - 2], points[length - 1], true);\n          ctx.stroke();\n          ctx.restore();\n        }\n      }\n    },\n\n    /**\n     * Invoked on mouse up\n     */\n    onMouseUp: function(options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return true;\n      }\n      this.oldEnd = undefined;\n      this._finalizeAndAddPath();\n      return false;\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _prepareForDrawing: function(pointer) {\n\n      var p = new fabric.Point(pointer.x, pointer.y);\n\n      this._reset();\n      this._addPoint(p);\n      this.canvas.contextTop.moveTo(p.x, p.y);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Point} point Point to be added to points array\n     */\n    _addPoint: function(point) {\n      if (this._points.length > 1 && point.eq(this._points[this._points.length - 1])) {\n        return false;\n      }\n      this._points.push(point);\n      return true;\n    },\n\n    /**\n     * Clear points array and set contextTop canvas style.\n     * @private\n     */\n    _reset: function() {\n      this._points = [];\n      this._setBrushStyles();\n      this._setShadow();\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _captureDrawingPath: function(pointer) {\n      var pointerPoint = new fabric.Point(pointer.x, pointer.y);\n      return this._addPoint(pointerPoint);\n    },\n\n    /**\n     * Draw a smooth path on the topCanvas using quadraticCurveTo\n     * @private\n     */\n    _render: function() {\n      var ctx  = this.canvas.contextTop, i, len,\n          p1 = this._points[0],\n          p2 = this._points[1];\n\n      this._saveAndTransform(ctx);\n      ctx.beginPath();\n      //if we only have 2 points in the path and they are the same\n      //it means that the user only clicked the canvas without moving the mouse\n      //then we should be drawing a dot. A path isn't drawn between two identical dots\n      //that's why we set them apart a bit\n      if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {\n        var width = this.width / 1000;\n        p1 = new fabric.Point(p1.x, p1.y);\n        p2 = new fabric.Point(p2.x, p2.y);\n        p1.x -= width;\n        p2.x += width;\n      }\n      ctx.moveTo(p1.x, p1.y);\n\n      for (i = 1, len = this._points.length; i < len; i++) {\n        // we pick the point between pi + 1 & pi + 2 as the\n        // end point and p1 as our control point.\n        this._drawSegment(ctx, p1, p2);\n        p1 = this._points[i];\n        p2 = this._points[i + 1];\n      }\n      // Draw last line as a straight line while\n      // we wait for the next point to be able to calculate\n      // the bezier control point\n      ctx.lineTo(p1.x, p1.y);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * Converts points to SVG path\n     * @param {Array} points Array of points\n     * @return {String} SVG path\n     */\n    convertPointsToSVGPath: function(points) {\n      var path = [], i, width = this.width / 1000,\n          p1 = new fabric.Point(points[0].x, points[0].y),\n          p2 = new fabric.Point(points[1].x, points[1].y),\n          len = points.length, multSignX = 1, multSignY = 0, manyPoints = len > 2;\n\n      if (manyPoints) {\n        multSignX = points[2].x < p2.x ? -1 : points[2].x === p2.x ? 0 : 1;\n        multSignY = points[2].y < p2.y ? -1 : points[2].y === p2.y ? 0 : 1;\n      }\n      path.push('M ', p1.x - multSignX * width, ' ', p1.y - multSignY * width, ' ');\n      for (i = 1; i < len; i++) {\n        if (!p1.eq(p2)) {\n          var midPoint = p1.midPointFrom(p2);\n          // p1 is our bezier control point\n          // midpoint is our endpoint\n          // start point is p(i-1) value.\n          path.push('Q ', p1.x, ' ', p1.y, ' ', midPoint.x, ' ', midPoint.y, ' ');\n        }\n        p1 = points[i];\n        if ((i + 1) < points.length) {\n          p2 = points[i + 1];\n        }\n      }\n      if (manyPoints) {\n        multSignX = p1.x > points[i - 2].x ? 1 : p1.x === points[i - 2].x ? 0 : -1;\n        multSignY = p1.y > points[i - 2].y ? 1 : p1.y === points[i - 2].y ? 0 : -1;\n      }\n      path.push('L ', p1.x + multSignX * width, ' ', p1.y + multSignY * width);\n      return path;\n    },\n\n    /**\n     * Creates fabric.Path object to add on canvas\n     * @param {String} pathData Path data\n     * @return {fabric.Path} Path to add on canvas\n     */\n    createPath: function(pathData) {\n      var path = new fabric.Path(pathData, {\n        fill: null,\n        stroke: this.color,\n        strokeWidth: this.width,\n        strokeLineCap: this.strokeLineCap,\n        strokeMiterLimit: this.strokeMiterLimit,\n        strokeLineJoin: this.strokeLineJoin,\n        strokeDashArray: this.strokeDashArray,\n      });\n      if (this.shadow) {\n        this.shadow.affectStroke = true;\n        path.shadow = new fabric.Shadow(this.shadow);\n      }\n\n      return path;\n    },\n\n    /**\n     * Decimate points array with the decimate value\n     */\n    decimatePoints: function(points, distance) {\n      if (points.length <= 2) {\n        return points;\n      }\n      var zoom = this.canvas.getZoom(), adjustedDistance = Math.pow(distance / zoom, 2),\n          i, l = points.length - 1, lastPoint = points[0], newPoints = [lastPoint],\n          cDistance;\n      for (i = 1; i < l - 1; i++) {\n        cDistance = Math.pow(lastPoint.x - points[i].x, 2) + Math.pow(lastPoint.y - points[i].y, 2);\n        if (cDistance >= adjustedDistance) {\n          lastPoint = points[i];\n          newPoints.push(lastPoint);\n        }\n      }\n      /**\n       * Add the last point from the original line to the end of the array.\n       * This ensures decimate doesn't delete the last point on the line, and ensures the line is > 1 point.\n       */\n      newPoints.push(points[l]);\n      return newPoints;\n    },\n\n    /**\n     * On mouseup after drawing the path on contextTop canvas\n     * we use the points captured to create an new fabric path object\n     * and add it to the fabric canvas.\n     */\n    _finalizeAndAddPath: function() {\n      var ctx = this.canvas.contextTop;\n      ctx.closePath();\n      if (this.decimate) {\n        this._points = this.decimatePoints(this._points, this.decimate);\n      }\n      var pathData = this.convertPointsToSVGPath(this._points).join('');\n      if (pathData === 'M 0 0 Q 0 0 0 0 L 0 0') {\n        // do not create 0 width/height paths, as they are\n        // rendered inconsistently across browsers\n        // Firefox 4, for example, renders a dot,\n        // whereas Chrome 10 renders nothing\n        this.canvas.requestRenderAll();\n        return;\n      }\n\n      var path = this.createPath(pathData);\n      this.canvas.clearContext(this.canvas.contextTop);\n      this.canvas.fire('before:path:created', { path: path });\n      this.canvas.add(path);\n      this.canvas.requestRenderAll();\n      path.setCoords();\n      this._resetShadow();\n\n\n      // fire event 'path' created\n      this.canvas.fire('path:created', { path: path });\n    }\n  });\n})();\n\n\n/**\n * CircleBrush class\n * @class fabric.CircleBrush\n */\nfabric.CircleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.CircleBrush.prototype */ {\n\n  /**\n   * Width of a brush\n   * @type Number\n   * @default\n   */\n  width: 10,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.CircleBrush} Instance of a circle brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.points = [];\n  },\n\n  /**\n   * Invoked inside on mouse down and mouse move\n   * @param {Object} pointer\n   */\n  drawDot: function(pointer) {\n    var point = this.addPoint(pointer),\n        ctx = this.canvas.contextTop;\n    this._saveAndTransform(ctx);\n    this.dot(ctx, point);\n    ctx.restore();\n  },\n\n  dot: function(ctx, point) {\n    ctx.fillStyle = point.fill;\n    ctx.beginPath();\n    ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2, false);\n    ctx.closePath();\n    ctx.fill();\n  },\n\n  /**\n   * Invoked on mouse down\n   */\n  onMouseDown: function(pointer) {\n    this.points.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n    this.drawDot(pointer);\n  },\n\n  /**\n   * Render the full state of the brush\n   * @private\n   */\n  _render: function() {\n    var ctx  = this.canvas.contextTop, i, len,\n        points = this.points;\n    this._saveAndTransform(ctx);\n    for (i = 0, len = points.length; i < len; i++) {\n      this.dot(ctx, points[i]);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\n      return;\n    }\n    if (this.needsFullRender()) {\n      this.canvas.clearContext(this.canvas.contextTop);\n      this.addPoint(pointer);\n      this._render();\n    }\n    else {\n      this.drawDot(pointer);\n    }\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove, i, len;\n    this.canvas.renderOnAddRemove = false;\n\n    var circles = [];\n\n    for (i = 0, len = this.points.length; i < len; i++) {\n      var point = this.points[i],\n          circle = new fabric.Circle({\n            radius: point.radius,\n            left: point.x,\n            top: point.y,\n            originX: 'center',\n            originY: 'center',\n            fill: point.fill\n          });\n\n      this.shadow && (circle.shadow = new fabric.Shadow(this.shadow));\n\n      circles.push(circle);\n    }\n    var group = new fabric.Group(circles);\n    group.canvas = this.canvas;\n\n    this.canvas.fire('before:path:created', { path: group });\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.requestRenderAll();\n  },\n\n  /**\n   * @param {Object} pointer\n   * @return {fabric.Point} Just added pointer point\n   */\n  addPoint: function(pointer) {\n    var pointerPoint = new fabric.Point(pointer.x, pointer.y),\n\n        circleRadius = fabric.util.getRandomInt(\n          Math.max(0, this.width - 20), this.width + 20) / 2,\n\n        circleColor = new fabric.Color(this.color)\n          .setAlpha(fabric.util.getRandomInt(0, 100) / 100)\n          .toRgba();\n\n    pointerPoint.radius = circleRadius;\n    pointerPoint.fill = circleColor;\n\n    this.points.push(pointerPoint);\n\n    return pointerPoint;\n  }\n});\n\n\n/**\n * SprayBrush class\n * @class fabric.SprayBrush\n */\nfabric.SprayBrush = fabric.util.createClass( fabric.BaseBrush, /** @lends fabric.SprayBrush.prototype */ {\n\n  /**\n   * Width of a spray\n   * @type Number\n   * @default\n   */\n  width:              10,\n\n  /**\n   * Density of a spray (number of dots per chunk)\n   * @type Number\n   * @default\n   */\n  density:            20,\n\n  /**\n   * Width of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidth:           1,\n\n  /**\n   * Width variance of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidthVariance:   1,\n\n  /**\n   * Whether opacity of a dot should be random\n   * @type Boolean\n   * @default\n   */\n  randomOpacity:        false,\n\n  /**\n   * Whether overlapping dots (rectangles) should be removed (for performance reasons)\n   * @type Boolean\n   * @default\n   */\n  optimizeOverlapping:  true,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.SprayBrush} Instance of a spray brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.sprayChunks = [];\n  },\n\n  /**\n   * Invoked on mouse down\n   * @param {Object} pointer\n   */\n  onMouseDown: function(pointer) {\n    this.sprayChunks.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n\n    this.addSprayChunk(pointer);\n    this.render(this.sprayChunkPoints);\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\n      return;\n    }\n    this.addSprayChunk(pointer);\n    this.render(this.sprayChunkPoints);\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;\n    this.canvas.renderOnAddRemove = false;\n\n    var rects = [];\n\n    for (var i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      var sprayChunk = this.sprayChunks[i];\n\n      for (var j = 0, jlen = sprayChunk.length; j < jlen; j++) {\n\n        var rect = new fabric.Rect({\n          width: sprayChunk[j].width,\n          height: sprayChunk[j].width,\n          left: sprayChunk[j].x + 1,\n          top: sprayChunk[j].y + 1,\n          originX: 'center',\n          originY: 'center',\n          fill: this.color\n        });\n        rects.push(rect);\n      }\n    }\n\n    if (this.optimizeOverlapping) {\n      rects = this._getOptimizedRects(rects);\n    }\n\n    var group = new fabric.Group(rects);\n    this.shadow && group.set('shadow', new fabric.Shadow(this.shadow));\n    this.canvas.fire('before:path:created', { path: group });\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.requestRenderAll();\n  },\n\n  /**\n   * @private\n   * @param {Array} rects\n   */\n  _getOptimizedRects: function(rects) {\n\n    // avoid creating duplicate rects at the same coordinates\n    var uniqueRects = { }, key, i, len;\n\n    for (i = 0, len = rects.length; i < len; i++) {\n      key = rects[i].left + '' + rects[i].top;\n      if (!uniqueRects[key]) {\n        uniqueRects[key] = rects[i];\n      }\n    }\n    var uniqueRectsArray = [];\n    for (key in uniqueRects) {\n      uniqueRectsArray.push(uniqueRects[key]);\n    }\n\n    return uniqueRectsArray;\n  },\n\n  /**\n   * Render new chunk of spray brush\n   */\n  render: function(sprayChunk) {\n    var ctx = this.canvas.contextTop, i, len;\n    ctx.fillStyle = this.color;\n\n    this._saveAndTransform(ctx);\n\n    for (i = 0, len = sprayChunk.length; i < len; i++) {\n      var point = sprayChunk[i];\n      if (typeof point.opacity !== 'undefined') {\n        ctx.globalAlpha = point.opacity;\n      }\n      ctx.fillRect(point.x, point.y, point.width, point.width);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * Render all spray chunks\n   */\n  _render: function() {\n    var ctx = this.canvas.contextTop, i, ilen;\n    ctx.fillStyle = this.color;\n\n    this._saveAndTransform(ctx);\n\n    for (i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      this.render(this.sprayChunks[i]);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * @param {Object} pointer\n   */\n  addSprayChunk: function(pointer) {\n    this.sprayChunkPoints = [];\n\n    var x, y, width, radius = this.width / 2, i;\n\n    for (i = 0; i < this.density; i++) {\n\n      x = fabric.util.getRandomInt(pointer.x - radius, pointer.x + radius);\n      y = fabric.util.getRandomInt(pointer.y - radius, pointer.y + radius);\n\n      if (this.dotWidthVariance) {\n        width = fabric.util.getRandomInt(\n          // bottom clamp width to 1\n          Math.max(1, this.dotWidth - this.dotWidthVariance),\n          this.dotWidth + this.dotWidthVariance);\n      }\n      else {\n        width = this.dotWidth;\n      }\n\n      var point = new fabric.Point(x, y);\n      point.width = width;\n\n      if (this.randomOpacity) {\n        point.opacity = fabric.util.getRandomInt(0, 100) / 100;\n      }\n\n      this.sprayChunkPoints.push(point);\n    }\n\n    this.sprayChunks.push(this.sprayChunkPoints);\n  }\n});\n\n\n/**\n * PatternBrush class\n * @class fabric.PatternBrush\n * @extends fabric.BaseBrush\n */\nfabric.PatternBrush = fabric.util.createClass(fabric.PencilBrush, /** @lends fabric.PatternBrush.prototype */ {\n\n  getPatternSrc: function() {\n\n    var dotWidth = 20,\n        dotDistance = 5,\n        patternCanvas = fabric.util.createCanvasElement(),\n        patternCtx = patternCanvas.getContext('2d');\n\n    patternCanvas.width = patternCanvas.height = dotWidth + dotDistance;\n\n    patternCtx.fillStyle = this.color;\n    patternCtx.beginPath();\n    patternCtx.arc(dotWidth / 2, dotWidth / 2, dotWidth / 2, 0, Math.PI * 2, false);\n    patternCtx.closePath();\n    patternCtx.fill();\n\n    return patternCanvas;\n  },\n\n  getPatternSrcFunction: function() {\n    return String(this.getPatternSrc).replace('this.color', '\"' + this.color + '\"');\n  },\n\n  /**\n   * Creates \"pattern\" instance property\n   */\n  getPattern: function() {\n    return this.canvas.contextTop.createPattern(this.source || this.getPatternSrc(), 'repeat');\n  },\n\n  /**\n   * Sets brush styles\n   */\n  _setBrushStyles: function() {\n    this.callSuper('_setBrushStyles');\n    this.canvas.contextTop.strokeStyle = this.getPattern();\n  },\n\n  /**\n   * Creates path\n   */\n  createPath: function(pathData) {\n    var path = this.callSuper('createPath', pathData),\n        topLeft = path._getLeftTopCoords().scalarAdd(path.strokeWidth / 2);\n\n    path.stroke = new fabric.Pattern({\n      source: this.source || this.getPatternSrcFunction(),\n      offsetX: -topLeft.x,\n      offsetY: -topLeft.y\n    });\n    return path;\n  }\n});\n\n\n(function() {\n\n  var getPointer = fabric.util.getPointer,\n      degreesToRadians = fabric.util.degreesToRadians,\n      abs = Math.abs,\n      supportLineDash = fabric.StaticCanvas.supports('setLineDash'),\n      isTouchEvent = fabric.util.isTouchEvent,\n      STROKE_OFFSET = 0.5;\n\n  /**\n   * Canvas class\n   * @class fabric.Canvas\n   * @extends fabric.StaticCanvas\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#canvas}\n   * @see {@link fabric.Canvas#initialize} for constructor definition\n   *\n   * @fires object:modified at the end of a transform or any change when statefull is true\n   * @fires object:rotating while an object is being rotated from the control\n   * @fires object:scaling while an object is being scaled by controls\n   * @fires object:moving while an object is being dragged\n   * @fires object:skewing while an object is being skewed from the controls\n   *\n   * @fires before:transform before a transform is is started\n   * @fires before:selection:cleared\n   * @fires selection:cleared\n   * @fires selection:updated\n   * @fires selection:created\n   *\n   * @fires path:created after a drawing operation ends and the path is added\n   * @fires mouse:down\n   * @fires mouse:move\n   * @fires mouse:up\n   * @fires mouse:down:before  on mouse down, before the inner fabric logic runs\n   * @fires mouse:move:before on mouse move, before the inner fabric logic runs\n   * @fires mouse:up:before on mouse up, before the inner fabric logic runs\n   * @fires mouse:over\n   * @fires mouse:out\n   * @fires mouse:dblclick whenever a native dbl click event fires on the canvas.\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   * @fires after:render at the end of the render process, receives the context in the callback\n   * @fires before:render at start the render process, receives the context in the callback\n   *\n   * the following events are deprecated:\n   * @fires object:rotated at the end of a rotation transform\n   * @fires object:scaled at the end of a scale transform\n   * @fires object:moved at the end of translation transform\n   * @fires object:skewed at the end of a skew transform\n   */\n  fabric.Canvas = fabric.util.createClass(fabric.StaticCanvas, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n      this.renderAndResetBound = this.renderAndReset.bind(this);\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\n      this._initStatic(el, options);\n      this._initInteractive();\n      this._createCacheCanvas();\n    },\n\n    /**\n     * When true, objects can be transformed by one side (unproportionally)\n     * when dragged on the corners that normally would not do that.\n     * @type Boolean\n     * @default\n     * @since fabric 4.0 // changed name and default value\n     */\n    uniformScaling:      true,\n\n    /**\n     * Indicates which key switches uniform scaling.\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled.\n     * totally wrong named. this sounds like `uniform scaling`\n     * if Canvas.uniformScaling is true, pressing this will set it to false\n     * and viceversa.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    uniScaleKey:           'shiftKey',\n\n    /**\n     * When true, objects use center point as the origin of scale transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:        false,\n\n    /**\n     * When true, objects use center point as the origin of rotate transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:       false,\n\n    /**\n     * Indicates which key enable centered Transform\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    centeredKey:           'altKey',\n\n    /**\n     * Indicates which key enable alternate action on corner\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    altActionKey:           'shiftKey',\n\n    /**\n     * Indicates that canvas is interactive. This property should not be changed.\n     * @type Boolean\n     * @default\n     */\n    interactive:            true,\n\n    /**\n     * Indicates whether group selection should be enabled\n     * @type Boolean\n     * @default\n     */\n    selection:              true,\n\n    /**\n     * Indicates which key or keys enable multiple click selection\n     * Pass value as a string or array of strings\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or empty or containing any other string that is not a modifier key\n     * feature is disabled.\n     * @since 1.6.2\n     * @type String|Array\n     * @default\n     */\n    selectionKey:           'shiftKey',\n\n    /**\n     * Indicates which key enable alternative selection\n     * in case of target overlapping with active object\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * For a series of reason that come from the general expectations on how\n     * things should work, this feature works only for preserveObjectStacking true.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled.\n     * @since 1.6.5\n     * @type null|String\n     * @default\n     */\n    altSelectionKey:           null,\n\n    /**\n     * Color of selection\n     * @type String\n     * @default\n     */\n    selectionColor:         'rgba(100, 100, 255, 0.3)', // blue\n\n    /**\n     * Default dash array pattern\n     * If not empty the selection border is dashed\n     * @type Array\n     */\n    selectionDashArray:     [],\n\n    /**\n     * Color of the border of selection (usually slightly darker than color of selection itself)\n     * @type String\n     * @default\n     */\n    selectionBorderColor:   'rgba(255, 255, 255, 0.3)',\n\n    /**\n     * Width of a line used in object/group selection\n     * @type Number\n     * @default\n     */\n    selectionLineWidth:     1,\n\n    /**\n     * Select only shapes that are fully contained in the dragged selection rectangle.\n     * @type Boolean\n     * @default\n     */\n    selectionFullyContained: false,\n\n    /**\n     * Default cursor value used when hovering over an object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:            'move',\n\n    /**\n     * Default cursor value used when moving an object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:             'move',\n\n    /**\n     * Default cursor value used for the entire canvas\n     * @type String\n     * @default\n     */\n    defaultCursor:          'default',\n\n    /**\n     * Cursor value used during free drawing\n     * @type String\n     * @default\n     */\n    freeDrawingCursor:      'crosshair',\n\n    /**\n     * Cursor value used for rotation point\n     * @type String\n     * @default\n     */\n    rotationCursor:         'crosshair',\n\n    /**\n     * Cursor value used for disabled elements ( corners with disabled action )\n     * @type String\n     * @since 2.0.0\n     * @default\n     */\n    notAllowedCursor:         'not-allowed',\n\n    /**\n     * Default element class that's given to wrapper (div) element of canvas\n     * @type String\n     * @default\n     */\n    containerClass:         'canvas-container',\n\n    /**\n     * When true, object detection happens on per-pixel basis rather than on per-bounding-box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:     false,\n\n    /**\n     * Number of pixels around target pixel to tolerate (consider active) during object detection\n     * @type Number\n     * @default\n     */\n    targetFindTolerance:    0,\n\n    /**\n     * When true, target detection is skipped. Target detection will return always undefined.\n     * click selection won't work anymore, events will fire with no targets.\n     * if something is selected before setting it to true, it will be deselected at the first click.\n     * area selection will still work. check the `selection` property too.\n     * if you deactivate both, you should look into staticCanvas.\n     * @type Boolean\n     * @default\n     */\n    skipTargetFind:         false,\n\n    /**\n     * When true, mouse events on canvas (mousedown/mousemove/mouseup) result in free drawing.\n     * After mousedown, mousemove creates a shape,\n     * and then mouseup finalizes it and adds an instance of `fabric.Path` onto canvas.\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-4#free_drawing}\n     * @type Boolean\n     * @default\n     */\n    isDrawingMode:          false,\n\n    /**\n     * Indicates whether objects should remain in current stack position when selected.\n     * When false objects are brought to top and rendered as part of the selection group\n     * @type Boolean\n     * @default\n     */\n    preserveObjectStacking: false,\n\n    /**\n     * Indicates the angle that an object will lock to while rotating.\n     * @type Number\n     * @since 1.6.7\n     * @default\n     */\n    snapAngle: 0,\n\n    /**\n     * Indicates the distance from the snapAngle the rotation will lock to the snapAngle.\n     * When `null`, the snapThreshold will default to the snapAngle.\n     * @type null|Number\n     * @since 1.6.7\n     * @default\n     */\n    snapThreshold: null,\n\n    /**\n     * Indicates if the right click on canvas can output the context menu or not\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    stopContextMenu: false,\n\n    /**\n     * Indicates if the canvas can fire right click events\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    fireRightClick: false,\n\n    /**\n     * Indicates if the canvas can fire middle click events\n     * @type Boolean\n     * @since 1.7.8\n     * @default\n     */\n    fireMiddleClick: false,\n\n    /**\n     * Keep track of the subTargets for Mouse Events\n     * @type fabric.Object[]\n     */\n    targets: [],\n\n    /**\n     * Keep track of the hovered target\n     * @type fabric.Object\n     * @private\n     */\n    _hoveredTarget: null,\n\n    /**\n     * hold the list of nested targets hovered\n     * @type fabric.Object[]\n     * @private\n     */\n    _hoveredTargets: [],\n\n    /**\n     * @private\n     */\n    _initInteractive: function() {\n      this._currentTransform = null;\n      this._groupSelector = null;\n      this._initWrapperElement();\n      this._createUpperCanvas();\n      this._initEventListeners();\n\n      this._initRetinaScaling();\n\n      this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this);\n\n      this.calcOffset();\n    },\n\n    /**\n     * Divides objects in two groups, one to render immediately\n     * and one to render as activeGroup.\n     * @return {Array} objects to render immediately and pushes the other in the activeGroup.\n     */\n    _chooseObjectsToRender: function() {\n      var activeObjects = this.getActiveObjects(),\n          object, objsToRender, activeGroupObjects;\n\n      if (activeObjects.length > 0 && !this.preserveObjectStacking) {\n        objsToRender = [];\n        activeGroupObjects = [];\n        for (var i = 0, length = this._objects.length; i < length; i++) {\n          object = this._objects[i];\n          if (activeObjects.indexOf(object) === -1 ) {\n            objsToRender.push(object);\n          }\n          else {\n            activeGroupObjects.push(object);\n          }\n        }\n        if (activeObjects.length > 1) {\n          this._activeObject._objects = activeGroupObjects;\n        }\n        objsToRender.push.apply(objsToRender, activeGroupObjects);\n      }\n      else {\n        objsToRender = this._objects;\n      }\n      return objsToRender;\n    },\n\n    /**\n     * Renders both the top canvas and the secondary container canvas.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      if (this.contextTopDirty && !this._groupSelector && !this.isDrawingMode) {\n        this.clearContext(this.contextTop);\n        this.contextTopDirty = false;\n      }\n      if (this.hasLostContext) {\n        this.renderTopLayer(this.contextTop);\n      }\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._chooseObjectsToRender());\n      return this;\n    },\n\n    renderTopLayer: function(ctx) {\n      ctx.save();\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this.freeDrawingBrush && this.freeDrawingBrush._render();\n        this.contextTopDirty = true;\n      }\n      // we render the top context - last object\n      if (this.selection && this._groupSelector) {\n        this._drawSelection(ctx);\n        this.contextTopDirty = true;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Method to render only the top canvas.\n     * Also used to render the group selection box.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    renderTop: function () {\n      var ctx = this.contextTop;\n      this.clearContext(ctx);\n      this.renderTopLayer(ctx);\n      this.fire('after:render');\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _normalizePointer: function (object, pointer) {\n      var m = object.calcTransformMatrix(),\n          invertedM = fabric.util.invertTransform(m),\n          vptPointer = this.restorePointerVpt(pointer);\n      return fabric.util.transformPoint(vptPointer, invertedM);\n    },\n\n    /**\n     * Returns true if object is transparent at a certain location\n     * @param {fabric.Object} target Object to check\n     * @param {Number} x Left coordinate\n     * @param {Number} y Top coordinate\n     * @return {Boolean}\n     */\n    isTargetTransparent: function (target, x, y) {\n      // in case the target is the activeObject, we cannot execute this optimization\n      // because we need to draw controls too.\n      if (target.shouldCache() && target._cacheCanvas && target !== this._activeObject) {\n        var normalizedPointer = this._normalizePointer(target, {x: x, y: y}),\n            targetRelativeX = Math.max(target.cacheTranslationX + (normalizedPointer.x * target.zoomX), 0),\n            targetRelativeY = Math.max(target.cacheTranslationY + (normalizedPointer.y * target.zoomY), 0);\n\n        var isTransparent = fabric.util.isTransparent(\n          target._cacheContext, Math.round(targetRelativeX), Math.round(targetRelativeY), this.targetFindTolerance);\n\n        return isTransparent;\n      }\n\n      var ctx = this.contextCache,\n          originalColor = target.selectionBackgroundColor, v = this.viewportTransform;\n\n      target.selectionBackgroundColor = '';\n\n      this.clearContext(ctx);\n\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      target.render(ctx);\n      ctx.restore();\n\n      target.selectionBackgroundColor = originalColor;\n\n      var isTransparent = fabric.util.isTransparent(\n        ctx, x, y, this.targetFindTolerance);\n\n      return isTransparent;\n    },\n\n    /**\n     * takes an event and determines if selection key has been pressed\n     * @private\n     * @param {Event} e Event object\n     */\n    _isSelectionKeyPressed: function(e) {\n      var selectionKeyPressed = false;\n\n      if (Object.prototype.toString.call(this.selectionKey) === '[object Array]') {\n        selectionKeyPressed = !!this.selectionKey.find(function(key) { return e[key] === true; });\n      }\n      else {\n        selectionKeyPressed = e[this.selectionKey];\n      }\n\n      return selectionKeyPressed;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _shouldClearSelection: function (e, target) {\n      var activeObjects = this.getActiveObjects(),\n          activeObject = this._activeObject;\n\n      return (\n        !target\n        ||\n        (target &&\n          activeObject &&\n          activeObjects.length > 1 &&\n          activeObjects.indexOf(target) === -1 &&\n          activeObject !== target &&\n          !this._isSelectionKeyPressed(e))\n        ||\n        (target && !target.evented)\n        ||\n        (target &&\n          !target.selectable &&\n          activeObject &&\n          activeObject !== target)\n      );\n    },\n\n    /**\n     * centeredScaling from object can't override centeredScaling from canvas.\n     * this should be fixed, since object setting should take precedence over canvas.\n     * also this should be something that will be migrated in the control properties.\n     * as ability to define the origin of the transformation that the control provide.\n     * @private\n     * @param {fabric.Object} target\n     * @param {String} action\n     * @param {Boolean} altKey\n     */\n    _shouldCenterTransform: function (target, action, altKey) {\n      if (!target) {\n        return;\n      }\n\n      var centerTransform;\n\n      if (action === 'scale' || action === 'scaleX' || action === 'scaleY' || action === 'resizing') {\n        centerTransform = this.centeredScaling || target.centeredScaling;\n      }\n      else if (action === 'rotate') {\n        centerTransform = this.centeredRotation || target.centeredRotation;\n      }\n\n      return centerTransform ? !altKey : altKey;\n    },\n\n    /**\n     * should disappear before release 4.0\n     * @private\n     */\n    _getOriginFromCorner: function(target, corner) {\n      var origin = {\n        x: target.originX,\n        y: target.originY\n      };\n\n      if (corner === 'ml' || corner === 'tl' || corner === 'bl') {\n        origin.x = 'right';\n      }\n      else if (corner === 'mr' || corner === 'tr' || corner === 'br') {\n        origin.x = 'left';\n      }\n\n      if (corner === 'tl' || corner === 'mt' || corner === 'tr') {\n        origin.y = 'bottom';\n      }\n      else if (corner === 'bl' || corner === 'mb' || corner === 'br') {\n        origin.y = 'top';\n      }\n      return origin;\n    },\n\n    /**\n     * @private\n     * @param {Boolean} alreadySelected true if target is already selected\n     * @param {String} corner a string representing the corner ml, mr, tl ...\n     * @param {Event} e Event object\n     * @param {fabric.Object} [target] inserted back to help overriding. Unused\n     */\n    _getActionFromCorner: function(alreadySelected, corner, e, target) {\n      if (!corner || !alreadySelected) {\n        return 'drag';\n      }\n      var control = target.controls[corner];\n      return control.getActionName(e, control, target);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _setupCurrentTransform: function (e, target, alreadySelected) {\n      if (!target) {\n        return;\n      }\n\n      var pointer = this.getPointer(e), corner = target.__corner,\n          control = target.controls[corner],\n          actionHandler = (alreadySelected && corner) ?\n            control.getActionHandler(e, target, control) : fabric.controlsUtils.dragHandler,\n          action = this._getActionFromCorner(alreadySelected, corner, e, target),\n          origin = this._getOriginFromCorner(target, corner),\n          altKey = e[this.centeredKey],\n          transform = {\n            target: target,\n            action: action,\n            actionHandler: actionHandler,\n            corner: corner,\n            scaleX: target.scaleX,\n            scaleY: target.scaleY,\n            skewX: target.skewX,\n            skewY: target.skewY,\n            // used by transation\n            offsetX: pointer.x - target.left,\n            offsetY: pointer.y - target.top,\n            originX: origin.x,\n            originY: origin.y,\n            ex: pointer.x,\n            ey: pointer.y,\n            lastX: pointer.x,\n            lastY: pointer.y,\n            // unsure they are useful anymore.\n            // left: target.left,\n            // top: target.top,\n            theta: degreesToRadians(target.angle),\n            // end of unsure\n            width: target.width * target.scaleX,\n            shiftKey: e.shiftKey,\n            altKey: altKey,\n            original: fabric.util.saveObjectTransform(target),\n          };\n\n      if (this._shouldCenterTransform(target, action, altKey)) {\n        transform.originX = 'center';\n        transform.originY = 'center';\n      }\n      transform.original.originX = origin.x;\n      transform.original.originY = origin.y;\n      this._currentTransform = transform;\n      this._beforeTransform(e);\n    },\n\n    /**\n     * Set the cursor type of the canvas element\n     * @param {String} value Cursor type of the canvas element.\n     * @see http://www.w3.org/TR/css3-ui/#cursor\n     */\n    setCursor: function (value) {\n      this.upperCanvasEl.style.cursor = value;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx to draw the selection on\n     */\n    _drawSelection: function (ctx) {\n      var groupSelector = this._groupSelector,\n          left = groupSelector.left,\n          top = groupSelector.top,\n          aleft = abs(left),\n          atop = abs(top);\n\n      if (this.selectionColor) {\n        ctx.fillStyle = this.selectionColor;\n\n        ctx.fillRect(\n          groupSelector.ex - ((left > 0) ? 0 : -left),\n          groupSelector.ey - ((top > 0) ? 0 : -top),\n          aleft,\n          atop\n        );\n      }\n\n      if (!this.selectionLineWidth || !this.selectionBorderColor) {\n        return;\n      }\n      ctx.lineWidth = this.selectionLineWidth;\n      ctx.strokeStyle = this.selectionBorderColor;\n\n      // selection border\n      if (this.selectionDashArray.length > 1 && !supportLineDash) {\n\n        var px = groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),\n            py = groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop);\n\n        ctx.beginPath();\n\n        fabric.util.drawDashedLine(ctx, px, py, px + aleft, py, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px, py + atop - 1, px + aleft, py + atop - 1, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px, py, px, py + atop, this.selectionDashArray);\n        fabric.util.drawDashedLine(ctx, px + aleft - 1, py, px + aleft - 1, py + atop, this.selectionDashArray);\n\n        ctx.closePath();\n        ctx.stroke();\n      }\n      else {\n        fabric.Object.prototype._setLineDash.call(this, ctx, this.selectionDashArray);\n        ctx.strokeRect(\n          groupSelector.ex + STROKE_OFFSET - ((left > 0) ? 0 : aleft),\n          groupSelector.ey + STROKE_OFFSET - ((top > 0) ? 0 : atop),\n          aleft,\n          atop\n        );\n      }\n    },\n\n    /**\n     * Method that determines what object we are clicking on\n     * the skipGroup parameter is for internal use, is needed for shift+click action\n     * 11/09/2018 TODO: would be cool if findTarget could discern between being a full target\n     * or the outside part of the corner.\n     * @param {Event} e mouse event\n     * @param {Boolean} skipGroup when true, activeGroup is skipped and only objects are traversed through\n     * @return {fabric.Object} the target found\n     */\n    findTarget: function (e, skipGroup) {\n      if (this.skipTargetFind) {\n        return;\n      }\n\n      var ignoreZoom = true,\n          pointer = this.getPointer(e, ignoreZoom),\n          activeObject = this._activeObject,\n          aObjects = this.getActiveObjects(),\n          activeTarget, activeTargetSubs,\n          isTouch = isTouchEvent(e),\n          shouldLookForActive = (aObjects.length > 1 && !skipGroup) || aObjects.length === 1;\n\n      // first check current group (if one exists)\n      // active group does not check sub targets like normal groups.\n      // if active group just exits.\n      this.targets = [];\n\n      // if we hit the corner of an activeObject, let's return that.\n      if (shouldLookForActive && activeObject._findTargetCorner(pointer, isTouch)) {\n        return activeObject;\n      }\n      if (aObjects.length > 1 && !skipGroup && activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        return activeObject;\n      }\n      if (aObjects.length === 1 &&\n        activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        if (!this.preserveObjectStacking) {\n          return activeObject;\n        }\n        else {\n          activeTarget = activeObject;\n          activeTargetSubs = this.targets;\n          this.targets = [];\n        }\n      }\n      var target = this._searchPossibleTargets(this._objects, pointer);\n      if (e[this.altSelectionKey] && target && activeTarget && target !== activeTarget) {\n        target = activeTarget;\n        this.targets = activeTargetSubs;\n      }\n      return target;\n    },\n\n    /**\n     * Checks point is inside the object.\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\n     * @param {fabric.Object} obj Object to test against\n     * @param {Object} [globalPointer] x,y object of point coordinates relative to canvas used to search per pixel target.\n     * @return {Boolean} true if point is contained within an area of given object\n     * @private\n     */\n    _checkTarget: function(pointer, obj, globalPointer) {\n      if (obj &&\n          obj.visible &&\n          obj.evented &&\n          // http://www.geog.ubc.ca/courses/klink/gis.notes/ncgia/u32.html\n          // http://idav.ucdavis.edu/~okreylos/TAship/Spring2000/PointInPolygon.html\n          obj.containsPoint(pointer)\n      ) {\n        if ((this.perPixelTargetFind || obj.perPixelTargetFind) && !obj.isEditing) {\n          var isTransparent = this.isTargetTransparent(obj, globalPointer.x, globalPointer.y);\n          if (!isTransparent) {\n            return true;\n          }\n        }\n        else {\n          return true;\n        }\n      }\n    },\n\n    /**\n     * Function used to search inside objects an object that contains pointer in bounding box or that contains pointerOnCanvas when painted\n     * @param {Array} [objects] objects array to look into\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\n     * @return {fabric.Object} object that contains pointer\n     * @private\n     */\n    _searchPossibleTargets: function(objects, pointer) {\n      // Cache all targets where their bounding box contains point.\n      var target, i = objects.length, subTarget;\n      // Do not check for currently grouped objects, since we check the parent group itself.\n      // until we call this function specifically to search inside the activeGroup\n      while (i--) {\n        var objToCheck = objects[i];\n        var pointerToUse = objToCheck.group ?\n          this._normalizePointer(objToCheck.group, pointer) : pointer;\n        if (this._checkTarget(pointerToUse, objToCheck, pointer)) {\n          target = objects[i];\n          if (target.subTargetCheck && target instanceof fabric.Group) {\n            subTarget = this._searchPossibleTargets(target._objects, pointer);\n            subTarget && this.targets.push(subTarget);\n          }\n          break;\n        }\n      }\n      return target;\n    },\n\n    /**\n     * Returns pointer coordinates without the effect of the viewport\n     * @param {Object} pointer with \"x\" and \"y\" number values\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    restorePointerVpt: function(pointer) {\n      return fabric.util.transformPoint(\n        pointer,\n        fabric.util.invertTransform(this.viewportTransform)\n      );\n    },\n\n    /**\n     * Returns pointer coordinates relative to canvas.\n     * Can return coordinates with or without viewportTransform.\n     * ignoreZoom false gives back coordinates that represent\n     * the point clicked on canvas element.\n     * ignoreZoom true gives back coordinates after being processed\n     * by the viewportTransform ( sort of coordinates of what is displayed\n     * on the canvas where you are clicking.\n     * ignoreZoom true = HTMLElement coordinates relative to top,left\n     * ignoreZoom false, default = fabric space coordinates, the same used for shape position\n     * To interact with your shapes top and left you want to use ignoreZoom true\n     * most of the time, while ignoreZoom false will give you coordinates\n     * compatible with the object.oCoords system.\n     * of the time.\n     * @param {Event} e\n     * @param {Boolean} ignoreZoom\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    getPointer: function (e, ignoreZoom) {\n      // return cached values if we are in the event processing chain\n      if (this._absolutePointer && !ignoreZoom) {\n        return this._absolutePointer;\n      }\n      if (this._pointer && ignoreZoom) {\n        return this._pointer;\n      }\n\n      var pointer = getPointer(e),\n          upperCanvasEl = this.upperCanvasEl,\n          bounds = upperCanvasEl.getBoundingClientRect(),\n          boundsWidth = bounds.width || 0,\n          boundsHeight = bounds.height || 0,\n          cssScale;\n\n      if (!boundsWidth || !boundsHeight ) {\n        if ('top' in bounds && 'bottom' in bounds) {\n          boundsHeight = Math.abs( bounds.top - bounds.bottom );\n        }\n        if ('right' in bounds && 'left' in bounds) {\n          boundsWidth = Math.abs( bounds.right - bounds.left );\n        }\n      }\n\n      this.calcOffset();\n      pointer.x = pointer.x - this._offset.left;\n      pointer.y = pointer.y - this._offset.top;\n      if (!ignoreZoom) {\n        pointer = this.restorePointerVpt(pointer);\n      }\n\n      var retinaScaling = this.getRetinaScaling();\n      if (retinaScaling !== 1) {\n        pointer.x /= retinaScaling;\n        pointer.y /= retinaScaling;\n      }\n\n      if (boundsWidth === 0 || boundsHeight === 0) {\n        // If bounds are not available (i.e. not visible), do not apply scale.\n        cssScale = { width: 1, height: 1 };\n      }\n      else {\n        cssScale = {\n          width: upperCanvasEl.width / boundsWidth,\n          height: upperCanvasEl.height / boundsHeight\n        };\n      }\n\n      return {\n        x: pointer.x * cssScale.width,\n        y: pointer.y * cssScale.height\n      };\n    },\n\n    /**\n     * @private\n     * @throws {CANVAS_INIT_ERROR} If canvas can not be initialized\n     */\n    _createUpperCanvas: function () {\n      var lowerCanvasClass = this.lowerCanvasEl.className.replace(/\\s*lower-canvas\\s*/, ''),\n          lowerCanvasEl = this.lowerCanvasEl, upperCanvasEl = this.upperCanvasEl;\n\n      // there is no need to create a new upperCanvas element if we have already one.\n      if (upperCanvasEl) {\n        upperCanvasEl.className = '';\n      }\n      else {\n        upperCanvasEl = this._createCanvasElement();\n        this.upperCanvasEl = upperCanvasEl;\n      }\n      fabric.util.addClass(upperCanvasEl, 'upper-canvas ' + lowerCanvasClass);\n\n      this.wrapperEl.appendChild(upperCanvasEl);\n\n      this._copyCanvasStyle(lowerCanvasEl, upperCanvasEl);\n      this._applyCanvasStyle(upperCanvasEl);\n      this.contextTop = upperCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _createCacheCanvas: function () {\n      this.cacheCanvasEl = this._createCanvasElement();\n      this.cacheCanvasEl.setAttribute('width', this.width);\n      this.cacheCanvasEl.setAttribute('height', this.height);\n      this.contextCache = this.cacheCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _initWrapperElement: function () {\n      this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, 'div', {\n        'class': this.containerClass\n      });\n      fabric.util.setStyle(this.wrapperEl, {\n        width: this.width + 'px',\n        height: this.height + 'px',\n        position: 'relative'\n      });\n      fabric.util.makeElementUnselectable(this.wrapperEl);\n    },\n\n    /**\n     * @private\n     * @param {HTMLElement} element canvas element to apply styles on\n     */\n    _applyCanvasStyle: function (element) {\n      var width = this.width || element.width,\n          height = this.height || element.height;\n\n      fabric.util.setStyle(element, {\n        position: 'absolute',\n        width: width + 'px',\n        height: height + 'px',\n        left: 0,\n        top: 0,\n        'touch-action': this.allowTouchScrolling ? 'manipulation' : 'none',\n        '-ms-touch-action': this.allowTouchScrolling ? 'manipulation' : 'none'\n      });\n      element.width = width;\n      element.height = height;\n      fabric.util.makeElementUnselectable(element);\n    },\n\n    /**\n     * Copy the entire inline style from one element (fromEl) to another (toEl)\n     * @private\n     * @param {Element} fromEl Element style is copied from\n     * @param {Element} toEl Element copied style is applied to\n     */\n    _copyCanvasStyle: function (fromEl, toEl) {\n      toEl.style.cssText = fromEl.style.cssText;\n    },\n\n    /**\n     * Returns context of canvas where object selection is drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getSelectionContext: function() {\n      return this.contextTop;\n    },\n\n    /**\n     * Returns &lt;canvas> element on which object selection is drawn\n     * @return {HTMLCanvasElement}\n     */\n    getSelectionElement: function () {\n      return this.upperCanvasEl;\n    },\n\n    /**\n     * Returns currently active object\n     * @return {fabric.Object} active object\n     */\n    getActiveObject: function () {\n      return this._activeObject;\n    },\n\n    /**\n     * Returns an array with the current selected objects\n     * @return {fabric.Object} active object\n     */\n    getActiveObjects: function () {\n      var active = this._activeObject;\n      if (active) {\n        if (active.type === 'activeSelection' && active._objects) {\n          return active._objects.slice(0);\n        }\n        else {\n          return [active];\n        }\n      }\n      return [];\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      // removing active object should fire \"selection:cleared\" events\n      if (obj === this._activeObject) {\n        this.fire('before:selection:cleared', { target: obj });\n        this._discardActiveObject();\n        this.fire('selection:cleared', { target: obj });\n        obj.fire('deselected');\n      }\n      if (obj === this._hoveredTarget){\n        this._hoveredTarget = null;\n        this._hoveredTargets = [];\n      }\n      this.callSuper('_onObjectRemoved', obj);\n    },\n\n    /**\n     * @private\n     * Compares the old activeObject with the current one and fires correct events\n     * @param {fabric.Object} obj old activeObject\n     */\n    _fireSelectionEvents: function(oldObjects, e) {\n      var somethingChanged = false, objects = this.getActiveObjects(),\n          added = [], removed = [];\n      oldObjects.forEach(function(oldObject) {\n        if (objects.indexOf(oldObject) === -1) {\n          somethingChanged = true;\n          oldObject.fire('deselected', {\n            e: e,\n            target: oldObject\n          });\n          removed.push(oldObject);\n        }\n      });\n      objects.forEach(function(object) {\n        if (oldObjects.indexOf(object) === -1) {\n          somethingChanged = true;\n          object.fire('selected', {\n            e: e,\n            target: object\n          });\n          added.push(object);\n        }\n      });\n      if (oldObjects.length > 0 && objects.length > 0) {\n        somethingChanged && this.fire('selection:updated', {\n          e: e,\n          selected: added,\n          deselected: removed,\n          // added for backward compatibility\n          // deprecated\n          updated: added[0] || removed[0],\n          target: this._activeObject,\n        });\n      }\n      else if (objects.length > 0) {\n        this.fire('selection:created', {\n          e: e,\n          selected: added,\n          target: this._activeObject,\n        });\n      }\n      else if (oldObjects.length > 0) {\n        this.fire('selection:cleared', {\n          e: e,\n          deselected: removed,\n        });\n      }\n    },\n\n    /**\n     * Sets given object as the only active object on canvas\n     * @param {fabric.Object} object Object to set as an active one\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setActiveObject: function (object, e) {\n      var currentActives = this.getActiveObjects();\n      this._setActiveObject(object, e);\n      this._fireSelectionEvents(currentActives, e);\n      return this;\n    },\n\n    /**\n     * This is a private method for now.\n     * This is supposed to be equivalent to setActiveObject but without firing\n     * any event. There is commitment to have this stay this way.\n     * This is the functional part of setActiveObject.\n     * @private\n     * @param {Object} object to set as active\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {Boolean} true if the selection happened\n     */\n    _setActiveObject: function(object, e) {\n      if (this._activeObject === object) {\n        return false;\n      }\n      if (!this._discardActiveObject(e, object)) {\n        return false;\n      }\n      if (object.onSelect({ e: e })) {\n        return false;\n      }\n      this._activeObject = object;\n      return true;\n    },\n\n    /**\n     * This is a private method for now.\n     * This is supposed to be equivalent to discardActiveObject but without firing\n     * any events. There is commitment to have this stay this way.\n     * This is the functional part of discardActiveObject.\n     * @param {Event} [e] Event (passed along when firing \"object:deselected\")\n     * @param {Object} object to set as active\n     * @return {Boolean} true if the selection happened\n     * @private\n     */\n    _discardActiveObject: function(e, object) {\n      var obj = this._activeObject;\n      if (obj) {\n        // onDeselect return TRUE to cancel selection;\n        if (obj.onDeselect({ e: e, object: object })) {\n          return false;\n        }\n        this._activeObject = null;\n      }\n      return true;\n    },\n\n    /**\n     * Discards currently active object and fire events. If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parameter and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @param {event} e\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    discardActiveObject: function (e) {\n      var currentActives = this.getActiveObjects(), activeObject = this.getActiveObject();\n      if (currentActives.length) {\n        this.fire('before:selection:cleared', { target: activeObject, e: e });\n      }\n      this._discardActiveObject(e);\n      this._fireSelectionEvents(currentActives, e);\n      return this;\n    },\n\n    /**\n     * Clears a canvas element and removes all event listeners\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      var wrapper = this.wrapperEl;\n      this.removeListeners();\n      wrapper.removeChild(this.upperCanvasEl);\n      wrapper.removeChild(this.lowerCanvasEl);\n      this.contextCache = null;\n      this.contextTop = null;\n      ['upperCanvasEl', 'cacheCanvasEl'].forEach((function(element) {\n        fabric.util.cleanUpJsdomNode(this[element]);\n        this[element] = undefined;\n      }).bind(this));\n      if (wrapper.parentNode) {\n        wrapper.parentNode.replaceChild(this.lowerCanvasEl, this.wrapperEl);\n      }\n      delete this.wrapperEl;\n      fabric.StaticCanvas.prototype.dispose.call(this);\n      return this;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      // this.discardActiveGroup();\n      this.discardActiveObject();\n      this.clearContext(this.contextTop);\n      return this.callSuper('clear');\n    },\n\n    /**\n     * Draws objects' controls (borders/controls)\n     * @param {CanvasRenderingContext2D} ctx Context to render controls on\n     */\n    drawControls: function(ctx) {\n      var activeObject = this._activeObject;\n\n      if (activeObject) {\n        activeObject._renderControls(ctx);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      //If the object is part of the current selection group, it should\n      //be transformed appropriately\n      //i.e. it should be serialised as it would appear if the selection group\n      //were to be destroyed.\n      var originalProperties = this._realizeGroupTransformOnObject(instance),\n          object = this.callSuper('_toObject', instance, methodName, propertiesToInclude);\n      //Undo the damage we did by changing all of its properties\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n      return object;\n    },\n\n    /**\n     * Realises an object's group transformation on it\n     * @private\n     * @param {fabric.Object} [instance] the object to transform (gets mutated)\n     * @returns the original values of instance which were changed\n     */\n    _realizeGroupTransformOnObject: function(instance) {\n      if (instance.group && instance.group.type === 'activeSelection' && this._activeObject === instance.group) {\n        var layoutProps = ['angle', 'flipX', 'flipY', 'left', 'scaleX', 'scaleY', 'skewX', 'skewY', 'top'];\n        //Copy all the positionally relevant properties across now\n        var originalValues = {};\n        layoutProps.forEach(function(prop) {\n          originalValues[prop] = instance[prop];\n        });\n        fabric.util.addTransformToObject(instance, this._activeObject.calcOwnMatrix());\n        return originalValues;\n      }\n      else {\n        return null;\n      }\n    },\n\n    /**\n     * Restores the changed properties of instance\n     * @private\n     * @param {fabric.Object} [instance] the object to un-transform (gets mutated)\n     * @param {Object} [originalValues] the original values of instance, as returned by _realizeGroupTransformOnObject\n     */\n    _unwindGroupTransformOnObject: function(instance, originalValues) {\n      if (originalValues) {\n        instance.set(originalValues);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      //If the object is in a selection group, simulate what would happen to that\n      //object when the group is deselected\n      var originalProperties = this._realizeGroupTransformOnObject(instance);\n      this.callSuper('_setSVGObject', markup, instance, reviver);\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n    },\n\n    setViewportTransform: function (vpt) {\n      if (this.renderOnAddRemove && this._activeObject && this._activeObject.isEditing) {\n        this._activeObject.clearContextTop();\n      }\n      fabric.StaticCanvas.prototype.setViewportTransform.call(this, vpt);\n    }\n  });\n\n  // copying static properties manually to work around Opera's bug,\n  // where \"prototype\" property is enumerable and overrides existing prototype\n  for (var prop in fabric.StaticCanvas) {\n    if (prop !== 'prototype') {\n      fabric.Canvas[prop] = fabric.StaticCanvas[prop];\n    }\n  }\n})();\n\n\n(function() {\n\n  var addListener = fabric.util.addListener,\n      removeListener = fabric.util.removeListener,\n      RIGHT_CLICK = 3, MIDDLE_CLICK = 2, LEFT_CLICK = 1,\n      addEventOptions = { passive: false };\n\n  function checkClick(e, value) {\n    return e.button && (e.button === value - 1);\n  }\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Contains the id of the touch event that owns the fabric transform\n     * @type Number\n     * @private\n     */\n    mainTouchId: null,\n\n    /**\n     * Adds mouse listeners to canvas\n     * @private\n     */\n    _initEventListeners: function () {\n      // in case we initialized the class twice. This should not happen normally\n      // but in some kind of applications where the canvas element may be changed\n      // this is a workaround to having double listeners.\n      this.removeListeners();\n      this._bindEvents();\n      this.addOrRemove(addListener, 'add');\n    },\n\n    /**\n     * return an event prefix pointer or mouse.\n     * @private\n     */\n    _getEventPrefix: function () {\n      return this.enablePointerEvents ? 'pointer' : 'mouse';\n    },\n\n    addOrRemove: function(functor, eventjsFunctor) {\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      functor(fabric.window, 'resize', this._onResize);\n      functor(canvasElement, eventTypePrefix + 'down', this._onMouseDown);\n      functor(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      functor(canvasElement, eventTypePrefix + 'out', this._onMouseOut);\n      functor(canvasElement, eventTypePrefix + 'enter', this._onMouseEnter);\n      functor(canvasElement, 'wheel', this._onMouseWheel);\n      functor(canvasElement, 'contextmenu', this._onContextMenu);\n      functor(canvasElement, 'dblclick', this._onDoubleClick);\n      functor(canvasElement, 'dragover', this._onDragOver);\n      functor(canvasElement, 'dragenter', this._onDragEnter);\n      functor(canvasElement, 'dragleave', this._onDragLeave);\n      functor(canvasElement, 'drop', this._onDrop);\n      if (!this.enablePointerEvents) {\n        functor(canvasElement, 'touchstart', this._onTouchStart, addEventOptions);\n      }\n      if (typeof eventjs !== 'undefined' && eventjsFunctor in eventjs) {\n        eventjs[eventjsFunctor](canvasElement, 'gesture', this._onGesture);\n        eventjs[eventjsFunctor](canvasElement, 'drag', this._onDrag);\n        eventjs[eventjsFunctor](canvasElement, 'orientation', this._onOrientationChange);\n        eventjs[eventjsFunctor](canvasElement, 'shake', this._onShake);\n        eventjs[eventjsFunctor](canvasElement, 'longpress', this._onLongPress);\n      }\n    },\n\n    /**\n     * Removes all event listeners\n     */\n    removeListeners: function() {\n      this.addOrRemove(removeListener, 'remove');\n      // if you dispose on a mouseDown, before mouse up, you need to clean document to...\n      var eventTypePrefix = this._getEventPrefix();\n      removeListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n      removeListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      removeListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n    },\n\n    /**\n     * @private\n     */\n    _bindEvents: function() {\n      if (this.eventsBound) {\n        // for any reason we pass here twice we do not want to bind events twice.\n        return;\n      }\n      this._onMouseDown = this._onMouseDown.bind(this);\n      this._onTouchStart = this._onTouchStart.bind(this);\n      this._onMouseMove = this._onMouseMove.bind(this);\n      this._onMouseUp = this._onMouseUp.bind(this);\n      this._onTouchEnd = this._onTouchEnd.bind(this);\n      this._onResize = this._onResize.bind(this);\n      this._onGesture = this._onGesture.bind(this);\n      this._onDrag = this._onDrag.bind(this);\n      this._onShake = this._onShake.bind(this);\n      this._onLongPress = this._onLongPress.bind(this);\n      this._onOrientationChange = this._onOrientationChange.bind(this);\n      this._onMouseWheel = this._onMouseWheel.bind(this);\n      this._onMouseOut = this._onMouseOut.bind(this);\n      this._onMouseEnter = this._onMouseEnter.bind(this);\n      this._onContextMenu = this._onContextMenu.bind(this);\n      this._onDoubleClick = this._onDoubleClick.bind(this);\n      this._onDragOver = this._onDragOver.bind(this);\n      this._onDragEnter = this._simpleEventHandler.bind(this, 'dragenter');\n      this._onDragLeave = this._simpleEventHandler.bind(this, 'dragleave');\n      this._onDrop = this._simpleEventHandler.bind(this, 'drop');\n      this.eventsBound = true;\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js gesture\n     * @param {Event} [self] Inner Event object\n     */\n    _onGesture: function(e, self) {\n      this.__onTransformGesture && this.__onTransformGesture(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js drag\n     * @param {Event} [self] Inner Event object\n     */\n    _onDrag: function(e, self) {\n      this.__onDrag && this.__onDrag(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on wheel event\n     */\n    _onMouseWheel: function(e) {\n      this.__onMouseWheel(e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseOut: function(e) {\n      var target = this._hoveredTarget;\n      this.fire('mouse:out', { target: target, e: e });\n      this._hoveredTarget = null;\n      target && target.fire('mouseout', { e: e });\n\n      var _this = this;\n      this._hoveredTargets.forEach(function(_target){\n        _this.fire('mouse:out', { target: target, e: e });\n        _target && target.fire('mouseout', { e: e });\n      });\n      this._hoveredTargets = [];\n\n      if (this._iTextInstances) {\n        this._iTextInstances.forEach(function(obj) {\n          if (obj.isEditing) {\n            obj.hiddenTextarea.focus();\n          }\n        });\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseenter\n     */\n    _onMouseEnter: function(e) {\n      // This find target and consequent 'mouse:over' is used to\n      // clear old instances on hovered target.\n      // calling findTarget has the side effect of killing target.__corner.\n      // as a short term fix we are not firing this if we are currently transforming.\n      // as a long term fix we need to separate the action of finding a target with the\n      // side effects we added to it.\n      if (!this._currentTransform && !this.findTarget(e)) {\n        this.fire('mouse:over', { target: null, e: e });\n        this._hoveredTarget = null;\n        this._hoveredTargets = [];\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js orientation change\n     * @param {Event} [self] Inner Event object\n     */\n    _onOrientationChange: function(e, self) {\n      this.__onOrientationChange && this.__onOrientationChange(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onShake: function(e, self) {\n      this.__onShake && this.__onShake(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onLongPress: function(e, self) {\n      this.__onLongPress && this.__onLongPress(e, self);\n    },\n\n    /**\n     * prevent default to allow drop event to be fired\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     */\n    _onDragOver: function(e) {\n      e.preventDefault();\n      var target = this._simpleEventHandler('dragover', e);\n      this._fireEnterLeaveEvents(target, e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onContextMenu: function (e) {\n      if (this.stopContextMenu) {\n        e.stopPropagation();\n        e.preventDefault();\n      }\n      return false;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onDoubleClick: function (e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'dblclick');\n      this._resetTransformEventData(e);\n    },\n\n    /**\n     * Return a the id of an event.\n     * returns either the pointerId or the identifier or 0 for the mouse event\n     * @private\n     * @param {Event} evt Event object\n     */\n    getPointerId: function(evt) {\n      var changedTouches = evt.changedTouches;\n\n      if (changedTouches) {\n        return changedTouches[0] && changedTouches[0].identifier;\n      }\n\n      if (this.enablePointerEvents) {\n        return evt.pointerId;\n      }\n\n      return -1;\n    },\n\n    /**\n     * Determines if an event has the id of the event that is considered main\n     * @private\n     * @param {evt} event Event object\n     */\n    _isMainEvent: function(evt) {\n      if (evt.isPrimary === true) {\n        return true;\n      }\n      if (evt.isPrimary === false) {\n        return false;\n      }\n      if (evt.type === 'touchend' && evt.touches.length === 0) {\n        return true;\n      }\n      if (evt.changedTouches) {\n        return evt.changedTouches[0].identifier === this.mainTouchId;\n      }\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onTouchStart: function(e) {\n      e.preventDefault();\n      if (this.mainTouchId === null) {\n        this.mainTouchId = this.getPointerId(e);\n      }\n      this.__onMouseDown(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      addListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      addListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n      // Unbind mousedown to prevent double triggers from touch devices\n      removeListener(canvasElement, eventTypePrefix + 'down', this._onMouseDown);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDown: function (e) {\n      this.__onMouseDown(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      removeListener(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      addListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n      addListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onTouchEnd: function(e) {\n      if (e.touches.length > 0) {\n        // if there are still touches stop here\n        return;\n      }\n      this.__onMouseUp(e);\n      this._resetTransformEventData();\n      this.mainTouchId = null;\n      var eventTypePrefix = this._getEventPrefix();\n      removeListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n      var _this = this;\n      if (this._willAddMouseDown) {\n        clearTimeout(this._willAddMouseDown);\n      }\n      this._willAddMouseDown = setTimeout(function() {\n        // Wait 400ms before rebinding mousedown to prevent double triggers\n        // from touch devices\n        addListener(_this.upperCanvasEl, eventTypePrefix + 'down', _this._onMouseDown);\n        _this._willAddMouseDown = 0;\n      }, 400);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUp: function (e) {\n      this.__onMouseUp(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      if (this._isMainEvent(e)) {\n        removeListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n        removeListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n        addListener(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMove: function (e) {\n      !this.allowTouchScrolling && e.preventDefault && e.preventDefault();\n      this.__onMouseMove(e);\n    },\n\n    /**\n     * @private\n     */\n    _onResize: function () {\n      this.calcOffset();\n    },\n\n    /**\n     * Decides whether the canvas should be redrawn in mouseup and mousedown events.\n     * @private\n     * @param {Object} target\n     */\n    _shouldRender: function(target) {\n      var activeObject = this._activeObject;\n\n      if (\n        !!activeObject !== !!target ||\n        (activeObject && target && (activeObject !== target))\n      ) {\n        // this covers: switch of target, from target to no target, selection of target\n        // multiSelection with key and mouse\n        return true;\n      }\n      else if (activeObject && activeObject.isEditing) {\n        // if we mouse up/down over a editing textbox a cursor change,\n        // there is no need to re render\n        return false;\n      }\n      return false;\n    },\n\n    /**\n     * Method that defines the actions when mouse is released on canvas.\n     * The method resets the currentTransform parameters, store the image corner\n     * position in the image object and render the canvas on top.\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseUp: function (e) {\n      var target, transform = this._currentTransform,\n          groupSelector = this._groupSelector, shouldRender = false,\n          isClick = (!groupSelector || (groupSelector.left === 0 && groupSelector.top === 0));\n      this._cacheTransformEventData(e);\n      target = this._target;\n      this._handleEvent(e, 'up:before');\n      // if right/middle click just fire events and return\n      // target undefined will make the _handleEvent search the target\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'up', RIGHT_CLICK, isClick);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'up', MIDDLE_CLICK, isClick);\n        }\n        this._resetTransformEventData();\n        return;\n      }\n\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this._onMouseUpInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n      if (transform) {\n        this._finalizeCurrentTransform(e);\n        shouldRender = transform.actionPerformed;\n      }\n      if (!isClick) {\n        var targetWasActive = target === this._activeObject;\n        this._maybeGroupObjects(e);\n        if (!shouldRender) {\n          shouldRender = (\n            this._shouldRender(target) ||\n            (!targetWasActive && target === this._activeObject)\n          );\n        }\n      }\n      if (target) {\n        if (target.selectable && target !== this._activeObject && target.activeOn === 'up') {\n          this.setActiveObject(target, e);\n          shouldRender = true;\n        }\n        else {\n          var corner = target._findTargetCorner(\n            this.getPointer(e, true),\n            fabric.util.isTouchEvent(e)\n          );\n          var control = target.controls[corner],\n              mouseUpHandler = control && control.getMouseUpHandler(e, target, control);\n          if (mouseUpHandler) {\n            var pointer = this.getPointer(e);\n            mouseUpHandler(e, transform, pointer.x, pointer.y);\n          }\n        }\n        target.isMoving = false;\n      }\n      this._setCursorFromEvent(e, target);\n      this._handleEvent(e, 'up', LEFT_CLICK, isClick);\n      this._groupSelector = null;\n      this._currentTransform = null;\n      // reset the target information about which corner is selected\n      target && (target.__corner = 0);\n      if (shouldRender) {\n        this.requestRenderAll();\n      }\n      else if (!isClick) {\n        this.renderTop();\n      }\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @return {Fabric.Object} target return the the target found, for internal reasons.\n     */\n    _simpleEventHandler: function(eventType, e) {\n      var target = this.findTarget(e),\n          targets = this.targets,\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n          };\n      this.fire(eventType, options);\n      target && target.fire(eventType, options);\n      if (!targets) {\n        return target;\n      }\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire(eventType, options);\n      }\n      return target;\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @param {fabric.Object} targetObj receiving event\n     * @param {Number} [button] button used in the event 1 = left, 2 = middle, 3 = right\n     * @param {Boolean} isClick for left button only, indicates that the mouse up happened without move.\n     */\n    _handleEvent: function(e, eventType, button, isClick) {\n      var target = this._target,\n          targets = this.targets || [],\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n            button: button || LEFT_CLICK,\n            isClick: isClick || false,\n            pointer: this._pointer,\n            absolutePointer: this._absolutePointer,\n            transform: this._currentTransform\n          };\n      if (eventType === 'up') {\n        options.currentTarget = this.findTarget(e);\n        options.currentSubTargets = this.targets;\n      }\n      this.fire('mouse:' + eventType, options);\n      target && target.fire('mouse' + eventType, options);\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire('mouse' + eventType, options);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e send the mouse event that generate the finalize down, so it can be used in the event\n     */\n    _finalizeCurrentTransform: function(e) {\n\n      var transform = this._currentTransform,\n          target = transform.target,\n          eventName,\n          options = {\n            e: e,\n            target: target,\n            transform: transform,\n            action: transform.action,\n          };\n\n      if (target._scaling) {\n        target._scaling = false;\n      }\n\n      target.setCoords();\n\n      if (transform.actionPerformed || (this.stateful && target.hasStateChanged())) {\n        if (transform.actionPerformed) {\n          // this is not friendly to the new control api.\n          // is deprecated.\n          eventName = this._addEventOptions(options, transform);\n          this._fire(eventName, options);\n        }\n        this._fire('modified', options);\n      }\n    },\n\n    /**\n     * Mutate option object in order to add by property and give back the event name.\n     * @private\n     * @deprecated since 4.2.0\n     * @param {Object} options to mutate\n     * @param {Object} transform to inspect action from\n     */\n    _addEventOptions: function(options, transform) {\n      // we can probably add more details at low cost\n      // scale change, rotation changes, translation changes\n      var eventName, by;\n      switch (transform.action) {\n        case 'scaleX':\n          eventName = 'scaled';\n          by = 'x';\n          break;\n        case 'scaleY':\n          eventName = 'scaled';\n          by = 'y';\n          break;\n        case 'skewX':\n          eventName = 'skewed';\n          by = 'x';\n          break;\n        case 'skewY':\n          eventName = 'skewed';\n          by = 'y';\n          break;\n        case 'scale':\n          eventName = 'scaled';\n          by = 'equally';\n          break;\n        case 'rotate':\n          eventName = 'rotated';\n          break;\n        case 'drag':\n          eventName = 'moved';\n          break;\n      }\n      options.by = by;\n      return eventName;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDownInDrawingMode: function(e) {\n      this._isCurrentlyDrawing = true;\n      if (this.getActiveObject()) {\n        this.discardActiveObject(e).requestRenderAll();\n      }\n      var pointer = this.getPointer(e);\n      this.freeDrawingBrush.onMouseDown(pointer, { e: e, pointer: pointer });\n      this._handleEvent(e, 'down');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMoveInDrawingMode: function(e) {\n      if (this._isCurrentlyDrawing) {\n        var pointer = this.getPointer(e);\n        this.freeDrawingBrush.onMouseMove(pointer, { e: e, pointer: pointer });\n      }\n      this.setCursor(this.freeDrawingCursor);\n      this._handleEvent(e, 'move');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUpInDrawingMode: function(e) {\n      var pointer = this.getPointer(e);\n      this._isCurrentlyDrawing = this.freeDrawingBrush.onMouseUp({ e: e, pointer: pointer });\n      this._handleEvent(e, 'up');\n    },\n\n    /**\n     * Method that defines the actions when mouse is clicked on canvas.\n     * The method inits the currentTransform parameters and renders all the\n     * canvas so the current image can be placed on the top canvas and the rest\n     * in on the container one.\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    __onMouseDown: function (e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'down:before');\n      var target = this._target;\n      // if right click just fire events\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'down', RIGHT_CLICK);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'down', MIDDLE_CLICK);\n        }\n        return;\n      }\n\n      if (this.isDrawingMode) {\n        this._onMouseDownInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n\n      // ignore if some object is being transformed at this moment\n      if (this._currentTransform) {\n        return;\n      }\n\n      var pointer = this._pointer;\n      // save pointer for check in __onMouseUp event\n      this._previousPointer = pointer;\n      var shouldRender = this._shouldRender(target),\n          shouldGroup = this._shouldGroup(e, target);\n      if (this._shouldClearSelection(e, target)) {\n        this.discardActiveObject(e);\n      }\n      else if (shouldGroup) {\n        this._handleGrouping(e, target);\n        target = this._activeObject;\n      }\n\n      if (this.selection && (!target ||\n        (!target.selectable && !target.isEditing && target !== this._activeObject))) {\n        this._groupSelector = {\n          ex: pointer.x,\n          ey: pointer.y,\n          top: 0,\n          left: 0\n        };\n      }\n\n      if (target) {\n        var alreadySelected = target === this._activeObject;\n        if (target.selectable && target.activeOn === 'down') {\n          this.setActiveObject(target, e);\n        }\n        var corner = target._findTargetCorner(\n          this.getPointer(e, true),\n          fabric.util.isTouchEvent(e)\n        );\n        target.__corner = corner;\n        if (target === this._activeObject && (corner || !shouldGroup)) {\n          this._setupCurrentTransform(e, target, alreadySelected);\n          var control = target.controls[corner],\n              pointer = this.getPointer(e),\n              mouseDownHandler = control && control.getMouseDownHandler(e, target, control);\n          if (mouseDownHandler) {\n            mouseDownHandler(e, this._currentTransform, pointer.x, pointer.y);\n          }\n        }\n      }\n      this._handleEvent(e, 'down');\n      // we must renderAll so that we update the visuals\n      (shouldRender || shouldGroup) && this.requestRenderAll();\n    },\n\n    /**\n     * reset cache form common information needed during event processing\n     * @private\n     */\n    _resetTransformEventData: function() {\n      this._target = null;\n      this._pointer = null;\n      this._absolutePointer = null;\n    },\n\n    /**\n     * Cache common information needed during event processing\n     * @private\n     * @param {Event} e Event object fired on event\n     */\n    _cacheTransformEventData: function(e) {\n      // reset in order to avoid stale caching\n      this._resetTransformEventData();\n      this._pointer = this.getPointer(e, true);\n      this._absolutePointer = this.restorePointerVpt(this._pointer);\n      this._target = this._currentTransform ? this._currentTransform.target : this.findTarget(e) || null;\n    },\n\n    /**\n     * @private\n     */\n    _beforeTransform: function(e) {\n      var t = this._currentTransform;\n      this.stateful && t.target.saveState();\n      this.fire('before:transform', {\n        e: e,\n        transform: t,\n      });\n    },\n\n    /**\n     * Method that defines the actions when mouse is hovering the canvas.\n     * The currentTransform parameter will define whether the user is rotating/scaling/translating\n     * an image or neither of them (only hovering). A group selection is also possible and would cancel\n     * all any other type of action.\n     * In case of an image transformation only the top canvas will be rendered.\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    __onMouseMove: function (e) {\n      this._handleEvent(e, 'move:before');\n      this._cacheTransformEventData(e);\n      var target, pointer;\n\n      if (this.isDrawingMode) {\n        this._onMouseMoveInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n\n      var groupSelector = this._groupSelector;\n\n      // We initially clicked in an empty area, so we draw a box for multiple selection\n      if (groupSelector) {\n        pointer = this._pointer;\n\n        groupSelector.left = pointer.x - groupSelector.ex;\n        groupSelector.top = pointer.y - groupSelector.ey;\n\n        this.renderTop();\n      }\n      else if (!this._currentTransform) {\n        target = this.findTarget(e) || null;\n        this._setCursorFromEvent(e, target);\n        this._fireOverOutEvents(target, e);\n      }\n      else {\n        this._transformObject(e);\n      }\n      this._handleEvent(e, 'move');\n      this._resetTransformEventData();\n    },\n\n    /**\n     * Manage the mouseout, mouseover events for the fabric object on the canvas\n     * @param {Fabric.Object} target the target where the target from the mousemove event\n     * @param {Event} e Event object fired on mousemove\n     * @private\n     */\n    _fireOverOutEvents: function(target, e) {\n      var _hoveredTarget = this._hoveredTarget,\n          _hoveredTargets = this._hoveredTargets, targets = this.targets,\n          length = Math.max(_hoveredTargets.length, targets.length);\n\n      this.fireSyntheticInOutEvents(target, e, {\n        oldTarget: _hoveredTarget,\n        evtOut: 'mouseout',\n        canvasEvtOut: 'mouse:out',\n        evtIn: 'mouseover',\n        canvasEvtIn: 'mouse:over',\n      });\n      for (var i = 0; i < length; i++){\n        this.fireSyntheticInOutEvents(targets[i], e, {\n          oldTarget: _hoveredTargets[i],\n          evtOut: 'mouseout',\n          evtIn: 'mouseover',\n        });\n      }\n      this._hoveredTarget = target;\n      this._hoveredTargets = this.targets.concat();\n    },\n\n    /**\n     * Manage the dragEnter, dragLeave events for the fabric objects on the canvas\n     * @param {Fabric.Object} target the target where the target from the onDrag event\n     * @param {Event} e Event object fired on ondrag\n     * @private\n     */\n    _fireEnterLeaveEvents: function(target, e) {\n      var _draggedoverTarget = this._draggedoverTarget,\n          _hoveredTargets = this._hoveredTargets, targets = this.targets,\n          length = Math.max(_hoveredTargets.length, targets.length);\n\n      this.fireSyntheticInOutEvents(target, e, {\n        oldTarget: _draggedoverTarget,\n        evtOut: 'dragleave',\n        evtIn: 'dragenter',\n      });\n      for (var i = 0; i < length; i++) {\n        this.fireSyntheticInOutEvents(targets[i], e, {\n          oldTarget: _hoveredTargets[i],\n          evtOut: 'dragleave',\n          evtIn: 'dragenter',\n        });\n      }\n      this._draggedoverTarget = target;\n    },\n\n    /**\n     * Manage the synthetic in/out events for the fabric objects on the canvas\n     * @param {Fabric.Object} target the target where the target from the supported events\n     * @param {Event} e Event object fired\n     * @param {Object} config configuration for the function to work\n     * @param {String} config.targetName property on the canvas where the old target is stored\n     * @param {String} [config.canvasEvtOut] name of the event to fire at canvas level for out\n     * @param {String} config.evtOut name of the event to fire for out\n     * @param {String} [config.canvasEvtIn] name of the event to fire at canvas level for in\n     * @param {String} config.evtIn name of the event to fire for in\n     * @private\n     */\n    fireSyntheticInOutEvents: function(target, e, config) {\n      var inOpt, outOpt, oldTarget = config.oldTarget, outFires, inFires,\n          targetChanged = oldTarget !== target, canvasEvtIn = config.canvasEvtIn, canvasEvtOut = config.canvasEvtOut;\n      if (targetChanged) {\n        inOpt = { e: e, target: target, previousTarget: oldTarget };\n        outOpt = { e: e, target: oldTarget, nextTarget: target };\n      }\n      inFires = target && targetChanged;\n      outFires = oldTarget && targetChanged;\n      if (outFires) {\n        canvasEvtOut && this.fire(canvasEvtOut, outOpt);\n        oldTarget.fire(config.evtOut, outOpt);\n      }\n      if (inFires) {\n        canvasEvtIn && this.fire(canvasEvtIn, inOpt);\n        target.fire(config.evtIn, inOpt);\n      }\n    },\n\n    /**\n     * Method that defines actions when an Event Mouse Wheel\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseWheel: function(e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'wheel');\n      this._resetTransformEventData();\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event fired on mousemove\n     */\n    _transformObject: function(e) {\n      var pointer = this.getPointer(e),\n          transform = this._currentTransform;\n\n      transform.reset = false;\n      transform.shiftKey = e.shiftKey;\n      transform.altKey = e[this.centeredKey];\n\n      this._performTransformAction(e, transform, pointer);\n      transform.actionPerformed && this.requestRenderAll();\n    },\n\n    /**\n     * @private\n     */\n    _performTransformAction: function(e, transform, pointer) {\n      var x = pointer.x,\n          y = pointer.y,\n          action = transform.action,\n          actionPerformed = false,\n          actionHandler = transform.actionHandler;\n          // this object could be created from the function in the control handlers\n\n\n      if (actionHandler) {\n        actionPerformed = actionHandler(e, transform, x, y);\n      }\n      if (action === 'drag' && actionPerformed) {\n        transform.target.isMoving = true;\n        this.setCursor(transform.target.moveCursor || this.moveCursor);\n      }\n      transform.actionPerformed = transform.actionPerformed || actionPerformed;\n    },\n\n    /**\n     * @private\n     */\n    _fire: fabric.controlsUtils.fireEvent,\n\n    /**\n     * Sets the cursor depending on where the canvas is being hovered.\n     * Note: very buggy in Opera\n     * @param {Event} e Event object\n     * @param {Object} target Object that the mouse is hovering, if so.\n     */\n    _setCursorFromEvent: function (e, target) {\n      if (!target) {\n        this.setCursor(this.defaultCursor);\n        return false;\n      }\n      var hoverCursor = target.hoverCursor || this.hoverCursor,\n          activeSelection = this._activeObject && this._activeObject.type === 'activeSelection' ?\n            this._activeObject : null,\n          // only show proper corner when group selection is not active\n          corner = (!activeSelection || !activeSelection.contains(target))\n          // here we call findTargetCorner always with undefined for the touch parameter.\n          // we assume that if you are using a cursor you do not need to interact with\n          // the bigger touch area.\n                    && target._findTargetCorner(this.getPointer(e, true));\n\n      if (!corner) {\n        if (target.subTargetCheck){\n          // hoverCursor should come from top-most subTarget,\n          // so we walk the array backwards\n          this.targets.concat().reverse().map(function(_target){\n            hoverCursor = _target.hoverCursor || hoverCursor;\n          });\n        }\n        this.setCursor(hoverCursor);\n      }\n      else {\n        this.setCursor(this.getCornerCursor(corner, target, e));\n      }\n    },\n\n    /**\n     * @private\n     */\n    getCornerCursor: function(corner, target, e) {\n      var control = target.controls[corner];\n      return control.cursorStyleHandler(e, control, target);\n    }\n  });\n})();\n\n\n(function() {\n\n  var min = Math.min,\n      max = Math.max;\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     * @return {Boolean}\n     */\n    _shouldGroup: function(e, target) {\n      var activeObject = this._activeObject;\n      return activeObject && this._isSelectionKeyPressed(e) && target && target.selectable && this.selection &&\n            (activeObject !== target || activeObject.type === 'activeSelection') && !target.onSelect({ e: e });\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _handleGrouping: function (e, target) {\n      var activeObject = this._activeObject;\n      // avoid multi select when shift click on a corner\n      if (activeObject.__corner) {\n        return;\n      }\n      if (target === activeObject) {\n        // if it's a group, find target again, using activeGroup objects\n        target = this.findTarget(e, true);\n        // if even object is not found or we are on activeObjectCorner, bail out\n        if (!target || !target.selectable) {\n          return;\n        }\n      }\n      if (activeObject && activeObject.type === 'activeSelection') {\n        this._updateActiveSelection(target, e);\n      }\n      else {\n        this._createActiveSelection(target, e);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _updateActiveSelection: function(target, e) {\n      var activeSelection = this._activeObject,\n          currentActiveObjects = activeSelection._objects.slice(0);\n      if (activeSelection.contains(target)) {\n        activeSelection.removeWithUpdate(target);\n        this._hoveredTarget = target;\n        this._hoveredTargets = this.targets.concat();\n        if (activeSelection.size() === 1) {\n          // activate last remaining object\n          this._setActiveObject(activeSelection.item(0), e);\n        }\n      }\n      else {\n        activeSelection.addWithUpdate(target);\n        this._hoveredTarget = activeSelection;\n        this._hoveredTargets = this.targets.concat();\n      }\n      this._fireSelectionEvents(currentActiveObjects, e);\n    },\n\n    /**\n     * @private\n     */\n    _createActiveSelection: function(target, e) {\n      var currentActives = this.getActiveObjects(), group = this._createGroup(target);\n      this._hoveredTarget = group;\n      // ISSUE 4115: should we consider subTargets here?\n      // this._hoveredTargets = [];\n      // this._hoveredTargets = this.targets.concat();\n      this._setActiveObject(group, e);\n      this._fireSelectionEvents(currentActives, e);\n    },\n\n    /**\n     * @private\n     * @param {Object} target\n     */\n    _createGroup: function(target) {\n      var objects = this._objects,\n          isActiveLower = objects.indexOf(this._activeObject) < objects.indexOf(target),\n          groupObjects = isActiveLower\n            ? [this._activeObject, target]\n            : [target, this._activeObject];\n      this._activeObject.isEditing && this._activeObject.exitEditing();\n      return new fabric.ActiveSelection(groupObjects, {\n        canvas: this\n      });\n    },\n\n    /**\n     * @private\n     * @param {Event} e mouse event\n     */\n    _groupSelectedObjects: function (e) {\n\n      var group = this._collectObjects(e),\n          aGroup;\n\n      // do not create group for 1 element only\n      if (group.length === 1) {\n        this.setActiveObject(group[0], e);\n      }\n      else if (group.length > 1) {\n        aGroup = new fabric.ActiveSelection(group.reverse(), {\n          canvas: this\n        });\n        this.setActiveObject(aGroup, e);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _collectObjects: function(e) {\n      var group = [],\n          currentObject,\n          x1 = this._groupSelector.ex,\n          y1 = this._groupSelector.ey,\n          x2 = x1 + this._groupSelector.left,\n          y2 = y1 + this._groupSelector.top,\n          selectionX1Y1 = new fabric.Point(min(x1, x2), min(y1, y2)),\n          selectionX2Y2 = new fabric.Point(max(x1, x2), max(y1, y2)),\n          allowIntersect = !this.selectionFullyContained,\n          isClick = x1 === x2 && y1 === y2;\n      // we iterate reverse order to collect top first in case of click.\n      for (var i = this._objects.length; i--; ) {\n        currentObject = this._objects[i];\n\n        if (!currentObject || !currentObject.selectable || !currentObject.visible) {\n          continue;\n        }\n\n        if ((allowIntersect && currentObject.intersectsWithRect(selectionX1Y1, selectionX2Y2)) ||\n            currentObject.isContainedWithinRect(selectionX1Y1, selectionX2Y2) ||\n            (allowIntersect && currentObject.containsPoint(selectionX1Y1)) ||\n            (allowIntersect && currentObject.containsPoint(selectionX2Y2))\n        ) {\n          group.push(currentObject);\n          // only add one object if it's a click\n          if (isClick) {\n            break;\n          }\n        }\n      }\n\n      if (group.length > 1) {\n        group = group.filter(function(object) {\n          return !object.onSelect({ e: e });\n        });\n      }\n\n      return group;\n    },\n\n    /**\n     * @private\n     */\n    _maybeGroupObjects: function(e) {\n      if (this.selection && this._groupSelector) {\n        this._groupSelectedObjects(e);\n      }\n      this.setCursor(this.defaultCursor);\n      // clear selection and current transformation\n      this._groupSelector = null;\n    }\n  });\n\n})();\n\n\n(function () {\n  fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Exports canvas element to a dataurl image. Note that when multiplier is used, cropping is scaled appropriately\n     * @param {Object} [options] Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by, to have consistent\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 2.0.0\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     * @see {@link http://jsfiddle.net/fabricjs/NfZVb/|jsFiddle demo}\n     * @example <caption>Generate jpeg dataURL with lower quality</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'jpeg',\n     *   quality: 0.8\n     * });\n     * @example <caption>Generate cropped png dataURL (clipping of canvas)</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   left: 100,\n     *   top: 100,\n     *   width: 200,\n     *   height: 200\n     * });\n     * @example <caption>Generate double scaled png dataURL</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   multiplier: 2\n     * });\n     */\n    toDataURL: function (options) {\n      options || (options = { });\n\n      var format = options.format || 'png',\n          quality = options.quality || 1,\n          multiplier = (options.multiplier || 1) * (options.enableRetinaScaling ? this.getRetinaScaling() : 1),\n          canvasEl = this.toCanvasElement(multiplier, options);\n      return fabric.util.toDataURL(canvasEl, format, quality);\n    },\n\n    /**\n     * Create a new HTMLCanvas element painted with the current canvas content.\n     * No need to resize the actual one or repaint it.\n     * Will transfer object ownership to a new canvas, paint it, and set everything back.\n     * This is an intermediary step used to get to a dataUrl but also it is useful to\n     * create quick image copies of a canvas without passing for the dataUrl string\n     * @param {Number} [multiplier] a zoom factor.\n     * @param {Object} [cropping] Cropping informations\n     * @param {Number} [cropping.left] Cropping left offset.\n     * @param {Number} [cropping.top] Cropping top offset.\n     * @param {Number} [cropping.width] Cropping width.\n     * @param {Number} [cropping.height] Cropping height.\n     */\n    toCanvasElement: function(multiplier, cropping) {\n      multiplier = multiplier || 1;\n      cropping = cropping || { };\n      var scaledWidth = (cropping.width || this.width) * multiplier,\n          scaledHeight = (cropping.height || this.height) * multiplier,\n          zoom = this.getZoom(),\n          originalWidth = this.width,\n          originalHeight = this.height,\n          newZoom = zoom * multiplier,\n          vp = this.viewportTransform,\n          translateX = (vp[4] - (cropping.left || 0)) * multiplier,\n          translateY = (vp[5] - (cropping.top || 0)) * multiplier,\n          originalInteractive = this.interactive,\n          newVp = [newZoom, 0, 0, newZoom, translateX, translateY],\n          originalRetina = this.enableRetinaScaling,\n          canvasEl = fabric.util.createCanvasElement(),\n          originalContextTop = this.contextTop;\n      canvasEl.width = scaledWidth;\n      canvasEl.height = scaledHeight;\n      this.contextTop = null;\n      this.enableRetinaScaling = false;\n      this.interactive = false;\n      this.viewportTransform = newVp;\n      this.width = scaledWidth;\n      this.height = scaledHeight;\n      this.calcViewportBoundaries();\n      this.renderCanvas(canvasEl.getContext('2d'), this._objects);\n      this.viewportTransform = vp;\n      this.width = originalWidth;\n      this.height = originalHeight;\n      this.calcViewportBoundaries();\n      this.interactive = originalInteractive;\n      this.enableRetinaScaling = originalRetina;\n      this.contextTop = originalContextTop;\n      return canvasEl;\n    },\n  });\n\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n  /**\n   * Populates canvas with data from the specified JSON.\n   * JSON format must conform to the one of {@link fabric.Canvas#toJSON}\n   * @param {String|Object} json JSON string or object\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: {@link fabric.Image})\n   *                            are initialized\n   * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n   * @return {fabric.Canvas} instance\n   * @chainable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n   * @see {@link http://jsfiddle.net/fabricjs/fmgXt/|jsFiddle demo}\n   * @example <caption>loadFromJSON</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));\n   * @example <caption>loadFromJSON with reviver</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas), function(o, object) {\n   *   // `o` = json object\n   *   // `object` = fabric.Object instance\n   *   // ... do some stuff ...\n   * });\n   */\n  loadFromJSON: function (json, callback, reviver) {\n    if (!json) {\n      return;\n    }\n\n    // serialize if it wasn't already\n    var serialized = (typeof json === 'string')\n      ? JSON.parse(json)\n      : fabric.util.object.clone(json);\n\n    var _this = this,\n        clipPath = serialized.clipPath,\n        renderOnAddRemove = this.renderOnAddRemove;\n\n    this.renderOnAddRemove = false;\n\n    delete serialized.clipPath;\n\n    this._enlivenObjects(serialized.objects, function (enlivenedObjects) {\n      _this.clear();\n      _this._setBgOverlay(serialized, function () {\n        if (clipPath) {\n          _this._enlivenObjects([clipPath], function (enlivenedCanvasClip) {\n            _this.clipPath = enlivenedCanvasClip[0];\n            _this.__setupCanvas.call(_this, serialized, enlivenedObjects, renderOnAddRemove, callback);\n          });\n        }\n        else {\n          _this.__setupCanvas.call(_this, serialized, enlivenedObjects, renderOnAddRemove, callback);\n        }\n      });\n    }, reviver);\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {Object} serialized Object with background and overlay information\n   * @param {Array} restored canvas objects\n   * @param {Function} cached renderOnAddRemove callback\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n   */\n  __setupCanvas: function(serialized, enlivenedObjects, renderOnAddRemove, callback) {\n    var _this = this;\n    enlivenedObjects.forEach(function(obj, index) {\n      // we splice the array just in case some custom classes restored from JSON\n      // will add more object to canvas at canvas init.\n      _this.insertAt(obj, index);\n    });\n    this.renderOnAddRemove = renderOnAddRemove;\n    // remove parts i cannot set as options\n    delete serialized.objects;\n    delete serialized.backgroundImage;\n    delete serialized.overlayImage;\n    delete serialized.background;\n    delete serialized.overlay;\n    // this._initOptions does too many things to just\n    // call it. Normally loading an Object from JSON\n    // create the Object instance. Here the Canvas is\n    // already an instance and we are just loading things over it\n    this._setOptions(serialized);\n    this.renderAll();\n    callback && callback();\n  },\n\n  /**\n   * @private\n   * @param {Object} serialized Object with background and overlay information\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n   */\n  _setBgOverlay: function(serialized, callback) {\n    var loaded = {\n      backgroundColor: false,\n      overlayColor: false,\n      backgroundImage: false,\n      overlayImage: false\n    };\n\n    if (!serialized.backgroundImage && !serialized.overlayImage && !serialized.background && !serialized.overlay) {\n      callback && callback();\n      return;\n    }\n\n    var cbIfLoaded = function () {\n      if (loaded.backgroundImage && loaded.overlayImage && loaded.backgroundColor && loaded.overlayColor) {\n        callback && callback();\n      }\n    };\n\n    this.__setBgOverlay('backgroundImage', serialized.backgroundImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayImage', serialized.overlayImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('backgroundColor', serialized.background, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayColor', serialized.overlay, loaded, cbIfLoaded);\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to set (backgroundImage, overlayImage, backgroundColor, overlayColor)\n   * @param {(Object|String)} value Value to set\n   * @param {Object} loaded Set loaded property to true if property is set\n   * @param {Object} callback Callback function to invoke after property is set\n   */\n  __setBgOverlay: function(property, value, loaded, callback) {\n    var _this = this;\n\n    if (!value) {\n      loaded[property] = true;\n      callback && callback();\n      return;\n    }\n\n    if (property === 'backgroundImage' || property === 'overlayImage') {\n      fabric.util.enlivenObjects([value], function(enlivedObject){\n        _this[property] = enlivedObject[0];\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n    else {\n      this['set' + fabric.util.string.capitalize(property, true)](value, function() {\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n  },\n\n  /**\n   * @private\n   * @param {Array} objects\n   * @param {Function} callback\n   * @param {Function} [reviver]\n   */\n  _enlivenObjects: function (objects, callback, reviver) {\n    if (!objects || objects.length === 0) {\n      callback && callback([]);\n      return;\n    }\n\n    fabric.util.enlivenObjects(objects, function(enlivenedObjects) {\n      callback && callback(enlivenedObjects);\n    }, null, reviver);\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Function} callback\n   */\n  _toDataURL: function (format, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURL(format));\n    });\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Number} multiplier\n   * @param {Function} callback\n   */\n  _toDataURLWithMultiplier: function (format, multiplier, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURLWithMultiplier(format, multiplier));\n    });\n  },\n\n  /**\n   * Clones canvas instance\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   * @param {Array} [properties] Array of properties to include in the cloned canvas and children\n   */\n  clone: function (callback, properties) {\n    var data = JSON.stringify(this.toJSON(properties));\n    this.cloneWithoutData(function(clone) {\n      clone.loadFromJSON(data, function() {\n        callback && callback(clone);\n      });\n    });\n  },\n\n  /**\n   * Clones canvas instance without cloning existing data.\n   * This essentially copies canvas dimensions, clipping properties, etc.\n   * but leaves data empty (so that you can populate it with your own)\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   */\n  cloneWithoutData: function(callback) {\n    var el = fabric.util.createCanvasElement();\n\n    el.width = this.width;\n    el.height = this.height;\n\n    var clone = new fabric.Canvas(el);\n    if (this.backgroundImage) {\n      clone.setBackgroundImage(this.backgroundImage.src, function() {\n        clone.renderAll();\n        callback && callback(clone);\n      });\n      clone.backgroundImageOpacity = this.backgroundImageOpacity;\n      clone.backgroundImageStretch = this.backgroundImageStretch;\n    }\n    else {\n      callback && callback(clone);\n    }\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      capitalize = fabric.util.string.capitalize,\n      degreesToRadians = fabric.util.degreesToRadians,\n      supportsLineDash = fabric.StaticCanvas.supports('setLineDash'),\n      objectCaching = !fabric.isLikelyNode,\n      ALIASING_LIMIT = 2;\n\n  if (fabric.Object) {\n    return;\n  }\n\n  /**\n   * Root object class from which all 2d shape classes inherit from\n   * @class fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#objects}\n   * @see {@link fabric.Object#initialize} for constructor definition\n   *\n   * @fires added\n   * @fires removed\n   *\n   * @fires selected\n   * @fires deselected\n   * @fires modified\n   * @fires modified\n   * @fires moved\n   * @fires scaled\n   * @fires rotated\n   * @fires skewed\n   *\n   * @fires rotating\n   * @fires scaling\n   * @fires moving\n   * @fires skewing\n   *\n   * @fires mousedown\n   * @fires mouseup\n   * @fires mouseover\n   * @fires mouseout\n   * @fires mousewheel\n   * @fires mousedblclick\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   */\n  fabric.Object = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Type of an object (rect, circle, path, etc.).\n     * Note that this property is meant to be read-only and not meant to be modified.\n     * If you modify, certain parts of Fabric (such as JSON loading) won't work correctly.\n     * @type String\n     * @default\n     */\n    type:                     'object',\n\n    /**\n     * Horizontal origin of transformation of an object (one of \"left\", \"right\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originX:                  'left',\n\n    /**\n     * Vertical origin of transformation of an object (one of \"top\", \"bottom\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originY:                  'top',\n\n    /**\n     * Top position of an object. Note that by default it's relative to object top. You can change this by setting originY={top/center/bottom}\n     * @type Number\n     * @default\n     */\n    top:                      0,\n\n    /**\n     * Left position of an object. Note that by default it's relative to object left. You can change this by setting originX={left/center/right}\n     * @type Number\n     * @default\n     */\n    left:                     0,\n\n    /**\n     * Object width\n     * @type Number\n     * @default\n     */\n    width:                    0,\n\n    /**\n     * Object height\n     * @type Number\n     * @default\n     */\n    height:                   0,\n\n    /**\n     * Object scale factor (horizontal)\n     * @type Number\n     * @default\n     */\n    scaleX:                   1,\n\n    /**\n     * Object scale factor (vertical)\n     * @type Number\n     * @default\n     */\n    scaleY:                   1,\n\n    /**\n     * When true, an object is rendered as flipped horizontally\n     * @type Boolean\n     * @default\n     */\n    flipX:                    false,\n\n    /**\n     * When true, an object is rendered as flipped vertically\n     * @type Boolean\n     * @default\n     */\n    flipY:                    false,\n\n    /**\n     * Opacity of an object\n     * @type Number\n     * @default\n     */\n    opacity:                  1,\n\n    /**\n     * Angle of rotation of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    angle:                    0,\n\n    /**\n     * Angle of skew on x axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewX:                    0,\n\n    /**\n     * Angle of skew on y axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewY:                    0,\n\n    /**\n     * Size of object's controlling corners (in pixels)\n     * @type Number\n     * @default\n     */\n    cornerSize:               13,\n\n    /**\n     * Size of object's controlling corners when touch interaction is detected\n     * @type Number\n     * @default\n     */\n    touchCornerSize:               24,\n\n    /**\n     * When true, object's controlling corners are rendered as transparent inside (i.e. stroke instead of fill)\n     * @type Boolean\n     * @default\n     */\n    transparentCorners:       true,\n\n    /**\n     * Default cursor value used when hovering over this object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:              null,\n\n    /**\n     * Default cursor value used when moving this object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:               null,\n\n    /**\n     * Padding between object and its controlling borders (in pixels)\n     * @type Number\n     * @default\n     */\n    padding:                  0,\n\n    /**\n     * Color of controlling borders of an object (when it's active)\n     * @type String\n     * @default\n     */\n    borderColor:              'rgb(178,204,255)',\n\n    /**\n     * Array specifying dash pattern of an object's borders (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    borderDashArray:          null,\n\n    /**\n     * Color of controlling corners of an object (when it's active)\n     * @type String\n     * @default\n     */\n    cornerColor:              'rgb(178,204,255)',\n\n    /**\n     * Color of controlling corners of an object (when it's active and transparentCorners false)\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    cornerStrokeColor:        null,\n\n    /**\n     * Specify style of control, 'rect' or 'circle'\n     * @since 1.6.2\n     * @type String\n     */\n    cornerStyle:          'rect',\n\n    /**\n     * Array specifying dash pattern of an object's control (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    cornerDashArray:          null,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being scaled via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:          false,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being rotated via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:         true,\n\n    /**\n     * Color of object's fill\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    fill:                     'rgb(0,0,0)',\n\n    /**\n     * Fill rule used to fill an object\n     * accepted values are nonzero, evenodd\n     * <b>Backwards incompatibility note:</b> This property was used for setting globalCompositeOperation until v1.4.12 (use `fabric.Object#globalCompositeOperation` instead)\n     * @type String\n     * @default\n     */\n    fillRule:                 'nonzero',\n\n    /**\n     * Composite rule used for canvas globalCompositeOperation\n     * @type String\n     * @default\n     */\n    globalCompositeOperation: 'source-over',\n\n    /**\n     * Background color of an object.\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    backgroundColor:          '',\n\n    /**\n     * Selection Background color of an object. colored layer behind the object when it is active.\n     * does not mix good with globalCompositeOperation methods.\n     * @type String\n     * @default\n     */\n    selectionBackgroundColor:          '',\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    stroke:                   null,\n\n    /**\n     * Width of a stroke used to render this object\n     * @type Number\n     * @default\n     */\n    strokeWidth:              1,\n\n    /**\n     * Array specifying dash pattern of an object's stroke (stroke must be defined)\n     * @type Array\n     */\n    strokeDashArray:          null,\n\n    /**\n     * Line offset of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeDashOffset: 0,\n\n    /**\n     * Line endings style of an object's stroke (one of \"butt\", \"round\", \"square\")\n     * @type String\n     * @default\n     */\n    strokeLineCap:            'butt',\n\n    /**\n     * Corner style of an object's stroke (one of \"bevel\", \"round\", \"miter\")\n     * @type String\n     * @default\n     */\n    strokeLineJoin:           'miter',\n\n    /**\n     * Maximum miter length (used for strokeLineJoin = \"miter\") of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeMiterLimit:         4,\n\n    /**\n     * Shadow object representing shadow of this shape\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:                   null,\n\n    /**\n     * Opacity of object's controlling borders when object is active and moving\n     * @type Number\n     * @default\n     */\n    borderOpacityWhenMoving:  0.4,\n\n    /**\n     * Scale factor of object's controlling borders\n     * bigger number will make a thicker border\n     * border is 1, so this is basically a border thickness\n     * since there is no way to change the border itself.\n     * @type Number\n     * @default\n     */\n    borderScaleFactor:        1,\n\n    /**\n     * Minimum allowed scale value of an object\n     * @type Number\n     * @default\n     */\n    minScaleLimit:            0,\n\n    /**\n     * When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection).\n     * But events still fire on it.\n     * @type Boolean\n     * @default\n     */\n    selectable:               true,\n\n    /**\n     * When set to `false`, an object can not be a target of events. All events propagate through it. Introduced in v1.3.4\n     * @type Boolean\n     * @default\n     */\n    evented:                  true,\n\n    /**\n     * When set to `false`, an object is not rendered on canvas\n     * @type Boolean\n     * @default\n     */\n    visible:                  true,\n\n    /**\n     * When set to `false`, object's controls are not displayed and can not be used to manipulate object\n     * @type Boolean\n     * @default\n     */\n    hasControls:              true,\n\n    /**\n     * When set to `false`, object's controlling borders are not rendered\n     * @type Boolean\n     * @default\n     */\n    hasBorders:               true,\n\n    /**\n     * When set to `true`, objects are \"found\" on canvas on per-pixel basis rather than according to bounding box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:       false,\n\n    /**\n     * When `false`, default object's values are not included in its serialization\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues:     true,\n\n    /**\n     * When `true`, object horizontal movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementX:            false,\n\n    /**\n     * When `true`, object vertical movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementY:            false,\n\n    /**\n     * When `true`, object rotation is locked\n     * @type Boolean\n     * @default\n     */\n    lockRotation:             false,\n\n    /**\n     * When `true`, object horizontal scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingX:             false,\n\n    /**\n     * When `true`, object vertical scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingY:             false,\n\n    /**\n     * When `true`, object horizontal skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingX:             false,\n\n    /**\n     * When `true`, object vertical skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingY:             false,\n\n    /**\n     * When `true`, object cannot be flipped by scaling into negative values\n     * @type Boolean\n     * @default\n     */\n    lockScalingFlip:          false,\n\n    /**\n     * When `true`, object is not exported in OBJECT/JSON\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    excludeFromExport:        false,\n\n    /**\n     * When `true`, object is cached on an additional canvas.\n     * When `false`, object is not cached unless necessary ( clipPath )\n     * default to true\n     * @since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    objectCaching:            objectCaching,\n\n    /**\n     * When `true`, object properties are checked for cache invalidation. In some particular\n     * situation you may want this to be disabled ( spray brush, very big, groups)\n     * or if your application does not allow you to modify properties for groups child you want\n     * to disable it for groups.\n     * default to false\n     * since 1.7.0\n     * @type Boolean\n     * @default false\n     */\n    statefullCache:            false,\n\n    /**\n     * When `true`, cache does not get updated during scaling. The picture will get blocky if scaled\n     * too much and will be redrawn with correct details at the end of scaling.\n     * this setting is performance and application dependant.\n     * default to true\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    noScaleCache:              true,\n\n    /**\n     * When `false`, the stoke width will scale with the object.\n     * When `true`, the stroke will always match the exact pixel size entered for stroke width.\n     * default to false\n     * @since 2.6.0\n     * @type Boolean\n     * @default false\n     * @type Boolean\n     * @default false\n     */\n    strokeUniform:              false,\n\n    /**\n     * When set to `true`, object's cache will be rerendered next render call.\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    dirty:                true,\n\n    /**\n     * keeps the value of the last hovered corner during mouse move.\n     * 0 is no corner, or 'mt', 'ml', 'mtr' etc..\n     * It should be private, but there is no harm in using it as\n     * a read-only property.\n     * @type number|string|any\n     * @default 0\n     */\n    __corner: 0,\n\n    /**\n     * Determines if the fill or the stroke is drawn first (one of \"fill\" or \"stroke\")\n     * @type String\n     * @default\n     */\n    paintFirst:           'fill',\n\n    /**\n     * When 'down', object is set to active on mousedown/touchstart\n     * When 'up', object is set to active on mouseup/touchend\n     * Experimental. Let's see if this breaks anything before supporting officially\n     * @private\n     * since 4.4.0\n     * @type String\n     * @default 'down'\n     */\n    activeOn:           'down',\n\n    /**\n     * List of properties to consider when checking if state\n     * of an object is changed (fabric.Object#hasStateChanged)\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: (\n      'top left width height scaleX scaleY flipX flipY originX originY transformMatrix ' +\n      'stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit ' +\n      'angle opacity fill globalCompositeOperation shadow visible backgroundColor ' +\n      'skewX skewY fillRule paintFirst clipPath strokeUniform'\n    ).split(' '),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\n     * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\n     * and refreshed at the next render\n     * @type Array\n     */\n    cacheProperties: (\n      'fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform' +\n      ' strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath'\n    ).split(' '),\n\n    /**\n     * List of properties to consider for animating colors.\n     * @type Array\n     */\n    colorProperties: (\n      'fill stroke backgroundColor'\n    ).split(' '),\n\n    /**\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n     * the clipPath object gets used when the object has rendered, and the context is placed in the center\n     * of the object cacheCanvas.\n     * If you want 0,0 of a clipPath to align with an object center, use clipPath.originX/Y to 'center'\n     * @type fabric.Object\n     */\n    clipPath: undefined,\n\n    /**\n     * Meaningful ONLY when the object is used as clipPath.\n     * if true, the clipPath will make the object clip to the outside of the clipPath\n     * since 2.4.0\n     * @type boolean\n     * @default false\n     */\n    inverted: false,\n\n    /**\n     * Meaningful ONLY when the object is used as clipPath.\n     * if true, the clipPath will have its top and left relative to canvas, and will\n     * not be influenced by the object transform. This will make the clipPath relative\n     * to the canvas, but clipping just a particular object.\n     * WARNING this is beta, this feature may change or be renamed.\n     * since 2.4.0\n     * @type boolean\n     * @default false\n     */\n    absolutePositioned: false,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      if (options) {\n        this.setOptions(options);\n      }\n    },\n\n    /**\n     * Create a the canvas used to keep the cached copy of the object\n     * @private\n     */\n    _createCacheCanvas: function() {\n      this._cacheProperties = {};\n      this._cacheCanvas = fabric.util.createCanvasElement();\n      this._cacheContext = this._cacheCanvas.getContext('2d');\n      this._updateCacheCanvas();\n      // if canvas gets created, is empty, so dirty.\n      this.dirty = true;\n    },\n\n    /**\n     * Limit the cache dimensions so that X * Y do not cross fabric.perfLimitSizeTotal\n     * and each side do not cross fabric.cacheSideLimit\n     * those numbers are configurable so that you can get as much detail as you want\n     * making bargain with performances.\n     * @param {Object} dims\n     * @param {Object} dims.width width of canvas\n     * @param {Object} dims.height height of canvas\n     * @param {Object} dims.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @param {Object} dims.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _limitCacheSize: function(dims) {\n      var perfLimitSizeTotal = fabric.perfLimitSizeTotal,\n          width = dims.width, height = dims.height,\n          max = fabric.maxCacheSideLimit, min = fabric.minCacheSideLimit;\n      if (width <= max && height <= max && width * height <= perfLimitSizeTotal) {\n        if (width < min) {\n          dims.width = min;\n        }\n        if (height < min) {\n          dims.height = min;\n        }\n        return dims;\n      }\n      var ar = width / height, limitedDims = fabric.util.limitDimsByArea(ar, perfLimitSizeTotal),\n          capValue = fabric.util.capValue,\n          x = capValue(min, limitedDims.x, max),\n          y = capValue(min, limitedDims.y, max);\n      if (width > x) {\n        dims.zoomX /= width / x;\n        dims.width = x;\n        dims.capped = true;\n      }\n      if (height > y) {\n        dims.zoomY /= height / y;\n        dims.height = y;\n        dims.capped = true;\n      }\n      return dims;\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @return {Object}.x width of object to be cached\n     * @return {Object}.y height of object to be cached\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var objectScale = this.getTotalObjectScaling(),\n          // caculate dimensions without skewing\n          dim = this._getTransformedDimensions(0, 0),\n          neededX = dim.x * objectScale.scaleX / this.scaleX,\n          neededY = dim.y * objectScale.scaleY / this.scaleY;\n      return {\n        // for sure this ALIASING_LIMIT is slightly creating problem\n        // in situation in which the cache canvas gets an upper limit\n        // also objectScale contains already scaleX and scaleY\n        width: neededX + ALIASING_LIMIT,\n        height: neededY + ALIASING_LIMIT,\n        zoomX: objectScale.scaleX,\n        zoomY: objectScale.scaleY,\n        x: neededX,\n        y: neededY\n      };\n    },\n\n    /**\n     * Update width and height of the canvas for cache\n     * returns true or false if canvas needed resize.\n     * @private\n     * @return {Boolean} true if the canvas has been resized\n     */\n    _updateCacheCanvas: function() {\n      var targetCanvas = this.canvas;\n      if (this.noScaleCache && targetCanvas && targetCanvas._currentTransform) {\n        var target = targetCanvas._currentTransform.target,\n            action = targetCanvas._currentTransform.action;\n        if (this === target && action.slice && action.slice(0, 5) === 'scale') {\n          return false;\n        }\n      }\n      var canvas = this._cacheCanvas,\n          dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          minCacheSize = fabric.minCacheSideLimit,\n          width = dims.width, height = dims.height, drawingWidth, drawingHeight,\n          zoomX = dims.zoomX, zoomY = dims.zoomY,\n          dimensionsChanged = width !== this.cacheWidth || height !== this.cacheHeight,\n          zoomChanged = this.zoomX !== zoomX || this.zoomY !== zoomY,\n          shouldRedraw = dimensionsChanged || zoomChanged,\n          additionalWidth = 0, additionalHeight = 0, shouldResizeCanvas = false;\n      if (dimensionsChanged) {\n        var canvasWidth = this._cacheCanvas.width,\n            canvasHeight = this._cacheCanvas.height,\n            sizeGrowing = width > canvasWidth || height > canvasHeight,\n            sizeShrinking = (width < canvasWidth * 0.9 || height < canvasHeight * 0.9) &&\n              canvasWidth > minCacheSize && canvasHeight > minCacheSize;\n        shouldResizeCanvas = sizeGrowing || sizeShrinking;\n        if (sizeGrowing && !dims.capped && (width > minCacheSize || height > minCacheSize)) {\n          additionalWidth = width * 0.1;\n          additionalHeight = height * 0.1;\n        }\n      }\n      if (shouldRedraw) {\n        if (shouldResizeCanvas) {\n          canvas.width = Math.ceil(width + additionalWidth);\n          canvas.height = Math.ceil(height + additionalHeight);\n        }\n        else {\n          this._cacheContext.setTransform(1, 0, 0, 1, 0, 0);\n          this._cacheContext.clearRect(0, 0, canvas.width, canvas.height);\n        }\n        drawingWidth = dims.x / 2;\n        drawingHeight = dims.y / 2;\n        this.cacheTranslationX = Math.round(canvas.width / 2 - drawingWidth) + drawingWidth;\n        this.cacheTranslationY = Math.round(canvas.height / 2 - drawingHeight) + drawingHeight;\n        this.cacheWidth = width;\n        this.cacheHeight = height;\n        this._cacheContext.translate(this.cacheTranslationX, this.cacheTranslationY);\n        this._cacheContext.scale(zoomX, zoomY);\n        this.zoomX = zoomX;\n        this.zoomY = zoomY;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Sets object's properties from options\n     * @param {Object} [options] Options object\n     */\n    setOptions: function(options) {\n      this._setOptions(options);\n      this._initGradient(options.fill, 'fill');\n      this._initGradient(options.stroke, 'stroke');\n      this._initPattern(options.fill, 'fill');\n      this._initPattern(options.stroke, 'stroke');\n    },\n\n    /**\n     * Transforms context when rendering an object\n     * @param {CanvasRenderingContext2D} ctx Context\n     */\n    transform: function(ctx) {\n      var needFullTransform = (this.group && !this.group._transformDone) ||\n         (this.group && this.canvas && ctx === this.canvas.contextTop);\n      var m = this.calcTransformMatrix(!needFullTransform);\n      ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n    },\n\n    /**\n     * Returns an object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n\n          object = {\n            type:                     this.type,\n            version:                  fabric.version,\n            originX:                  this.originX,\n            originY:                  this.originY,\n            left:                     toFixed(this.left, NUM_FRACTION_DIGITS),\n            top:                      toFixed(this.top, NUM_FRACTION_DIGITS),\n            width:                    toFixed(this.width, NUM_FRACTION_DIGITS),\n            height:                   toFixed(this.height, NUM_FRACTION_DIGITS),\n            fill:                     (this.fill && this.fill.toObject) ? this.fill.toObject() : this.fill,\n            stroke:                   (this.stroke && this.stroke.toObject) ? this.stroke.toObject() : this.stroke,\n            strokeWidth:              toFixed(this.strokeWidth, NUM_FRACTION_DIGITS),\n            strokeDashArray:          this.strokeDashArray ? this.strokeDashArray.concat() : this.strokeDashArray,\n            strokeLineCap:            this.strokeLineCap,\n            strokeDashOffset:         this.strokeDashOffset,\n            strokeLineJoin:           this.strokeLineJoin,\n            strokeUniform:            this.strokeUniform,\n            strokeMiterLimit:         toFixed(this.strokeMiterLimit, NUM_FRACTION_DIGITS),\n            scaleX:                   toFixed(this.scaleX, NUM_FRACTION_DIGITS),\n            scaleY:                   toFixed(this.scaleY, NUM_FRACTION_DIGITS),\n            angle:                    toFixed(this.angle, NUM_FRACTION_DIGITS),\n            flipX:                    this.flipX,\n            flipY:                    this.flipY,\n            opacity:                  toFixed(this.opacity, NUM_FRACTION_DIGITS),\n            shadow:                   (this.shadow && this.shadow.toObject) ? this.shadow.toObject() : this.shadow,\n            visible:                  this.visible,\n            backgroundColor:          this.backgroundColor,\n            fillRule:                 this.fillRule,\n            paintFirst:               this.paintFirst,\n            globalCompositeOperation: this.globalCompositeOperation,\n            skewX:                    toFixed(this.skewX, NUM_FRACTION_DIGITS),\n            skewY:                    toFixed(this.skewY, NUM_FRACTION_DIGITS),\n          };\n\n      if (this.clipPath) {\n        object.clipPath = this.clipPath.toObject(propertiesToInclude);\n        object.clipPath.inverted = this.clipPath.inverted;\n        object.clipPath.absolutePositioned = this.clipPath.absolutePositioned;\n      }\n\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        object = this._removeDefaultValues(object);\n      }\n\n      return object;\n    },\n\n    /**\n     * Returns (dataless) object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      // will be overwritten by subclasses\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     */\n    _removeDefaultValues: function(object) {\n      var prototype = fabric.util.getKlass(object.type).prototype,\n          stateProperties = prototype.stateProperties;\n      stateProperties.forEach(function(prop) {\n        if (prop === 'left' || prop === 'top') {\n          return;\n        }\n        if (object[prop] === prototype[prop]) {\n          delete object[prop];\n        }\n        var isArray = Object.prototype.toString.call(object[prop]) === '[object Array]' &&\n                      Object.prototype.toString.call(prototype[prop]) === '[object Array]';\n\n        // basically a check for [] === []\n        if (isArray && object[prop].length === 0 && prototype[prop].length === 0) {\n          delete object[prop];\n        }\n      });\n\n      return object;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.' + capitalize(this.type) + '>';\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getObjectScaling: function() {\n      var options = fabric.util.qrDecompose(this.calcTransformMatrix());\n      return { scaleX: Math.abs(options.scaleX), scaleY: Math.abs(options.scaleY) };\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling, zoom and retina\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getTotalObjectScaling: function() {\n      var scale = this.getObjectScaling(), scaleX = scale.scaleX, scaleY = scale.scaleY;\n      if (this.canvas) {\n        var zoom = this.canvas.getZoom();\n        var retina = this.canvas.getRetinaScaling();\n        scaleX *= zoom * retina;\n        scaleY *= zoom * retina;\n      }\n      return { scaleX: scaleX, scaleY: scaleY };\n    },\n\n    /**\n     * Return the object opacity counting also the group property\n     * @return {Number}\n     */\n    getObjectOpacity: function() {\n      var opacity = this.opacity;\n      if (this.group) {\n        opacity *= this.group.getObjectOpacity();\n      }\n      return opacity;\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Object} thisArg\n     */\n    _set: function(key, value) {\n      var shouldConstrainValue = (key === 'scaleX' || key === 'scaleY'),\n          isChanged = this[key] !== value, groupNeedsUpdate = false;\n\n      if (shouldConstrainValue) {\n        value = this._constrainScale(value);\n      }\n      if (key === 'scaleX' && value < 0) {\n        this.flipX = !this.flipX;\n        value *= -1;\n      }\n      else if (key === 'scaleY' && value < 0) {\n        this.flipY = !this.flipY;\n        value *= -1;\n      }\n      else if (key === 'shadow' && value && !(value instanceof fabric.Shadow)) {\n        value = new fabric.Shadow(value);\n      }\n      else if (key === 'dirty' && this.group) {\n        this.group.set('dirty', value);\n      }\n\n      this[key] = value;\n\n      if (isChanged) {\n        groupNeedsUpdate = this.group && this.group.isOnACache();\n        if (this.cacheProperties.indexOf(key) > -1) {\n          this.dirty = true;\n          groupNeedsUpdate && this.group.set('dirty', true);\n        }\n        else if (groupNeedsUpdate && this.stateProperties.indexOf(key) > -1) {\n          this.group.set('dirty', true);\n        }\n      }\n      return this;\n    },\n\n    /**\n     * This callback function is called by the parent group of an object every\n     * time a non-delegated property changes on the group. It is passed the key\n     * and value as parameters. Not adding in this function's signature to avoid\n     * Travis build error about unused variables.\n     */\n    setOnGroup: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n    /**\n     * Retrieves viewportTransform from Object's canvas if possible\n     * @method getViewportTransform\n     * @memberOf fabric.Object.prototype\n     * @return {Array}\n     */\n    getViewportTransform: function() {\n      if (this.canvas && this.canvas.viewportTransform) {\n        return this.canvas.viewportTransform;\n      }\n      return fabric.iMatrix.concat();\n    },\n\n    /*\n     * @private\n     * return if the object would be visible in rendering\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean}\n     */\n    isNotVisible: function() {\n      return this.opacity === 0 ||\n        (!this.width && !this.height && this.strokeWidth === 0) ||\n        !this.visible;\n    },\n\n    /**\n     * Renders an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      // do not render if width/height are zeros or object is not visible\n      if (this.isNotVisible()) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      ctx.save();\n      this._setupCompositeOperation(ctx);\n      this.drawSelectionBackground(ctx);\n      this.transform(ctx);\n      this._setOpacity(ctx);\n      this._setShadow(ctx, this);\n      if (this.shouldCache()) {\n        this.renderCache();\n        this.drawCacheOnCanvas(ctx);\n      }\n      else {\n        this._removeCacheCanvas();\n        this.dirty = false;\n        this.drawObject(ctx);\n        if (this.objectCaching && this.statefullCache) {\n          this.saveState({ propertySet: 'cacheProperties' });\n        }\n      }\n      ctx.restore();\n    },\n\n    renderCache: function(options) {\n      options = options || {};\n      if (!this._cacheCanvas) {\n        this._createCacheCanvas();\n      }\n      if (this.isCacheDirty()) {\n        this.statefullCache && this.saveState({ propertySet: 'cacheProperties' });\n        this.drawObject(this._cacheContext, options.forClipping);\n        this.dirty = false;\n      }\n    },\n\n    /**\n     * Remove cacheCanvas and its dimensions from the objects\n     */\n    _removeCacheCanvas: function() {\n      this._cacheCanvas = null;\n      this.cacheWidth = 0;\n      this.cacheHeight = 0;\n    },\n\n    /**\n     * return true if the object will draw a stroke\n     * Does not consider text styles. This is just a shortcut used at rendering time\n     * We want it to be an approximation and be fast.\n     * wrote to avoid extra caching, it has to return true when stroke happens,\n     * can guess when it will not happen at 100% chance, does not matter if it misses\n     * some use case where the stroke is invisible.\n     * @since 3.0.0\n     * @returns Boolean\n     */\n    hasStroke: function() {\n      return this.stroke && this.stroke !== 'transparent' && this.strokeWidth !== 0;\n    },\n\n    /**\n     * return true if the object will draw a fill\n     * Does not consider text styles. This is just a shortcut used at rendering time\n     * We want it to be an approximation and be fast.\n     * wrote to avoid extra caching, it has to return true when fill happens,\n     * can guess when it will not happen at 100% chance, does not matter if it misses\n     * some use case where the fill is invisible.\n     * @since 3.0.0\n     * @returns Boolean\n     */\n    hasFill: function() {\n      return this.fill && this.fill !== 'transparent';\n    },\n\n    /**\n     * When set to `true`, force the object to have its own cache, even if it is inside a group\n     * it may be needed when your object behave in a particular way on the cache and always needs\n     * its own isolated canvas to render correctly.\n     * Created to be overridden\n     * since 1.7.12\n     * @returns Boolean\n     */\n    needsItsOwnCache: function() {\n      if (this.paintFirst === 'stroke' &&\n        this.hasFill() && this.hasStroke() && typeof this.shadow === 'object') {\n        return true;\n      }\n      if (this.clipPath) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * Read as: cache if is needed, or if the feature is enabled but we are not already caching.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      this.ownCaching = this.needsItsOwnCache() || (\n        this.objectCaching &&\n        (!this.group || !this.group.isOnACache())\n      );\n      return this.ownCaching;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * used by Group.shouldCache to know if child has a shadow recursively\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      return !!this.shadow && (this.shadow.offsetX !== 0 || this.shadow.offsetY !== 0);\n    },\n\n    /**\n     * Execute the drawing operation for an object clipPath\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawClipPathOnCache: function(ctx) {\n      var path = this.clipPath;\n      ctx.save();\n      // DEBUG: uncomment this line, comment the following\n      // ctx.globalAlpha = 0.4\n      if (path.inverted) {\n        ctx.globalCompositeOperation = 'destination-out';\n      }\n      else {\n        ctx.globalCompositeOperation = 'destination-in';\n      }\n      //ctx.scale(1 / 2, 1 / 2);\n      if (path.absolutePositioned) {\n        var m = fabric.util.invertTransform(this.calcTransformMatrix());\n        ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n      }\n      path.transform(ctx);\n      ctx.scale(1 / path.zoomX, 1 / path.zoomY);\n      ctx.drawImage(path._cacheCanvas, -path.cacheTranslationX, -path.cacheTranslationY);\n      ctx.restore();\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawObject: function(ctx, forClipping) {\n      var originalFill = this.fill, originalStroke = this.stroke;\n      if (forClipping) {\n        this.fill = 'black';\n        this.stroke = '';\n        this._setClippingProperties(ctx);\n      }\n      else {\n        this._renderBackground(ctx);\n      }\n      this._render(ctx);\n      this._drawClipPath(ctx);\n      this.fill = originalFill;\n      this.stroke = originalStroke;\n    },\n\n    _drawClipPath: function(ctx) {\n      var path = this.clipPath;\n      if (!path) { return; }\n      // needed to setup a couple of variables\n      // path canvas gets overridden with this one.\n      // TODO find a better solution?\n      path.canvas = this.canvas;\n      path.shouldCache();\n      path._transformDone = true;\n      path.renderCache({ forClipping: true });\n      this.drawClipPathOnCache(ctx);\n    },\n\n    /**\n     * Paint the cached copy of the object on the target context.\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawCacheOnCanvas: function(ctx) {\n      ctx.scale(1 / this.zoomX, 1 / this.zoomY);\n      ctx.drawImage(this._cacheCanvas, -this.cacheTranslationX, -this.cacheTranslationY);\n    },\n\n    /**\n     * Check if cache is dirty\n     * @param {Boolean} skipCanvas skip canvas checks because this object is painted\n     * on parent canvas.\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.isNotVisible()) {\n        return false;\n      }\n      if (this._cacheCanvas && !skipCanvas && this._updateCacheCanvas()) {\n        // in this case the context is already cleared.\n        return true;\n      }\n      else {\n        if (this.dirty ||\n          (this.clipPath && this.clipPath.absolutePositioned) ||\n          (this.statefullCache && this.hasStateChanged('cacheProperties'))\n        ) {\n          if (this._cacheCanvas && !skipCanvas) {\n            var width = this.cacheWidth / this.zoomX;\n            var height = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-width / 2, -height / 2, width, height);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Draws a background for the object big as its untransformed dimensions\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      if (!this.backgroundColor) {\n        return;\n      }\n      var dim = this._getNonTransformedDimensions();\n      ctx.fillStyle = this.backgroundColor;\n\n      ctx.fillRect(\n        -dim.x / 2,\n        -dim.y / 2,\n        dim.x,\n        dim.y\n      );\n      // if there is background color no other shadows\n      // should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setOpacity: function(ctx) {\n      if (this.group && !this.group._transformDone) {\n        ctx.globalAlpha = this.getObjectOpacity();\n      }\n      else {\n        ctx.globalAlpha *= this.opacity;\n      }\n    },\n\n    _setStrokeStyles: function(ctx, decl) {\n      var stroke = decl.stroke;\n      if (stroke) {\n        ctx.lineWidth = decl.strokeWidth;\n        ctx.lineCap = decl.strokeLineCap;\n        ctx.lineDashOffset = decl.strokeDashOffset;\n        ctx.lineJoin = decl.strokeLineJoin;\n        ctx.miterLimit = decl.strokeMiterLimit;\n        if (stroke.toLive) {\n          if (stroke.gradientUnits === 'percentage' || stroke.gradientTransform || stroke.patternTransform) {\n            // need to transform gradient in a pattern.\n            // this is a slow process. If you are hitting this codepath, and the object\n            // is not using caching, you should consider switching it on.\n            // we need a canvas as big as the current object caching canvas.\n            this._applyPatternForTransformedGradient(ctx, stroke);\n          }\n          else {\n            // is a simple gradient or pattern\n            ctx.strokeStyle = stroke.toLive(ctx, this);\n            this._applyPatternGradientTransform(ctx, stroke);\n          }\n        }\n        else {\n          // is a color\n          ctx.strokeStyle = decl.stroke;\n        }\n      }\n    },\n\n    _setFillStyles: function(ctx, decl) {\n      var fill = decl.fill;\n      if (fill) {\n        if (fill.toLive) {\n          ctx.fillStyle = fill.toLive(ctx, this);\n          this._applyPatternGradientTransform(ctx, decl.fill);\n        }\n        else {\n          ctx.fillStyle = fill;\n        }\n      }\n    },\n\n    _setClippingProperties: function(ctx) {\n      ctx.globalAlpha = 1;\n      ctx.strokeStyle = 'transparent';\n      ctx.fillStyle = '#000000';\n    },\n\n    /**\n     * @private\n     * Sets line dash\n     * @param {CanvasRenderingContext2D} ctx Context to set the dash line on\n     * @param {Array} dashArray array representing dashes\n     * @param {Function} alternative function to call if browser does not support lineDash\n     */\n    _setLineDash: function(ctx, dashArray, alternative) {\n      if (!dashArray || dashArray.length === 0) {\n        return;\n      }\n      // Spec requires the concatenation of two copies the dash list when the number of elements is odd\n      if (1 & dashArray.length) {\n        dashArray.push.apply(dashArray, dashArray);\n      }\n      if (supportsLineDash) {\n        ctx.setLineDash(dashArray);\n      }\n      else {\n        alternative && alternative(ctx);\n      }\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [styleOverride] properties to override the object style\n     */\n    _renderControls: function(ctx, styleOverride) {\n      var vpt = this.getViewportTransform(),\n          matrix = this.calcTransformMatrix(),\n          options, drawBorders, drawControls;\n      styleOverride = styleOverride || { };\n      drawBorders = typeof styleOverride.hasBorders !== 'undefined' ? styleOverride.hasBorders : this.hasBorders;\n      drawControls = typeof styleOverride.hasControls !== 'undefined' ? styleOverride.hasControls : this.hasControls;\n      matrix = fabric.util.multiplyTransformMatrices(vpt, matrix);\n      options = fabric.util.qrDecompose(matrix);\n      ctx.save();\n      ctx.translate(options.translateX, options.translateY);\n      ctx.lineWidth = 1 * this.borderScaleFactor;\n      if (!this.group) {\n        ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      }\n      if (styleOverride.forActiveSelection) {\n        ctx.rotate(degreesToRadians(options.angle));\n        drawBorders && this.drawBordersInGroup(ctx, options, styleOverride);\n      }\n      else {\n        ctx.rotate(degreesToRadians(this.angle));\n        drawBorders && this.drawBorders(ctx, styleOverride);\n      }\n      drawControls && this.drawControls(ctx, styleOverride);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      var shadow = this.shadow, canvas = this.canvas, scaling,\n          multX = (canvas && canvas.viewportTransform[0]) || 1,\n          multY = (canvas && canvas.viewportTransform[3]) || 1;\n      if (shadow.nonScaling) {\n        scaling = { scaleX: 1, scaleY: 1 };\n      }\n      else {\n        scaling = this.getObjectScaling();\n      }\n      if (canvas && canvas._isRetinaScaling()) {\n        multX *= fabric.devicePixelRatio;\n        multY *= fabric.devicePixelRatio;\n      }\n      ctx.shadowColor = shadow.color;\n      ctx.shadowBlur = shadow.blur * fabric.browserShadowBlurConstant *\n        (multX + multY) * (scaling.scaleX + scaling.scaleY) / 4;\n      ctx.shadowOffsetX = shadow.offsetX * multX * scaling.scaleX;\n      ctx.shadowOffsetY = shadow.offsetY * multY * scaling.scaleY;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _removeShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      ctx.shadowColor = '';\n      ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} filler fabric.Pattern or fabric.Gradient\n     * @return {Object} offset.offsetX offset for text rendering\n     * @return {Object} offset.offsetY offset for text rendering\n     */\n    _applyPatternGradientTransform: function(ctx, filler) {\n      if (!filler || !filler.toLive) {\n        return { offsetX: 0, offsetY: 0 };\n      }\n      var t = filler.gradientTransform || filler.patternTransform;\n      var offsetX = -this.width / 2 + filler.offsetX || 0,\n          offsetY = -this.height / 2 + filler.offsetY || 0;\n\n      if (filler.gradientUnits === 'percentage') {\n        ctx.transform(this.width, 0, 0, this.height, offsetX, offsetY);\n      }\n      else {\n        ctx.transform(1, 0, 0, 1, offsetX, offsetY);\n      }\n      if (t) {\n        ctx.transform(t[0], t[1], t[2], t[3], t[4], t[5]);\n      }\n      return { offsetX: offsetX, offsetY: offsetY };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderPaintInOrder: function(ctx) {\n      if (this.paintFirst === 'stroke') {\n        this._renderStroke(ctx);\n        this._renderFill(ctx);\n      }\n      else {\n        this._renderFill(ctx);\n        this._renderStroke(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * function that actually render something on the context.\n     * empty here to allow Obects to work on tests to benchmark fabric functionalites\n     * not related to rendering\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(/* ctx */) {\n\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderFill: function(ctx) {\n      if (!this.fill) {\n        return;\n      }\n\n      ctx.save();\n      this._setFillStyles(ctx, this);\n      if (this.fillRule === 'evenodd') {\n        ctx.fill('evenodd');\n      }\n      else {\n        ctx.fill();\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderStroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      if (this.strokeUniform && this.group) {\n        var scaling = this.getObjectScaling();\n        ctx.scale(1 / scaling.scaleX, 1 / scaling.scaleY);\n      }\n      else if (this.strokeUniform) {\n        ctx.scale(1 / this.scaleX, 1 / this.scaleY);\n      }\n      this._setLineDash(ctx, this.strokeDashArray, this._renderDashedStroke);\n      this._setStrokeStyles(ctx, this);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * This function try to patch the missing gradientTransform on canvas gradients.\n     * transforming a context to transform the gradient, is going to transform the stroke too.\n     * we want to transform the gradient but not the stroke operation, so we create\n     * a transformed gradient on a pattern and then we use the pattern instead of the gradient.\n     * this method has drwabacks: is slow, is in low resolution, needs a patch for when the size\n     * is limited.\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {fabric.Gradient} filler a fabric gradient instance\n     */\n    _applyPatternForTransformedGradient: function(ctx, filler) {\n      var dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          pCanvas = fabric.util.createCanvasElement(), pCtx, retinaScaling = this.canvas.getRetinaScaling(),\n          width = dims.x / this.scaleX / retinaScaling, height = dims.y / this.scaleY / retinaScaling;\n      pCanvas.width = width;\n      pCanvas.height = height;\n      pCtx = pCanvas.getContext('2d');\n      pCtx.beginPath(); pCtx.moveTo(0, 0); pCtx.lineTo(width, 0); pCtx.lineTo(width, height);\n      pCtx.lineTo(0, height); pCtx.closePath();\n      pCtx.translate(width / 2, height / 2);\n      pCtx.scale(\n        dims.zoomX / this.scaleX / retinaScaling,\n        dims.zoomY / this.scaleY / retinaScaling\n      );\n      this._applyPatternGradientTransform(pCtx, filler);\n      pCtx.fillStyle = filler.toLive(ctx);\n      pCtx.fill();\n      ctx.translate(-this.width / 2 - this.strokeWidth / 2, -this.height / 2 - this.strokeWidth / 2);\n      ctx.scale(\n        retinaScaling * this.scaleX / dims.zoomX,\n        retinaScaling * this.scaleY / dims.zoomY\n      );\n      ctx.strokeStyle = pCtx.createPattern(pCanvas, 'no-repeat');\n    },\n\n    /**\n     * This function is an helper for svg import. it returns the center of the object in the svg\n     * untransformed coordinates\n     * @private\n     * @return {Object} center point from element coordinates\n     */\n    _findCenterFromElement: function() {\n      return { x: this.left + this.width / 2, y: this.top + this.height / 2 };\n    },\n\n    /**\n     * This function is an helper for svg import. it decompose the transformMatrix\n     * and assign properties to object.\n     * untransformed coordinates\n     * @private\n     * @chainable\n     */\n    _assignTransformMatrixProps: function() {\n      if (this.transformMatrix) {\n        var options = fabric.util.qrDecompose(this.transformMatrix);\n        this.flipX = false;\n        this.flipY = false;\n        this.set('scaleX', options.scaleX);\n        this.set('scaleY', options.scaleY);\n        this.angle = options.angle;\n        this.skewX = options.skewX;\n        this.skewY = 0;\n      }\n    },\n\n    /**\n     * This function is an helper for svg import. it removes the transform matrix\n     * and set to object properties that fabricjs can handle\n     * @private\n     * @param {Object} preserveAspectRatioOptions\n     * @return {thisArg}\n     */\n    _removeTransformMatrix: function(preserveAspectRatioOptions) {\n      var center = this._findCenterFromElement();\n      if (this.transformMatrix) {\n        this._assignTransformMatrixProps();\n        center = fabric.util.transformPoint(center, this.transformMatrix);\n      }\n      this.transformMatrix = null;\n      if (preserveAspectRatioOptions) {\n        this.scaleX *= preserveAspectRatioOptions.scaleX;\n        this.scaleY *= preserveAspectRatioOptions.scaleY;\n        this.cropX = preserveAspectRatioOptions.cropX;\n        this.cropY = preserveAspectRatioOptions.cropY;\n        center.x += preserveAspectRatioOptions.offsetLeft;\n        center.y += preserveAspectRatioOptions.offsetTop;\n        this.width = preserveAspectRatioOptions.width;\n        this.height = preserveAspectRatioOptions.height;\n      }\n      this.setPositionByOrigin(center, 'center', 'center');\n    },\n\n    /**\n     * Clones an instance, using a callback method will work for every object.\n     * @param {Function} callback Callback is invoked with a clone as a first argument\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     */\n    clone: function(callback, propertiesToInclude) {\n      var objectForm = this.toObject(propertiesToInclude);\n      if (this.constructor.fromObject) {\n        this.constructor.fromObject(objectForm, callback);\n      }\n      else {\n        fabric.Object._fromObject('Object', objectForm, callback);\n      }\n    },\n\n    /**\n     * Creates an instance of fabric.Image out of an object\n     * makes use of toCanvasElement.\n     * Once this method was based on toDataUrl and loadImage, so it also had a quality\n     * and format option. toCanvasElement is faster and produce no loss of quality.\n     * If you need to get a real Jpeg or Png from an object, using toDataURL is the right way to do it.\n     * toCanvasElement and then toBlob from the obtained canvas is also a good option.\n     * This method is sync now, but still support the callback because we did not want to break.\n     * When fabricJS 5.0 will be planned, this will probably be changed to not have a callback.\n     * @param {Function} callback callback, invoked with an instance as a first argument\n     * @param {Object} [options] for clone as image, passed to toDataURL\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {fabric.Object} thisArg\n     */\n    cloneAsImage: function(callback, options) {\n      var canvasEl = this.toCanvasElement(options);\n      if (callback) {\n        callback(new fabric.Image(canvasEl));\n      }\n      return this;\n    },\n\n    /**\n     * Converts an object into a HTMLCanvas element\n     * @param {Object} options Options object\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {HTMLCanvasElement} Returns DOM element <canvas> with the fabric.Object\n     */\n    toCanvasElement: function(options) {\n      options || (options = { });\n\n      var utils = fabric.util, origParams = utils.saveObjectTransform(this),\n          originalGroup = this.group,\n          originalShadow = this.shadow, abs = Math.abs,\n          multiplier = (options.multiplier || 1) * (options.enableRetinaScaling ? fabric.devicePixelRatio : 1);\n      delete this.group;\n      if (options.withoutTransform) {\n        utils.resetObjectTransform(this);\n      }\n      if (options.withoutShadow) {\n        this.shadow = null;\n      }\n\n      var el = fabric.util.createCanvasElement(),\n          // skip canvas zoom and calculate with setCoords now.\n          boundingRect = this.getBoundingRect(true, true),\n          shadow = this.shadow, scaling,\n          shadowOffset = { x: 0, y: 0 }, shadowBlur,\n          width, height;\n\n      if (shadow) {\n        shadowBlur = shadow.blur;\n        if (shadow.nonScaling) {\n          scaling = { scaleX: 1, scaleY: 1 };\n        }\n        else {\n          scaling = this.getObjectScaling();\n        }\n        // consider non scaling shadow.\n        shadowOffset.x = 2 * Math.round(abs(shadow.offsetX) + shadowBlur) * (abs(scaling.scaleX));\n        shadowOffset.y = 2 * Math.round(abs(shadow.offsetY) + shadowBlur) * (abs(scaling.scaleY));\n      }\n      width = boundingRect.width + shadowOffset.x;\n      height = boundingRect.height + shadowOffset.y;\n      // if the current width/height is not an integer\n      // we need to make it so.\n      el.width = Math.ceil(width);\n      el.height = Math.ceil(height);\n      var canvas = new fabric.StaticCanvas(el, {\n        enableRetinaScaling: false,\n        renderOnAddRemove: false,\n        skipOffscreen: false,\n      });\n      if (options.format === 'jpeg') {\n        canvas.backgroundColor = '#fff';\n      }\n      this.setPositionByOrigin(new fabric.Point(canvas.width / 2, canvas.height / 2), 'center', 'center');\n\n      var originalCanvas = this.canvas;\n      canvas.add(this);\n      var canvasEl = canvas.toCanvasElement(multiplier || 1, options);\n      this.shadow = originalShadow;\n      this.set('canvas', originalCanvas);\n      if (originalGroup) {\n        this.group = originalGroup;\n      }\n      this.set(origParams).setCoords();\n      // canvas.dispose will call image.dispose that will nullify the elements\n      // since this canvas is a simple element for the process, we remove references\n      // to objects in this way in order to avoid object trashing.\n      canvas._objects = [];\n      canvas.dispose();\n      canvas = null;\n\n      return canvasEl;\n    },\n\n    /**\n     * Converts an object into a data-url-like string\n     * @param {Object} options Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     */\n    toDataURL: function(options) {\n      options || (options = { });\n      return fabric.util.toDataURL(this.toCanvasElement(options), options.format || 'png', options.quality || 1);\n    },\n\n    /**\n     * Returns true if specified type is identical to the type of an instance\n     * @param {String} type Type to check against\n     * @return {Boolean}\n     */\n    isType: function(type) {\n      return this.type === type;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance (is 1 unless subclassed)\n     */\n    complexity: function() {\n      return 1;\n    },\n\n    /**\n     * Returns a JSON representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} JSON\n     */\n    toJSON: function(propertiesToInclude) {\n      // delegate, not alias\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * Sets \"angle\" of an instance with centered rotation\n     * @param {Number} angle Angle value (in degrees)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    rotate: function(angle) {\n      var shouldCenterOrigin = (this.originX !== 'center' || this.originY !== 'center') && this.centeredRotation;\n\n      if (shouldCenterOrigin) {\n        this._setOriginToCenter();\n      }\n\n      this.set('angle', angle);\n\n      if (shouldCenterOrigin) {\n        this._resetOrigin();\n      }\n\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerH: function () {\n      this.canvas && this.canvas.centerObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterH: function () {\n      this.canvas && this.canvas.viewportCenterObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerV: function () {\n      this.canvas && this.canvas.centerObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterV: function () {\n      this.canvas && this.canvas.viewportCenterObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically and horizontally on canvas to which is was added last\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    center: function () {\n      this.canvas && this.canvas.centerObject(this);\n      return this;\n    },\n\n    /**\n     * Centers object on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenter: function () {\n      this.canvas && this.canvas.viewportCenterObject(this);\n      return this;\n    },\n\n    /**\n     * Returns coordinates of a pointer relative to an object\n     * @param {Event} e Event to operate upon\n     * @param {Object} [pointer] Pointer to operate upon (instead of event)\n     * @return {Object} Coordinates of a pointer (x, y)\n     */\n    getLocalPointer: function(e, pointer) {\n      pointer = pointer || this.canvas.getPointer(e);\n      var pClicked = new fabric.Point(pointer.x, pointer.y),\n          objectLeftTop = this._getLeftTopCoords();\n      if (this.angle) {\n        pClicked = fabric.util.rotatePoint(\n          pClicked, objectLeftTop, degreesToRadians(-this.angle));\n      }\n      return {\n        x: pClicked.x - objectLeftTop.x,\n        y: pClicked.y - objectLeftTop.y\n      };\n    },\n\n    /**\n     * Sets canvas globalCompositeOperation for specific object\n     * custom composition operation for the particular object can be specified using globalCompositeOperation property\n     * @param {CanvasRenderingContext2D} ctx Rendering canvas context\n     */\n    _setupCompositeOperation: function (ctx) {\n      if (this.globalCompositeOperation) {\n        ctx.globalCompositeOperation = this.globalCompositeOperation;\n      }\n    }\n  });\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Object);\n\n  extend(fabric.Object.prototype, fabric.Observable);\n\n  /**\n   * Defines the number of fraction digits to use when serializing object values.\n   * You can use it to increase/decrease precision of such values like left, top, scaleX, scaleY, etc.\n   * @static\n   * @memberOf fabric.Object\n   * @constant\n   * @type Number\n   */\n  fabric.Object.NUM_FRACTION_DIGITS = 2;\n\n  fabric.Object._fromObject = function(className, object, callback, extraParam) {\n    var klass = fabric[className];\n    object = clone(object, true);\n    fabric.util.enlivenPatterns([object.fill, object.stroke], function(patterns) {\n      if (typeof patterns[0] !== 'undefined') {\n        object.fill = patterns[0];\n      }\n      if (typeof patterns[1] !== 'undefined') {\n        object.stroke = patterns[1];\n      }\n      fabric.util.enlivenObjects([object.clipPath], function(enlivedProps) {\n        object.clipPath = enlivedProps[0];\n        var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);\n        callback && callback(instance);\n      });\n    });\n  };\n\n  /**\n   * Unique id used internally when creating SVG elements\n   * @static\n   * @memberOf fabric.Object\n   * @type Number\n   */\n  fabric.Object.__uid = 0;\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      originXOffset = {\n        left: -0.5,\n        center: 0,\n        right: 0.5\n      },\n      originYOffset = {\n        top: -0.5,\n        center: 0,\n        bottom: 0.5\n      };\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Translates the coordinates from a set of origin to another (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} fromOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} fromOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @param {String} toOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} toOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToGivenOrigin: function(point, fromOriginX, fromOriginY, toOriginX, toOriginY) {\n      var x = point.x,\n          y = point.y,\n          offsetX, offsetY, dim;\n\n      if (typeof fromOriginX === 'string') {\n        fromOriginX = originXOffset[fromOriginX];\n      }\n      else {\n        fromOriginX -= 0.5;\n      }\n\n      if (typeof toOriginX === 'string') {\n        toOriginX = originXOffset[toOriginX];\n      }\n      else {\n        toOriginX -= 0.5;\n      }\n\n      offsetX = toOriginX - fromOriginX;\n\n      if (typeof fromOriginY === 'string') {\n        fromOriginY = originYOffset[fromOriginY];\n      }\n      else {\n        fromOriginY -= 0.5;\n      }\n\n      if (typeof toOriginY === 'string') {\n        toOriginY = originYOffset[toOriginY];\n      }\n      else {\n        toOriginY -= 0.5;\n      }\n\n      offsetY = toOriginY - fromOriginY;\n\n      if (offsetX || offsetY) {\n        dim = this._getTransformedDimensions();\n        x = point.x + offsetX * dim.x;\n        y = point.y + offsetY * dim.y;\n      }\n\n      return new fabric.Point(x, y);\n    },\n\n    /**\n     * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToCenterPoint: function(point, originX, originY) {\n      var p = this.translateToGivenOrigin(point, originX, originY, 'center', 'center');\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, point, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Translates the coordinates from center to origin coordinates (based on the object's dimensions)\n     * @param {fabric.Point} center The point which corresponds to center of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToOriginPoint: function(center, originX, originY) {\n      var p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, center, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Returns the real center coordinates of the object\n     * @return {fabric.Point}\n     */\n    getCenterPoint: function() {\n      var leftTop = new fabric.Point(this.left, this.top);\n      return this.translateToCenterPoint(leftTop, this.originX, this.originY);\n    },\n\n    /**\n     * Returns the coordinates of the object based on center coordinates\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @return {fabric.Point}\n     */\n    // getOriginPoint: function(center) {\n    //   return this.translateToOriginPoint(center, this.originX, this.originY);\n    // },\n\n    /**\n     * Returns the coordinates of the object as if it has a different origin\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    getPointByOrigin: function(originX, originY) {\n      var center = this.getCenterPoint();\n      return this.translateToOriginPoint(center, originX, originY);\n    },\n\n    /**\n     * Returns the point in local coordinates\n     * @param {fabric.Point} point The point relative to the global coordinate system\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    toLocalPoint: function(point, originX, originY) {\n      var center = this.getCenterPoint(),\n          p, p2;\n\n      if (typeof originX !== 'undefined' && typeof originY !== 'undefined' ) {\n        p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      }\n      else {\n        p = new fabric.Point(this.left, this.top);\n      }\n\n      p2 = new fabric.Point(point.x, point.y);\n      if (this.angle) {\n        p2 = fabric.util.rotatePoint(p2, center, -degreesToRadians(this.angle));\n      }\n      return p2.subtractEquals(p);\n    },\n\n    /**\n     * Returns the point in global coordinates\n     * @param {fabric.Point} The point relative to the local coordinate system\n     * @return {fabric.Point}\n     */\n    // toGlobalPoint: function(point) {\n    //   return fabric.util.rotatePoint(point, this.getCenterPoint(), degreesToRadians(this.angle)).addEquals(new fabric.Point(this.left, this.top));\n    // },\n\n    /**\n     * Sets the position of the object taking into consideration the object's origin\n     * @param {fabric.Point} pos The new position of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {void}\n     */\n    setPositionByOrigin: function(pos, originX, originY) {\n      var center = this.translateToCenterPoint(pos, originX, originY),\n          position = this.translateToOriginPoint(center, this.originX, this.originY);\n      this.set('left', position.x);\n      this.set('top', position.y);\n    },\n\n    /**\n     * @param {String} to One of 'left', 'center', 'right'\n     */\n    adjustPosition: function(to) {\n      var angle = degreesToRadians(this.angle),\n          hypotFull = this.getScaledWidth(),\n          xFull = fabric.util.cos(angle) * hypotFull,\n          yFull = fabric.util.sin(angle) * hypotFull,\n          offsetFrom, offsetTo;\n\n      //TODO: this function does not consider mixed situation like top, center.\n      if (typeof this.originX === 'string') {\n        offsetFrom = originXOffset[this.originX];\n      }\n      else {\n        offsetFrom = this.originX - 0.5;\n      }\n      if (typeof to === 'string') {\n        offsetTo = originXOffset[to];\n      }\n      else {\n        offsetTo = to - 0.5;\n      }\n      this.left += xFull * (offsetTo - offsetFrom);\n      this.top += yFull * (offsetTo - offsetFrom);\n      this.setCoords();\n      this.originX = to;\n    },\n\n    /**\n     * Sets the origin/position of the object to it's center point\n     * @private\n     * @return {void}\n     */\n    _setOriginToCenter: function() {\n      this._originalOriginX = this.originX;\n      this._originalOriginY = this.originY;\n\n      var center = this.getCenterPoint();\n\n      this.originX = 'center';\n      this.originY = 'center';\n\n      this.left = center.x;\n      this.top = center.y;\n    },\n\n    /**\n     * Resets the origin/position of the object to it's original origin\n     * @private\n     * @return {void}\n     */\n    _resetOrigin: function() {\n      var originPoint = this.translateToOriginPoint(\n        this.getCenterPoint(),\n        this._originalOriginX,\n        this._originalOriginY);\n\n      this.originX = this._originalOriginX;\n      this.originY = this._originalOriginY;\n\n      this.left = originPoint.x;\n      this.top = originPoint.y;\n\n      this._originalOriginX = null;\n      this._originalOriginY = null;\n    },\n\n    /**\n     * @private\n     */\n    _getLeftTopCoords: function() {\n      return this.translateToOriginPoint(this.getCenterPoint(), 'left', 'top');\n    },\n  });\n\n})();\n\n\n(function() {\n\n  function arrayFromCoords(coords) {\n    return [\n      new fabric.Point(coords.tl.x, coords.tl.y),\n      new fabric.Point(coords.tr.x, coords.tr.y),\n      new fabric.Point(coords.br.x, coords.br.y),\n      new fabric.Point(coords.bl.x, coords.bl.y)\n    ];\n  }\n\n  var util = fabric.util,\n      degreesToRadians = util.degreesToRadians,\n      multiplyMatrices = util.multiplyTransformMatrices,\n      transformPoint = util.transformPoint;\n\n  util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Describe object's corner position in canvas element coordinates.\n     * properties are depending on control keys and padding the main controls.\n     * each property is an object with x, y and corner.\n     * The `corner` property contains in a similar manner the 4 points of the\n     * interactive area of the corner.\n     * The coordinates depends from the controls positionHandler and are used\n     * to draw and locate controls\n     * @memberOf fabric.Object.prototype\n     */\n    oCoords: null,\n\n    /**\n     * Describe object's corner position in canvas object absolute coordinates\n     * properties are tl,tr,bl,br and describe the four main corner.\n     * each property is an object with x, y, instance of Fabric.Point.\n     * The coordinates depends from this properties: width, height, scaleX, scaleY\n     * skewX, skewY, angle, strokeWidth, top, left.\n     * Those coordinates are useful to understand where an object is. They get updated\n     * with oCoords but they do not need to be updated when zoom or panning change.\n     * The coordinates get updated with @method setCoords.\n     * You can calculate them without updating with @method calcACoords();\n     * @memberOf fabric.Object.prototype\n     */\n    aCoords: null,\n\n    /**\n     * Describe object's corner position in canvas element coordinates.\n     * includes padding. Used of object detection.\n     * set and refreshed with setCoords and calcCoords.\n     * @memberOf fabric.Object.prototype\n     */\n    lineCoords: null,\n\n    /**\n     * storage for object transform matrix\n     */\n    ownMatrixCache: null,\n\n    /**\n     * storage for object full transform matrix\n     */\n    matrixCache: null,\n\n    /**\n     * custom controls interface\n     * controls are added by default_controls.js\n     */\n    controls: { },\n\n    /**\n     * return correct set of coordinates for intersection\n     * this will return either aCoords or lineCoords.\n     * @param {Boolean} absolute will return aCoords if true or lineCoords\n     * @return {Object} {tl, tr, br, bl} points\n     */\n    _getCoords: function(absolute, calculate) {\n      if (calculate) {\n        return (absolute ? this.calcACoords() : this.calcLineCoords());\n      }\n      if (!this.aCoords || !this.lineCoords) {\n        this.setCoords(true);\n      }\n      return (absolute ? this.aCoords : this.lineCoords);\n    },\n\n    /**\n     * return correct set of coordinates for intersection\n     * this will return either aCoords or lineCoords.\n     * The coords are returned in an array.\n     * @return {Array} [tl, tr, br, bl] of points\n     */\n    getCoords: function(absolute, calculate) {\n      return arrayFromCoords(this._getCoords(absolute, calculate));\n    },\n\n    /**\n     * Checks if object intersects with an area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with an area formed by 2 points\n     */\n    intersectsWithRect: function(pointTL, pointBR, absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate),\n          intersection = fabric.Intersection.intersectPolygonRectangle(\n            coords,\n            pointTL,\n            pointBR\n          );\n      return intersection.status === 'Intersection';\n    },\n\n    /**\n     * Checks if object intersects with another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with another object\n     */\n    intersectsWithObject: function(other, absolute, calculate) {\n      var intersection = fabric.Intersection.intersectPolygonPolygon(\n        this.getCoords(absolute, calculate),\n        other.getCoords(absolute, calculate)\n      );\n\n      return intersection.status === 'Intersection'\n        || other.isContainedWithinObject(this, absolute, calculate)\n        || this.isContainedWithinObject(other, absolute, calculate);\n    },\n\n    /**\n     * Checks if object is fully contained within area of another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area of another object\n     */\n    isContainedWithinObject: function(other, absolute, calculate) {\n      var points = this.getCoords(absolute, calculate),\n          otherCoords = absolute ? other.aCoords : other.lineCoords,\n          i = 0, lines = other._getImageLines(otherCoords);\n      for (; i < 4; i++) {\n        if (!other.containsPoint(points[i], lines)) {\n          return false;\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Checks if object is fully contained within area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area formed by 2 points\n     */\n    isContainedWithinRect: function(pointTL, pointBR, absolute, calculate) {\n      var boundingRect = this.getBoundingRect(absolute, calculate);\n\n      return (\n        boundingRect.left >= pointTL.x &&\n        boundingRect.left + boundingRect.width <= pointBR.x &&\n        boundingRect.top >= pointTL.y &&\n        boundingRect.top + boundingRect.height <= pointBR.y\n      );\n    },\n\n    /**\n     * Checks if point is inside the object\n     * @param {fabric.Point} point Point to check against\n     * @param {Object} [lines] object returned from @method _getImageLines\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if point is inside the object\n     */\n    containsPoint: function(point, lines, absolute, calculate) {\n      var coords = this._getCoords(absolute, calculate),\n          lines = lines || this._getImageLines(coords),\n          xPoints = this._findCrossPoints(point, lines);\n      // if xPoints is odd then point is inside the object\n      return (xPoints !== 0 && xPoints % 2 === 1);\n    },\n\n    /**\n     * Checks if object is contained within the canvas with current viewportTransform\n     * the check is done stopping at first point that appears on screen\n     * @param {Boolean} [calculate] use coordinates of current position instead of .aCoords\n     * @return {Boolean} true if object is fully or partially contained within canvas\n     */\n    isOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      var points = this.getCoords(true, calculate);\n      // if some point is on screen, the object is on screen.\n      if (points.some(function(point) {\n        return point.x <= pointBR.x && point.x >= pointTL.x &&\n        point.y <= pointBR.y && point.y >= pointTL.y;\n      })) {\n        return true;\n      }\n      // no points on screen, check intersection with absolute coordinates\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n        return true;\n      }\n      return this._containsCenterOfCanvas(pointTL, pointBR, calculate);\n    },\n\n    /**\n     * Checks if the object contains the midpoint between canvas extremities\n     * Does not make sense outside the context of isOnScreen and isPartiallyOnScreen\n     * @private\n     * @param {Fabric.Point} pointTL Top Left point\n     * @param {Fabric.Point} pointBR Top Right point\n     * @param {Boolean} calculate use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if the object contains the point\n     */\n    _containsCenterOfCanvas: function(pointTL, pointBR, calculate) {\n      // worst case scenario the object is so big that contains the screen\n      var centerPoint = { x: (pointTL.x + pointBR.x) / 2, y: (pointTL.y + pointBR.y) / 2 };\n      if (this.containsPoint(centerPoint, null, true, calculate)) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Checks if object is partially contained within the canvas with current viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is partially contained within canvas\n     */\n    isPartiallyOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n        return true;\n      }\n      var allPointsAreOutside = this.getCoords(true, calculate).every(function(point) {\n        return (point.x >= pointBR.x || point.x <= pointTL.x) &&\n        (point.y >= pointBR.y || point.y <= pointTL.y);\n      });\n      return allPointsAreOutside && this._containsCenterOfCanvas(pointTL, pointBR, calculate);\n    },\n\n    /**\n     * Method that returns an object with the object edges in it, given the coordinates of the corners\n     * @private\n     * @param {Object} oCoords Coordinates of the object corners\n     */\n    _getImageLines: function(oCoords) {\n\n      var lines = {\n        topline: {\n          o: oCoords.tl,\n          d: oCoords.tr\n        },\n        rightline: {\n          o: oCoords.tr,\n          d: oCoords.br\n        },\n        bottomline: {\n          o: oCoords.br,\n          d: oCoords.bl\n        },\n        leftline: {\n          o: oCoords.bl,\n          d: oCoords.tl\n        }\n      };\n\n      // // debugging\n      // if (this.canvas.contextTop) {\n      //   this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n      // }\n\n      return lines;\n    },\n\n    /**\n     * Helper method to determine how many cross points are between the 4 object edges\n     * and the horizontal line determined by a point on canvas\n     * @private\n     * @param {fabric.Point} point Point to check\n     * @param {Object} lines Coordinates of the object being evaluated\n     */\n    // remove yi, not used but left code here just in case.\n    _findCrossPoints: function(point, lines) {\n      var b1, b2, a1, a2, xi, // yi,\n          xcount = 0,\n          iLine;\n\n      for (var lineKey in lines) {\n        iLine = lines[lineKey];\n        // optimisation 1: line below point. no cross\n        if ((iLine.o.y < point.y) && (iLine.d.y < point.y)) {\n          continue;\n        }\n        // optimisation 2: line above point. no cross\n        if ((iLine.o.y >= point.y) && (iLine.d.y >= point.y)) {\n          continue;\n        }\n        // optimisation 3: vertical line case\n        if ((iLine.o.x === iLine.d.x) && (iLine.o.x >= point.x)) {\n          xi = iLine.o.x;\n          // yi = point.y;\n        }\n        // calculate the intersection point\n        else {\n          b1 = 0;\n          b2 = (iLine.d.y - iLine.o.y) / (iLine.d.x - iLine.o.x);\n          a1 = point.y - b1 * point.x;\n          a2 = iLine.o.y - b2 * iLine.o.x;\n\n          xi = -(a1 - a2) / (b1 - b2);\n          // yi = a1 + b1 * xi;\n        }\n        // dont count xi < point.x cases\n        if (xi >= point.x) {\n          xcount += 1;\n        }\n        // optimisation 4: specific for square images\n        if (xcount === 2) {\n          break;\n        }\n      }\n      return xcount;\n    },\n\n    /**\n     * Returns coordinates of object's bounding rectangle (left, top, width, height)\n     * the box is intended as aligned to axis of canvas.\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords / .aCoords\n     * @return {Object} Object with left, top, width, height properties\n     */\n    getBoundingRect: function(absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate);\n      return util.makeBoundingBoxFromPoints(coords);\n    },\n\n    /**\n     * Returns width of an object's bounding box counting transformations\n     * before 2.0 it was named getWidth();\n     * @return {Number} width value\n     */\n    getScaledWidth: function() {\n      return this._getTransformedDimensions().x;\n    },\n\n    /**\n     * Returns height of an object bounding box counting transformations\n     * before 2.0 it was named getHeight();\n     * @return {Number} height value\n     */\n    getScaledHeight: function() {\n      return this._getTransformedDimensions().y;\n    },\n\n    /**\n     * Makes sure the scale is valid and modifies it if necessary\n     * @private\n     * @param {Number} value\n     * @return {Number}\n     */\n    _constrainScale: function(value) {\n      if (Math.abs(value) < this.minScaleLimit) {\n        if (value < 0) {\n          return -this.minScaleLimit;\n        }\n        else {\n          return this.minScaleLimit;\n        }\n      }\n      else if (value === 0) {\n        return 0.0001;\n      }\n      return value;\n    },\n\n    /**\n     * Scales an object (equally by x and y)\n     * @param {Number} value Scale factor\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scale: function(value) {\n      this._set('scaleX', value);\n      this._set('scaleY', value);\n      return this.setCoords();\n    },\n\n    /**\n     * Scales an object to a given width, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New width value\n     * @param {Boolean} absolute ignore viewport\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToWidth: function(value, absolute) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect(absolute).width / this.getScaledWidth();\n      return this.scale(value / this.width / boundingRectFactor);\n    },\n\n    /**\n     * Scales an object to a given height, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New height value\n     * @param {Boolean} absolute ignore viewport\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToHeight: function(value, absolute) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect(absolute).height / this.getScaledHeight();\n      return this.scale(value / this.height / boundingRectFactor);\n    },\n\n    /**\n     * Calculates and returns the .coords of an object.\n     * unused by the library, only for the end dev.\n     * @return {Object} Object with tl, tr, br, bl ....\n     * @chainable\n     * @deprecated\n     */\n    calcCoords: function(absolute) {\n      // this is a compatibility function to avoid removing calcCoords now.\n      if (absolute) {\n        return this.calcACoords();\n      }\n      return this.calcOCoords();\n    },\n\n    calcLineCoords: function() {\n      var vpt = this.getViewportTransform(),\n          padding = this.padding, angle = degreesToRadians(this.angle),\n          cos = util.cos(angle), sin = util.sin(angle),\n          cosP = cos * padding, sinP = sin * padding, cosPSinP = cosP + sinP,\n          cosPMinusSinP = cosP - sinP, aCoords = this.calcACoords();\n\n      var lineCoords = {\n        tl: transformPoint(aCoords.tl, vpt),\n        tr: transformPoint(aCoords.tr, vpt),\n        bl: transformPoint(aCoords.bl, vpt),\n        br: transformPoint(aCoords.br, vpt),\n      };\n\n      if (padding) {\n        lineCoords.tl.x -= cosPMinusSinP;\n        lineCoords.tl.y -= cosPSinP;\n        lineCoords.tr.x += cosPSinP;\n        lineCoords.tr.y -= cosPMinusSinP;\n        lineCoords.bl.x -= cosPSinP;\n        lineCoords.bl.y += cosPMinusSinP;\n        lineCoords.br.x += cosPMinusSinP;\n        lineCoords.br.y += cosPSinP;\n      }\n\n      return lineCoords;\n    },\n\n    calcOCoords: function() {\n      var rotateMatrix = this._calcRotateMatrix(),\n          translateMatrix = this._calcTranslateMatrix(),\n          vpt = this.getViewportTransform(),\n          startMatrix = multiplyMatrices(vpt, translateMatrix),\n          finalMatrix = multiplyMatrices(startMatrix, rotateMatrix),\n          finalMatrix = multiplyMatrices(finalMatrix, [1 / vpt[0], 0, 0, 1 / vpt[3], 0, 0]),\n          dim = this._calculateCurrentDimensions(),\n          coords = {};\n      this.forEachControl(function(control, key, fabricObject) {\n        coords[key] = control.positionHandler(dim, finalMatrix, fabricObject);\n      });\n\n      // debug code\n      // var canvas = this.canvas;\n      // setTimeout(function() {\n      //   canvas.contextTop.clearRect(0, 0, 700, 700);\n      //   canvas.contextTop.fillStyle = 'green';\n      //   Object.keys(coords).forEach(function(key) {\n      //     var control = coords[key];\n      //     canvas.contextTop.fillRect(control.x, control.y, 3, 3);\n      //   });\n      // }, 50);\n      return coords;\n    },\n\n    calcACoords: function() {\n      var rotateMatrix = this._calcRotateMatrix(),\n          translateMatrix = this._calcTranslateMatrix(),\n          finalMatrix = multiplyMatrices(translateMatrix, rotateMatrix),\n          dim = this._getTransformedDimensions(),\n          w = dim.x / 2, h = dim.y / 2;\n      return {\n        // corners\n        tl: transformPoint({ x: -w, y: -h }, finalMatrix),\n        tr: transformPoint({ x: w, y: -h }, finalMatrix),\n        bl: transformPoint({ x: -w, y: h }, finalMatrix),\n        br: transformPoint({ x: w, y: h }, finalMatrix)\n      };\n    },\n\n    /**\n     * Sets corner and controls position coordinates based on current angle, width and height, left and top.\n     * oCoords are used to find the corners\n     * aCoords are used to quickly find an object on the canvas\n     * lineCoords are used to quickly find object during pointer events.\n     * See {@link https://github.com/kangax/fabric.js/wiki/When-to-call-setCoords|When-to-call-setCoords}\n     * @param {Boolean} [skipCorners] skip calculation of oCoords.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setCoords: function(skipCorners) {\n      this.aCoords = this.calcACoords();\n      // in case we are in a group, for how the inner group target check works,\n      // lineCoords are exactly aCoords. Since the vpt gets absorbed by the normalized pointer.\n      this.lineCoords = this.group ? this.aCoords : this.calcLineCoords();\n      if (skipCorners) {\n        return this;\n      }\n      // set coordinates of the draggable boxes in the corners used to scale/rotate the image\n      this.oCoords = this.calcOCoords();\n      this._setCornerCoords && this._setCornerCoords();\n      return this;\n    },\n\n    /**\n     * calculate rotation matrix of an object\n     * @return {Array} rotation matrix for the object\n     */\n    _calcRotateMatrix: function() {\n      return util.calcRotateMatrix(this);\n    },\n\n    /**\n     * calculate the translation matrix for an object transform\n     * @return {Array} rotation matrix for the object\n     */\n    _calcTranslateMatrix: function() {\n      var center = this.getCenterPoint();\n      return [1, 0, 0, 1, center.x, center.y];\n    },\n\n    transformMatrixKey: function(skipGroup) {\n      var sep = '_', prefix = '';\n      if (!skipGroup && this.group) {\n        prefix = this.group.transformMatrixKey(skipGroup) + sep;\n      };\n      return prefix + this.top + sep + this.left + sep + this.scaleX + sep + this.scaleY +\n        sep + this.skewX + sep + this.skewY + sep + this.angle + sep + this.originX + sep + this.originY +\n        sep + this.width + sep + this.height + sep + this.strokeWidth + this.flipX + this.flipY;\n    },\n\n    /**\n     * calculate transform matrix that represents the current transformations from the\n     * object's properties.\n     * @param {Boolean} [skipGroup] return transform matrix for object not counting parent transformations\n     * There are some situation in which this is useful to avoid the fake rotation.\n     * @return {Array} transform matrix for the object\n     */\n    calcTransformMatrix: function(skipGroup) {\n      var matrix = this.calcOwnMatrix();\n      if (skipGroup || !this.group) {\n        return matrix;\n      }\n      var key = this.transformMatrixKey(skipGroup), cache = this.matrixCache || (this.matrixCache = {});\n      if (cache.key === key) {\n        return cache.value;\n      }\n      if (this.group) {\n        matrix = multiplyMatrices(this.group.calcTransformMatrix(false), matrix);\n      }\n      cache.key = key;\n      cache.value = matrix;\n      return matrix;\n    },\n\n    /**\n     * calculate transform matrix that represents the current transformations from the\n     * object's properties, this matrix does not include the group transformation\n     * @return {Array} transform matrix for the object\n     */\n    calcOwnMatrix: function() {\n      var key = this.transformMatrixKey(true), cache = this.ownMatrixCache || (this.ownMatrixCache = {});\n      if (cache.key === key) {\n        return cache.value;\n      }\n      var tMatrix = this._calcTranslateMatrix(),\n          options = {\n            angle: this.angle,\n            translateX: tMatrix[4],\n            translateY: tMatrix[5],\n            scaleX: this.scaleX,\n            scaleY: this.scaleY,\n            skewX: this.skewX,\n            skewY: this.skewY,\n            flipX: this.flipX,\n            flipY: this.flipY,\n          };\n      cache.key = key;\n      cache.value = util.composeMatrix(options);\n      return cache.value;\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     * @deprecated since 3.4.0, please use fabric.util._calcDimensionsTransformMatrix\n     * not including or including flipX, flipY to emulate the flipping boolean\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _calcDimensionsTransformMatrix: function(skewX, skewY, flipping) {\n      return util.calcDimensionsMatrix({\n        skewX: skewX,\n        skewY: skewY,\n        scaleX: this.scaleX * (flipping && this.flipX ? -1 : 1),\n        scaleY: this.scaleY * (flipping && this.flipY ? -1 : 1)\n      });\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getNonTransformedDimensions: function() {\n      var strokeWidth = this.strokeWidth,\n          w = this.width + strokeWidth,\n          h = this.height + strokeWidth;\n      return { x: w, y: h };\n    },\n\n    /*\n     * Calculate object bounding box dimensions from its properties scale, skew.\n     * @param {Number} skewX, a value to override current skewX\n     * @param {Number} skewY, a value to override current skewY\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getTransformedDimensions: function(skewX, skewY) {\n      if (typeof skewX === 'undefined') {\n        skewX = this.skewX;\n      }\n      if (typeof skewY === 'undefined') {\n        skewY = this.skewY;\n      }\n      var dimensions = this._getNonTransformedDimensions(), dimX, dimY,\n          noSkew = skewX === 0 && skewY === 0;\n\n      if (this.strokeUniform) {\n        dimX = this.width;\n        dimY = this.height;\n      }\n      else {\n        dimX = dimensions.x;\n        dimY = dimensions.y;\n      }\n      if (noSkew) {\n        return this._finalizeDimensions(dimX * this.scaleX, dimY * this.scaleY);\n      }\n      var bbox = util.sizeAfterTransform(dimX, dimY, {\n        scaleX: this.scaleX,\n        scaleY: this.scaleY,\n        skewX: skewX,\n        skewY: skewY,\n      });\n      return this._finalizeDimensions(bbox.x, bbox.y);\n    },\n\n    /*\n     * Calculate object bounding box dimensions from its properties scale, skew.\n     * @param Number width width of the bbox\n     * @param Number height height of the bbox\n     * @private\n     * @return {Object} .x finalized width dimension\n     * @return {Object} .y finalized height dimension\n     */\n    _finalizeDimensions: function(width, height) {\n      return this.strokeUniform ?\n        { x: width + this.strokeWidth, y: height + this.strokeWidth }\n        :\n        { x: width, y: height };\n    },\n\n    /*\n     * Calculate object dimensions for controls box, including padding and canvas zoom.\n     * and active selection\n     * private\n     */\n    _calculateCurrentDimensions: function()  {\n      var vpt = this.getViewportTransform(),\n          dim = this._getTransformedDimensions(),\n          p = transformPoint(dim, vpt, true);\n      return p.scalarAdd(2 * this.padding);\n    },\n  });\n})();\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * Moves an object to the bottom of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendToBack: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendToBack.call(this.group, this);\n    }\n    else if (this.canvas) {\n      this.canvas.sendToBack(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to the top of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringToFront: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringToFront.call(this.group, this);\n    }\n    else if (this.canvas) {\n      this.canvas.bringToFront(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object down in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendBackwards: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, intersecting);\n    }\n    else if (this.canvas) {\n      this.canvas.sendBackwards(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object up in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringForward: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringForward.call(this.group, this, intersecting);\n    }\n    else if (this.canvas) {\n      this.canvas.bringForward(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to specified level in stack of drawn objects\n   * @param {Number} index New position of object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  moveTo: function(index) {\n    if (this.group && this.group.type !== 'activeSelection') {\n      fabric.StaticCanvas.prototype.moveTo.call(this.group, this, index);\n    }\n    else if (this.canvas) {\n      this.canvas.moveTo(this, index);\n    }\n    return this;\n  }\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n  function getSvgColorString(prop, value) {\n    if (!value) {\n      return prop + ': none; ';\n    }\n    else if (value.toLive) {\n      return prop + ': url(#SVGID_' + value.id + '); ';\n    }\n    else {\n      var color = new fabric.Color(value),\n          str = prop + ': ' + color.toRgb() + '; ',\n          opacity = color.getAlpha();\n      if (opacity !== 1) {\n        //change the color in rgb + opacity\n        str += prop + '-opacity: ' + opacity.toString() + '; ';\n      }\n      return str;\n    }\n  }\n\n  var toFixed = fabric.util.toFixed;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n\n      var fillRule = this.fillRule ? this.fillRule : 'nonzero',\n          strokeWidth = this.strokeWidth ? this.strokeWidth : '0',\n          strokeDashArray = this.strokeDashArray ? this.strokeDashArray.join(' ') : 'none',\n          strokeDashOffset = this.strokeDashOffset ? this.strokeDashOffset : '0',\n          strokeLineCap = this.strokeLineCap ? this.strokeLineCap : 'butt',\n          strokeLineJoin = this.strokeLineJoin ? this.strokeLineJoin : 'miter',\n          strokeMiterLimit = this.strokeMiterLimit ? this.strokeMiterLimit : '4',\n          opacity = typeof this.opacity !== 'undefined' ? this.opacity : '1',\n          visibility = this.visible ? '' : ' visibility: hidden;',\n          filter = skipShadow ? '' : this.getSvgFilter(),\n          fill = getSvgColorString('fill', this.fill),\n          stroke = getSvgColorString('stroke', this.stroke);\n\n      return [\n        stroke,\n        'stroke-width: ', strokeWidth, '; ',\n        'stroke-dasharray: ', strokeDashArray, '; ',\n        'stroke-linecap: ', strokeLineCap, '; ',\n        'stroke-dashoffset: ', strokeDashOffset, '; ',\n        'stroke-linejoin: ', strokeLineJoin, '; ',\n        'stroke-miterlimit: ', strokeMiterLimit, '; ',\n        fill,\n        'fill-rule: ', fillRule, '; ',\n        'opacity: ', opacity, ';',\n        filter,\n        visibility\n      ].join('');\n    },\n\n    /**\n     * Returns styles-string for svg-export\n     * @param {Object} style the object from which to retrieve style properties\n     * @param {Boolean} useWhiteSpace a boolean to include an additional attribute in the style.\n     * @return {String}\n     */\n    getSvgSpanStyles: function(style, useWhiteSpace) {\n      var term = '; ';\n      var fontFamily = style.fontFamily ?\n        'font-family: ' + (((style.fontFamily.indexOf('\\'') === -1 && style.fontFamily.indexOf('\"') === -1) ?\n          '\\'' + style.fontFamily  + '\\'' : style.fontFamily)) + term : '';\n      var strokeWidth = style.strokeWidth ? 'stroke-width: ' + style.strokeWidth + term : '',\n          fontFamily = fontFamily,\n          fontSize = style.fontSize ? 'font-size: ' + style.fontSize + 'px' + term : '',\n          fontStyle = style.fontStyle ? 'font-style: ' + style.fontStyle + term : '',\n          fontWeight = style.fontWeight ? 'font-weight: ' + style.fontWeight + term : '',\n          fill = style.fill ? getSvgColorString('fill', style.fill) : '',\n          stroke = style.stroke ? getSvgColorString('stroke', style.stroke) : '',\n          textDecoration = this.getSvgTextDecoration(style),\n          deltaY = style.deltaY ? 'baseline-shift: ' + (-style.deltaY) + '; ' : '';\n      if (textDecoration) {\n        textDecoration = 'text-decoration: ' + textDecoration + term;\n      }\n\n      return [\n        stroke,\n        strokeWidth,\n        fontFamily,\n        fontSize,\n        fontStyle,\n        fontWeight,\n        textDecoration,\n        fill,\n        deltaY,\n        useWhiteSpace ? 'white-space: pre; ' : ''\n      ].join('');\n    },\n\n    /**\n     * Returns text-decoration property for svg-export\n     * @param {Object} style the object from which to retrieve style properties\n     * @return {String}\n     */\n    getSvgTextDecoration: function(style) {\n      return ['overline', 'underline', 'line-through'].filter(function(decoration) {\n        return style[decoration.replace('-', '')];\n      }).join(' ');\n    },\n\n    /**\n     * Returns filter for svg shadow\n     * @return {String}\n     */\n    getSvgFilter: function() {\n      return this.shadow ? 'filter: url(#SVGID_' + this.shadow.id + ');' : '';\n    },\n\n    /**\n     * Returns id attribute for svg output\n     * @return {String}\n     */\n    getSvgCommons: function() {\n      return [\n        this.id ? 'id=\"' + this.id + '\" ' : '',\n        this.clipPath ? 'clip-path=\"url(#' + this.clipPath.clipPathId + ')\" ' : '',\n      ].join('');\n    },\n\n    /**\n     * Returns transform-string for svg-export\n     * @param {Boolean} use the full transform or the single object one.\n     * @return {String}\n     */\n    getSvgTransform: function(full, additionalTransform) {\n      var transform = full ? this.calcTransformMatrix() : this.calcOwnMatrix(),\n          svgTransform = 'transform=\"' + fabric.util.matrixToSVG(transform);\n      return svgTransform +\n        (additionalTransform || '') + '\" ';\n    },\n\n    _setSVGBg: function(textBgRects) {\n      if (this.backgroundColor) {\n        var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n        textBgRects.push(\n          '\\t\\t<rect ',\n          this._getFillAttributes(this.backgroundColor),\n          ' x=\"',\n          toFixed(-this.width / 2, NUM_FRACTION_DIGITS),\n          '\" y=\"',\n          toFixed(-this.height / 2, NUM_FRACTION_DIGITS),\n          '\" width=\"',\n          toFixed(this.width, NUM_FRACTION_DIGITS),\n          '\" height=\"',\n          toFixed(this.height, NUM_FRACTION_DIGITS),\n          '\"></rect>\\n');\n      }\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      return this._createBaseSVGMarkup(this._toSVG(reviver), { reviver: reviver });\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      return '\\t' + this._createBaseClipPathSVGMarkup(this._toSVG(reviver), { reviver: reviver });\n    },\n\n    /**\n     * @private\n     */\n    _createBaseClipPathSVGMarkup: function(objectMarkup, options) {\n      options = options || {};\n      var reviver = options.reviver,\n          additionalTransform = options.additionalTransform || '',\n          commonPieces = [\n            this.getSvgTransform(true, additionalTransform),\n            this.getSvgCommons(),\n          ].join(''),\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf('COMMON_PARTS');\n      objectMarkup[index] = commonPieces;\n      return reviver ? reviver(objectMarkup.join('')) : objectMarkup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _createBaseSVGMarkup: function(objectMarkup, options) {\n      options = options || {};\n      var noStyle = options.noStyle,\n          reviver = options.reviver,\n          styleInfo = noStyle ? '' : 'style=\"' + this.getSvgStyles() + '\" ',\n          shadowInfo = options.withShadow ? 'style=\"' + this.getSvgFilter() + '\" ' : '',\n          clipPath = this.clipPath,\n          vectorEffect = this.strokeUniform ? 'vector-effect=\"non-scaling-stroke\" ' : '',\n          absoluteClipPath = clipPath && clipPath.absolutePositioned,\n          stroke = this.stroke, fill = this.fill, shadow = this.shadow,\n          commonPieces, markup = [], clipPathMarkup,\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf('COMMON_PARTS'),\n          additionalTransform = options.additionalTransform;\n      if (clipPath) {\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\n        clipPathMarkup = '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\n          clipPath.toClipPathSVG(reviver) +\n          '</clipPath>\\n';\n      }\n      if (absoluteClipPath) {\n        markup.push(\n          '<g ', shadowInfo, this.getSvgCommons(), ' >\\n'\n        );\n      }\n      markup.push(\n        '<g ',\n        this.getSvgTransform(false),\n        !absoluteClipPath ? shadowInfo + this.getSvgCommons() : '',\n        ' >\\n'\n      );\n      commonPieces = [\n        styleInfo,\n        vectorEffect,\n        noStyle ? '' : this.addPaintOrder(), ' ',\n        additionalTransform ? 'transform=\"' + additionalTransform + '\" ' : '',\n      ].join('');\n      objectMarkup[index] = commonPieces;\n      if (fill && fill.toLive) {\n        markup.push(fill.toSVG(this));\n      }\n      if (stroke && stroke.toLive) {\n        markup.push(stroke.toSVG(this));\n      }\n      if (shadow) {\n        markup.push(shadow.toSVG(this));\n      }\n      if (clipPath) {\n        markup.push(clipPathMarkup);\n      }\n      markup.push(objectMarkup.join(''));\n      markup.push('</g>\\n');\n      absoluteClipPath && markup.push('</g>\\n');\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n\n    addPaintOrder: function() {\n      return this.paintFirst !== 'fill' ? ' paint-order=\"' + this.paintFirst + '\" ' : '';\n    }\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function() {\n\n  var extend = fabric.util.object.extend,\n      originalSet = 'stateProperties';\n\n  /*\n    Depends on `stateProperties`\n  */\n  function saveProps(origin, destination, props) {\n    var tmpObj = { }, deep = true;\n    props.forEach(function(prop) {\n      tmpObj[prop] = origin[prop];\n    });\n\n    extend(origin[destination], tmpObj, deep);\n  }\n\n  function _isEqual(origValue, currentValue, firstPass) {\n    if (origValue === currentValue) {\n      // if the objects are identical, return\n      return true;\n    }\n    else if (Array.isArray(origValue)) {\n      if (!Array.isArray(currentValue) || origValue.length !== currentValue.length) {\n        return false;\n      }\n      for (var i = 0, len = origValue.length; i < len; i++) {\n        if (!_isEqual(origValue[i], currentValue[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    else if (origValue && typeof origValue === 'object') {\n      var keys = Object.keys(origValue), key;\n      if (!currentValue ||\n          typeof currentValue !== 'object' ||\n          (!firstPass && keys.length !== Object.keys(currentValue).length)\n      ) {\n        return false;\n      }\n      for (var i = 0, len = keys.length; i < len; i++) {\n        key = keys[i];\n        // since clipPath is in the statefull cache list and the clipPath objects\n        // would be iterated as an object, this would lead to possible infinite recursion\n        // we do not want to compare those.\n        if (key === 'canvas' || key === 'group') {\n          continue;\n        }\n        if (!_isEqual(origValue[key], currentValue[key])) {\n          return false;\n        }\n      }\n      return true;\n    }\n  }\n\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Returns true if object state (one of its state properties) was changed\n     * @param {String} [propertySet] optional name for the set of property we want to save\n     * @return {Boolean} true if instance' state has changed since `{@link fabric.Object#saveState}` was called\n     */\n    hasStateChanged: function(propertySet) {\n      propertySet = propertySet || originalSet;\n      var dashedPropertySet = '_' + propertySet;\n      if (Object.keys(this[dashedPropertySet]).length < this[propertySet].length) {\n        return true;\n      }\n      return !_isEqual(this[dashedPropertySet], this, true);\n    },\n\n    /**\n     * Saves state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    saveState: function(options) {\n      var propertySet = options && options.propertySet || originalSet,\n          destination = '_' + propertySet;\n      if (!this[destination]) {\n        return this.setupState(options);\n      }\n      saveProps(this, destination, this[propertySet]);\n      if (options && options.stateProperties) {\n        saveProps(this, destination, options.stateProperties);\n      }\n      return this;\n    },\n\n    /**\n     * Setups state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    setupState: function(options) {\n      options = options || { };\n      var propertySet = options.propertySet || originalSet;\n      options.propertySet = propertySet;\n      this['_' + propertySet] = { };\n      this.saveState(options);\n      return this;\n    }\n  });\n})();\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n    /**\n     * Determines which corner has been clicked\n     * @private\n     * @param {Object} pointer The pointer indicating the mouse position\n     * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found\n     */\n    _findTargetCorner: function(pointer, forTouch) {\n      // objects in group, anykind, are not self modificable,\n      // must not return an hovered corner.\n      if (!this.hasControls || this.group || (!this.canvas || this.canvas._activeObject !== this)) {\n        return false;\n      }\n\n      var ex = pointer.x,\n          ey = pointer.y,\n          xPoints,\n          lines, keys = Object.keys(this.oCoords),\n          j = keys.length - 1, i;\n      this.__corner = 0;\n\n      // cycle in reverse order so we pick first the one on top\n      for (; j >= 0; j--) {\n        i = keys[j];\n        if (!this.isControlVisible(i)) {\n          continue;\n        }\n\n        lines = this._getImageLines(forTouch ? this.oCoords[i].touchCorner : this.oCoords[i].corner);\n        // // debugging\n        //\n        // this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n\n        xPoints = this._findCrossPoints({ x: ex, y: ey }, lines);\n        if (xPoints !== 0 && xPoints % 2 === 1) {\n          this.__corner = i;\n          return i;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Calls a function for each control. The function gets called,\n     * with the control, the object that is calling the iterator and the control's key\n     * @param {Function} fn function to iterate over the controls over\n     */\n    forEachControl: function(fn) {\n      for (var i in this.controls) {\n        fn(this.controls[i], i, this);\n      };\n    },\n\n    /**\n     * Sets the coordinates of the draggable boxes in the corners of\n     * the image used to scale/rotate it.\n     * note: if we would switch to ROUND corner area, all of this would disappear.\n     * everything would resolve to a single point and a pythagorean theorem for the distance\n     * @private\n     */\n    _setCornerCoords: function() {\n      var coords = this.oCoords;\n\n      for (var control in coords) {\n        var controlObject = this.controls[control];\n        coords[control].corner = controlObject.calcCornerCoords(\n          this.angle, this.cornerSize, coords[control].x, coords[control].y, false);\n        coords[control].touchCorner = controlObject.calcCornerCoords(\n          this.angle, this.touchCornerSize, coords[control].x, coords[control].y, true);\n      }\n    },\n\n    /**\n     * Draws a colored layer behind the object, inside its selection borders.\n     * Requires public options: padding, selectionBackgroundColor\n     * this function is called when the context is transformed\n     * has checks to be skipped when the object is on a staticCanvas\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawSelectionBackground: function(ctx) {\n      if (!this.selectionBackgroundColor ||\n        (this.canvas && !this.canvas.interactive) ||\n        (this.canvas && this.canvas._activeObject !== this)\n      ) {\n        return this;\n      }\n      ctx.save();\n      var center = this.getCenterPoint(), wh = this._calculateCurrentDimensions(),\n          vpt = this.canvas.viewportTransform;\n      ctx.translate(center.x, center.y);\n      ctx.scale(1 / vpt[0], 1 / vpt[3]);\n      ctx.rotate(degreesToRadians(this.angle));\n      ctx.fillStyle = this.selectionBackgroundColor;\n      ctx.fillRect(-wh.x / 2, -wh.y / 2, wh.x, wh.y);\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBorders: function(ctx, styleOverride) {\n      styleOverride = styleOverride || {};\n      var wh = this._calculateCurrentDimensions(),\n          strokeWidth = this.borderScaleFactor,\n          width = wh.x + strokeWidth,\n          height = wh.y + strokeWidth,\n          hasControls = typeof styleOverride.hasControls !== 'undefined' ?\n            styleOverride.hasControls : this.hasControls,\n          shouldStroke = false;\n\n      ctx.save();\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray, null);\n\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      if (hasControls) {\n        ctx.beginPath();\n        this.forEachControl(function(control, key, fabricObject) {\n          // in this moment, the ctx is centered on the object.\n          // width and height of the above function are the size of the bbox.\n          if (control.withConnection && control.getVisibility(fabricObject, key)) {\n            // reset movement for each control\n            shouldStroke = true;\n            ctx.moveTo(control.x * width, control.y * height);\n            ctx.lineTo(\n              control.x * width + control.offsetX,\n              control.y * height + control.offsetY\n            );\n          }\n        });\n        if (shouldStroke) {\n          ctx.stroke();\n        }\n      }\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box when it is inside a group.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {object} options object representing current object parameters\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBordersInGroup: function(ctx, options, styleOverride) {\n      styleOverride = styleOverride || {};\n      var bbox = fabric.util.sizeAfterTransform(this.width, this.height, options),\n          strokeWidth = this.strokeWidth,\n          strokeUniform = this.strokeUniform,\n          borderScaleFactor = this.borderScaleFactor,\n          width =\n            bbox.x + strokeWidth * (strokeUniform ? this.canvas.getZoom() : options.scaleX) + borderScaleFactor,\n          height =\n            bbox.y + strokeWidth * (strokeUniform ? this.canvas.getZoom() : options.scaleY) + borderScaleFactor;\n      ctx.save();\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray, null);\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws corners of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: cornerSize, padding\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawControls: function(ctx, styleOverride) {\n      styleOverride = styleOverride || {};\n      ctx.save();\n      ctx.setTransform(this.canvas.getRetinaScaling(), 0, 0, this.canvas.getRetinaScaling(), 0, 0);\n      ctx.strokeStyle = ctx.fillStyle = styleOverride.cornerColor || this.cornerColor;\n      if (!this.transparentCorners) {\n        ctx.strokeStyle = styleOverride.cornerStrokeColor || this.cornerStrokeColor;\n      }\n      this._setLineDash(ctx, styleOverride.cornerDashArray || this.cornerDashArray, null);\n      this.setCoords();\n      this.forEachControl(function(control, key, fabricObject) {\n        if (control.getVisibility(fabricObject, key)) {\n          control.render(ctx,\n            fabricObject.oCoords[key].x,\n            fabricObject.oCoords[key].y, styleOverride, fabricObject);\n        }\n      });\n      ctx.restore();\n\n      return this;\n    },\n\n    /**\n     * Returns true if the specified control is visible, false otherwise.\n     * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @returns {Boolean} true if the specified control is visible, false otherwise\n     */\n    isControlVisible: function(controlKey) {\n      return this.controls[controlKey] && this.controls[controlKey].getVisibility(this, controlKey);\n    },\n\n    /**\n     * Sets the visibility of the specified control.\n     * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @param {Boolean} visible true to set the specified control visible, false otherwise\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlVisible: function(controlKey, visible) {\n      if (!this._controlsVisibility) {\n        this._controlsVisibility = {};\n      }\n      this._controlsVisibility[controlKey] = visible;\n      return this;\n    },\n\n    /**\n     * Sets the visibility state of object controls.\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.bl] true to enable the bottom-left control, false to disable it\n     * @param {Boolean} [options.br] true to enable the bottom-right control, false to disable it\n     * @param {Boolean} [options.mb] true to enable the middle-bottom control, false to disable it\n     * @param {Boolean} [options.ml] true to enable the middle-left control, false to disable it\n     * @param {Boolean} [options.mr] true to enable the middle-right control, false to disable it\n     * @param {Boolean} [options.mt] true to enable the middle-top control, false to disable it\n     * @param {Boolean} [options.tl] true to enable the top-left control, false to disable it\n     * @param {Boolean} [options.tr] true to enable the top-right control, false to disable it\n     * @param {Boolean} [options.mtr] true to enable the middle-top-rotate control, false to disable it\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlsVisibility: function(options) {\n      options || (options = { });\n\n      for (var p in options) {\n        this.setControlVisible(p, options[p]);\n      }\n      return this;\n    },\n\n\n    /**\n     * This callback function is called every time _discardActiveObject or _setActiveObject\n     * try to to deselect this object. If the function returns true, the process is cancelled\n     * @param {Object} [options] options sent from the upper functions\n     * @param {Event} [options.e] event if the process is generated by an event\n     */\n    onDeselect: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n\n    /**\n     * This callback function is called every time _discardActiveObject or _setActiveObject\n     * try to to select this object. If the function returns true, the process is cancelled\n     * @param {Object} [options] options sent from the upper functions\n     * @param {Event} [options.e] event if the process is generated by an event\n     */\n    onSelect: function() {\n      // implemented by sub-classes, as needed.\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Animation duration (in ms) for fx* methods\n   * @type Number\n   * @default\n   */\n  FX_DURATION: 500,\n\n  /**\n   * Centers object horizontally with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectH: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.left,\n      endValue: this.getCenter().left,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('left', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Centers object vertically with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxCenterObjectV: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.top,\n      endValue: this.getCenter().top,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('top', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n\n    return this;\n  },\n\n  /**\n   * Same as `fabric.Canvas#remove` but animated\n   * @param {fabric.Object} object Object to remove\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxRemove: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: object.opacity,\n      endValue: 0,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('opacity', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function () {\n        _this.remove(object);\n        onComplete();\n      }\n    });\n\n    return this;\n  }\n});\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n  /**\n   * Animates object's properties\n   * @param {String|Object} property Property to animate (if string) or properties to animate (if object)\n   * @param {Number|Object} value Value to animate property to (if string was given first) or options object\n   * @return {fabric.Object} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#animation}\n   * @chainable\n   *\n   * As object  multiple properties\n   *\n   * object.animate({ left: ..., top: ... });\n   * object.animate({ left: ..., top: ... }, { duration: ... });\n   *\n   * As string  one property\n   *\n   * object.animate('left', ...);\n   * object.animate('left', { duration: ... });\n   *\n   */\n  animate: function() {\n    if (arguments[0] && typeof arguments[0] === 'object') {\n      var propsToAnimate = [], prop, skipCallbacks;\n      for (prop in arguments[0]) {\n        propsToAnimate.push(prop);\n      }\n      for (var i = 0, len = propsToAnimate.length; i < len; i++) {\n        prop = propsToAnimate[i];\n        skipCallbacks = i !== len - 1;\n        this._animate(prop, arguments[0][prop], arguments[1], skipCallbacks);\n      }\n    }\n    else {\n      this._animate.apply(this, arguments);\n    }\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to animate\n   * @param {String} to Value to animate to\n   * @param {Object} [options] Options object\n   * @param {Boolean} [skipCallbacks] When true, callbacks like onchange and oncomplete are not invoked\n   */\n  _animate: function(property, to, options, skipCallbacks) {\n    var _this = this, propPair;\n\n    to = to.toString();\n\n    if (!options) {\n      options = { };\n    }\n    else {\n      options = fabric.util.object.clone(options);\n    }\n\n    if (~property.indexOf('.')) {\n      propPair = property.split('.');\n    }\n\n    var propIsColor =\n      _this.colorProperties.indexOf(property) > -1 ||\n      (propPair && _this.colorProperties.indexOf(propPair[1]) > -1);\n\n    var currentValue = propPair\n      ? this.get(propPair[0])[propPair[1]]\n      : this.get(property);\n\n    if (!('from' in options)) {\n      options.from = currentValue;\n    }\n\n    if (!propIsColor) {\n      if (~to.indexOf('=')) {\n        to = currentValue + parseFloat(to.replace('=', ''));\n      }\n      else {\n        to = parseFloat(to);\n      }\n    }\n\n    var _options = {\n      startValue: options.from,\n      endValue: to,\n      byValue: options.by,\n      easing: options.easing,\n      duration: options.duration,\n      abort: options.abort && function () {\n        return options.abort.call(_this);\n      },\n      onChange: function (value, valueProgress, timeProgress) {\n        if (propPair) {\n          _this[propPair[0]][propPair[1]] = value;\n        }\n        else {\n          _this.set(property, value);\n        }\n        if (skipCallbacks) {\n          return;\n        }\n        options.onChange && options.onChange(value, valueProgress, timeProgress);\n      },\n      onComplete: function (value, valueProgress, timeProgress) {\n        if (skipCallbacks) {\n          return;\n        }\n\n        _this.setCoords();\n        options.onComplete && options.onComplete(value, valueProgress, timeProgress);\n      }\n    };\n\n    if (propIsColor) {\n      fabric.util.animateColor(_options.startValue, _options.endValue, _options.duration, _options);\n    }\n    else {\n      fabric.util.animate(_options);\n    }\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      coordProps = { x1: 1, x2: 1, y1: 1, y2: 1 },\n      supportsLineDash = fabric.StaticCanvas.supports('setLineDash');\n\n  if (fabric.Line) {\n    fabric.warn('fabric.Line is already defined');\n    return;\n  }\n\n  /**\n   * Line class\n   * @class fabric.Line\n   * @extends fabric.Object\n   * @see {@link fabric.Line#initialize} for constructor definition\n   */\n  fabric.Line = fabric.util.createClass(fabric.Object, /** @lends fabric.Line.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'line',\n\n    /**\n     * x value or first line edge\n     * @type Number\n     * @default\n     */\n    x1: 0,\n\n    /**\n     * y value or first line edge\n     * @type Number\n     * @default\n     */\n    y1: 0,\n\n    /**\n     * x value or second line edge\n     * @type Number\n     * @default\n     */\n    x2: 0,\n\n    /**\n     * y value or second line edge\n     * @type Number\n     * @default\n     */\n    y2: 0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('x1', 'x2', 'y1', 'y2'),\n\n    /**\n     * Constructor\n     * @param {Array} [points] Array of points\n     * @param {Object} [options] Options object\n     * @return {fabric.Line} thisArg\n     */\n    initialize: function(points, options) {\n      if (!points) {\n        points = [0, 0, 0, 0];\n      }\n\n      this.callSuper('initialize', options);\n\n      this.set('x1', points[0]);\n      this.set('y1', points[1]);\n      this.set('x2', points[2]);\n      this.set('y2', points[3]);\n\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n\n      this.width = Math.abs(this.x2 - this.x1);\n      this.height = Math.abs(this.y2 - this.y1);\n\n      this.left = 'left' in options\n        ? options.left\n        : this._getLeftToOriginX();\n\n      this.top = 'top' in options\n        ? options.top\n        : this._getTopToOriginY();\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      if (typeof coordProps[key] !== 'undefined') {\n        this._setWidthHeight();\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @return {Number} leftToOriginX Distance from left edge of canvas to originX of Line.\n     */\n    _getLeftToOriginX: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originX',\n        axis1: 'x1',\n        axis2: 'x2',\n        dimension: 'width'\n      },\n      { // possible values of origin\n        nearest: 'left',\n        center: 'center',\n        farthest: 'right'\n      }\n    ),\n\n    /**\n     * @private\n     * @return {Number} topToOriginY Distance from top edge of canvas to originY of Line.\n     */\n    _getTopToOriginY: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originY',\n        axis1: 'y1',\n        axis2: 'y2',\n        dimension: 'height'\n      },\n      { // possible values of origin\n        nearest: 'top',\n        center: 'center',\n        farthest: 'bottom'\n      }\n    ),\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n\n      if (!this.strokeDashArray || this.strokeDashArray && supportsLineDash) {\n        // move from center (of virtual box) to its left/top corner\n        // we can't assume x1, y1 is top left and x2, y2 is bottom right\n        var p = this.calcLinePoints();\n        ctx.moveTo(p.x1, p.y1);\n        ctx.lineTo(p.x2, p.y2);\n      }\n\n      ctx.lineWidth = this.strokeWidth;\n\n      // TODO: test this\n      // make sure setting \"fill\" changes color of a line\n      // (by copying fillStyle to strokeStyle, since line is stroked, not filled)\n      var origStrokeStyle = ctx.strokeStyle;\n      ctx.strokeStyle = this.stroke || ctx.fillStyle;\n      this.stroke && this._renderStroke(ctx);\n      ctx.strokeStyle = origStrokeStyle;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var p = this.calcLinePoints();\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, p.x1, p.y1, p.x2, p.y2, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /**\n     * This function is an helper for svg import. it returns the center of the object in the svg\n     * untransformed coordinates\n     * @private\n     * @return {Object} center point from element coordinates\n     */\n    _findCenterFromElement: function() {\n      return {\n        x: (this.x1 + this.x2) / 2,\n        y: (this.y1 + this.y2) / 2,\n      };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), this.calcLinePoints());\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     */\n    _getNonTransformedDimensions: function() {\n      var dim = this.callSuper('_getNonTransformedDimensions');\n      if (this.strokeLineCap === 'butt') {\n        if (this.width === 0) {\n          dim.y -= this.strokeWidth;\n        }\n        if (this.height === 0) {\n          dim.x -= this.strokeWidth;\n        }\n      }\n      return dim;\n    },\n\n    /**\n     * Recalculates line points given width and height\n     * @private\n     */\n    calcLinePoints: function() {\n      var xMult = this.x1 <= this.x2 ? -1 : 1,\n          yMult = this.y1 <= this.y2 ? -1 : 1,\n          x1 = (xMult * this.width * 0.5),\n          y1 = (yMult * this.height * 0.5),\n          x2 = (xMult * this.width * -0.5),\n          y2 = (yMult * this.height * -0.5);\n\n      return {\n        x1: x1,\n        x2: x2,\n        y1: y1,\n        y2: y2\n      };\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var p = this.calcLinePoints();\n      return [\n        '<line ', 'COMMON_PARTS',\n        'x1=\"', p.x1,\n        '\" y1=\"', p.y1,\n        '\" x2=\"', p.x2,\n        '\" y2=\"', p.y2,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Line.fromElement})\n   * @static\n   * @memberOf fabric.Line\n   * @see http://www.w3.org/TR/SVG/shapes.html#LineElement\n   */\n  fabric.Line.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));\n\n  /**\n   * Returns fabric.Line instance from an SVG element\n   * @static\n   * @memberOf fabric.Line\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] callback function invoked after parsing\n   */\n  fabric.Line.fromElement = function(element, callback, options) {\n    options = options || { };\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Line.ATTRIBUTE_NAMES),\n        points = [\n          parsedAttributes.x1 || 0,\n          parsedAttributes.y1 || 0,\n          parsedAttributes.x2 || 0,\n          parsedAttributes.y2 || 0\n        ];\n    callback(new fabric.Line(points, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Line instance from an object representation\n   * @static\n   * @memberOf fabric.Line\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Line.fromObject = function(object, callback) {\n    function _callback(instance) {\n      delete instance.points;\n      callback && callback(instance);\n    };\n    var options = clone(object, true);\n    options.points = [object.x1, object.y1, object.x2, object.y2];\n    fabric.Object._fromObject('Line', options, _callback, 'points');\n  };\n\n  /**\n   * Produces a function that calculates distance from canvas edge to Line origin.\n   */\n  function makeEdgeToOriginGetter(propertyNames, originValues) {\n    var origin = propertyNames.origin,\n        axis1 = propertyNames.axis1,\n        axis2 = propertyNames.axis2,\n        dimension = propertyNames.dimension,\n        nearest = originValues.nearest,\n        center = originValues.center,\n        farthest = originValues.farthest;\n\n    return function() {\n      switch (this.get(origin)) {\n        case nearest:\n          return Math.min(this.get(axis1), this.get(axis2));\n        case center:\n          return Math.min(this.get(axis1), this.get(axis2)) + (0.5 * this.get(dimension));\n        case farthest:\n          return Math.max(this.get(axis1), this.get(axis2));\n      }\n    };\n\n  }\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      pi = Math.PI;\n\n  if (fabric.Circle) {\n    fabric.warn('fabric.Circle is already defined.');\n    return;\n  }\n\n  /**\n   * Circle class\n   * @class fabric.Circle\n   * @extends fabric.Object\n   * @see {@link fabric.Circle#initialize} for constructor definition\n   */\n  fabric.Circle = fabric.util.createClass(fabric.Object, /** @lends fabric.Circle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'circle',\n\n    /**\n     * Radius of this circle\n     * @type Number\n     * @default\n     */\n    radius: 0,\n\n    /**\n     * Start angle of the circle, moving clockwise\n     * deprecated type, this should be in degree, this was an oversight.\n     * probably will change to degrees in next major version\n     * @type Number\n     * @default 0\n     */\n    startAngle: 0,\n\n    /**\n     * End angle of the circle\n     * deprecated type, this should be in degree, this was an oversight.\n     * probably will change to degrees in next major version\n     * @type Number\n     * @default 2Pi\n     */\n    endAngle: pi * 2,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('radius', 'startAngle', 'endAngle'),\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Circle} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n\n      if (key === 'radius') {\n        this.setRadius(value);\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['radius', 'startAngle', 'endAngle'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var svgString, x = 0, y = 0,\n          angle = (this.endAngle - this.startAngle) % ( 2 * pi);\n\n      if (angle === 0) {\n        svgString = [\n          '<circle ', 'COMMON_PARTS',\n          'cx=\"' + x + '\" cy=\"' + y + '\" ',\n          'r=\"', this.radius,\n          '\" />\\n'\n        ];\n      }\n      else {\n        var startX = fabric.util.cos(this.startAngle) * this.radius,\n            startY = fabric.util.sin(this.startAngle) * this.radius,\n            endX = fabric.util.cos(this.endAngle) * this.radius,\n            endY = fabric.util.sin(this.endAngle) * this.radius,\n            largeFlag = angle > pi ? '1' : '0';\n        svgString = [\n          '<path d=\"M ' + startX + ' ' + startY,\n          ' A ' + this.radius + ' ' + this.radius,\n          ' 0 ', +largeFlag + ' 1', ' ' + endX + ' ' + endY,\n          '\" ', 'COMMON_PARTS', ' />\\n'\n        ];\n      }\n      return svgString;\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n      ctx.arc(\n        0,\n        0,\n        this.radius,\n        this.startAngle,\n        this.endAngle, false);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusX: function() {\n      return this.get('radius') * this.get('scaleX');\n    },\n\n    /**\n     * Returns vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusY: function() {\n      return this.get('radius') * this.get('scaleY');\n    },\n\n    /**\n     * Sets radius of an object (and updates width accordingly)\n     * @return {fabric.Circle} thisArg\n     */\n    setRadius: function(value) {\n      this.radius = value;\n      return this.set('width', value * 2).set('height', value * 2);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})\n   * @static\n   * @memberOf fabric.Circle\n   * @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement\n   */\n  fabric.Circle.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));\n\n  /**\n   * Returns {@link fabric.Circle} instance from an SVG element\n   * @static\n   * @memberOf fabric.Circle\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @param {Object} [options] Options object\n   * @throws {Error} If value of `r` attribute is missing or invalid\n   */\n  fabric.Circle.fromElement = function(element, callback) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Circle.ATTRIBUTE_NAMES);\n\n    if (!isValidRadius(parsedAttributes)) {\n      throw new Error('value of `r` attribute is required and can not be negative');\n    }\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.radius;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.radius;\n    callback(new fabric.Circle(parsedAttributes));\n  };\n\n  /**\n   * @private\n   */\n  function isValidRadius(attributes) {\n    return (('radius' in attributes) && (attributes.radius >= 0));\n  }\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Circle} instance from an object representation\n   * @static\n   * @memberOf fabric.Circle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {Object} Instance of fabric.Circle\n   */\n  fabric.Circle.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Circle', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Triangle) {\n    fabric.warn('fabric.Triangle is already defined');\n    return;\n  }\n\n  /**\n   * Triangle class\n   * @class fabric.Triangle\n   * @extends fabric.Object\n   * @return {fabric.Triangle} thisArg\n   * @see {@link fabric.Triangle#initialize} for constructor definition\n   */\n  fabric.Triangle = fabric.util.createClass(fabric.Object, /** @lends fabric.Triangle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'triangle',\n\n    /**\n     * Width is set to 100 to compensate the old initialize code that was setting it to 100\n     * @type Number\n     * @default\n     */\n    width: 100,\n\n    /**\n     * Height is set to 100 to compensate the old initialize code that was setting it to 100\n     * @type Number\n     * @default\n     */\n    height: 100,\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      ctx.moveTo(-widthBy2, heightBy2);\n      ctx.lineTo(0, -heightBy2);\n      ctx.lineTo(widthBy2, heightBy2);\n      ctx.closePath();\n\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, -widthBy2, heightBy2, 0, -heightBy2, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, 0, -heightBy2, widthBy2, heightBy2, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, widthBy2, heightBy2, -widthBy2, heightBy2, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2,\n          points = [\n            -widthBy2 + ' ' + heightBy2,\n            '0 ' + -heightBy2,\n            widthBy2 + ' ' + heightBy2\n          ].join(',');\n      return [\n        '<polygon ', 'COMMON_PARTS',\n        'points=\"', points,\n        '\" />'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Triangle} instance from an object representation\n   * @static\n   * @memberOf fabric.Triangle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Triangle.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Triangle', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      piBy2   = Math.PI * 2;\n\n  if (fabric.Ellipse) {\n    fabric.warn('fabric.Ellipse is already defined.');\n    return;\n  }\n\n  /**\n   * Ellipse class\n   * @class fabric.Ellipse\n   * @extends fabric.Object\n   * @return {fabric.Ellipse} thisArg\n   * @see {@link fabric.Ellipse#initialize} for constructor definition\n   */\n  fabric.Ellipse = fabric.util.createClass(fabric.Object, /** @lends fabric.Ellipse.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'ellipse',\n\n    /**\n     * Horizontal radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {fabric.Ellipse} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this.set('rx', options && options.rx || 0);\n      this.set('ry', options && options.ry || 0);\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Ellipse} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      switch (key) {\n\n        case 'rx':\n          this.rx = value;\n          this.set('width', value * 2);\n          break;\n\n        case 'ry':\n          this.ry = value;\n          this.set('height', value * 2);\n          break;\n\n      }\n      return this;\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRx: function() {\n      return this.get('rx') * this.get('scaleX');\n    },\n\n    /**\n     * Returns Vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRy: function() {\n      return this.get('ry') * this.get('scaleY');\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      return [\n        '<ellipse ', 'COMMON_PARTS',\n        'cx=\"0\" cy=\"0\" ',\n        'rx=\"', this.rx,\n        '\" ry=\"', this.ry,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n      ctx.save();\n      ctx.transform(1, 0, 0, this.ry / this.rx, 0, 0);\n      ctx.arc(\n        0,\n        0,\n        this.rx,\n        0,\n        piBy2,\n        false);\n      ctx.restore();\n      this._renderPaintInOrder(ctx);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})\n   * @static\n   * @memberOf fabric.Ellipse\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\n   */\n  fabric.Ellipse.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an SVG element\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromElement = function(element, callback) {\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Ellipse.ATTRIBUTE_NAMES);\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.rx;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.ry;\n    callback(new fabric.Ellipse(parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an object representation\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Ellipse', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.Rect) {\n    fabric.warn('fabric.Rect is already defined');\n    return;\n  }\n\n  /**\n   * Rectangle class\n   * @class fabric.Rect\n   * @extends fabric.Object\n   * @return {fabric.Rect} thisArg\n   * @see {@link fabric.Rect#initialize} for constructor definition\n   */\n  fabric.Rect = fabric.util.createClass(fabric.Object, /** @lends fabric.Rect.prototype */ {\n\n    /**\n     * List of properties to consider when checking if state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('rx', 'ry'),\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'rect',\n\n    /**\n     * Horizontal border radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical border radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this._initRxRy();\n    },\n\n    /**\n     * Initializes rx/ry attributes\n     * @private\n     */\n    _initRxRy: function() {\n      if (this.rx && !this.ry) {\n        this.ry = this.rx;\n      }\n      else if (this.ry && !this.rx) {\n        this.rx = this.ry;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n\n      // 1x1 case (used in spray brush) optimization was removed because\n      // with caching and higher zoom level this makes more damage than help\n\n      var rx = this.rx ? Math.min(this.rx, this.width / 2) : 0,\n          ry = this.ry ? Math.min(this.ry, this.height / 2) : 0,\n          w = this.width,\n          h = this.height,\n          x = -this.width / 2,\n          y = -this.height / 2,\n          isRounded = rx !== 0 || ry !== 0,\n          /* \"magic number\" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */\n          k = 1 - 0.5522847498;\n      ctx.beginPath();\n\n      ctx.moveTo(x + rx, y);\n\n      ctx.lineTo(x + w - rx, y);\n      isRounded && ctx.bezierCurveTo(x + w - k * rx, y, x + w, y + k * ry, x + w, y + ry);\n\n      ctx.lineTo(x + w, y + h - ry);\n      isRounded && ctx.bezierCurveTo(x + w, y + h - k * ry, x + w - k * rx, y + h, x + w - rx, y + h);\n\n      ctx.lineTo(x + rx, y + h);\n      isRounded && ctx.bezierCurveTo(x + k * rx, y + h, x, y + h - k * ry, x, y + h - ry);\n\n      ctx.lineTo(x, y + ry);\n      isRounded && ctx.bezierCurveTo(x, y + k * ry, x + k * rx, y, x + rx, y);\n\n      ctx.closePath();\n\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y, x + w, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y + h, x, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n      ctx.closePath();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var x = -this.width / 2, y = -this.height / 2;\n      return [\n        '<rect ', 'COMMON_PARTS',\n        'x=\"', x, '\" y=\"', y,\n        '\" rx=\"', this.rx, '\" ry=\"', this.ry,\n        '\" width=\"', this.width, '\" height=\"', this.height,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)\n   * @static\n   * @memberOf fabric.Rect\n   * @see: http://www.w3.org/TR/SVG/shapes.html#RectElement\n   */\n  fabric.Rect.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));\n\n  /**\n   * Returns {@link fabric.Rect} instance from an SVG element\n   * @static\n   * @memberOf fabric.Rect\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Rect.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n    options = options || { };\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Rect.ATTRIBUTE_NAMES);\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top  = parsedAttributes.top  || 0;\n    parsedAttributes.height  = parsedAttributes.height || 0;\n    parsedAttributes.width  = parsedAttributes.width || 0;\n    var rect = new fabric.Rect(extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n    rect.visible = rect.visible && rect.width > 0 && rect.height > 0;\n    callback(rect);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Rect} instance from an object representation\n   * @static\n   * @memberOf fabric.Rect\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Rect instance is created\n   */\n  fabric.Rect.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Rect', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Polyline) {\n    fabric.warn('fabric.Polyline is already defined');\n    return;\n  }\n\n  /**\n   * Polyline class\n   * @class fabric.Polyline\n   * @extends fabric.Object\n   * @see {@link fabric.Polyline#initialize} for constructor definition\n   */\n  fabric.Polyline = fabric.util.createClass(fabric.Object, /** @lends fabric.Polyline.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polyline',\n\n    /**\n     * Points array\n     * @type Array\n     * @default\n     */\n    points: null,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('points'),\n\n    /**\n     * Constructor\n     * @param {Array} points Array of points (where each point is an object with x and y)\n     * @param {Object} [options] Options object\n     * @return {fabric.Polyline} thisArg\n     * @example\n     * var poly = new fabric.Polyline([\n     *     { x: 10, y: 10 },\n     *     { x: 50, y: 30 },\n     *     { x: 40, y: 70 },\n     *     { x: 60, y: 50 },\n     *     { x: 100, y: 150 },\n     *     { x: 40, y: 100 }\n     *   ], {\n     *   stroke: 'red',\n     *   left: 100,\n     *   top: 100\n     * });\n     */\n    initialize: function(points, options) {\n      options = options || {};\n      this.points = points || [];\n      this.callSuper('initialize', options);\n      this._setPositionDimensions(options);\n    },\n\n    _setPositionDimensions: function(options) {\n      var calcDim = this._calcDimensions(options), correctLeftTop;\n      this.width = calcDim.width;\n      this.height = calcDim.height;\n      if (!options.fromSVG) {\n        correctLeftTop = this.translateToGivenOrigin(\n          { x: calcDim.left - this.strokeWidth / 2, y: calcDim.top - this.strokeWidth / 2 },\n          'left',\n          'top',\n          this.originX,\n          this.originY\n        );\n      }\n      if (typeof options.left === 'undefined') {\n        this.left = options.fromSVG ? calcDim.left : correctLeftTop.x;\n      }\n      if (typeof options.top === 'undefined') {\n        this.top = options.fromSVG ? calcDim.top : correctLeftTop.y;\n      }\n      this.pathOffset = {\n        x: calcDim.left + this.width / 2,\n        y: calcDim.top + this.height / 2\n      };\n    },\n\n    /**\n     * Calculate the polygon min and max point from points array,\n     * returning an object with left, top, width, height to measure the\n     * polygon size\n     * @return {Object} object.left X coordinate of the polygon leftmost point\n     * @return {Object} object.top Y coordinate of the polygon topmost point\n     * @return {Object} object.width distance between X coordinates of the polygon leftmost and rightmost point\n     * @return {Object} object.height distance between Y coordinates of the polygon topmost and bottommost point\n     * @private\n     */\n    _calcDimensions: function() {\n\n      var points = this.points,\n          minX = min(points, 'x') || 0,\n          minY = min(points, 'y') || 0,\n          maxX = max(points, 'x') || 0,\n          maxY = max(points, 'y') || 0,\n          width = (maxX - minX),\n          height = (maxY - minY);\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height\n      };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        points: this.points.concat()\n      });\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var points = [], diffX = this.pathOffset.x, diffY = this.pathOffset.y,\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        points.push(\n          toFixed(this.points[i].x - diffX, NUM_FRACTION_DIGITS), ',',\n          toFixed(this.points[i].y - diffY, NUM_FRACTION_DIGITS), ' '\n        );\n      }\n      return [\n        '<' + this.type + ' ', 'COMMON_PARTS',\n        'points=\"', points.join(''),\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    commonRender: function(ctx) {\n      var point, len = this.points.length,\n          x = this.pathOffset.x,\n          y = this.pathOffset.y;\n\n      if (!len || isNaN(this.points[len - 1].y)) {\n        // do not draw if no points or odd points\n        // NaN comes from parseFloat of a empty string in parser\n        return false;\n      }\n      ctx.beginPath();\n      ctx.moveTo(this.points[0].x - x, this.points[0].y - y);\n      for (var i = 0; i < len; i++) {\n        point = this.points[i];\n        ctx.lineTo(point.x - x, point.y - y);\n      }\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (!this.commonRender(ctx)) {\n        return;\n      }\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var p1, p2;\n\n      ctx.beginPath();\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        p1 = this.points[i];\n        p2 = this.points[i + 1] || p1;\n        fabric.util.drawDashedLine(ctx, p1.x, p1.y, p2.x, p2.y, this.strokeDashArray);\n      }\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.get('points').length;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Polyline.fromElement})\n   * @static\n   * @memberOf fabric.Polyline\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement\n   */\n  fabric.Polyline.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns fabric.Polyline instance from an SVG element\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {SVGElement} element Element to parser\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polyline.fromElementGenerator = function(_class) {\n    return function(element, callback, options) {\n      if (!element) {\n        return callback(null);\n      }\n      options || (options = { });\n\n      var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n          parsedAttributes = fabric.parseAttributes(element, fabric[_class].ATTRIBUTE_NAMES);\n      parsedAttributes.fromSVG = true;\n      callback(new fabric[_class](points, extend(parsedAttributes, options)));\n    };\n  };\n\n  fabric.Polyline.fromElement = fabric.Polyline.fromElementGenerator('Polyline');\n\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polyline instance from an object representation\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Polyline.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Polyline', object, callback, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Polygon) {\n    fabric.warn('fabric.Polygon is already defined');\n    return;\n  }\n\n  /**\n   * Polygon class\n   * @class fabric.Polygon\n   * @extends fabric.Polyline\n   * @see {@link fabric.Polygon#initialize} for constructor definition\n   */\n  fabric.Polygon = fabric.util.createClass(fabric.Polyline, /** @lends fabric.Polygon.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polygon',\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (!this.commonRender(ctx)) {\n        return;\n      }\n      ctx.closePath();\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      this.callSuper('_renderDashedStroke', ctx);\n      ctx.closePath();\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)\n   * @static\n   * @memberOf fabric.Polygon\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement\n   */\n  fabric.Polygon.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns {@link fabric.Polygon} instance from an SVG element\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polygon.fromElement = fabric.Polyline.fromElementGenerator('Polygon');\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polygon instance from an object representation\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Polygon.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Polygon', object, callback, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      extend = fabric.util.object.extend,\n      _toString = Object.prototype.toString,\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Path) {\n    fabric.warn('fabric.Path is already defined');\n    return;\n  }\n\n  /**\n   * Path class\n   * @class fabric.Path\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\n   * @see {@link fabric.Path#initialize} for constructor definition\n   */\n  fabric.Path = fabric.util.createClass(fabric.Object, /** @lends fabric.Path.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'path',\n\n    /**\n     * Array of path points\n     * @type Array\n     * @default\n     */\n    path: null,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('path', 'fillRule'),\n\n    stateProperties: fabric.Object.prototype.stateProperties.concat('path'),\n\n    /**\n     * Constructor\n     * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n     * @param {Object} [options] Options object\n     * @return {fabric.Path} thisArg\n     */\n    initialize: function(path, options) {\n      options = options || { };\n      this.callSuper('initialize', options);\n      if (!path) {\n        path = [];\n      }\n\n      var fromArray = _toString.call(path) === '[object Array]';\n\n      this.path = fromArray\n        ? fabric.util.makePathSimpler(path)\n\n        : fabric.util.makePathSimpler(\n          fabric.util.parsePath(path)\n        );\n\n      if (!this.path) {\n        return;\n      }\n      fabric.Polyline.prototype._setPositionDimensions.call(this, options);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _renderPathCommands: function(ctx) {\n      var current, // current instruction\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          l = -this.pathOffset.x,\n          t = -this.pathOffset.y;\n\n      ctx.beginPath();\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            x = current[5];\n            y = current[6];\n            controlX = current[3];\n            controlY = current[4];\n            ctx.bezierCurveTo(\n              current[1] + l,\n              current[2] + t,\n              controlX + l,\n              controlY + t,\n              x + l,\n              y + t\n            );\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            ctx.quadraticCurveTo(\n              current[1] + l,\n              current[2] + t,\n              current[3] + l,\n              current[4] + t\n            );\n            x = current[3];\n            y = current[4];\n            controlX = current[1];\n            controlY = current[2];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            ctx.closePath();\n            break;\n        }\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _render: function(ctx) {\n      this._renderPathCommands(ctx);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Path (' + this.complexity() +\n        '): { \"top\": ' + this.top + ', \"left\": ' + this.left + ' }>';\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        path: this.path.map(function(item) { return item.slice(); }),\n      });\n    },\n\n    /**\n     * Returns dataless object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var o = this.toObject(['sourcePath'].concat(propertiesToInclude));\n      if (o.sourcePath) {\n        delete o.path;\n      }\n      return o;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var path = this.path.map(function(path) {\n        return path.join(' ');\n      }).join(' ');\n      return [\n        '<path ', 'COMMON_PARTS',\n        'd=\"', path,\n        '\" stroke-linecap=\"round\" ',\n        '/>\\n'\n      ];\n    },\n\n    _getOffsetTransform: function() {\n      var digits = fabric.Object.NUM_FRACTION_DIGITS;\n      return ' translate(' + toFixed(-this.pathOffset.x, digits) + ', ' +\n          toFixed(-this.pathOffset.y, digits) + ')';\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      var additionalTransform = this._getOffsetTransform();\n      return '\\t' + this._createBaseClipPathSVGMarkup(\n        this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform }\n      );\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var additionalTransform = this._getOffsetTransform();\n      return this._createBaseSVGMarkup(this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform  });\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns number representation of an instance complexity\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.path.length;\n    },\n\n    /**\n     * @private\n     */\n    _calcDimensions: function() {\n\n      var aX = [],\n          aY = [],\n          current, // current instruction\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          bounds;\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            bounds = [];\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            bounds = [];\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6]\n            );\n            x = current[5];\n            y = current[6];\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              current[1],\n              current[2],\n              current[1],\n              current[2],\n              current[3],\n              current[4]\n            );\n            x = current[3];\n            y = current[4];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            break;\n        }\n        bounds.forEach(function (point) {\n          aX.push(point.x);\n          aY.push(point.y);\n        });\n        aX.push(x);\n        aY.push(y);\n      }\n\n      var minX = min(aX) || 0,\n          minY = min(aY) || 0,\n          maxX = max(aX) || 0,\n          maxY = max(aY) || 0,\n          deltaX = maxX - minX,\n          deltaY = maxY - minY;\n\n      return {\n        left: minX,\n        top: minY,\n        width: deltaX,\n        height: deltaY\n      };\n    }\n  });\n\n  /**\n   * Creates an instance of fabric.Path from an object\n   * @static\n   * @memberOf fabric.Path\n   * @param {Object} object\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Path.fromObject = function(object, callback) {\n    if (typeof object.sourcePath === 'string') {\n      var pathUrl = object.sourcePath;\n      fabric.loadSVGFromURL(pathUrl, function (elements) {\n        var path = elements[0];\n        path.setOptions(object);\n        callback && callback(path);\n      });\n    }\n    else {\n      fabric.Object._fromObject('Path', object, callback, 'path');\n    }\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)\n   * @static\n   * @memberOf fabric.Path\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\n   */\n  fabric.Path.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(['d']);\n\n  /**\n   * Creates an instance of fabric.Path from an SVG <path> element\n   * @static\n   * @memberOf fabric.Path\n   * @param {SVGElement} element to parse\n   * @param {Function} callback Callback to invoke when an fabric.Path instance is created\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   */\n  fabric.Path.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Path.ATTRIBUTE_NAMES);\n    parsedAttributes.fromSVG = true;\n    callback(new fabric.Path(parsedAttributes.d, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max;\n\n  if (fabric.Group) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.Group\n   * @extends fabric.Object\n   * @mixes fabric.Collection\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.Group#initialize} for constructor definition\n   */\n  fabric.Group = fabric.util.createClass(fabric.Object, fabric.Collection, /** @lends fabric.Group.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'group',\n\n    /**\n     * Width of stroke\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * Indicates if click, mouseover, mouseout events & hoverCursor should also check for subtargets\n     * @type Boolean\n     * @default\n     */\n    subTargetCheck: false,\n\n    /**\n     * Groups are container, do not render anything on theyr own, ence no cache properties\n     * @type Array\n     * @default\n     */\n    cacheProperties: [],\n\n    /**\n     * setOnGroup is a method used for TextBox that is no more used since 2.0.0 The behavior is still\n     * available setting this boolean to true.\n     * @type Boolean\n     * @since 2.0.0\n     * @default\n     */\n    useSetOnGroup: false,\n\n    /**\n     * Constructor\n     * @param {Object} objects Group objects\n     * @param {Object} [options] Options object\n     * @param {Boolean} [isAlreadyGrouped] if true, objects have been grouped already.\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options, isAlreadyGrouped) {\n      options = options || {};\n      this._objects = [];\n      // if objects enclosed in a group have been grouped already,\n      // we cannot change properties of objects.\n      // Thus we need to set options to group without objects,\n      isAlreadyGrouped && this.callSuper('initialize', options);\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (!isAlreadyGrouped) {\n        var center = options && options.centerPoint;\n        // we want to set origins before calculating the bounding box.\n        // so that the topleft can be set with that in mind.\n        // if specific top and left are passed, are overwritten later\n        // with the callSuper('initialize', options)\n        if (options.originX !== undefined) {\n          this.originX = options.originX;\n        }\n        if (options.originY !== undefined) {\n          this.originY = options.originY;\n        }\n        // if coming from svg i do not want to calc bounds.\n        // i assume width and height are passed along options\n        center || this._calcBounds();\n        this._updateObjectsCoords(center);\n        delete options.centerPoint;\n        this.callSuper('initialize', options);\n      }\n      else {\n        this._updateObjectsACoords();\n      }\n\n      this.setCoords();\n    },\n\n    /**\n     * @private\n     */\n    _updateObjectsACoords: function() {\n      var skipControls = true;\n      for (var i = this._objects.length; i--; ){\n        this._objects[i].setCoords(skipControls);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n     */\n    _updateObjectsCoords: function(center) {\n      var center = center || this.getCenterPoint();\n      for (var i = this._objects.length; i--; ){\n        this._updateObjectCoords(this._objects[i], center);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     * @param {fabric.Point} center, current center of group.\n     */\n    _updateObjectCoords: function(object, center) {\n      var objectLeft = object.left,\n          objectTop = object.top,\n          skipControls = true;\n\n      object.set({\n        left: objectLeft - center.x,\n        top: objectTop - center.y\n      });\n      object.group = this;\n      object.setCoords(skipControls);\n    },\n\n    /**\n     * Returns string represenation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.Group: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Adds an object to a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    addWithUpdate: function(object) {\n      var nested = !!this.group;\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n      if (object) {\n        if (nested) {\n          // if this group is inside another group, we need to pre transform the object\n          fabric.util.removeTransformFromObject(object, this.group.calcTransformMatrix());\n        }\n        this._objects.push(object);\n        object.group = this;\n        object._set('canvas', this.canvas);\n      }\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.dirty = true;\n      if (nested) {\n        this.group.addWithUpdate();\n      }\n      else {\n        this.setCoords();\n      }\n      return this;\n    },\n\n    /**\n     * Removes an object from a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    removeWithUpdate: function(object) {\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n\n      this.remove(object);\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.setCoords();\n      this.dirty = true;\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _onObjectAdded: function(object) {\n      this.dirty = true;\n      object.group = this;\n      object._set('canvas', this.canvas);\n    },\n\n    /**\n     * @private\n     */\n    _onObjectRemoved: function(object) {\n      this.dirty = true;\n      delete object.group;\n    },\n\n    /**\n     * @private\n     */\n    _set: function(key, value) {\n      var i = this._objects.length;\n      if (this.useSetOnGroup) {\n        while (i--) {\n          this._objects[i].setOnGroup(key, value);\n        }\n      }\n      if (key === 'canvas') {\n        while (i--) {\n          this._objects[i]._set(key, value);\n        }\n      }\n      fabric.Object.prototype._set.call(this, key, value);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var _includeDefaultValues = this.includeDefaultValues;\n      var objsToObject = this._objects.map(function(obj) {\n        var originalDefaults = obj.includeDefaultValues;\n        obj.includeDefaultValues = _includeDefaultValues;\n        var _obj = obj.toObject(propertiesToInclude);\n        obj.includeDefaultValues = originalDefaults;\n        return _obj;\n      });\n      var obj = fabric.Object.prototype.toObject.call(this, propertiesToInclude);\n      obj.objects = objsToObject;\n      return obj;\n    },\n\n    /**\n     * Returns object representation of an instance, in dataless mode.\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var objsToObject, sourcePath = this.sourcePath;\n      if (sourcePath) {\n        objsToObject = sourcePath;\n      }\n      else {\n        var _includeDefaultValues = this.includeDefaultValues;\n        objsToObject = this._objects.map(function(obj) {\n          var originalDefaults = obj.includeDefaultValues;\n          obj.includeDefaultValues = _includeDefaultValues;\n          var _obj = obj.toDatalessObject(propertiesToInclude);\n          obj.includeDefaultValues = originalDefaults;\n          return _obj;\n        });\n      }\n      var obj = fabric.Object.prototype.toDatalessObject.call(this, propertiesToInclude);\n      obj.objects = objsToObject;\n      return obj;\n    },\n\n    /**\n     * Renders instance on a given context\n     * @param {CanvasRenderingContext2D} ctx context to render instance on\n     */\n    render: function(ctx) {\n      this._transformDone = true;\n      this.callSuper('render', ctx);\n      this._transformDone = false;\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group is already cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      var ownCache = fabric.Object.prototype.shouldCache.call(this);\n      if (ownCache) {\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          if (this._objects[i].willDrawShadow()) {\n            this.ownCaching = false;\n            return false;\n          }\n        }\n      }\n      return ownCache;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      if (fabric.Object.prototype.willDrawShadow.call(this)) {\n        return true;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].willDrawShadow()) {\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isOnACache: function() {\n      return this.ownCaching || (this.group && this.group.isOnACache());\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawObject: function(ctx) {\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i].render(ctx);\n      }\n      this._drawClipPath(ctx);\n    },\n\n    /**\n     * Check if cache is dirty\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.callSuper('isCacheDirty', skipCanvas)) {\n        return true;\n      }\n      if (!this.statefullCache) {\n        return false;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].isCacheDirty(true)) {\n          if (this._cacheCanvas) {\n            // if this group has not a cache canvas there is nothing to clean\n            var x = this.cacheWidth / this.zoomX, y = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-x / 2, -y / 2, x, y);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Restores original state of each of group objects (original state is that which was before group was created).\n     * if the nested boolean is true, the original state will be restored just for the\n     * first group and not for all the group chain\n     * @private\n     * @param {Boolean} nested tell the function to restore object state up to the parent group and not more\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    _restoreObjectsState: function() {\n      var groupMatrix = this.calcOwnMatrix();\n      this._objects.forEach(function(object) {\n        // instead of using _this = this;\n        fabric.util.addTransformToObject(object, groupMatrix);\n        delete object.group;\n        object.setCoords();\n      });\n      return this;\n    },\n\n    /**\n     * Realises the transform from this group onto the supplied object\n     * i.e. it tells you what would happen if the supplied object was in\n     * the group, and then the group was destroyed. It mutates the supplied\n     * object.\n     * Warning: this method is not useful anymore, it has been kept to no break the api.\n     * is not used in the fabricJS codebase\n     * this method will be reduced to using the utility.\n     * @private\n     * @deprecated\n     * @param {fabric.Object} object\n     * @param {Array} parentMatrix parent transformation\n     * @return {fabric.Object} transformedObject\n     */\n    realizeTransform: function(object, parentMatrix) {\n      fabric.util.addTransformToObject(object, parentMatrix);\n      return object;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    destroy: function() {\n      // when group is destroyed objects needs to get a repaint to be eventually\n      // displayed on canvas.\n      this._objects.forEach(function(object) {\n        object.set('dirty', true);\n      });\n      return this._restoreObjectsState();\n    },\n\n    /**\n     * make a group an active selection, remove the group from canvas\n     * the group has to be on canvas for this to work.\n     * @return {fabric.ActiveSelection} thisArg\n     * @chainable\n     */\n    toActiveSelection: function() {\n      if (!this.canvas) {\n        return;\n      }\n      var objects = this._objects, canvas = this.canvas;\n      this._objects = [];\n      var options = this.toObject();\n      delete options.objects;\n      var activeSelection = new fabric.ActiveSelection([]);\n      activeSelection.set(options);\n      activeSelection.type = 'activeSelection';\n      canvas.remove(this);\n      objects.forEach(function(object) {\n        object.group = activeSelection;\n        object.dirty = true;\n        canvas.add(object);\n      });\n      activeSelection.canvas = canvas;\n      activeSelection._objects = objects;\n      canvas._activeObject = activeSelection;\n      activeSelection.setCoords();\n      return activeSelection;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    ungroupOnCanvas: function() {\n      return this._restoreObjectsState();\n    },\n\n    /**\n     * Sets coordinates of all objects inside group\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    setObjectsCoords: function() {\n      var skipControls = true;\n      this.forEachObject(function(object) {\n        object.setCoords(skipControls);\n      });\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _calcBounds: function(onlyWidthHeight) {\n      var aX = [],\n          aY = [],\n          o, prop, coords,\n          props = ['tr', 'br', 'bl', 'tl'],\n          i = 0, iLen = this._objects.length,\n          j, jLen = props.length;\n\n      for ( ; i < iLen; ++i) {\n        o = this._objects[i];\n        coords = o.calcACoords();\n        for (j = 0; j < jLen; j++) {\n          prop = props[j];\n          aX.push(coords[prop].x);\n          aY.push(coords[prop].y);\n        }\n        o.aCoords = coords;\n      }\n\n      this._getBounds(aX, aY, onlyWidthHeight);\n    },\n\n    /**\n     * @private\n     */\n    _getBounds: function(aX, aY, onlyWidthHeight) {\n      var minXY = new fabric.Point(min(aX), min(aY)),\n          maxXY = new fabric.Point(max(aX), max(aY)),\n          top = minXY.y || 0, left = minXY.x || 0,\n          width = (maxXY.x - minXY.x) || 0,\n          height = (maxXY.y - minXY.y) || 0;\n      this.width = width;\n      this.height = height;\n      if (!onlyWidthHeight) {\n        // the bounding box always finds the topleft most corner.\n        // whatever is the group origin, we set up here the left/top position.\n        this.setPositionByOrigin({ x: left, y: top }, 'left', 'top');\n      }\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    _toSVG: function(reviver) {\n      var svgString = ['<g ', 'COMMON_PARTS', ' >\\n'];\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        svgString.push('\\t\\t', this._objects[i].toSVG(reviver));\n      }\n      svgString.push('</g>\\n');\n      return svgString;\n    },\n\n    /**\n     * Returns styles-string for svg-export, specific version for group\n     * @return {String}\n     */\n    getSvgStyles: function() {\n      var opacity = typeof this.opacity !== 'undefined' && this.opacity !== 1 ?\n            'opacity: ' + this.opacity + ';' : '',\n          visibility = this.visible ? '' : ' visibility: hidden;';\n      return [\n        opacity,\n        this.getSvgFilter(),\n        visibility\n      ].join('');\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      var svgString = [];\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        svgString.push('\\t', this._objects[i].toClipPathSVG(reviver));\n      }\n\n      return this._createBaseClipPathSVGMarkup(svgString, { reviver: reviver });\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Group} instance from an object representation\n   * @static\n   * @memberOf fabric.Group\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an group instance is created\n   */\n  fabric.Group.fromObject = function(object, callback) {\n    var objects = object.objects,\n        options = fabric.util.object.clone(object, true);\n    delete options.objects;\n    if (typeof objects === 'string') {\n      // it has to be an url or something went wrong.\n      fabric.loadSVGFromURL(objects, function (elements) {\n        var group = fabric.util.groupSVGElements(elements, object, objects);\n        group.set(options);\n        callback && callback(group);\n      });\n      return;\n    }\n    fabric.util.enlivenObjects(objects, function(enlivenedObjects) {\n      fabric.util.enlivenObjects([object.clipPath], function(enlivedClipPath) {\n        var options = fabric.util.object.clone(object, true);\n        options.clipPath = enlivedClipPath[0];\n        delete options.objects;\n        callback && callback(new fabric.Group(enlivenedObjects, options, true));\n      });\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.ActiveSelection) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.ActiveSelection\n   * @extends fabric.Group\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.ActiveSelection#initialize} for constructor definition\n   */\n  fabric.ActiveSelection = fabric.util.createClass(fabric.Group, /** @lends fabric.ActiveSelection.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'activeSelection',\n\n    /**\n     * Constructor\n     * @param {Object} objects ActiveSelection objects\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options) {\n      options = options || {};\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (options.originX) {\n        this.originX = options.originX;\n      }\n      if (options.originY) {\n        this.originY = options.originY;\n      }\n      this._calcBounds();\n      this._updateObjectsCoords();\n      fabric.Object.prototype.initialize.call(this, options);\n      this.setCoords();\n    },\n\n    /**\n     * Change te activeSelection to a normal group,\n     * High level function that automatically adds it to canvas as\n     * active object. no events fired.\n     * @since 2.0.0\n     * @return {fabric.Group}\n     */\n    toGroup: function() {\n      var objects = this._objects.concat();\n      this._objects = [];\n      var options = fabric.Object.prototype.toObject.call(this);\n      var newGroup = new fabric.Group([]);\n      delete options.type;\n      newGroup.set(options);\n      objects.forEach(function(object) {\n        object.canvas.remove(object);\n        object.group = newGroup;\n      });\n      newGroup._objects = objects;\n      if (!this.canvas) {\n        return newGroup;\n      }\n      var canvas = this.canvas;\n      canvas.add(newGroup);\n      canvas._activeObject = newGroup;\n      newGroup.setCoords();\n      return newGroup;\n    },\n\n    /**\n     * If returns true, deselection is cancelled.\n     * @since 2.0.0\n     * @return {Boolean} [cancel]\n     */\n    onDeselect: function() {\n      this.destroy();\n      return false;\n    },\n\n    /**\n     * Returns string representation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.ActiveSelection: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isOnACache: function() {\n      return false;\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [styleOverride] properties to override the object style\n     * @param {Object} [childrenOverride] properties to override the children overrides\n     */\n    _renderControls: function(ctx, styleOverride, childrenOverride) {\n      ctx.save();\n      ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      this.callSuper('_renderControls', ctx, styleOverride);\n      childrenOverride = childrenOverride || { };\n      if (typeof childrenOverride.hasControls === 'undefined') {\n        childrenOverride.hasControls = false;\n      }\n      childrenOverride.forActiveSelection = true;\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i]._renderControls(ctx, childrenOverride);\n      }\n      ctx.restore();\n    },\n  });\n\n  /**\n   * Returns {@link fabric.ActiveSelection} instance from an object representation\n   * @static\n   * @memberOf fabric.ActiveSelection\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an ActiveSelection instance is created\n   */\n  fabric.ActiveSelection.fromObject = function(object, callback) {\n    fabric.util.enlivenObjects(object.objects, function(enlivenedObjects) {\n      delete object.objects;\n      callback && callback(new fabric.ActiveSelection(enlivenedObjects, object, true));\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var extend = fabric.util.object.extend;\n\n  if (!global.fabric) {\n    global.fabric = { };\n  }\n\n  if (global.fabric.Image) {\n    fabric.warn('fabric.Image is already defined.');\n    return;\n  }\n\n  /**\n   * Image class\n   * @class fabric.Image\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#images}\n   * @see {@link fabric.Image#initialize} for constructor definition\n   */\n  fabric.Image = fabric.util.createClass(fabric.Object, /** @lends fabric.Image.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'image',\n\n    /**\n     * Width of a stroke.\n     * For image quality a stroke multiple of 2 gives better results.\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * When calling {@link fabric.Image.getSrc}, return value from element src with `element.getAttribute('src')`.\n     * This allows for relative urls as image src.\n     * @since 2.7.0\n     * @type Boolean\n     * @default\n     */\n    srcFromAttribute: false,\n\n    /**\n     * private\n     * contains last value of scaleX to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleX: 1,\n\n    /**\n     * private\n     * contains last value of scaleY to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleY: 1,\n\n    /**\n     * private\n     * contains last value of scaling applied by the apply filter chain\n     * @type Number\n     */\n    _filterScalingX: 1,\n\n    /**\n     * private\n     * contains last value of scaling applied by the apply filter chain\n     * @type Number\n     */\n    _filterScalingY: 1,\n\n    /**\n     * minimum scale factor under which any resizeFilter is triggered to resize the image\n     * 0 will disable the automatic resize. 1 will trigger automatically always.\n     * number bigger than 1 are not implemented yet.\n     * @type Number\n     */\n    minimumScaleTrigger: 0.5,\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('cropX', 'cropY'),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\n     * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\n     * and refreshed at the next render\n     * @type Array\n     */\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('cropX', 'cropY'),\n\n    /**\n     * key used to retrieve the texture representing this image\n     * @since 2.0.0\n     * @type String\n     * @default\n     */\n    cacheKey: '',\n\n    /**\n     * Image crop in pixels from original image size.\n     * @since 2.0.0\n     * @type Number\n     * @default\n     */\n    cropX: 0,\n\n    /**\n     * Image crop in pixels from original image size.\n     * @since 2.0.0\n     * @type Number\n     * @default\n     */\n    cropY: 0,\n\n    /**\n     * Indicates whether this canvas will use image smoothing when painting this image.\n     * Also influence if the cacheCanvas for this image uses imageSmoothing\n     * @since 4.0.0-beta.11\n     * @type Boolean\n     * @default\n     */\n    imageSmoothing: true,\n\n    /**\n     * Constructor\n     * Image can be initialized with any canvas drawable or a string.\n     * The string should be a url and will be loaded as an image.\n     * Canvas and Image element work out of the box, while videos require extra code to work.\n     * Please check video element events for seeking.\n     * @param {HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | String} element Image element\n     * @param {Object} [options] Options object\n     * @param {function} [callback] callback function to call after eventual filters applied.\n     * @return {fabric.Image} thisArg\n     */\n    initialize: function(element, options) {\n      options || (options = { });\n      this.filters = [];\n      this.cacheKey = 'texture' + fabric.Object.__uid++;\n      this.callSuper('initialize', options);\n      this._initElement(element, options);\n    },\n\n    /**\n     * Returns image element which this instance if based on\n     * @return {HTMLImageElement} Image element\n     */\n    getElement: function() {\n      return this._element || {};\n    },\n\n    /**\n     * Sets image element for this instance to a specified one.\n     * If filters defined they are applied to new image.\n     * You might need to call `canvas.renderAll` and `object.setCoords` after replacing, to render new image and update controls area.\n     * @param {HTMLImageElement} element\n     * @param {Object} [options] Options object\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setElement: function(element, options) {\n      this.removeTexture(this.cacheKey);\n      this.removeTexture(this.cacheKey + '_filtered');\n      this._element = element;\n      this._originalElement = element;\n      this._initConfig(options);\n      if (this.filters.length !== 0) {\n        this.applyFilters();\n      }\n      // resizeFilters work on the already filtered copy.\n      // we need to apply resizeFilters AFTER normal filters.\n      // applyResizeFilters is run more often than normal filters\n      // and is triggered by user interactions rather than dev code\n      if (this.resizeFilter) {\n        this.applyResizeFilters();\n      }\n      return this;\n    },\n\n    /**\n     * Delete a single texture if in webgl mode\n     */\n    removeTexture: function(key) {\n      var backend = fabric.filterBackend;\n      if (backend && backend.evictCachesForKey) {\n        backend.evictCachesForKey(key);\n      }\n    },\n\n    /**\n     * Delete textures, reference to elements and eventually JSDOM cleanup\n     */\n    dispose: function() {\n      this.removeTexture(this.cacheKey);\n      this.removeTexture(this.cacheKey + '_filtered');\n      this._cacheContext = undefined;\n      ['_originalElement', '_element', '_filteredEl', '_cacheCanvas'].forEach((function(element) {\n        fabric.util.cleanUpJsdomNode(this[element]);\n        this[element] = undefined;\n      }).bind(this));\n    },\n\n    /**\n     * Get the crossOrigin value (of the corresponding image element)\n     */\n    getCrossOrigin: function() {\n      return this._originalElement && (this._originalElement.crossOrigin || null);\n    },\n\n    /**\n     * Returns original size of an image\n     * @return {Object} Object with \"width\" and \"height\" properties\n     */\n    getOriginalSize: function() {\n      var element = this.getElement();\n      return {\n        width: element.naturalWidth || element.width,\n        height: element.naturalHeight || element.height\n      };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _stroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n      var w = this.width / 2, h = this.height / 2;\n      ctx.beginPath();\n      ctx.moveTo(-w, -h);\n      ctx.lineTo(w, -h);\n      ctx.lineTo(w, h);\n      ctx.lineTo(-w, h);\n      ctx.lineTo(-w, -h);\n      ctx.closePath();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderDashedStroke: function(ctx) {\n      var x = -this.width / 2,\n          y = -this.height / 2,\n          w = this.width,\n          h = this.height;\n\n      ctx.save();\n      this._setStrokeStyles(ctx, this);\n\n      ctx.beginPath();\n      fabric.util.drawDashedLine(ctx, x, y, x + w, y, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y, x + w, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x + w, y + h, x, y + h, this.strokeDashArray);\n      fabric.util.drawDashedLine(ctx, x, y + h, x, y, this.strokeDashArray);\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var filters = [];\n\n      this.filters.forEach(function(filterObj) {\n        if (filterObj) {\n          filters.push(filterObj.toObject());\n        }\n      });\n      var object = extend(\n        this.callSuper(\n          'toObject',\n          ['cropX', 'cropY'].concat(propertiesToInclude)\n        ), {\n          src: this.getSrc(),\n          crossOrigin: this.getCrossOrigin(),\n          filters: filters,\n        });\n      if (this.resizeFilter) {\n        object.resizeFilter = this.resizeFilter.toObject();\n      }\n      return object;\n    },\n\n    /**\n     * Returns true if an image has crop applied, inspecting values of cropX,cropY,width,height.\n     * @return {Boolean}\n     */\n    hasCrop: function() {\n      return this.cropX || this.cropY || this.width < this._element.width || this.height < this._element.height;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var svgString = [], imageMarkup = [], strokeSvg, element = this._element,\n          x = -this.width / 2, y = -this.height / 2, clipPath = '', imageRendering = '';\n      if (!element) {\n        return [];\n      }\n      if (this.hasCrop()) {\n        var clipPathId = fabric.Object.__uid++;\n        svgString.push(\n          '<clipPath id=\"imageCrop_' + clipPathId + '\">\\n',\n          '\\t<rect x=\"' + x + '\" y=\"' + y + '\" width=\"' + this.width + '\" height=\"' + this.height + '\" />\\n',\n          '</clipPath>\\n'\n        );\n        clipPath = ' clip-path=\"url(#imageCrop_' + clipPathId + ')\" ';\n      }\n      if (!this.imageSmoothing) {\n        imageRendering = '\" image-rendering=\"optimizeSpeed';\n      }\n      imageMarkup.push('\\t<image ', 'COMMON_PARTS', 'xlink:href=\"', this.getSvgSrc(true),\n        '\" x=\"', x - this.cropX, '\" y=\"', y - this.cropY,\n        // we're essentially moving origin of transformation from top/left corner to the center of the shape\n        // by wrapping it in container <g> element with actual transformation, then offsetting object to the top/left\n        // so that object's center aligns with container's left/top\n        '\" width=\"', element.width || element.naturalWidth,\n        '\" height=\"', element.height || element.height,\n        imageRendering,\n        '\"', clipPath,\n        '></image>\\n');\n\n      if (this.stroke || this.strokeDashArray) {\n        var origFill = this.fill;\n        this.fill = null;\n        strokeSvg = [\n          '\\t<rect ',\n          'x=\"', x, '\" y=\"', y,\n          '\" width=\"', this.width, '\" height=\"', this.height,\n          '\" style=\"', this.getSvgStyles(),\n          '\"/>\\n'\n        ];\n        this.fill = origFill;\n      }\n      if (this.paintFirst !== 'fill') {\n        svgString = svgString.concat(strokeSvg, imageMarkup);\n      }\n      else {\n        svgString = svgString.concat(imageMarkup, strokeSvg);\n      }\n      return svgString;\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns source of an image\n     * @param {Boolean} filtered indicates if the src is needed for svg\n     * @return {String} Source of an image\n     */\n    getSrc: function(filtered) {\n      var element = filtered ? this._element : this._originalElement;\n      if (element) {\n        if (element.toDataURL) {\n          return element.toDataURL();\n        }\n\n        if (this.srcFromAttribute) {\n          return element.getAttribute('src');\n        }\n        else {\n          return element.src;\n        }\n      }\n      else {\n        return this.src || '';\n      }\n    },\n\n    /**\n     * Sets source of an image\n     * @param {String} src Source string (URL)\n     * @param {Function} [callback] Callback is invoked when image has been loaded (and all filters have been applied)\n     * @param {Object} [options] Options object\n     * @param {String} [options.crossOrigin] crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setSrc: function(src, callback, options) {\n      fabric.util.loadImage(src, function(img, isError) {\n        this.setElement(img, options);\n        this._setWidthHeight();\n        callback && callback(this, isError);\n      }, this, options && options.crossOrigin);\n      return this;\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Image: { src: \"' + this.getSrc() + '\" }>';\n    },\n\n    applyResizeFilters: function() {\n      var filter = this.resizeFilter,\n          minimumScale = this.minimumScaleTrigger,\n          objectScale = this.getTotalObjectScaling(),\n          scaleX = objectScale.scaleX,\n          scaleY = objectScale.scaleY,\n          elementToFilter = this._filteredEl || this._originalElement;\n      if (this.group) {\n        this.set('dirty', true);\n      }\n      if (!filter || (scaleX > minimumScale && scaleY > minimumScale)) {\n        this._element = elementToFilter;\n        this._filterScalingX = 1;\n        this._filterScalingY = 1;\n        this._lastScaleX = scaleX;\n        this._lastScaleY = scaleY;\n        return;\n      }\n      if (!fabric.filterBackend) {\n        fabric.filterBackend = fabric.initFilterBackend();\n      }\n      var canvasEl = fabric.util.createCanvasElement(),\n          cacheKey = this._filteredEl ? (this.cacheKey + '_filtered') : this.cacheKey,\n          sourceWidth = elementToFilter.width, sourceHeight = elementToFilter.height;\n      canvasEl.width = sourceWidth;\n      canvasEl.height = sourceHeight;\n      this._element = canvasEl;\n      this._lastScaleX = filter.scaleX = scaleX;\n      this._lastScaleY = filter.scaleY = scaleY;\n      fabric.filterBackend.applyFilters(\n        [filter], elementToFilter, sourceWidth, sourceHeight, this._element, cacheKey);\n      this._filterScalingX = canvasEl.width / this._originalElement.width;\n      this._filterScalingY = canvasEl.height / this._originalElement.height;\n    },\n\n    /**\n     * Applies filters assigned to this image (from \"filters\" array) or from filter param\n     * @method applyFilters\n     * @param {Array} filters to be applied\n     * @param {Boolean} forResizing specify if the filter operation is a resize operation\n     * @return {thisArg} return the fabric.Image object\n     * @chainable\n     */\n    applyFilters: function(filters) {\n\n      filters = filters || this.filters || [];\n      filters = filters.filter(function(filter) { return filter && !filter.isNeutralState(); });\n      this.set('dirty', true);\n\n      // needs to clear out or WEBGL will not resize correctly\n      this.removeTexture(this.cacheKey + '_filtered');\n\n      if (filters.length === 0) {\n        this._element = this._originalElement;\n        this._filteredEl = null;\n        this._filterScalingX = 1;\n        this._filterScalingY = 1;\n        return this;\n      }\n\n      var imgElement = this._originalElement,\n          sourceWidth = imgElement.naturalWidth || imgElement.width,\n          sourceHeight = imgElement.naturalHeight || imgElement.height;\n\n      if (this._element === this._originalElement) {\n        // if the element is the same we need to create a new element\n        var canvasEl = fabric.util.createCanvasElement();\n        canvasEl.width = sourceWidth;\n        canvasEl.height = sourceHeight;\n        this._element = canvasEl;\n        this._filteredEl = canvasEl;\n      }\n      else {\n        // clear the existing element to get new filter data\n        // also dereference the eventual resized _element\n        this._element = this._filteredEl;\n        this._filteredEl.getContext('2d').clearRect(0, 0, sourceWidth, sourceHeight);\n        // we also need to resize again at next renderAll, so remove saved _lastScaleX/Y\n        this._lastScaleX = 1;\n        this._lastScaleY = 1;\n      }\n      if (!fabric.filterBackend) {\n        fabric.filterBackend = fabric.initFilterBackend();\n      }\n      fabric.filterBackend.applyFilters(\n        filters, this._originalElement, sourceWidth, sourceHeight, this._element, this.cacheKey);\n      if (this._originalElement.width !== this._element.width ||\n        this._originalElement.height !== this._element.height) {\n        this._filterScalingX = this._element.width / this._originalElement.width;\n        this._filterScalingY = this._element.height / this._originalElement.height;\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\n      if (this.isMoving !== true && this.resizeFilter && this._needsResize()) {\n        this.applyResizeFilters();\n      }\n      this._stroke(ctx);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Paint the cached copy of the object on the target context.\n     * it will set the imageSmoothing for the draw operation\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawCacheOnCanvas: function(ctx) {\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\n      fabric.Object.prototype.drawCacheOnCanvas.call(this, ctx);\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * This is the special image version where we would like to avoid caching where possible.\n     * Essentially images do not benefit from caching. They may require caching, and in that\n     * case we do it. Also caching an image usually ends in a loss of details.\n     * A full performance audit should be done.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      return this.needsItsOwnCache();\n    },\n\n    _renderFill: function(ctx) {\n      var elementToDraw = this._element;\n      if (!elementToDraw) {\n        return;\n      }\n      var scaleX = this._filterScalingX, scaleY = this._filterScalingY,\n          w = this.width, h = this.height, min = Math.min, max = Math.max,\n          // crop values cannot be lesser than 0.\n          cropX = max(this.cropX, 0), cropY = max(this.cropY, 0),\n          elWidth = elementToDraw.naturalWidth || elementToDraw.width,\n          elHeight = elementToDraw.naturalHeight || elementToDraw.height,\n          sX = cropX * scaleX,\n          sY = cropY * scaleY,\n          // the width height cannot exceed element width/height, starting from the crop offset.\n          sW = min(w * scaleX, elWidth - sX),\n          sH = min(h * scaleY, elHeight - sY),\n          x = -w / 2, y = -h / 2,\n          maxDestW = min(w, elWidth / scaleX - cropX),\n          maxDestH = min(h, elHeight / scaleY - cropY);\n\n      elementToDraw && ctx.drawImage(elementToDraw, sX, sY, sW, sH, x, y, maxDestW, maxDestH);\n    },\n\n    /**\n     * needed to check if image needs resize\n     * @private\n     */\n    _needsResize: function() {\n      var scale = this.getTotalObjectScaling();\n      return (scale.scaleX !== this._lastScaleX || scale.scaleY !== this._lastScaleY);\n    },\n\n    /**\n     * @private\n     */\n    _resetWidthHeight: function() {\n      this.set(this.getOriginalSize());\n    },\n\n    /**\n     * The Image class's initialization method. This method is automatically\n     * called by the constructor.\n     * @private\n     * @param {HTMLImageElement|String} element The element representing the image\n     * @param {Object} [options] Options object\n     */\n    _initElement: function(element, options) {\n      this.setElement(fabric.util.getById(element), options);\n      fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initConfig: function(options) {\n      options || (options = { });\n      this.setOptions(options);\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @param {Array} filters to be initialized\n     * @param {Function} callback Callback to invoke when all fabric.Image.filters instances are created\n     */\n    _initFilters: function(filters, callback) {\n      if (filters && filters.length) {\n        fabric.util.enlivenObjects(filters, function(enlivenedObjects) {\n          callback && callback(enlivenedObjects);\n        }, 'fabric.Image.filters');\n      }\n      else {\n        callback && callback();\n      }\n    },\n\n    /**\n     * @private\n     * Set the width and the height of the image object, using the element or the\n     * options.\n     * @param {Object} [options] Object with width/height properties\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n      var el = this.getElement();\n      this.width = options.width || el.naturalWidth || el.width || 0;\n      this.height = options.height || el.naturalHeight || el.height || 0;\n    },\n\n    /**\n     * Calculate offset for center and scale factor for the image in order to respect\n     * the preserveAspectRatio attribute\n     * @private\n     * @return {Object}\n     */\n    parsePreserveAspectRatioAttribute: function() {\n      var pAR = fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio || ''),\n          rWidth = this._element.width, rHeight = this._element.height,\n          scaleX = 1, scaleY = 1, offsetLeft = 0, offsetTop = 0, cropX = 0, cropY = 0,\n          offset, pWidth = this.width, pHeight = this.height, parsedAttributes = { width: pWidth, height: pHeight };\n      if (pAR && (pAR.alignX !== 'none' || pAR.alignY !== 'none')) {\n        if (pAR.meetOrSlice === 'meet') {\n          scaleX = scaleY = fabric.util.findScaleToFit(this._element, parsedAttributes);\n          offset = (pWidth - rWidth * scaleX) / 2;\n          if (pAR.alignX === 'Min') {\n            offsetLeft = -offset;\n          }\n          if (pAR.alignX === 'Max') {\n            offsetLeft = offset;\n          }\n          offset = (pHeight - rHeight * scaleY) / 2;\n          if (pAR.alignY === 'Min') {\n            offsetTop = -offset;\n          }\n          if (pAR.alignY === 'Max') {\n            offsetTop = offset;\n          }\n        }\n        if (pAR.meetOrSlice === 'slice') {\n          scaleX = scaleY = fabric.util.findScaleToCover(this._element, parsedAttributes);\n          offset = rWidth - pWidth / scaleX;\n          if (pAR.alignX === 'Mid') {\n            cropX = offset / 2;\n          }\n          if (pAR.alignX === 'Max') {\n            cropX = offset;\n          }\n          offset = rHeight - pHeight / scaleY;\n          if (pAR.alignY === 'Mid') {\n            cropY = offset / 2;\n          }\n          if (pAR.alignY === 'Max') {\n            cropY = offset;\n          }\n          rWidth = pWidth / scaleX;\n          rHeight = pHeight / scaleY;\n        }\n      }\n      else {\n        scaleX = pWidth / rWidth;\n        scaleY = pHeight / rHeight;\n      }\n      return {\n        width: rWidth,\n        height: rHeight,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        offsetLeft: offsetLeft,\n        offsetTop: offsetTop,\n        cropX: cropX,\n        cropY: cropY\n      };\n    }\n  });\n\n  /**\n   * Default CSS class name for canvas\n   * @static\n   * @type String\n   * @default\n   */\n  fabric.Image.CSS_CANVAS = 'canvas-img';\n\n  /**\n   * Alias for getSrc\n   * @static\n   */\n  fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc;\n\n  /**\n   * Creates an instance of fabric.Image from its object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} callback Callback to invoke when an image instance is created\n   */\n  fabric.Image.fromObject = function(_object, callback) {\n    var object = fabric.util.object.clone(_object);\n    fabric.util.loadImage(object.src, function(img, isError) {\n      if (isError) {\n        callback && callback(null, true);\n        return;\n      }\n      fabric.Image.prototype._initFilters.call(object, object.filters, function(filters) {\n        object.filters = filters || [];\n        fabric.Image.prototype._initFilters.call(object, [object.resizeFilter], function(resizeFilters) {\n          object.resizeFilter = resizeFilters[0];\n          fabric.util.enlivenObjects([object.clipPath], function(enlivedProps) {\n            object.clipPath = enlivedProps[0];\n            var image = new fabric.Image(img, object);\n            callback(image, false);\n          });\n        });\n      });\n    }, null, object.crossOrigin);\n  };\n\n  /**\n   * Creates an instance of fabric.Image from an URL string\n   * @static\n   * @param {String} url URL to create an image from\n   * @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument). Second argument is a boolean indicating if an error occurred or not.\n   * @param {Object} [imgOptions] Options object\n   */\n  fabric.Image.fromURL = function(url, callback, imgOptions) {\n    fabric.util.loadImage(url, function(img, isError) {\n      callback && callback(new fabric.Image(img, imgOptions), isError);\n    }, null, imgOptions && imgOptions.crossOrigin);\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})\n   * @static\n   * @see {@link http://www.w3.org/TR/SVG/struct.html#ImageElement}\n   */\n  fabric.Image.ATTRIBUTE_NAMES =\n    fabric.SHARED_ATTRIBUTES.concat(\n      'x y width height preserveAspectRatio xlink:href crossOrigin image-rendering'.split(' ')\n    );\n\n  /**\n   * Returns {@link fabric.Image} instance from an SVG element\n   * @static\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} callback Callback to execute when fabric.Image object is created\n   * @return {fabric.Image} Instance of fabric.Image\n   */\n  fabric.Image.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Image.ATTRIBUTE_NAMES);\n    fabric.Image.fromURL(parsedAttributes['xlink:href'], callback,\n      extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * @private\n   * @return {Number} angle value\n   */\n  _getAngleValueForStraighten: function() {\n    var angle = this.angle % 360;\n    if (angle > 0) {\n      return Math.round((angle - 1) / 90) * 90;\n    }\n    return Math.round(angle / 90) * 90;\n  },\n\n  /**\n   * Straightens an object (rotating it from current angle to one of 0, 90, 180, 270, etc. depending on which is closer)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  straighten: function() {\n    this.rotate(this._getAngleValueForStraighten());\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Object.prototype.straighten} but with animation\n   * @param {Object} callbacks Object with callback functions\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  fxStraighten: function(callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    fabric.util.animate({\n      startValue: this.get('angle'),\n      endValue: this._getAngleValueForStraighten(),\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        _this.rotate(value);\n        onChange();\n      },\n      onComplete: function() {\n        _this.setCoords();\n        onComplete();\n      },\n    });\n\n    return this;\n  }\n});\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Straightens object, then rerenders canvas\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  straightenObject: function (object) {\n    object.straighten();\n    this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Canvas.prototype.straightenObject}, but animated\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  fxStraightenObject: function (object) {\n    object.fxStraighten({\n      onChange: this.requestRenderAllBound\n    });\n    return this;\n  }\n});\n\n\n(function() {\n\n  'use strict';\n\n  /**\n   * Tests if webgl supports certain precision\n   * @param {WebGL} Canvas WebGL context to test on\n   * @param {String} Precision to test can be any of following: 'lowp', 'mediump', 'highp'\n   * @returns {Boolean} Whether the user's browser WebGL supports given precision.\n   */\n  function testPrecision(gl, precision){\n    var fragmentSource = 'precision ' + precision + ' float;\\nvoid main(){}';\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Indicate whether this filtering backend is supported by the user's browser.\n   * @param {Number} tileSize check if the tileSize is supported\n   * @returns {Boolean} Whether the user's browser supports WebGL.\n   */\n  fabric.isWebglSupported = function(tileSize) {\n    if (fabric.isLikelyNode) {\n      return false;\n    }\n    tileSize = tileSize || fabric.WebglFilterBackend.prototype.tileSize;\n    var canvas = document.createElement('canvas');\n    var gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n    var isSupported = false;\n    // eslint-disable-next-line\n    if (gl) {\n      fabric.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\n      isSupported = fabric.maxTextureSize >= tileSize;\n      var precisions = ['highp', 'mediump', 'lowp'];\n      for (var i = 0; i < 3; i++){\n        if (testPrecision(gl, precisions[i])){\n          fabric.webGlPrecision = precisions[i];\n          break;\n        };\n      }\n    }\n    this.isSupported = isSupported;\n    return isSupported;\n  };\n\n  fabric.WebglFilterBackend = WebglFilterBackend;\n\n  /**\n   * WebGL filter backend.\n   */\n  function WebglFilterBackend(options) {\n    if (options && options.tileSize) {\n      this.tileSize = options.tileSize;\n    }\n    this.setupGLContext(this.tileSize, this.tileSize);\n    this.captureGPUInfo();\n  };\n\n  WebglFilterBackend.prototype = /** @lends fabric.WebglFilterBackend.prototype */ {\n\n    tileSize: 2048,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you probably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {\n\n    },\n\n    /**\n     * Setup a WebGL context suitable for filtering, and bind any needed event handlers.\n     */\n    setupGLContext: function(width, height) {\n      this.dispose();\n      this.createWebGLCanvas(width, height);\n      // eslint-disable-next-line\n      this.aPosition = new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]);\n      this.chooseFastestCopyGLTo2DMethod(width, height);\n    },\n\n    /**\n     * Pick a method to copy data from GL context to 2d canvas.  In some browsers using\n     * putImageData is faster than drawImage for that specific operation.\n     */\n    chooseFastestCopyGLTo2DMethod: function(width, height) {\n      var canMeasurePerf = typeof window.performance !== 'undefined', canUseImageData;\n      try {\n        new ImageData(1, 1);\n        canUseImageData = true;\n      }\n      catch (e) {\n        canUseImageData = false;\n      }\n      // eslint-disable-next-line no-undef\n      var canUseArrayBuffer = typeof ArrayBuffer !== 'undefined';\n      // eslint-disable-next-line no-undef\n      var canUseUint8Clamped = typeof Uint8ClampedArray !== 'undefined';\n\n      if (!(canMeasurePerf && canUseImageData && canUseArrayBuffer && canUseUint8Clamped)) {\n        return;\n      }\n\n      var targetCanvas = fabric.util.createCanvasElement();\n      // eslint-disable-next-line no-undef\n      var imageBuffer = new ArrayBuffer(width * height * 4);\n      if (fabric.forceGLPutImageData) {\n        this.imageBuffer = imageBuffer;\n        this.copyGLTo2D = copyGLTo2DPutImageData;\n        return;\n      }\n      var testContext = {\n        imageBuffer: imageBuffer,\n        destinationWidth: width,\n        destinationHeight: height,\n        targetCanvas: targetCanvas\n      };\n      var startTime, drawImageTime, putImageDataTime;\n      targetCanvas.width = width;\n      targetCanvas.height = height;\n\n      startTime = window.performance.now();\n      copyGLTo2DDrawImage.call(testContext, this.gl, testContext);\n      drawImageTime = window.performance.now() - startTime;\n\n      startTime = window.performance.now();\n      copyGLTo2DPutImageData.call(testContext, this.gl, testContext);\n      putImageDataTime = window.performance.now() - startTime;\n\n      if (drawImageTime > putImageDataTime) {\n        this.imageBuffer = imageBuffer;\n        this.copyGLTo2D = copyGLTo2DPutImageData;\n      }\n      else {\n        this.copyGLTo2D = copyGLTo2DDrawImage;\n      }\n    },\n\n    /**\n     * Create a canvas element and associated WebGL context and attaches them as\n     * class properties to the GLFilterBackend class.\n     */\n    createWebGLCanvas: function(width, height) {\n      var canvas = fabric.util.createCanvasElement();\n      canvas.width = width;\n      canvas.height = height;\n      var glOptions = {\n            alpha: true,\n            premultipliedAlpha: false,\n            depth: false,\n            stencil: false,\n            antialias: false\n          },\n          gl = canvas.getContext('webgl', glOptions);\n      if (!gl) {\n        gl = canvas.getContext('experimental-webgl', glOptions);\n      }\n      if (!gl) {\n        return;\n      }\n      gl.clearColor(0, 0, 0, 0);\n      // this canvas can fire webglcontextlost and webglcontextrestored\n      this.canvas = canvas;\n      this.gl = gl;\n    },\n\n    /**\n     * Attempts to apply the requested filters to the source provided, drawing the filtered output\n     * to the provided target canvas.\n     *\n     * @param {Array} filters The filters to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} source The source to be filtered.\n     * @param {Number} width The width of the source input.\n     * @param {Number} height The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     * @param {String|undefined} cacheKey A key used to cache resources related to the source. If\n     * omitted, caching will be skipped.\n     */\n    applyFilters: function(filters, source, width, height, targetCanvas, cacheKey) {\n      var gl = this.gl;\n      var cachedTexture;\n      if (cacheKey) {\n        cachedTexture = this.getCachedTexture(cacheKey, source);\n      }\n      var pipelineState = {\n        originalWidth: source.width || source.originalWidth,\n        originalHeight: source.height || source.originalHeight,\n        sourceWidth: width,\n        sourceHeight: height,\n        destinationWidth: width,\n        destinationHeight: height,\n        context: gl,\n        sourceTexture: this.createTexture(gl, width, height, !cachedTexture && source),\n        targetTexture: this.createTexture(gl, width, height),\n        originalTexture: cachedTexture ||\n          this.createTexture(gl, width, height, !cachedTexture && source),\n        passes: filters.length,\n        webgl: true,\n        aPosition: this.aPosition,\n        programCache: this.programCache,\n        pass: 0,\n        filterBackend: this,\n        targetCanvas: targetCanvas\n      };\n      var tempFbo = gl.createFramebuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, tempFbo);\n      filters.forEach(function(filter) { filter && filter.applyTo(pipelineState); });\n      resizeCanvasIfNeeded(pipelineState);\n      this.copyGLTo2D(gl, pipelineState);\n      gl.bindTexture(gl.TEXTURE_2D, null);\n      gl.deleteTexture(pipelineState.sourceTexture);\n      gl.deleteTexture(pipelineState.targetTexture);\n      gl.deleteFramebuffer(tempFbo);\n      targetCanvas.getContext('2d').setTransform(1, 0, 0, 1, 0, 0);\n      return pipelineState;\n    },\n\n    /**\n     * Detach event listeners, remove references, and clean up caches.\n     */\n    dispose: function() {\n      if (this.canvas) {\n        this.canvas = null;\n        this.gl = null;\n      }\n      this.clearWebGLCaches();\n    },\n\n    /**\n     * Wipe out WebGL-related caches.\n     */\n    clearWebGLCaches: function() {\n      this.programCache = {};\n      this.textureCache = {};\n    },\n\n    /**\n     * Create a WebGL texture object.\n     *\n     * Accepts specific dimensions to initialize the texture to or a source image.\n     *\n     * @param {WebGLRenderingContext} gl The GL context to use for creating the texture.\n     * @param {Number} width The width to initialize the texture at.\n     * @param {Number} height The height to initialize the texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source for the texture data.\n     * @returns {WebGLTexture}\n     */\n    createTexture: function(gl, width, height, textureImageSource) {\n      var texture = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      if (textureImageSource) {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureImageSource);\n      }\n      else {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n      }\n      return texture;\n    },\n\n    /**\n     * Can be optionally used to get a texture from the cache array\n     *\n     * If an existing texture is not found, a new texture is created and cached.\n     *\n     * @param {String} uniqueId A cache key to use to find an existing texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source to use to create the\n     * texture cache entry if one does not already exist.\n     */\n    getCachedTexture: function(uniqueId, textureImageSource) {\n      if (this.textureCache[uniqueId]) {\n        return this.textureCache[uniqueId];\n      }\n      else {\n        var texture = this.createTexture(\n          this.gl, textureImageSource.width, textureImageSource.height, textureImageSource);\n        this.textureCache[uniqueId] = texture;\n        return texture;\n      }\n    },\n\n    /**\n     * Clear out cached resources related to a source image that has been\n     * filtered previously.\n     *\n     * @param {String} cacheKey The cache key provided when the source image was filtered.\n     */\n    evictCachesForKey: function(cacheKey) {\n      if (this.textureCache[cacheKey]) {\n        this.gl.deleteTexture(this.textureCache[cacheKey]);\n        delete this.textureCache[cacheKey];\n      }\n    },\n\n    copyGLTo2D: copyGLTo2DDrawImage,\n\n    /**\n     * Attempt to extract GPU information strings from a WebGL context.\n     *\n     * Useful information when debugging or blacklisting specific GPUs.\n     *\n     * @returns {Object} A GPU info object with renderer and vendor strings.\n     */\n    captureGPUInfo: function() {\n      if (this.gpuInfo) {\n        return this.gpuInfo;\n      }\n      var gl = this.gl, gpuInfo = { renderer: '', vendor: '' };\n      if (!gl) {\n        return gpuInfo;\n      }\n      var ext = gl.getExtension('WEBGL_debug_renderer_info');\n      if (ext) {\n        var renderer = gl.getParameter(ext.UNMASKED_RENDERER_WEBGL);\n        var vendor = gl.getParameter(ext.UNMASKED_VENDOR_WEBGL);\n        if (renderer) {\n          gpuInfo.renderer = renderer.toLowerCase();\n        }\n        if (vendor) {\n          gpuInfo.vendor = vendor.toLowerCase();\n        }\n      }\n      this.gpuInfo = gpuInfo;\n      return gpuInfo;\n    },\n  };\n})();\n\nfunction resizeCanvasIfNeeded(pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas,\n      width = targetCanvas.width, height = targetCanvas.height,\n      dWidth = pipelineState.destinationWidth,\n      dHeight = pipelineState.destinationHeight;\n\n  if (width !== dWidth || height !== dHeight) {\n    targetCanvas.width = dWidth;\n    targetCanvas.height = dHeight;\n  }\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas.\n *\n * The WebGL canvas is assumed to be upside down, with the top-left pixel of the\n * desired output image appearing in the bottom-left corner of the WebGL canvas.\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DDrawImage(gl, pipelineState) {\n  var glCanvas = gl.canvas, targetCanvas = pipelineState.targetCanvas,\n      ctx = targetCanvas.getContext('2d');\n  ctx.translate(0, targetCanvas.height); // move it down again\n  ctx.scale(1, -1); // vertical flip\n  // where is my image on the big glcanvas?\n  var sourceY = glCanvas.height - targetCanvas.height;\n  ctx.drawImage(glCanvas, 0, sourceY, targetCanvas.width, targetCanvas.height, 0, 0,\n    targetCanvas.width, targetCanvas.height);\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas using 2d canvas' putImageData\n * API. Measurably faster than using ctx.drawImage in Firefox (version 54 on OSX Sierra).\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DPutImageData(gl, pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas, ctx = targetCanvas.getContext('2d'),\n      dWidth = pipelineState.destinationWidth,\n      dHeight = pipelineState.destinationHeight,\n      numBytes = dWidth * dHeight * 4;\n\n  // eslint-disable-next-line no-undef\n  var u8 = new Uint8Array(this.imageBuffer, 0, numBytes);\n  // eslint-disable-next-line no-undef\n  var u8Clamped = new Uint8ClampedArray(this.imageBuffer, 0, numBytes);\n\n  gl.readPixels(0, 0, dWidth, dHeight, gl.RGBA, gl.UNSIGNED_BYTE, u8);\n  var imgData = new ImageData(u8Clamped, dWidth, dHeight);\n  ctx.putImageData(imgData, 0, 0);\n}\n\n\n(function() {\n\n  'use strict';\n\n  var noop = function() {};\n\n  fabric.Canvas2dFilterBackend = Canvas2dFilterBackend;\n\n  /**\n   * Canvas 2D filter backend.\n   */\n  function Canvas2dFilterBackend() {};\n\n  Canvas2dFilterBackend.prototype = /** @lends fabric.Canvas2dFilterBackend.prototype */ {\n    evictCachesForKey: noop,\n    dispose: noop,\n    clearWebGLCaches: noop,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you probably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {\n\n    },\n\n    /**\n     * Apply a set of filters against a source image and draw the filtered output\n     * to the provided destination canvas.\n     *\n     * @param {EnhancedFilter} filters The filter to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} sourceElement The source to be filtered.\n     * @param {Number} sourceWidth The width of the source input.\n     * @param {Number} sourceHeight The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     */\n    applyFilters: function(filters, sourceElement, sourceWidth, sourceHeight, targetCanvas) {\n      var ctx = targetCanvas.getContext('2d');\n      ctx.drawImage(sourceElement, 0, 0, sourceWidth, sourceHeight);\n      var imageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      var originalImageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      var pipelineState = {\n        sourceWidth: sourceWidth,\n        sourceHeight: sourceHeight,\n        imageData: imageData,\n        originalEl: sourceElement,\n        originalImageData: originalImageData,\n        canvasEl: targetCanvas,\n        ctx: ctx,\n        filterBackend: this,\n      };\n      filters.forEach(function(filter) { filter.applyTo(pipelineState); });\n      if (pipelineState.imageData.width !== sourceWidth || pipelineState.imageData.height !== sourceHeight) {\n        targetCanvas.width = pipelineState.imageData.width;\n        targetCanvas.height = pipelineState.imageData.height;\n      }\n      ctx.putImageData(pipelineState.imageData, 0, 0);\n      return pipelineState;\n    },\n\n  };\n})();\n\n\n/**\n * @namespace fabric.Image.filters\n * @memberOf fabric.Image\n * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#image_filters}\n * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n */\nfabric.Image = fabric.Image || { };\nfabric.Image.filters = fabric.Image.filters || { };\n\n/**\n * Root filter class from which all filter classes inherit from\n * @class fabric.Image.filters.BaseFilter\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.BaseFilter = fabric.util.createClass(/** @lends fabric.Image.filters.BaseFilter.prototype */ {\n\n  /**\n   * Filter type\n   * @param {String} type\n   * @default\n   */\n  type: 'BaseFilter',\n\n  /**\n   * Array of attributes to send with buffers. do not modify\n   * @private\n   */\n\n  vertexSource: 'attribute vec2 aPosition;\\n' +\n    'varying vec2 vTexCoord;\\n' +\n    'void main() {\\n' +\n      'vTexCoord = aPosition;\\n' +\n      'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\n    '}',\n\n  fragmentSource: 'precision highp float;\\n' +\n    'varying vec2 vTexCoord;\\n' +\n    'uniform sampler2D uTexture;\\n' +\n    'void main() {\\n' +\n      'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\n    '}',\n\n  /**\n   * Constructor\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    if (options) {\n      this.setOptions(options);\n    }\n  },\n\n  /**\n   * Sets filter's properties from options\n   * @param {Object} [options] Options object\n   */\n  setOptions: function(options) {\n    for (var prop in options) {\n      this[prop] = options[prop];\n    }\n  },\n\n  /**\n   * Compile this filter's shader program.\n   *\n   * @param {WebGLRenderingContext} gl The GL canvas context to use for shader compilation.\n   * @param {String} fragmentSource fragmentShader source for compilation\n   * @param {String} vertexSource vertexShader source for compilation\n   */\n  createProgram: function(gl, fragmentSource, vertexSource) {\n    fragmentSource = fragmentSource || this.fragmentSource;\n    vertexSource = vertexSource || this.vertexSource;\n    if (fabric.webGlPrecision !== 'highp'){\n      fragmentSource = fragmentSource.replace(\n        /precision highp float/g,\n        'precision ' + fabric.webGlPrecision + ' float'\n      );\n    }\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vertexShader, vertexSource);\n    gl.compileShader(vertexShader);\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Vertex shader compile error for ' + this.type + ': ' +\n        gl.getShaderInfoLog(vertexShader)\n      );\n    }\n\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Fragment shader compile error for ' + this.type + ': ' +\n        gl.getShaderInfoLog(fragmentShader)\n      );\n    }\n\n    var program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Shader link error for \"${this.type}\" ' +\n        gl.getProgramInfoLog(program)\n      );\n    }\n\n    var attributeLocations = this.getAttributeLocations(gl, program);\n    var uniformLocations = this.getUniformLocations(gl, program) || { };\n    uniformLocations.uStepW = gl.getUniformLocation(program, 'uStepW');\n    uniformLocations.uStepH = gl.getUniformLocation(program, 'uStepH');\n    return {\n      program: program,\n      attributeLocations: attributeLocations,\n      uniformLocations: uniformLocations\n    };\n  },\n\n  /**\n   * Return a map of attribute names to WebGLAttributeLocation objects.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {WebGLShaderProgram} program The shader program from which to take attribute locations.\n   * @returns {Object} A map of attribute names to attribute locations.\n   */\n  getAttributeLocations: function(gl, program) {\n    return {\n      aPosition: gl.getAttribLocation(program, 'aPosition'),\n    };\n  },\n\n  /**\n   * Return a map of uniform names to WebGLUniformLocation objects.\n   *\n   * Intended to be overridden by subclasses.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {WebGLShaderProgram} program The shader program from which to take uniform locations.\n   * @returns {Object} A map of uniform names to uniform locations.\n   */\n  getUniformLocations: function (/* gl, program */) {\n    // in case i do not need any special uniform i need to return an empty object\n    return { };\n  },\n\n  /**\n   * Send attribute data from this filter to its shader program on the GPU.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {Object} attributeLocations A map of shader attribute names to their locations.\n   */\n  sendAttributeData: function(gl, attributeLocations, aPositionData) {\n    var attributeLocation = attributeLocations.aPosition;\n    var buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.enableVertexAttribArray(attributeLocation);\n    gl.vertexAttribPointer(attributeLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.bufferData(gl.ARRAY_BUFFER, aPositionData, gl.STATIC_DRAW);\n  },\n\n  _setupFrameBuffer: function(options) {\n    var gl = options.context, width, height;\n    if (options.passes > 1) {\n      width = options.destinationWidth;\n      height = options.destinationHeight;\n      if (options.sourceWidth !== width || options.sourceHeight !== height) {\n        gl.deleteTexture(options.targetTexture);\n        options.targetTexture = options.filterBackend.createTexture(gl, width, height);\n      }\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D,\n        options.targetTexture, 0);\n    }\n    else {\n      // draw last filter on canvas and not to framebuffer.\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.finish();\n    }\n  },\n\n  _swapTextures: function(options) {\n    options.passes--;\n    options.pass++;\n    var temp = options.targetTexture;\n    options.targetTexture = options.sourceTexture;\n    options.sourceTexture = temp;\n  },\n\n  /**\n   * Generic isNeutral implementation for one parameter based filters.\n   * Used only in image applyFilters to discard filters that will not have an effect\n   * on the image\n   * Other filters may need their own version ( ColorMatrix, HueRotation, gamma, ComposedFilter )\n   * @param {Object} options\n   **/\n  isNeutralState: function(/* options */) {\n    var main = this.mainParameter,\n        _class = fabric.Image.filters[this.type].prototype;\n    if (main) {\n      if (Array.isArray(_class[main])) {\n        for (var i = _class[main].length; i--;) {\n          if (this[main][i] !== _class[main][i]) {\n            return false;\n          }\n        }\n        return true;\n      }\n      else {\n        return _class[main] === this[main];\n      }\n    }\n    else {\n      return false;\n    }\n  },\n\n  /**\n   * Apply this filter to the input image data provided.\n   *\n   * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n   *\n   * @param {Object} options\n   * @param {Number} options.passes The number of filters remaining to be executed\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  applyTo: function(options) {\n    if (options.webgl) {\n      this._setupFrameBuffer(options);\n      this.applyToWebGL(options);\n      this._swapTextures(options);\n    }\n    else {\n      this.applyTo2d(options);\n    }\n  },\n\n  /**\n   * Retrieves the cached shader.\n   * @param {Object} options\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  retrieveShader: function(options) {\n    if (!options.programCache.hasOwnProperty(this.type)) {\n      options.programCache[this.type] = this.createProgram(options.context);\n    }\n    return options.programCache[this.type];\n  },\n\n  /**\n   * Apply this filter using webgl.\n   *\n   * @param {Object} options\n   * @param {Number} options.passes The number of filters remaining to be executed\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n   * @param {WebGLTexture} options.originalTexture The texture of the original input image.\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  applyToWebGL: function(options) {\n    var gl = options.context;\n    var shader = this.retrieveShader(options);\n    if (options.pass === 0 && options.originalTexture) {\n      gl.bindTexture(gl.TEXTURE_2D, options.originalTexture);\n    }\n    else {\n      gl.bindTexture(gl.TEXTURE_2D, options.sourceTexture);\n    }\n    gl.useProgram(shader.program);\n    this.sendAttributeData(gl, shader.attributeLocations, options.aPosition);\n\n    gl.uniform1f(shader.uniformLocations.uStepW, 1 / options.sourceWidth);\n    gl.uniform1f(shader.uniformLocations.uStepH, 1 / options.sourceHeight);\n\n    this.sendUniformData(gl, shader.uniformLocations);\n    gl.viewport(0, 0, options.destinationWidth, options.destinationHeight);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  },\n\n  bindAdditionalTexture: function(gl, texture, textureUnit) {\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    // reset active texture to 0 as usual\n    gl.activeTexture(gl.TEXTURE0);\n  },\n\n  unbindAdditionalTexture: function(gl, textureUnit) {\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    gl.activeTexture(gl.TEXTURE0);\n  },\n\n  getMainParameter: function() {\n    return this[this.mainParameter];\n  },\n\n  setMainParameter: function(value) {\n    this[this.mainParameter] = value;\n  },\n\n  /**\n   * Send uniform data from this filter to its shader program on the GPU.\n   *\n   * Intended to be overridden by subclasses.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {Object} uniformLocations A map of shader uniform names to their locations.\n   */\n  sendUniformData: function(/* gl, uniformLocations */) {\n    // Intentionally left blank.  Override me in subclasses.\n  },\n\n  /**\n   * If needed by a 2d filter, this functions can create an helper canvas to be used\n   * remember that options.targetCanvas is available for use till end of chain.\n   */\n  createHelpLayer: function(options) {\n    if (!options.helpLayer) {\n      var helpLayer = document.createElement('canvas');\n      helpLayer.width = options.sourceWidth;\n      helpLayer.height = options.sourceHeight;\n      options.helpLayer = helpLayer;\n    }\n  },\n\n  /**\n   * Returns object representation of an instance\n   * @return {Object} Object representation of an instance\n   */\n  toObject: function() {\n    var object = { type: this.type }, mainP = this.mainParameter;\n    if (mainP) {\n      object[mainP] = this[mainP];\n    }\n    return object;\n  },\n\n  /**\n   * Returns a JSON representation of an instance\n   * @return {Object} JSON\n   */\n  toJSON: function() {\n    // delegate, not alias\n    return this.toObject();\n  }\n});\n\nfabric.Image.filters.BaseFilter.fromObject = function(object, callback) {\n  var filter = new fabric.Image.filters[object.type](object);\n  callback && callback(filter);\n  return filter;\n};\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Matrix filter class\n   * @class fabric.Image.filters.ColorMatrix\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.ColorMatrix#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @see {@Link http://www.webwasp.co.uk/tutorials/219/Color_Matrix_Filter.php}\n   * @see {@Link http://phoboslab.org/log/2013/11/fast-image-filters-with-webgl}\n   * @example <caption>Kodachrome filter</caption>\n   * var filter = new fabric.Image.filters.ColorMatrix({\n   *  matrix: [\n       1.1285582396593525, -0.3967382283601348, -0.03992559172921793, 0, 63.72958762196502,\n       -0.16404339962244616, 1.0835251566291304, -0.05498805115633132, 0, 24.732407896706203,\n       -0.16786010706155763, -0.5603416277695248, 1.6014850761964943, 0, 35.62982807460946,\n       0, 0, 0, 1, 0\n      ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.ColorMatrix = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.ColorMatrix.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'ColorMatrix',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'uniform mat4 uColorMatrix;\\n' +\n      'uniform vec4 uConstants;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color *= uColorMatrix;\\n' +\n        'color += uConstants;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Colormatrix for pixels.\n     * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n     * outside the -1, 1 range.\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n     * @param {Array} matrix array of 20 numbers.\n     * @default\n     */\n    matrix: [\n      1, 0, 0, 0, 0,\n      0, 1, 0, 0, 0,\n      0, 0, 1, 0, 0,\n      0, 0, 0, 1, 0\n    ],\n\n    mainParameter: 'matrix',\n\n    /**\n     * Lock the colormatrix on the color part, skipping alpha, manly for non webgl scenario\n     * to save some calculation\n     */\n    colorsOnly: true,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      // create a new array instead mutating the prototype with push\n      this.matrix = this.matrix.slice(0);\n    },\n\n    /**\n     * Apply the ColorMatrix operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          iLen = data.length,\n          m = this.matrix,\n          r, g, b, a, i, colorsOnly = this.colorsOnly;\n\n      for (i = 0; i < iLen; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n        if (colorsOnly) {\n          data[i] = r * m[0] + g * m[1] + b * m[2] + m[4] * 255;\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + m[9] * 255;\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + m[14] * 255;\n        }\n        else {\n          a = data[i + 3];\n          data[i] = r * m[0] + g * m[1] + b * m[2] + a * m[3] + m[4] * 255;\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + a * m[8] + m[9] * 255;\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + a * m[13] + m[14] * 255;\n          data[i + 3] = r * m[15] + g * m[16] + b * m[17] + a * m[18] + m[19] * 255;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uColorMatrix: gl.getUniformLocation(program, 'uColorMatrix'),\n        uConstants: gl.getUniformLocation(program, 'uConstants'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var m = this.matrix,\n          matrix = [\n            m[0], m[1], m[2], m[3],\n            m[5], m[6], m[7], m[8],\n            m[10], m[11], m[12], m[13],\n            m[15], m[16], m[17], m[18]\n          ],\n          constants = [m[4], m[9], m[14], m[19]];\n      gl.uniformMatrix4fv(uniformLocations.uColorMatrix, false, matrix);\n      gl.uniform4fv(uniformLocations.uConstants, constants);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] function to invoke after filter creation\n   * @return {fabric.Image.filters.ColorMatrix} Instance of fabric.Image.filters.ColorMatrix\n   */\n  fabric.Image.filters.ColorMatrix.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Brightness filter class\n   * @class fabric.Image.filters.Brightness\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Brightness#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Brightness({\n   *   brightness: 0.05\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Brightness = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Brightness.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Brightness',\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uBrightness;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color.rgb += uBrightness;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Brightness value, from -1 to 1.\n     * translated to -255 to 255 for 2d\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n     * @param {Number} brightness\n     * @default\n     */\n    brightness: 0,\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'brightness',\n\n    /**\n    * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n    *\n    * @param {Object} options\n    * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n    */\n    applyTo2d: function(options) {\n      if (this.brightness === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, i, len = data.length,\n          brightness = Math.round(this.brightness * 255);\n      for (i = 0; i < len; i += 4) {\n        data[i] = data[i] + brightness;\n        data[i + 1] = data[i + 1] + brightness;\n        data[i + 2] = data[i + 2] + brightness;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uBrightness: gl.getUniformLocation(program, 'uBrightness'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uBrightness, this.brightness);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Brightness} Instance of fabric.Image.filters.Brightness\n   */\n  fabric.Image.filters.Brightness.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Adapted from <a href=\"http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\">html5rocks article</a>\n   * @class fabric.Image.filters.Convolute\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Convolute#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example <caption>Sharpen filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 0, -1,  0,\n   *            -1,  5, -1,\n   *             0, -1,  0 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Blur filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter with opaqueness</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   opaque: true,\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Convolute = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Convolute.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Convolute',\n\n    /*\n     * Opaque value (true/false)\n     */\n    opaque: false,\n\n    /*\n     * matrix for the filter, max 9x9\n     */\n    matrix: [0, 0, 0, 0, 1, 0, 0, 0, 0],\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: {\n      Convolute_3_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[9];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_3_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[9];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_5_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[25];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_5_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[25];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_7_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[49];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_7_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[49];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_9_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[81];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_9_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[81];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n    },\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Convolute.prototype\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.opaque=false] Opaque value (true/false)\n     * @param {Array} [options.matrix] Filter matrix\n     */\n\n\n    /**\n    * Retrieves the cached shader.\n    * @param {Object} options\n    * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n    * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n    */\n    retrieveShader: function(options) {\n      var size = Math.sqrt(this.matrix.length);\n      var cacheKey = this.type + '_' + size + '_' + (this.opaque ? 1 : 0);\n      var shaderSource = this.fragmentSource[cacheKey];\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          weights = this.matrix,\n          side = Math.round(Math.sqrt(weights.length)),\n          halfSide = Math.floor(side / 2),\n          sw = imageData.width,\n          sh = imageData.height,\n          output = options.ctx.createImageData(sw, sh),\n          dst = output.data,\n          // go through the destination image pixels\n          alphaFac = this.opaque ? 1 : 0,\n          r, g, b, a, dstOff,\n          scx, scy, srcOff, wt,\n          x, y, cx, cy;\n\n      for (y = 0; y < sh; y++) {\n        for (x = 0; x < sw; x++) {\n          dstOff = (y * sw + x) * 4;\n          // calculate the weighed sum of the source image pixels that\n          // fall under the convolution matrix\n          r = 0; g = 0; b = 0; a = 0;\n\n          for (cy = 0; cy < side; cy++) {\n            for (cx = 0; cx < side; cx++) {\n              scy = y + cy - halfSide;\n              scx = x + cx - halfSide;\n\n              // eslint-disable-next-line max-depth\n              if (scy < 0 || scy >= sh || scx < 0 || scx >= sw) {\n                continue;\n              }\n\n              srcOff = (scy * sw + scx) * 4;\n              wt = weights[cy * side + cx];\n\n              r += data[srcOff] * wt;\n              g += data[srcOff + 1] * wt;\n              b += data[srcOff + 2] * wt;\n              // eslint-disable-next-line max-depth\n              if (!alphaFac) {\n                a += data[srcOff + 3] * wt;\n              }\n            }\n          }\n          dst[dstOff] = r;\n          dst[dstOff + 1] = g;\n          dst[dstOff + 2] = b;\n          if (!alphaFac) {\n            dst[dstOff + 3] = a;\n          }\n          else {\n            dst[dstOff + 3] = data[dstOff + 3];\n          }\n        }\n      }\n      options.imageData = output;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uMatrix: gl.getUniformLocation(program, 'uMatrix'),\n        uOpaque: gl.getUniformLocation(program, 'uOpaque'),\n        uHalfSize: gl.getUniformLocation(program, 'uHalfSize'),\n        uSize: gl.getUniformLocation(program, 'uSize'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1fv(uniformLocations.uMatrix, this.matrix);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        opaque: this.opaque,\n        matrix: this.matrix\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Convolute} Instance of fabric.Image.filters.Convolute\n   */\n  fabric.Image.filters.Convolute.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Grayscale image filter class\n   * @class fabric.Image.filters.Grayscale\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Grayscale();\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Grayscale = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Grayscale.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Grayscale',\n\n    fragmentSource: {\n      average: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = (color.r + color.b + color.g) / 3.0;\\n' +\n          'gl_FragColor = vec4(average, average, average, color.a);\\n' +\n        '}',\n      lightness: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform int uMode;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\\n' +\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\n        '}',\n      luminosity: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform int uMode;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\\n' +\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\n        '}',\n    },\n\n\n    /**\n     * Grayscale mode, between 'average', 'lightness', 'luminosity'\n     * @param {String} type\n     * @default\n     */\n    mode: 'average',\n\n    mainParameter: 'mode',\n\n    /**\n     * Apply the Grayscale operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          len = data.length, value,\n          mode = this.mode;\n      for (i = 0; i < len; i += 4) {\n        if (mode === 'average') {\n          value = (data[i] + data[i + 1] + data[i + 2]) / 3;\n        }\n        else if (mode === 'lightness') {\n          value = (Math.min(data[i], data[i + 1], data[i + 2]) +\n            Math.max(data[i], data[i + 1], data[i + 2])) / 2;\n        }\n        else if (mode === 'luminosity') {\n          value = 0.21 * data[i] + 0.72 * data[i + 1] + 0.07 * data[i + 2];\n        }\n        data[i] = value;\n        data[i + 1] = value;\n        data[i + 2] = value;\n      }\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        var shaderSource = this.fragmentSource[this.mode];\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uMode: gl.getUniformLocation(program, 'uMode'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      // default average mode.\n      var mode = 1;\n      gl.uniform1i(uniformLocations.uMode, mode);\n    },\n\n    /**\n     * Grayscale filter isNeutralState implementation\n     * The filter is never neutral\n     * on the image\n     **/\n    isNeutralState: function() {\n      return false;\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Grayscale} Instance of fabric.Image.filters.Grayscale\n   */\n  fabric.Image.filters.Grayscale.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Invert filter class\n   * @class fabric.Image.filters.Invert\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Invert();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Invert = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Invert.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Invert',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform int uInvert;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'if (uInvert == 1) {\\n' +\n          'gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\\n' +\n        '} else {\\n' +\n          'gl_FragColor = color;\\n' +\n        '}\\n' +\n      '}',\n\n    /**\n     * Filter invert. if false, does nothing\n     * @param {Boolean} invert\n     * @default\n     */\n    invert: true,\n\n    mainParameter: 'invert',\n\n    /**\n     * Apply the Invert operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          len = data.length;\n      for (i = 0; i < len; i += 4) {\n        data[i] = 255 - data[i];\n        data[i + 1] = 255 - data[i + 1];\n        data[i + 2] = 255 - data[i + 2];\n      }\n    },\n\n    /**\n     * Invert filter isNeutralState implementation\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * @param {Object} options\n     **/\n    isNeutralState: function() {\n      return !this.invert;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uInvert: gl.getUniformLocation(program, 'uInvert'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1i(uniformLocations.uInvert, this.invert);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Invert} Instance of fabric.Image.filters.Invert\n   */\n  fabric.Image.filters.Invert.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Noise filter class\n   * @class fabric.Image.filters.Noise\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Noise#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Noise({\n   *   noise: 700\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Noise = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Noise.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Noise',\n\n    /**\n     * Fragment source for the noise program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uStepH;\\n' +\n      'uniform float uNoise;\\n' +\n      'uniform float uSeed;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'float rand(vec2 co, float seed, float vScale) {\\n' +\n        'return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\\n' +\n      '}\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'noise',\n\n    /**\n     * Noise value, from\n     * @param {Number} noise\n     * @default\n     */\n    noise: 0,\n\n    /**\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.noise === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, i, len = data.length,\n          noise = this.noise, rand;\n\n      for (i = 0, len = data.length; i < len; i += 4) {\n\n        rand = (0.5 - Math.random()) * noise;\n\n        data[i] += rand;\n        data[i + 1] += rand;\n        data[i + 2] += rand;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uNoise: gl.getUniformLocation(program, 'uNoise'),\n        uSeed: gl.getUniformLocation(program, 'uSeed'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uNoise, this.noise / 255);\n      gl.uniform1f(uniformLocations.uSeed, Math.random());\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        noise: this.noise\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Noise} Instance of fabric.Image.filters.Noise\n   */\n  fabric.Image.filters.Noise.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Pixelate filter class\n   * @class fabric.Image.filters.Pixelate\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Pixelate#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Pixelate({\n   *   blocksize: 8\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Pixelate = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Pixelate.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Pixelate',\n\n    blocksize: 4,\n\n    mainParameter: 'blocksize',\n\n    /**\n     * Fragment source for the Pixelate program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uBlocksize;\\n' +\n      'uniform float uStepW;\\n' +\n      'uniform float uStepH;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'float blockW = uBlocksize * uStepW;\\n' +\n        'float blockH = uBlocksize * uStepW;\\n' +\n        'int posX = int(vTexCoord.x / blockW);\\n' +\n        'int posY = int(vTexCoord.y / blockH);\\n' +\n        'float fposX = float(posX);\\n' +\n        'float fposY = float(posY);\\n' +\n        'vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\\n' +\n        'vec4 color = texture2D(uTexture, squareCoords);\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Apply the Pixelate operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          iLen = imageData.height,\n          jLen = imageData.width,\n          index, i, j, r, g, b, a,\n          _i, _j, _iLen, _jLen;\n\n      for (i = 0; i < iLen; i += this.blocksize) {\n        for (j = 0; j < jLen; j += this.blocksize) {\n\n          index = (i * 4) * jLen + (j * 4);\n\n          r = data[index];\n          g = data[index + 1];\n          b = data[index + 2];\n          a = data[index + 3];\n\n          _iLen = Math.min(i + this.blocksize, iLen);\n          _jLen = Math.min(j + this.blocksize, jLen);\n          for (_i = i; _i < _iLen; _i++) {\n            for (_j = j; _j < _jLen; _j++) {\n              index = (_i * 4) * jLen + (_j * 4);\n              data[index] = r;\n              data[index + 1] = g;\n              data[index + 2] = b;\n              data[index + 3] = a;\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Indicate when the filter is not gonna apply changes to the image\n     **/\n    isNeutralState: function() {\n      return this.blocksize === 1;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uBlocksize: gl.getUniformLocation(program, 'uBlocksize'),\n        uStepW: gl.getUniformLocation(program, 'uStepW'),\n        uStepH: gl.getUniformLocation(program, 'uStepH'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uBlocksize, this.blocksize);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Pixelate} Instance of fabric.Image.filters.Pixelate\n   */\n  fabric.Image.filters.Pixelate.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Remove white filter class\n   * @class fabric.Image.filters.RemoveColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.RemoveColor#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.RemoveColor({\n   *   threshold: 0.2,\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.RemoveColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.RemoveColor.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'RemoveColor',\n\n    /**\n     * Color to remove, in any format understood by fabric.Color.\n     * @param {String} type\n     * @default\n     */\n    color: '#FFFFFF',\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec4 uLow;\\n' +\n      'uniform vec4 uHigh;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\n        'if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\\n' +\n          'gl_FragColor.a = 0.0;\\n' +\n        '}\\n' +\n      '}',\n\n    /**\n     * distance to actual color, as value up or down from each r,g,b\n     * between 0 and 1\n     **/\n    distance: 0.02,\n\n    /**\n     * For color to remove inside distance, use alpha channel for a smoother deletion\n     * NOT IMPLEMENTED YET\n     **/\n    useAlpha: false,\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.RemoveWhite.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.color=#RRGGBB] Threshold value\n     * @param {Number} [options.distance=10] Distance value\n     */\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          distance = this.distance * 255,\n          r, g, b,\n          source = new fabric.Color(this.color).getSource(),\n          lowC = [\n            source[0] - distance,\n            source[1] - distance,\n            source[2] - distance,\n          ],\n          highC = [\n            source[0] + distance,\n            source[1] + distance,\n            source[2] + distance,\n          ];\n\n\n      for (i = 0; i < data.length; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        if (r > lowC[0] &&\n            g > lowC[1] &&\n            b > lowC[2] &&\n            r < highC[0] &&\n            g < highC[1] &&\n            b < highC[2]) {\n          data[i + 3] = 0;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uLow: gl.getUniformLocation(program, 'uLow'),\n        uHigh: gl.getUniformLocation(program, 'uHigh'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var source = new fabric.Color(this.color).getSource(),\n          distance = parseFloat(this.distance),\n          lowC = [\n            0 + source[0] / 255 - distance,\n            0 + source[1] / 255 - distance,\n            0 + source[2] / 255 - distance,\n            1\n          ],\n          highC = [\n            source[0] / 255 + distance,\n            source[1] / 255 + distance,\n            source[2] / 255 + distance,\n            1\n          ];\n      gl.uniform4fv(uniformLocations.uLow, lowC);\n      gl.uniform4fv(uniformLocations.uHigh, highC);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        color: this.color,\n        distance: this.distance\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.RemoveColor} Instance of fabric.Image.filters.RemoveWhite\n   */\n  fabric.Image.filters.RemoveColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  var matrices = {\n    Brownie: [\n      0.59970,0.34553,-0.27082,0,0.186,\n      -0.03770,0.86095,0.15059,0,-0.1449,\n      0.24113,-0.07441,0.44972,0,-0.02965,\n      0,0,0,1,0\n    ],\n    Vintage: [\n      0.62793,0.32021,-0.03965,0,0.03784,\n      0.02578,0.64411,0.03259,0,0.02926,\n      0.04660,-0.08512,0.52416,0,0.02023,\n      0,0,0,1,0\n    ],\n    Kodachrome: [\n      1.12855,-0.39673,-0.03992,0,0.24991,\n      -0.16404,1.08352,-0.05498,0,0.09698,\n      -0.16786,-0.56034,1.60148,0,0.13972,\n      0,0,0,1,0\n    ],\n    Technicolor: [\n      1.91252,-0.85453,-0.09155,0,0.04624,\n      -0.30878,1.76589,-0.10601,0,-0.27589,\n      -0.23110,-0.75018,1.84759,0,0.12137,\n      0,0,0,1,0\n    ],\n    Polaroid: [\n      1.438,-0.062,-0.062,0,0,\n      -0.122,1.378,-0.122,0,0,\n      -0.016,-0.016,1.483,0,0,\n      0,0,0,1,0\n    ],\n    Sepia: [\n      0.393, 0.769, 0.189, 0, 0,\n      0.349, 0.686, 0.168, 0, 0,\n      0.272, 0.534, 0.131, 0, 0,\n      0, 0, 0, 1, 0\n    ],\n    BlackWhite: [\n      1.5, 1.5, 1.5, 0, -1,\n      1.5, 1.5, 1.5, 0, -1,\n      1.5, 1.5, 1.5, 0, -1,\n      0, 0, 0, 1, 0,\n    ]\n  };\n\n  for (var key in matrices) {\n    filters[key] = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.Sepia.prototype */ {\n\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: key,\n\n      /**\n       * Colormatrix for the effect\n       * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n       * outside the -1, 1 range.\n       * @param {Array} matrix array of 20 numbers.\n       * @default\n       */\n      matrix: matrices[key],\n\n      /**\n       * Lock the matrix export for this kind of static, parameter less filters.\n       */\n      mainParameter: false,\n      /**\n       * Lock the colormatrix on the color part, skipping alpha\n       */\n      colorsOnly: true,\n\n    });\n    fabric.Image.filters[key].fromObject = fabric.Image.filters.BaseFilter.fromObject;\n  }\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Blend filter class\n   * @class fabric.Image.filter.BlendColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blend.prototype */ {\n    type: 'BlendColor',\n\n    /**\n     * Color to make the blend operation with. default to a reddish color since black or white\n     * gives always strong result.\n     **/\n    color: '#F95C63',\n\n    /**\n     * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n     * darken, lighten, overlay, exclusion, tint.\n     **/\n    mode: 'multiply',\n\n    /**\n     * alpha value. represent the strength of the blend color operation.\n     **/\n    alpha: 1,\n\n    /**\n     * Fragment source for the Multiply program\n     */\n    fragmentSource: {\n      multiply: 'gl_FragColor.rgb *= uColor.rgb;\\n',\n      screen: 'gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\\n',\n      add: 'gl_FragColor.rgb += uColor.rgb;\\n',\n      diff: 'gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\\n',\n      subtract: 'gl_FragColor.rgb -= uColor.rgb;\\n',\n      lighten: 'gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\\n',\n      darken: 'gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\\n',\n      exclusion: 'gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\\n',\n      overlay: 'if (uColor.r < 0.5) {\\n' +\n          'gl_FragColor.r *= 2.0 * uColor.r;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\\n' +\n        '}\\n' +\n        'if (uColor.g < 0.5) {\\n' +\n          'gl_FragColor.g *= 2.0 * uColor.g;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\\n' +\n        '}\\n' +\n        'if (uColor.b < 0.5) {\\n' +\n          'gl_FragColor.b *= 2.0 * uColor.b;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\\n' +\n        '}\\n',\n      tint: 'gl_FragColor.rgb *= (1.0 - uColor.a);\\n' +\n        'gl_FragColor.rgb += uColor.rgb;\\n',\n    },\n\n    /**\n     * build the fragment source for the filters, joining the common part with\n     * the specific one.\n     * @param {String} mode the mode of the filter, a key of this.fragmentSource\n     * @return {String} the source to be compiled\n     * @private\n     */\n    buildSource: function(mode) {\n      return 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'gl_FragColor = color;\\n' +\n          'if (color.a > 0.0) {\\n' +\n            this.fragmentSource[mode] +\n          '}\\n' +\n        '}';\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode, shaderSource;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        shaderSource = this.buildSource(this.mode);\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, iLen = data.length,\n          tr, tg, tb,\n          r, g, b,\n          source, alpha1 = 1 - this.alpha;\n\n      source = new fabric.Color(this.color).getSource();\n      tr = source[0] * this.alpha;\n      tg = source[1] * this.alpha;\n      tb = source[2] * this.alpha;\n\n      for (var i = 0; i < iLen; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            break;\n          case 'screen':\n            data[i] = 255 - (255 - r) * (255 - tr) / 255;\n            data[i + 1] = 255 - (255 - g) * (255 - tg) / 255;\n            data[i + 2] = 255 - (255 - b) * (255 - tb) / 255;\n            break;\n          case 'add':\n            data[i] = r + tr;\n            data[i + 1] = g + tg;\n            data[i + 2] = b + tb;\n            break;\n          case 'diff':\n          case 'difference':\n            data[i] = Math.abs(r - tr);\n            data[i + 1] = Math.abs(g - tg);\n            data[i + 2] = Math.abs(b - tb);\n            break;\n          case 'subtract':\n            data[i] = r - tr;\n            data[i + 1] = g - tg;\n            data[i + 2] = b - tb;\n            break;\n          case 'darken':\n            data[i] = Math.min(r, tr);\n            data[i + 1] = Math.min(g, tg);\n            data[i + 2] = Math.min(b, tb);\n            break;\n          case 'lighten':\n            data[i] = Math.max(r, tr);\n            data[i + 1] = Math.max(g, tg);\n            data[i + 2] = Math.max(b, tb);\n            break;\n          case 'overlay':\n            data[i] = tr < 128 ? (2 * r * tr / 255) : (255 - 2 * (255 - r) * (255 - tr) / 255);\n            data[i + 1] = tg < 128 ? (2 * g * tg / 255) : (255 - 2 * (255 - g) * (255 - tg) / 255);\n            data[i + 2] = tb < 128 ? (2 * b * tb / 255) : (255 - 2 * (255 - b) * (255 - tb) / 255);\n            break;\n          case 'exclusion':\n            data[i] = tr + r - ((2 * tr * r) / 255);\n            data[i + 1] = tg + g - ((2 * tg * g) / 255);\n            data[i + 2] = tb + b - ((2 * tb * b) / 255);\n            break;\n          case 'tint':\n            data[i] = tr + r * alpha1;\n            data[i + 1] = tg + g * alpha1;\n            data[i + 2] = tb + b * alpha1;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uColor: gl.getUniformLocation(program, 'uColor'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var source = new fabric.Color(this.color).getSource();\n      source[0] = this.alpha * source[0] / 255;\n      source[1] = this.alpha * source[1] / 255;\n      source[2] = this.alpha * source[2] / 255;\n      source[3] = this.alpha;\n      gl.uniform4fv(uniformLocations.uColor, source);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        color: this.color,\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendColor} Instance of fabric.Image.filters.BlendColor\n   */\n  fabric.Image.filters.BlendColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Image Blend filter class\n   * @class fabric.Image.filter.BlendImage\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendImage = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.BlendImage.prototype */ {\n    type: 'BlendImage',\n\n    /**\n     * Color to make the blend operation with. default to a reddish color since black or white\n     * gives always strong result.\n     **/\n    image: null,\n\n    /**\n     * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n     * darken, lighten, overlay, exclusion, tint.\n     **/\n    mode: 'multiply',\n\n    /**\n     * alpha value. represent the strength of the blend image operation.\n     * not implemented.\n     **/\n    alpha: 1,\n\n    vertexSource: 'attribute vec2 aPosition;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'varying vec2 vTexCoord2;\\n' +\n      'uniform mat3 uTransformMatrix;\\n' +\n      'void main() {\\n' +\n        'vTexCoord = aPosition;\\n' +\n        'vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\\n' +\n        'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\n      '}',\n\n    /**\n     * Fragment source for the Multiply program\n     */\n    fragmentSource: {\n      multiply: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform sampler2D uImage;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'varying vec2 vTexCoord2;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\n          'color.rgba *= color2.rgba;\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      mask: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform sampler2D uImage;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'varying vec2 vTexCoord2;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\n          'color.a = color2.a;\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode;\n      var shaderSource = this.fragmentSource[this.mode];\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    applyToWebGL: function(options) {\n      // load texture to blend.\n      var gl = options.context,\n          texture = this.createTexture(options.filterBackend, this.image);\n      this.bindAdditionalTexture(gl, texture, gl.TEXTURE1);\n      this.callSuper('applyToWebGL', options);\n      this.unbindAdditionalTexture(gl, gl.TEXTURE1);\n    },\n\n    createTexture: function(backend, image) {\n      return backend.getCachedTexture(image.cacheKey, image._element);\n    },\n\n    /**\n     * Calculate a transformMatrix to adapt the image to blend over\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    calculateMatrix: function() {\n      var image = this.image,\n          width = image._element.width,\n          height = image._element.height;\n      return [\n        1 / image.scaleX, 0, 0,\n        0, 1 / image.scaleY, 0,\n        -image.left / width, -image.top / height, 1\n      ];\n    },\n\n    /**\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          resources = options.filterBackend.resources,\n          data = imageData.data, iLen = data.length,\n          width = imageData.width,\n          height = imageData.height,\n          tr, tg, tb, ta,\n          r, g, b, a,\n          canvas1, context, image = this.image, blendData;\n\n      if (!resources.blendImage) {\n        resources.blendImage = fabric.util.createCanvasElement();\n      }\n      canvas1 = resources.blendImage;\n      context = canvas1.getContext('2d');\n      if (canvas1.width !== width || canvas1.height !== height) {\n        canvas1.width = width;\n        canvas1.height = height;\n      }\n      else {\n        context.clearRect(0, 0, width, height);\n      }\n      context.setTransform(image.scaleX, 0, 0, image.scaleY, image.left, image.top);\n      context.drawImage(image._element, 0, 0, width, height);\n      blendData = context.getImageData(0, 0, width, height).data;\n      for (var i = 0; i < iLen; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n        a = data[i + 3];\n\n        tr = blendData[i];\n        tg = blendData[i + 1];\n        tb = blendData[i + 2];\n        ta = blendData[i + 3];\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            data[i + 3] = a * ta / 255;\n            break;\n          case 'mask':\n            data[i + 3] = ta;\n            break;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uTransformMatrix: gl.getUniformLocation(program, 'uTransformMatrix'),\n        uImage: gl.getUniformLocation(program, 'uImage'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var matrix = this.calculateMatrix();\n      gl.uniform1i(uniformLocations.uImage, 1); // texture unit 1.\n      gl.uniformMatrix3fv(uniformLocations.uTransformMatrix, false, matrix);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        image: this.image && this.image.toObject(),\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} callback to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendImage} Instance of fabric.Image.filters.BlendImage\n   */\n  fabric.Image.filters.BlendImage.fromObject = function(object, callback) {\n    fabric.Image.fromObject(object.image, function(image) {\n      var options = fabric.util.object.clone(object);\n      options.image = image;\n      callback(new fabric.Image.filters.BlendImage(options));\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }), pow = Math.pow, floor = Math.floor,\n      sqrt = Math.sqrt, abs = Math.abs, round = Math.round, sin = Math.sin,\n      ceil = Math.ceil,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Resize image filter class\n   * @class fabric.Image.filters.Resize\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Resize();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Resize = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Resize.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Resize',\n\n    /**\n     * Resize type\n     * for webgl resizeType is just lanczos, for canvas2d can be:\n     * bilinear, hermite, sliceHack, lanczos.\n     * @param {String} resizeType\n     * @default\n     */\n    resizeType: 'hermite',\n\n    /**\n     * Scale factor for resizing, x axis\n     * @param {Number} scaleX\n     * @default\n     */\n    scaleX: 1,\n\n    /**\n     * Scale factor for resizing, y axis\n     * @param {Number} scaleY\n     * @default\n     */\n    scaleY: 1,\n\n    /**\n     * LanczosLobes parameter for lanczos filter, valid for resizeType lanczos\n     * @param {Number} lanczosLobes\n     * @default\n     */\n    lanczosLobes: 3,\n\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uDelta: gl.getUniformLocation(program, 'uDelta'),\n        uTaps: gl.getUniformLocation(program, 'uTaps'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform2fv(uniformLocations.uDelta, this.horizontal ? [1 / this.width, 0] : [0, 1 / this.height]);\n      gl.uniform1fv(uniformLocations.uTaps, this.taps);\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var filterWindow = this.getFilterWindow(), cacheKey = this.type + '_' + filterWindow;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        var fragmentShader = this.generateShader(filterWindow);\n        options.programCache[cacheKey] = this.createProgram(options.context, fragmentShader);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    getFilterWindow: function() {\n      var scale = this.tempScale;\n      return Math.ceil(this.lanczosLobes / scale);\n    },\n\n    getTaps: function() {\n      var lobeFunction = this.lanczosCreate(this.lanczosLobes), scale = this.tempScale,\n          filterWindow = this.getFilterWindow(), taps = new Array(filterWindow);\n      for (var i = 1; i <= filterWindow; i++) {\n        taps[i - 1] = lobeFunction(i * scale);\n      }\n      return taps;\n    },\n\n    /**\n     * Generate vertex and shader sources from the necessary steps numbers\n     * @param {Number} filterWindow\n     */\n    generateShader: function(filterWindow) {\n      var offsets = new Array(filterWindow),\n          fragmentShader = this.fragmentSourceTOP, filterWindow;\n\n      for (var i = 1; i <= filterWindow; i++) {\n        offsets[i - 1] = i + '.0 * uDelta';\n      }\n\n      fragmentShader += 'uniform float uTaps[' + filterWindow + '];\\n';\n      fragmentShader += 'void main() {\\n';\n      fragmentShader += '  vec4 color = texture2D(uTexture, vTexCoord);\\n';\n      fragmentShader += '  float sum = 1.0;\\n';\n\n      offsets.forEach(function(offset, i) {\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord + ' + offset + ') * uTaps[' + i + '];\\n';\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord - ' + offset + ') * uTaps[' + i + '];\\n';\n        fragmentShader += '  sum += 2.0 * uTaps[' + i + '];\\n';\n      });\n      fragmentShader += '  gl_FragColor = color / sum;\\n';\n      fragmentShader += '}';\n      return fragmentShader;\n    },\n\n    fragmentSourceTOP: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec2 uDelta;\\n' +\n      'varying vec2 vTexCoord;\\n',\n\n    /**\n     * Apply the resize filter to the image\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyTo: function(options) {\n      if (options.webgl) {\n        options.passes++;\n        this.width = options.sourceWidth;\n        this.horizontal = true;\n        this.dW = Math.round(this.width * this.scaleX);\n        this.dH = options.sourceHeight;\n        this.tempScale = this.dW / this.width;\n        this.taps = this.getTaps();\n        options.destinationWidth = this.dW;\n        this._setupFrameBuffer(options);\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        options.sourceWidth = options.destinationWidth;\n\n        this.height = options.sourceHeight;\n        this.horizontal = false;\n        this.dH = Math.round(this.height * this.scaleY);\n        this.tempScale = this.dH / this.height;\n        this.taps = this.getTaps();\n        options.destinationHeight = this.dH;\n        this._setupFrameBuffer(options);\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        options.sourceHeight = options.destinationHeight;\n      }\n      else {\n        this.applyTo2d(options);\n      }\n    },\n\n    isNeutralState: function() {\n      return this.scaleX === 1 && this.scaleY === 1;\n    },\n\n    lanczosCreate: function(lobes) {\n      return function(x) {\n        if (x >= lobes || x <= -lobes) {\n          return 0.0;\n        }\n        if (x < 1.19209290E-07 && x > -1.19209290E-07) {\n          return 1.0;\n        }\n        x *= Math.PI;\n        var xx = x / lobes;\n        return (sin(x) / x) * sin(xx) / xx;\n      };\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Resize.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} scaleX\n     * @param {Number} scaleY\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          scaleX = this.scaleX,\n          scaleY = this.scaleY;\n\n      this.rcpScaleX = 1 / scaleX;\n      this.rcpScaleY = 1 / scaleY;\n\n      var oW = imageData.width, oH = imageData.height,\n          dW = round(oW * scaleX), dH = round(oH * scaleY),\n          newData;\n\n      if (this.resizeType === 'sliceHack') {\n        newData = this.sliceByTwo(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'hermite') {\n        newData = this.hermiteFastResize(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'bilinear') {\n        newData = this.bilinearFiltering(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'lanczos') {\n        newData = this.lanczosResize(options, oW, oH, dW, dH);\n      }\n      options.imageData = newData;\n    },\n\n    /**\n     * Filter sliceByTwo\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    sliceByTwo: function(options, oW, oH, dW, dH) {\n      var imageData = options.imageData,\n          mult = 0.5, doneW = false, doneH = false, stepW = oW * mult,\n          stepH = oH * mult, resources = fabric.filterBackend.resources,\n          tmpCanvas, ctx, sX = 0, sY = 0, dX = oW, dY = 0;\n      if (!resources.sliceByTwo) {\n        resources.sliceByTwo = document.createElement('canvas');\n      }\n      tmpCanvas = resources.sliceByTwo;\n      if (tmpCanvas.width < oW * 1.5 || tmpCanvas.height < oH) {\n        tmpCanvas.width = oW * 1.5;\n        tmpCanvas.height = oH;\n      }\n      ctx = tmpCanvas.getContext('2d');\n      ctx.clearRect(0, 0, oW * 1.5, oH);\n      ctx.putImageData(imageData, 0, 0);\n\n      dW = floor(dW);\n      dH = floor(dH);\n\n      while (!doneW || !doneH) {\n        oW = stepW;\n        oH = stepH;\n        if (dW < floor(stepW * mult)) {\n          stepW = floor(stepW * mult);\n        }\n        else {\n          stepW = dW;\n          doneW = true;\n        }\n        if (dH < floor(stepH * mult)) {\n          stepH = floor(stepH * mult);\n        }\n        else {\n          stepH = dH;\n          doneH = true;\n        }\n        ctx.drawImage(tmpCanvas, sX, sY, oW, oH, dX, dY, stepW, stepH);\n        sX = dX;\n        sY = dY;\n        dY += stepH;\n      }\n      return ctx.getImageData(sX, sY, dW, dH);\n    },\n\n    /**\n     * Filter lanczosResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    lanczosResize: function(options, oW, oH, dW, dH) {\n\n      function process(u) {\n        var v, i, weight, idx, a, red, green,\n            blue, alpha, fX, fY;\n        center.x = (u + 0.5) * ratioX;\n        icenter.x = floor(center.x);\n        for (v = 0; v < dH; v++) {\n          center.y = (v + 0.5) * ratioY;\n          icenter.y = floor(center.y);\n          a = 0; red = 0; green = 0; blue = 0; alpha = 0;\n          for (i = icenter.x - range2X; i <= icenter.x + range2X; i++) {\n            if (i < 0 || i >= oW) {\n              continue;\n            }\n            fX = floor(1000 * abs(i - center.x));\n            if (!cacheLanc[fX]) {\n              cacheLanc[fX] = { };\n            }\n            for (var j = icenter.y - range2Y; j <= icenter.y + range2Y; j++) {\n              if (j < 0 || j >= oH) {\n                continue;\n              }\n              fY = floor(1000 * abs(j - center.y));\n              if (!cacheLanc[fX][fY]) {\n                cacheLanc[fX][fY] = lanczos(sqrt(pow(fX * rcpRatioX, 2) + pow(fY * rcpRatioY, 2)) / 1000);\n              }\n              weight = cacheLanc[fX][fY];\n              if (weight > 0) {\n                idx = (j * oW + i) * 4;\n                a += weight;\n                red += weight * srcData[idx];\n                green += weight * srcData[idx + 1];\n                blue += weight * srcData[idx + 2];\n                alpha += weight * srcData[idx + 3];\n              }\n            }\n          }\n          idx = (v * dW + u) * 4;\n          destData[idx] = red / a;\n          destData[idx + 1] = green / a;\n          destData[idx + 2] = blue / a;\n          destData[idx + 3] = alpha / a;\n        }\n\n        if (++u < dW) {\n          return process(u);\n        }\n        else {\n          return destImg;\n        }\n      }\n\n      var srcData = options.imageData.data,\n          destImg = options.ctx.createImageData(dW, dH),\n          destData = destImg.data,\n          lanczos = this.lanczosCreate(this.lanczosLobes),\n          ratioX = this.rcpScaleX, ratioY = this.rcpScaleY,\n          rcpRatioX = 2 / this.rcpScaleX, rcpRatioY = 2 / this.rcpScaleY,\n          range2X = ceil(ratioX * this.lanczosLobes / 2),\n          range2Y = ceil(ratioY * this.lanczosLobes / 2),\n          cacheLanc = { }, center = { }, icenter = { };\n\n      return process(0);\n    },\n\n    /**\n     * bilinearFiltering\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    bilinearFiltering: function(options, oW, oH, dW, dH) {\n      var a, b, c, d, x, y, i, j, xDiff, yDiff, chnl,\n          color, offset = 0, origPix, ratioX = this.rcpScaleX,\n          ratioY = this.rcpScaleY,\n          w4 = 4 * (oW - 1), img = options.imageData,\n          pixels = img.data, destImage = options.ctx.createImageData(dW, dH),\n          destPixels = destImage.data;\n      for (i = 0; i < dH; i++) {\n        for (j = 0; j < dW; j++) {\n          x = floor(ratioX * j);\n          y = floor(ratioY * i);\n          xDiff = ratioX * j - x;\n          yDiff = ratioY * i - y;\n          origPix = 4 * (y * oW + x);\n\n          for (chnl = 0; chnl < 4; chnl++) {\n            a = pixels[origPix + chnl];\n            b = pixels[origPix + 4 + chnl];\n            c = pixels[origPix + w4 + chnl];\n            d = pixels[origPix + w4 + 4 + chnl];\n            color = a * (1 - xDiff) * (1 - yDiff) + b * xDiff * (1 - yDiff) +\n                    c * yDiff * (1 - xDiff) + d * xDiff * yDiff;\n            destPixels[offset++] = color;\n          }\n        }\n      }\n      return destImage;\n    },\n\n    /**\n     * hermiteFastResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    hermiteFastResize: function(options, oW, oH, dW, dH) {\n      var ratioW = this.rcpScaleX, ratioH = this.rcpScaleY,\n          ratioWHalf = ceil(ratioW / 2),\n          ratioHHalf = ceil(ratioH / 2),\n          img = options.imageData, data = img.data,\n          img2 = options.ctx.createImageData(dW, dH), data2 = img2.data;\n      for (var j = 0; j < dH; j++) {\n        for (var i = 0; i < dW; i++) {\n          var x2 = (i + j * dW) * 4, weight = 0, weights = 0, weightsAlpha = 0,\n              gxR = 0, gxG = 0, gxB = 0, gxA = 0, centerY = (j + 0.5) * ratioH;\n          for (var yy = floor(j * ratioH); yy < (j + 1) * ratioH; yy++) {\n            var dy = abs(centerY - (yy + 0.5)) / ratioHHalf,\n                centerX = (i + 0.5) * ratioW, w0 = dy * dy;\n            for (var xx = floor(i * ratioW); xx < (i + 1) * ratioW; xx++) {\n              var dx = abs(centerX - (xx + 0.5)) / ratioWHalf,\n                  w = sqrt(w0 + dx * dx);\n              /* eslint-disable max-depth */\n              if (w > 1 && w < -1) {\n                continue;\n              }\n              //hermite filter\n              weight = 2 * w * w * w - 3 * w * w + 1;\n              if (weight > 0) {\n                dx = 4 * (xx + yy * oW);\n                //alpha\n                gxA += weight * data[dx + 3];\n                weightsAlpha += weight;\n                //colors\n                if (data[dx + 3] < 255) {\n                  weight = weight * data[dx + 3] / 250;\n                }\n                gxR += weight * data[dx];\n                gxG += weight * data[dx + 1];\n                gxB += weight * data[dx + 2];\n                weights += weight;\n              }\n              /* eslint-enable max-depth */\n            }\n          }\n          data2[x2] = gxR / weights;\n          data2[x2 + 1] = gxG / weights;\n          data2[x2 + 2] = gxB / weights;\n          data2[x2 + 3] = gxA / weightsAlpha;\n        }\n      }\n      return img2;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        scaleX: this.scaleX,\n        scaleY: this.scaleY,\n        resizeType: this.resizeType,\n        lanczosLobes: this.lanczosLobes\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Resize} Instance of fabric.Image.filters.Resize\n   */\n  fabric.Image.filters.Resize.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Contrast filter class\n   * @class fabric.Image.filters.Contrast\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Contrast#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Contrast({\n   *   contrast: 0.25\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Contrast = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Contrast.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Contrast',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uContrast;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\\n' +\n        'color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * contrast value, range from -1 to 1.\n     * @param {Number} contrast\n     * @default 0\n     */\n    contrast: 0,\n\n    mainParameter: 'contrast',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Contrast.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.contrast=0] Value to contrast the image up (-1...1)\n     */\n\n    /**\n      * Apply the Contrast operation to a Uint8Array representing the pixels of an image.\n      *\n      * @param {Object} options\n      * @param {ImageData} options.imageData The Uint8Array to be filtered.\n      */\n    applyTo2d: function(options) {\n      if (this.contrast === 0) {\n        return;\n      }\n      var imageData = options.imageData, i, len,\n          data = imageData.data, len = data.length,\n          contrast = Math.floor(this.contrast * 255),\n          contrastF = 259 * (contrast + 255) / (255 * (259 - contrast));\n\n      for (i = 0; i < len; i += 4) {\n        data[i] = contrastF * (data[i] - 128) + 128;\n        data[i + 1] = contrastF * (data[i + 1] - 128) + 128;\n        data[i + 2] = contrastF * (data[i + 2] - 128) + 128;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uContrast: gl.getUniformLocation(program, 'uContrast'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uContrast, this.contrast);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Contrast} Instance of fabric.Image.filters.Contrast\n   */\n  fabric.Image.filters.Contrast.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Saturate filter class\n   * @class fabric.Image.filters.Saturation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Saturation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Saturation({\n   *   saturation: 100\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Saturation = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Saturation.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Saturation',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uSaturation;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float rgMax = max(color.r, color.g);\\n' +\n        'float rgbMax = max(rgMax, color.b);\\n' +\n        'color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\\n' +\n        'color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\\n' +\n        'color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    saturation: 0,\n\n    mainParameter: 'saturation',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Saturate.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.saturate=0] Value to saturate the image (-1...1)\n     */\n\n    /**\n     * Apply the Saturation operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.saturation === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, len = data.length,\n          adjust = -this.saturation, i, max;\n\n      for (i = 0; i < len; i += 4) {\n        max = Math.max(data[i], data[i + 1], data[i + 2]);\n        data[i] += max !== data[i] ? (max - data[i]) * adjust : 0;\n        data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * adjust : 0;\n        data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * adjust : 0;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uSaturation: gl.getUniformLocation(program, 'uSaturation'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uSaturation, -this.saturation);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Saturation} Instance of fabric.Image.filters.Saturate\n   */\n  fabric.Image.filters.Saturation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Blur filter class\n   * @class fabric.Image.filters.Blur\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Blur#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Blur({\n   *   blur: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Blur = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blur.prototype */ {\n\n    type: 'Blur',\n\n    /*\n'gl_FragColor = vec4(0.0);',\n'gl_FragColor += texture2D(texture, vTexCoord + -7 * uDelta)*0.0044299121055113265;',\n'gl_FragColor += texture2D(texture, vTexCoord + -6 * uDelta)*0.00895781211794;',\n'gl_FragColor += texture2D(texture, vTexCoord + -5 * uDelta)*0.0215963866053;',\n'gl_FragColor += texture2D(texture, vTexCoord + -4 * uDelta)*0.0443683338718;',\n'gl_FragColor += texture2D(texture, vTexCoord + -3 * uDelta)*0.0776744219933;',\n'gl_FragColor += texture2D(texture, vTexCoord + -2 * uDelta)*0.115876621105;',\n'gl_FragColor += texture2D(texture, vTexCoord + -1 * uDelta)*0.147308056121;',\n'gl_FragColor += texture2D(texture, vTexCoord              )*0.159576912161;',\n'gl_FragColor += texture2D(texture, vTexCoord + 1 * uDelta)*0.147308056121;',\n'gl_FragColor += texture2D(texture, vTexCoord + 2 * uDelta)*0.115876621105;',\n'gl_FragColor += texture2D(texture, vTexCoord + 3 * uDelta)*0.0776744219933;',\n'gl_FragColor += texture2D(texture, vTexCoord + 4 * uDelta)*0.0443683338718;',\n'gl_FragColor += texture2D(texture, vTexCoord + 5 * uDelta)*0.0215963866053;',\n'gl_FragColor += texture2D(texture, vTexCoord + 6 * uDelta)*0.00895781211794;',\n'gl_FragColor += texture2D(texture, vTexCoord + 7 * uDelta)*0.0044299121055113265;',\n*/\n\n    /* eslint-disable max-len */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec2 uDelta;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'const float nSamples = 15.0;\\n' +\n      'vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\\n' +\n      'float random(vec3 scale) {\\n' +\n        /* use the fragment position for a different seed per-pixel */\n        'return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\\n' +\n      '}\\n' +\n      'void main() {\\n' +\n        'vec4 color = vec4(0.0);\\n' +\n        'float total = 0.0;\\n' +\n        'float offset = random(v3offset);\\n' +\n        'for (float t = -nSamples; t <= nSamples; t++) {\\n' +\n          'float percent = (t + offset - 0.5) / nSamples;\\n' +\n          'float weight = 1.0 - abs(percent);\\n' +\n          'color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\\n' +\n          'total += weight;\\n' +\n        '}\\n' +\n        'gl_FragColor = color / total;\\n' +\n      '}',\n    /* eslint-enable max-len */\n\n    /**\n     * blur value, in percentage of image dimensions.\n     * specific to keep the image blur constant at different resolutions\n     * range between 0 and 1.\n     */\n    blur: 0,\n\n    mainParameter: 'blur',\n\n    applyTo: function(options) {\n      if (options.webgl) {\n        // this aspectRatio is used to give the same blur to vertical and horizontal\n        this.aspectRatio = options.sourceWidth / options.sourceHeight;\n        options.passes++;\n        this._setupFrameBuffer(options);\n        this.horizontal = true;\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        this._setupFrameBuffer(options);\n        this.horizontal = false;\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n      }\n      else {\n        this.applyTo2d(options);\n      }\n    },\n\n    applyTo2d: function(options) {\n      // paint canvasEl with current image data.\n      //options.ctx.putImageData(options.imageData, 0, 0);\n      options.imageData = this.simpleBlur(options);\n    },\n\n    simpleBlur: function(options) {\n      var resources = options.filterBackend.resources, canvas1, canvas2,\n          width = options.imageData.width,\n          height = options.imageData.height;\n\n      if (!resources.blurLayer1) {\n        resources.blurLayer1 = fabric.util.createCanvasElement();\n        resources.blurLayer2 = fabric.util.createCanvasElement();\n      }\n      canvas1 = resources.blurLayer1;\n      canvas2 = resources.blurLayer2;\n      if (canvas1.width !== width || canvas1.height !== height) {\n        canvas2.width = canvas1.width = width;\n        canvas2.height = canvas1.height = height;\n      }\n      var ctx1 = canvas1.getContext('2d'),\n          ctx2 = canvas2.getContext('2d'),\n          nSamples = 15,\n          random, percent, j, i,\n          blur = this.blur * 0.06 * 0.5;\n\n      // load first canvas\n      ctx1.putImageData(options.imageData, 0, 0);\n      ctx2.clearRect(0, 0, width, height);\n\n      for (i = -nSamples; i <= nSamples; i++) {\n        random = (Math.random() - 0.5) / 4;\n        percent = i / nSamples;\n        j = blur * percent * width + random;\n        ctx2.globalAlpha = 1 - Math.abs(percent);\n        ctx2.drawImage(canvas1, j, random);\n        ctx1.drawImage(canvas2, 0, 0);\n        ctx2.globalAlpha = 1;\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n      }\n      for (i = -nSamples; i <= nSamples; i++) {\n        random = (Math.random() - 0.5) / 4;\n        percent = i / nSamples;\n        j = blur * percent * height + random;\n        ctx2.globalAlpha = 1 - Math.abs(percent);\n        ctx2.drawImage(canvas1, random, j);\n        ctx1.drawImage(canvas2, 0, 0);\n        ctx2.globalAlpha = 1;\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n      }\n      options.ctx.drawImage(canvas1, 0, 0);\n      var newImageData = options.ctx.getImageData(0, 0, canvas1.width, canvas1.height);\n      ctx1.globalAlpha = 1;\n      ctx1.clearRect(0, 0, canvas1.width, canvas1.height);\n      return newImageData;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        delta: gl.getUniformLocation(program, 'uDelta'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var delta = this.chooseRightDelta();\n      gl.uniform2fv(uniformLocations.delta, delta);\n    },\n\n    /**\n     * choose right value of image percentage to blur with\n     * @returns {Array} a numeric array with delta values\n     */\n    chooseRightDelta: function() {\n      var blurScale = 1, delta = [0, 0], blur;\n      if (this.horizontal) {\n        if (this.aspectRatio > 1) {\n          // image is wide, i want to shrink radius horizontal\n          blurScale = 1 / this.aspectRatio;\n        }\n      }\n      else {\n        if (this.aspectRatio < 1) {\n          // image is tall, i want to shrink radius vertical\n          blurScale = this.aspectRatio;\n        }\n      }\n      blur = blurScale * this.blur * 0.12;\n      if (this.horizontal) {\n        delta[0] = blur;\n      }\n      else {\n        delta[1] = blur;\n      }\n      return delta;\n    },\n  });\n\n  /**\n   * Deserialize a JSON definition of a BlurFilter into a concrete instance.\n   */\n  filters.Blur.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Gamma filter class\n   * @class fabric.Image.filters.Gamma\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Gamma#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Gamma({\n   *   gamma: [1, 0.5, 2.1]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Gamma = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Gamma.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Gamma',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec3 uGamma;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'vec3 correction = (1.0 / uGamma);\\n' +\n        'color.r = pow(color.r, correction.r);\\n' +\n        'color.g = pow(color.g, correction.g);\\n' +\n        'color.b = pow(color.b, correction.b);\\n' +\n        'gl_FragColor = color;\\n' +\n        'gl_FragColor.rgb *= color.a;\\n' +\n      '}',\n\n    /**\n     * Gamma array value, from 0.01 to 2.2.\n     * @param {Array} gamma\n     * @default\n     */\n    gamma: [1, 1, 1],\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'gamma',\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.gamma = [1, 1, 1];\n      filters.BaseFilter.prototype.initialize.call(this, options);\n    },\n\n    /**\n     * Apply the Gamma operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData, data = imageData.data,\n          gamma = this.gamma, len = data.length,\n          rInv = 1 / gamma[0], gInv = 1 / gamma[1],\n          bInv = 1 / gamma[2], i;\n\n      if (!this.rVals) {\n        // eslint-disable-next-line\n        this.rVals = new Uint8Array(256);\n        // eslint-disable-next-line\n        this.gVals = new Uint8Array(256);\n        // eslint-disable-next-line\n        this.bVals = new Uint8Array(256);\n      }\n\n      // This is an optimization - pre-compute a look-up table for each color channel\n      // instead of performing these pow calls for each pixel in the image.\n      for (i = 0, len = 256; i < len; i++) {\n        this.rVals[i] = Math.pow(i / 255, rInv) * 255;\n        this.gVals[i] = Math.pow(i / 255, gInv) * 255;\n        this.bVals[i] = Math.pow(i / 255, bInv) * 255;\n      }\n      for (i = 0, len = data.length; i < len; i += 4) {\n        data[i] = this.rVals[data[i]];\n        data[i + 1] = this.gVals[data[i + 1]];\n        data[i + 2] = this.bVals[data[i + 2]];\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uGamma: gl.getUniformLocation(program, 'uGamma'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform3fv(uniformLocations.uGamma, this.gamma);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Gamma} Instance of fabric.Image.filters.Gamma\n   */\n  fabric.Image.filters.Gamma.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * A container class that knows how to apply a sequence of filters to an input image.\n   */\n  filters.Composed = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Composed.prototype */ {\n\n    type: 'Composed',\n\n    /**\n     * A non sparse array of filters to apply\n     */\n    subFilters: [],\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      // create a new array instead mutating the prototype with push\n      this.subFilters = this.subFilters.slice(0);\n    },\n\n    /**\n     * Apply this container's filters to the input image provided.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be applied.\n     */\n    applyTo: function(options) {\n      options.passes += this.subFilters.length - 1;\n      this.subFilters.forEach(function(filter) {\n        filter.applyTo(options);\n      });\n    },\n\n    /**\n     * Serialize this filter into JSON.\n     *\n     * @returns {Object} A JSON representation of this filter.\n     */\n    toObject: function() {\n      return fabric.util.object.extend(this.callSuper('toObject'), {\n        subFilters: this.subFilters.map(function(filter) { return filter.toObject(); }),\n      });\n    },\n\n    isNeutralState: function() {\n      return !this.subFilters.some(function(filter) { return !filter.isNeutralState(); });\n    }\n  });\n\n  /**\n   * Deserialize a JSON definition of a ComposedFilter into a concrete instance.\n   */\n  fabric.Image.filters.Composed.fromObject = function(object, callback) {\n    var filters = object.subFilters || [],\n        subFilters = filters.map(function(filter) {\n          return new fabric.Image.filters[filter.type](filter);\n        }),\n        instance = new fabric.Image.filters.Composed({ subFilters: subFilters });\n    callback && callback(instance);\n    return instance;\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * HueRotation filter class\n   * @class fabric.Image.filters.HueRotation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.HueRotation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.HueRotation({\n   *   rotation: -0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.HueRotation = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.HueRotation.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'HueRotation',\n\n    /**\n     * HueRotation value, from -1 to 1.\n     * the unit is radians\n     * @param {Number} myParameter\n     * @default\n     */\n    rotation: 0,\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'rotation',\n\n    calculateMatrix: function() {\n      var rad = this.rotation * Math.PI, cos = fabric.util.cos(rad), sin = fabric.util.sin(rad),\n          aThird = 1 / 3, aThirdSqtSin = Math.sqrt(aThird) * sin, OneMinusCos = 1 - cos;\n      this.matrix = [\n        1, 0, 0, 0, 0,\n        0, 1, 0, 0, 0,\n        0, 0, 1, 0, 0,\n        0, 0, 0, 1, 0\n      ];\n      this.matrix[0] = cos + OneMinusCos / 3;\n      this.matrix[1] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[2] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[5] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[6] = cos + aThird * OneMinusCos;\n      this.matrix[7] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[10] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[11] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[12] = cos + aThird * OneMinusCos;\n    },\n\n    /**\n     * HueRotation isNeutralState implementation\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * @param {Object} options\n     **/\n    isNeutralState: function(options) {\n      this.calculateMatrix();\n      return filters.BaseFilter.prototype.isNeutralState.call(this, options);\n    },\n\n    /**\n     * Apply this filter to the input image data provided.\n     *\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyTo: function(options) {\n      this.calculateMatrix();\n      filters.BaseFilter.prototype.applyTo.call(this, options);\n    },\n\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.HueRotation} Instance of fabric.Image.filters.HueRotation\n   */\n  fabric.Image.filters.HueRotation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      clone = fabric.util.object.clone;\n\n  if (fabric.Text) {\n    fabric.warn('fabric.Text is already defined');\n    return;\n  }\n\n  var additionalProps =\n    ('fontFamily fontWeight fontSize text underline overline linethrough' +\n    ' textAlign fontStyle lineHeight textBackgroundColor charSpacing styles path').split(' ');\n\n  /**\n   * Text class\n   * @class fabric.Text\n   * @extends fabric.Object\n   * @return {fabric.Text} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#text}\n   * @see {@link fabric.Text#initialize} for constructor definition\n   */\n  fabric.Text = fabric.util.createClass(fabric.Object, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Array\n     * @private\n     */\n    _dimensionAffectingProps: [\n      'fontSize',\n      'fontWeight',\n      'fontFamily',\n      'fontStyle',\n      'lineHeight',\n      'text',\n      'charSpacing',\n      'textAlign',\n      'styles',\n      'path'\n    ],\n\n    /**\n     * @private\n     */\n    _reNewline: /\\r?\\n/,\n\n    /**\n     * Use this regular expression to filter for whitespaces that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpacesAndTabs: /[ \\t\\r]/g,\n\n    /**\n     * Use this regular expression to filter for whitespace that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpaceAndTab: /[ \\t\\r]/,\n\n    /**\n     * Use this regular expression to filter consecutive groups of non spaces.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reWords: /\\S+/g,\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type:                 'text',\n\n    /**\n     * Font size (in pixels)\n     * @type Number\n     * @default\n     */\n    fontSize:             40,\n\n    /**\n     * Font weight (e.g. bold, normal, 400, 600, 800)\n     * @type {(Number|String)}\n     * @default\n     */\n    fontWeight:           'normal',\n\n    /**\n     * Font family\n     * @type String\n     * @default\n     */\n    fontFamily:           'Times New Roman',\n\n    /**\n     * Text decoration underline.\n     * @type Boolean\n     * @default\n     */\n    underline:       false,\n\n    /**\n     * Text decoration overline.\n     * @type Boolean\n     * @default\n     */\n    overline:       false,\n\n    /**\n     * Text decoration linethrough.\n     * @type Boolean\n     * @default\n     */\n    linethrough:       false,\n\n    /**\n     * Text alignment. Possible values: \"left\", \"center\", \"right\", \"justify\",\n     * \"justify-left\", \"justify-center\" or \"justify-right\".\n     * @type String\n     * @default\n     */\n    textAlign:            'left',\n\n    /**\n     * Font style . Possible values: \"\", \"normal\", \"italic\" or \"oblique\".\n     * @type String\n     * @default\n     */\n    fontStyle:            'normal',\n\n    /**\n     * Line height\n     * @type Number\n     * @default\n     */\n    lineHeight:           1.16,\n\n    /**\n     * Superscript schema object (minimum overlap)\n     * @type {Object}\n     * @default\n     */\n    superscript: {\n      size:      0.60, // fontSize factor\n      baseline: -0.35  // baseline-shift factor (upwards)\n    },\n\n    /**\n     * Subscript schema object (minimum overlap)\n     * @type {Object}\n     * @default\n     */\n    subscript: {\n      size:      0.60, // fontSize factor\n      baseline:  0.11  // baseline-shift factor (downwards)\n    },\n\n    /**\n     * Background color of text lines\n     * @type String\n     * @default\n     */\n    textBackgroundColor:  '',\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat(additionalProps),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * @type Array\n     */\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat(additionalProps),\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color.\n     * <b>Backwards incompatibility note:</b> This property was named \"strokeStyle\" until v1.1.6\n     * @type String\n     * @default\n     */\n    stroke:               null,\n\n    /**\n     * Shadow object representing shadow of this shape.\n     * <b>Backwards incompatibility note:</b> This property was named \"textShadow\" (String) until v1.2.11\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:               null,\n\n    /**\n     * fabric.Path that the text can follow.\n     * This feature is in BETA.\n     * @type fabric.Path\n     * @default\n     */\n    path:               null,\n\n    /**\n     * @private\n     */\n    _fontSizeFraction: 0.222,\n\n    /**\n     * @private\n     */\n    offsets: {\n      underline: 0.10,\n      linethrough: -0.315,\n      overline: -0.88\n    },\n\n    /**\n     * Text Line proportion to font Size (in pixels)\n     * @type Number\n     * @default\n     */\n    _fontSizeMult:             1.13,\n\n    /**\n     * additional space between characters\n     * expressed in thousands of em unit\n     * @type Number\n     * @default\n     */\n    charSpacing:             0,\n\n    /**\n     * Object containing character styles - top-level properties -> line numbers,\n     * 2nd-level properties - character numbers\n     * @type Object\n     * @default\n     */\n    styles: null,\n\n    /**\n     * Reference to a context to measure text char or couple of chars\n     * the cacheContext of the canvas will be used or a freshly created one if the object is not on canvas\n     * once created it will be referenced on fabric._measuringContext to avoid creating a canvas for every\n     * text object created.\n     * @type {CanvasRenderingContext2D}\n     * @default\n     */\n    _measuringContext: null,\n\n    /**\n     * Baseline shift, styles only, keep at 0 for the main text object\n     * @type {Number}\n     * @default\n     */\n    deltaY: 0,\n\n    /**\n     * WARNING: EXPERIMENTAL. NOT SUPPORTED YET\n     * determine the direction of the text.\n     * This has to be set manually together with textAlign and originX for proper\n     * experience.\n     * some interesting link for the future\n     * https://www.w3.org/International/questions/qa-bidi-unicode-controls\n     * @since 4.5.0\n     * @type {String} 'ltr|rtl'\n     * @default\n     */\n    direction: 'ltr',\n\n    /**\n     * Array of properties that define a style unit (of 'styles').\n     * @type {Array}\n     * @default\n     */\n    _styleProperties: [\n      'stroke',\n      'strokeWidth',\n      'fill',\n      'fontFamily',\n      'fontSize',\n      'fontWeight',\n      'fontStyle',\n      'underline',\n      'overline',\n      'linethrough',\n      'deltaY',\n      'textBackgroundColor',\n    ],\n\n    /**\n     * contains characters bounding boxes\n     */\n    __charBounds: [],\n\n    /**\n     * use this size when measuring text. To avoid IE11 rounding errors\n     * @type {Number}\n     * @default\n     * @readonly\n     * @private\n     */\n    CACHE_FONT_SIZE: 400,\n\n    /**\n     * contains the min text width to avoid getting 0\n     * @type {Number}\n     * @default\n     */\n    MIN_TEXT_WIDTH: 2,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    initialize: function(text, options) {\n      this.styles = options ? (options.styles || { }) : { };\n      this.text = text;\n      this.__skipDimension = true;\n      this.callSuper('initialize', options);\n      if (this.path) {\n        this.setPathInfo();\n      }\n      this.__skipDimension = false;\n      this.initDimensions();\n      this.setCoords();\n      this.setupState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * If text has a path, it will add the extra information needed\n     * for path and text calculations\n     * @return {fabric.Text} thisArg\n     */\n    setPathInfo: function() {\n      var path = this.path;\n      if (path) {\n        path.segmentsInfo = fabric.util.getPathSegmentsInfo(path.path);\n      }\n    },\n\n    /**\n     * Return a context for measurement of text string.\n     * if created it gets stored for reuse\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    getMeasuringContext: function() {\n      // if we did not return we have to measure something.\n      if (!fabric._measuringContext) {\n        fabric._measuringContext = this.canvas && this.canvas.contextCache ||\n          fabric.util.createCanvasElement().getContext('2d');\n      }\n      return fabric._measuringContext;\n    },\n\n    /**\n     * @private\n     * Divides text into lines of text and lines of graphemes.\n     */\n    _splitText: function() {\n      var newLines = this._splitTextIntoLines(this.text);\n      this.textLines = newLines.lines;\n      this._textLines = newLines.graphemeLines;\n      this._unwrappedTextLines = newLines._unwrappedLines;\n      this._text = newLines.graphemeText;\n      return newLines;\n    },\n\n    /**\n     * Initialize or update text dimensions.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     */\n    initDimensions: function() {\n      if (this.__skipDimension) {\n        return;\n      }\n      this._splitText();\n      this._clearCache();\n      if (this.path) {\n        this.width = this.path.width;\n        this.height = this.path.height;\n      }\n      else {\n        this.width = this.calcTextWidth() || this.cursorWidth || this.MIN_TEXT_WIDTH;\n        this.height = this.calcTextHeight();\n      }\n      if (this.textAlign.indexOf('justify') !== -1) {\n        // once text is measured we need to make space fatter to make justified text.\n        this.enlargeSpaces();\n      }\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Enlarge space boxes and shift the others\n     */\n    enlargeSpaces: function() {\n      var diffSpace, currentLineWidth, numberOfSpaces, accumulatedSpace, line, charBound, spaces;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        if (this.textAlign !== 'justify' && (i === len - 1 || this.isEndOfWrapping(i))) {\n          continue;\n        }\n        accumulatedSpace = 0;\n        line = this._textLines[i];\n        currentLineWidth = this.getLineWidth(i);\n        if (currentLineWidth < this.width && (spaces = this.textLines[i].match(this._reSpacesAndTabs))) {\n          numberOfSpaces = spaces.length;\n          diffSpace = (this.width - currentLineWidth) / numberOfSpaces;\n          for (var j = 0, jlen = line.length; j <= jlen; j++) {\n            charBound = this.__charBounds[i][j];\n            if (this._reSpaceAndTab.test(line[j])) {\n              charBound.width += diffSpace;\n              charBound.kernedWidth += diffSpace;\n              charBound.left += accumulatedSpace;\n              accumulatedSpace += diffSpace;\n            }\n            else {\n              charBound.left += accumulatedSpace;\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @return {Boolean}\n     */\n    isEndOfWrapping: function(lineIndex) {\n      return lineIndex === this._textLines.length - 1;\n    },\n\n    /**\n     * Detect if a line has a linebreak and so we need to account for it when moving\n     * and counting style.\n     * It return always for text and Itext.\n     * @return Number\n     */\n    missingNewlineOffset: function() {\n      return 1;\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of text object\n     */\n    toString: function() {\n      return '#<fabric.Text (' + this.complexity() +\n        '): { \"text\": \"' + this.text + '\", \"fontFamily\": \"' + this.fontFamily + '\" }>';\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @param {Object} dim.x width of object to be cached\n     * @param {Object} dim.y height of object to be cached\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var dims = this.callSuper('_getCacheCanvasDimensions');\n      var fontSize = this.fontSize;\n      dims.width += fontSize * dims.zoomX;\n      dims.height += fontSize * dims.zoomY;\n      return dims;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this._setTextStyles(ctx);\n      this._renderTextLinesBackground(ctx);\n      this._renderTextDecoration(ctx, 'underline');\n      this._renderText(ctx);\n      this._renderTextDecoration(ctx, 'overline');\n      this._renderTextDecoration(ctx, 'linethrough');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderText: function(ctx) {\n      if (this.paintFirst === 'stroke') {\n        this._renderTextStroke(ctx);\n        this._renderTextFill(ctx);\n      }\n      else {\n        this._renderTextFill(ctx);\n        this._renderTextStroke(ctx);\n      }\n    },\n\n    /**\n     * Set the font parameter of the context with the object properties or with charStyle\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [charStyle] object with font style properties\n     * @param {String} [charStyle.fontFamily] Font Family\n     * @param {Number} [charStyle.fontSize] Font size in pixels. ( without px suffix )\n     * @param {String} [charStyle.fontWeight] Font weight\n     * @param {String} [charStyle.fontStyle] Font style (italic|normal)\n     */\n    _setTextStyles: function(ctx, charStyle, forMeasuring) {\n      ctx.textBaseline = 'alphabetic';\n      ctx.font = this._getFontDeclaration(charStyle, forMeasuring);\n    },\n\n    /**\n     * calculate and return the text Width measuring each line.\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {Number} Maximum width of fabric.Text object\n     */\n    calcTextWidth: function() {\n      var maxWidth = this.getLineWidth(0);\n\n      for (var i = 1, len = this._textLines.length; i < len; i++) {\n        var currentLineWidth = this.getLineWidth(i);\n        if (currentLineWidth > maxWidth) {\n          maxWidth = currentLineWidth;\n        }\n      }\n      return maxWidth;\n    },\n\n    /**\n     * @private\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Text to render\n     * @param {Number} left Left position of text\n     * @param {Number} top Top position of text\n     * @param {Number} lineIndex Index of a line in a text\n     */\n    _renderTextLine: function(method, ctx, line, left, top, lineIndex) {\n      this._renderChars(method, ctx, line, left, top, lineIndex);\n    },\n\n    /**\n     * Renders the text background for lines, taking care of style\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextLinesBackground: function(ctx) {\n      if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor')) {\n        return;\n      }\n      var heightOfLine,\n          lineLeftOffset, originalFill = ctx.fillStyle,\n          line, lastColor,\n          leftOffset = this._getLeftOffset(),\n          lineTopOffset = this._getTopOffset(),\n          boxStart = 0, boxWidth = 0, charBox, currentColor, path = this.path,\n          drawStart;\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this.getHeightOfLine(i);\n        if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor', i)) {\n          lineTopOffset += heightOfLine;\n          continue;\n        }\n        line = this._textLines[i];\n        lineLeftOffset = this._getLineLeftOffset(i);\n        boxWidth = 0;\n        boxStart = 0;\n        lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          charBox = this.__charBounds[i][j];\n          currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\n          if (path) {\n            ctx.save();\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\n            ctx.rotate(charBox.angle);\n            ctx.fillStyle = currentColor;\n            currentColor && ctx.fillRect(\n              -charBox.width / 2,\n              -heightOfLine / this.lineHeight * (1 - this._fontSizeFraction),\n              charBox.width,\n              heightOfLine / this.lineHeight\n            );\n            ctx.restore();\n          }\n          else if (currentColor !== lastColor) {\n            drawStart = leftOffset + lineLeftOffset + boxStart;\n            if (this.direction === 'rtl') {\n              drawStart = this.width - drawStart - boxWidth;\n            }\n            ctx.fillStyle = lastColor;\n            lastColor && ctx.fillRect(\n              drawStart,\n              lineTopOffset,\n              boxWidth,\n              heightOfLine / this.lineHeight\n            );\n            boxStart = charBox.left;\n            boxWidth = charBox.width;\n            lastColor = currentColor;\n          }\n          else {\n            boxWidth += charBox.kernedWidth;\n          }\n        }\n        if (currentColor && !path) {\n          drawStart = leftOffset + lineLeftOffset + boxStart;\n          if (this.direction === 'rtl') {\n            drawStart = this.width - drawStart - boxWidth;\n          }\n          ctx.fillStyle = currentColor;\n          ctx.fillRect(\n            drawStart,\n            lineTopOffset,\n            boxWidth,\n            heightOfLine / this.lineHeight\n          );\n        }\n        lineTopOffset += heightOfLine;\n      }\n      ctx.fillStyle = originalFill;\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {Object} decl style declaration for cache\n     * @param {String} decl.fontFamily fontFamily\n     * @param {String} decl.fontStyle fontStyle\n     * @param {String} decl.fontWeight fontWeight\n     * @return {Object} reference to cache\n     */\n    getFontCache: function(decl) {\n      var fontFamily = decl.fontFamily.toLowerCase();\n      if (!fabric.charWidthsCache[fontFamily]) {\n        fabric.charWidthsCache[fontFamily] = { };\n      }\n      var cache = fabric.charWidthsCache[fontFamily],\n          cacheProp = decl.fontStyle.toLowerCase() + '_' + (decl.fontWeight + '').toLowerCase();\n      if (!cache[cacheProp]) {\n        cache[cacheProp] = { };\n      }\n      return cache[cacheProp];\n    },\n\n    /**\n     * measure and return the width of a single character.\n     * possibly overridden to accommodate different measure logic or\n     * to hook some external lib for character measurement\n     * @private\n     * @param {String} _char, char to be measured\n     * @param {Object} charStyle style of char to be measured\n     * @param {String} [previousChar] previous char\n     * @param {Object} [prevCharStyle] style of previous char\n     */\n    _measureChar: function(_char, charStyle, previousChar, prevCharStyle) {\n      // first i try to return from cache\n      var fontCache = this.getFontCache(charStyle), fontDeclaration = this._getFontDeclaration(charStyle),\n          previousFontDeclaration = this._getFontDeclaration(prevCharStyle), couple = previousChar + _char,\n          stylesAreEqual = fontDeclaration === previousFontDeclaration, width, coupleWidth, previousWidth,\n          fontMultiplier = charStyle.fontSize / this.CACHE_FONT_SIZE, kernedWidth;\n\n      if (previousChar && fontCache[previousChar] !== undefined) {\n        previousWidth = fontCache[previousChar];\n      }\n      if (fontCache[_char] !== undefined) {\n        kernedWidth = width = fontCache[_char];\n      }\n      if (stylesAreEqual && fontCache[couple] !== undefined) {\n        coupleWidth = fontCache[couple];\n        kernedWidth = coupleWidth - previousWidth;\n      }\n      if (width === undefined || previousWidth === undefined || coupleWidth === undefined) {\n        var ctx = this.getMeasuringContext();\n        // send a TRUE to specify measuring font size CACHE_FONT_SIZE\n        this._setTextStyles(ctx, charStyle, true);\n      }\n      if (width === undefined) {\n        kernedWidth = width = ctx.measureText(_char).width;\n        fontCache[_char] = width;\n      }\n      if (previousWidth === undefined && stylesAreEqual && previousChar) {\n        previousWidth = ctx.measureText(previousChar).width;\n        fontCache[previousChar] = previousWidth;\n      }\n      if (stylesAreEqual && coupleWidth === undefined) {\n        // we can measure the kerning couple and subtract the width of the previous character\n        coupleWidth = ctx.measureText(couple).width;\n        fontCache[couple] = coupleWidth;\n        kernedWidth = coupleWidth - previousWidth;\n      }\n      return { width: width * fontMultiplier, kernedWidth: kernedWidth * fontMultiplier };\n    },\n\n    /**\n     * Computes height of character at given position\n     * @param {Number} line the line index number\n     * @param {Number} _char the character index number\n     * @return {Number} fontSize of the character\n     */\n    getHeightOfChar: function(line, _char) {\n      return this.getValueOfPropertyAt(line, _char, 'fontSize');\n    },\n\n    /**\n     * measure a text line measuring all characters.\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    measureLine: function(lineIndex) {\n      var lineInfo = this._measureLine(lineIndex);\n      if (this.charSpacing !== 0) {\n        lineInfo.width -= this._getWidthOfCharSpacing();\n      }\n      if (lineInfo.width < 0) {\n        lineInfo.width = 0;\n      }\n      return lineInfo;\n    },\n\n    /**\n     * measure every grapheme of a line, populating __charBounds\n     * @param {Number} lineIndex\n     * @return {Object} object.width total width of characters\n     * @return {Object} object.widthOfSpaces length of chars that match this._reSpacesAndTabs\n     */\n    _measureLine: function(lineIndex) {\n      var width = 0, i, grapheme, line = this._textLines[lineIndex], prevGrapheme,\n          graphemeInfo, numOfSpaces = 0, lineBounds = new Array(line.length),\n          positionInPath = 0, startingPoint, totalPathLength, path = this.path;\n\n      this.__charBounds[lineIndex] = lineBounds;\n      if (path) {\n        startingPoint = fabric.util.getPointOnPath(path.path, 0, path.segmentsInfo);\n        totalPathLength = path.segmentsInfo[path.segmentsInfo.length - 1].length;\n        startingPoint.x += path.pathOffset.x;\n        startingPoint.y += path.pathOffset.y;\n      }\n      for (i = 0; i < line.length; i++) {\n        grapheme = line[i];\n        graphemeInfo = this._getGraphemeBox(grapheme, lineIndex, i, prevGrapheme);\n        if (path) {\n          if (positionInPath > totalPathLength) {\n            positionInPath %= totalPathLength;\n          }\n          // it would probably much fater to send all the grapheme position for a line\n          // and calculate path position/angle at once.\n          this._setGraphemeOnPath(positionInPath, graphemeInfo, startingPoint);\n        }\n        lineBounds[i] = graphemeInfo;\n        width += graphemeInfo.kernedWidth;\n        positionInPath += graphemeInfo.kernedWidth;\n        prevGrapheme = grapheme;\n      }\n      // this latest bound box represent the last character of the line\n      // to simplify cursor handling in interactive mode.\n      lineBounds[i] = {\n        left: graphemeInfo ? graphemeInfo.left + graphemeInfo.width : 0,\n        width: 0,\n        kernedWidth: 0,\n        height: this.fontSize\n      };\n      return { width: width, numOfSpaces: numOfSpaces };\n    },\n\n    /**\n     * Calculate the angle  and the left,top position of the char that follow a path.\n     * It appends it to graphemeInfo to be reused later at rendering\n     * @private\n     * @param {Number} positionInPath to be measured\n     * @param {Object} graphemeInfo current grapheme box information\n     * @param {Object} startingPoint position of the point\n     */\n    _setGraphemeOnPath: function(positionInPath, graphemeInfo, startingPoint) {\n      var centerPosition = positionInPath + graphemeInfo.kernedWidth / 2,\n          path = this.path;\n\n      // we are at currentPositionOnPath. we want to know what point on the path is.\n      var info = fabric.util.getPointOnPath(path.path, centerPosition, path.segmentsInfo);\n      graphemeInfo.renderLeft = info.x - startingPoint.x;\n      graphemeInfo.renderTop = info.y - startingPoint.y;\n      graphemeInfo.angle = info.angle;\n    },\n\n    /**\n     * Measure and return the info of a single grapheme.\n     * needs the the info of previous graphemes already filled\n     * @private\n     * @param {String} grapheme to be measured\n     * @param {Number} lineIndex index of the line where the char is\n     * @param {Number} charIndex position in the line\n     * @param {String} [prevGrapheme] character preceding the one to be measured\n     */\n    _getGraphemeBox: function(grapheme, lineIndex, charIndex, prevGrapheme, skipLeft) {\n      var style = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          prevStyle = prevGrapheme ? this.getCompleteStyleDeclaration(lineIndex, charIndex - 1) : { },\n          info = this._measureChar(grapheme, style, prevGrapheme, prevStyle),\n          kernedWidth = info.kernedWidth,\n          width = info.width, charSpacing;\n\n      if (this.charSpacing !== 0) {\n        charSpacing = this._getWidthOfCharSpacing();\n        width += charSpacing;\n        kernedWidth += charSpacing;\n      }\n\n      var box = {\n        width: width,\n        left: 0,\n        height: style.fontSize,\n        kernedWidth: kernedWidth,\n        deltaY: style.deltaY,\n      };\n      if (charIndex > 0 && !skipLeft) {\n        var previousBox = this.__charBounds[lineIndex][charIndex - 1];\n        box.left = previousBox.left + previousBox.width + info.kernedWidth - info.width;\n      }\n      return box;\n    },\n\n    /**\n     * Calculate height of line at 'lineIndex'\n     * @param {Number} lineIndex index of line to calculate\n     * @return {Number}\n     */\n    getHeightOfLine: function(lineIndex) {\n      if (this.__lineHeights[lineIndex]) {\n        return this.__lineHeights[lineIndex];\n      }\n\n      var line = this._textLines[lineIndex],\n          // char 0 is measured before the line cycle because it nneds to char\n          // emptylines\n          maxHeight = this.getHeightOfChar(lineIndex, 0);\n      for (var i = 1, len = line.length; i < len; i++) {\n        maxHeight = Math.max(this.getHeightOfChar(lineIndex, i), maxHeight);\n      }\n\n      return this.__lineHeights[lineIndex] = maxHeight * this.lineHeight * this._fontSizeMult;\n    },\n\n    /**\n     * Calculate text box height\n     */\n    calcTextHeight: function() {\n      var lineHeight, height = 0;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineHeight = this.getHeightOfLine(i);\n        height += (i === len - 1 ? lineHeight / this.lineHeight : lineHeight);\n      }\n      return height;\n    },\n\n    /**\n     * @private\n     * @return {Number} Left offset\n     */\n    _getLeftOffset: function() {\n      return this.direction === 'ltr' ? -this.width / 2 : this.width / 2;\n    },\n\n    /**\n     * @private\n     * @return {Number} Top offset\n     */\n    _getTopOffset: function() {\n      return -this.height / 2;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     */\n    _renderTextCommon: function(ctx, method) {\n      ctx.save();\n      var lineHeights = 0, left = this._getLeftOffset(), top = this._getTopOffset();\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        var heightOfLine = this.getHeightOfLine(i),\n            maxHeight = heightOfLine / this.lineHeight,\n            leftOffset = this._getLineLeftOffset(i);\n        this._renderTextLine(\n          method,\n          ctx,\n          this._textLines[i],\n          left + leftOffset,\n          top + lineHeights + maxHeight,\n          i\n        );\n        lineHeights += heightOfLine;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextFill: function(ctx) {\n      if (!this.fill && !this.styleHas('fill')) {\n        return;\n      }\n\n      this._renderTextCommon(ctx, 'fillText');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextStroke: function(ctx) {\n      if ((!this.stroke || this.strokeWidth === 0) && this.isEmptyStyles()) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      this._setLineDash(ctx, this.strokeDashArray);\n      ctx.beginPath();\n      this._renderTextCommon(ctx, 'strokeText');\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {String} method fillText or strokeText.\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Array} line Content of the line, splitted in an array by grapheme\n     * @param {Number} left\n     * @param {Number} top\n     * @param {Number} lineIndex\n     */\n    _renderChars: function(method, ctx, line, left, top, lineIndex) {\n      // set proper line offset\n      var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = '',\n          charBox,\n          boxWidth = 0,\n          timeToRender,\n          path = this.path,\n          shortCut = !isJustify && this.charSpacing === 0 && this.isEmptyStyles(lineIndex) && !path,\n          isLtr = this.direction === 'ltr', sign = this.direction === 'ltr' ? 1 : -1,\n          drawingLeft;\n\n      ctx.save();\n      top -= lineHeight * this._fontSizeFraction / this.lineHeight;\n      if (shortCut) {\n        // render all the line in one pass without checking\n        // drawingLeft = isLtr ? left : left - this.getLineWidth(lineIndex);\n        ctx.canvas.setAttribute('dir', isLtr ? 'ltr' : 'rtl');\n        ctx.direction = isLtr ? 'ltr' : 'rtl';\n        ctx.textAlign = isLtr ? 'left' : 'right';\n        this._renderChar(method, ctx, lineIndex, 0, line.join(''), left, top, lineHeight);\n        ctx.restore();\n        return;\n      }\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\n        timeToRender = i === len || this.charSpacing || path;\n        charsToRender += line[i];\n        charBox = this.__charBounds[lineIndex][i];\n        if (boxWidth === 0) {\n          left += sign * (charBox.kernedWidth - charBox.width);\n          boxWidth += charBox.width;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n        if (isJustify && !timeToRender) {\n          if (this._reSpaceAndTab.test(line[i])) {\n            timeToRender = true;\n          }\n        }\n        if (!timeToRender) {\n          // if we have charSpacing, we render char by char\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n          timeToRender = this._hasStyleChanged(actualStyle, nextStyle);\n        }\n        if (timeToRender) {\n          if (path) {\n            ctx.save();\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\n            ctx.rotate(charBox.angle);\n            this._renderChar(method, ctx, lineIndex, i, charsToRender, -boxWidth / 2, 0, lineHeight);\n            ctx.restore();\n          }\n          else {\n            drawingLeft = left;\n            ctx.canvas.setAttribute('dir', isLtr ? 'ltr' : 'rtl');\n            ctx.direction = isLtr ? 'ltr' : 'rtl';\n            ctx.textAlign = isLtr ? 'left' : 'right';\n            this._renderChar(method, ctx, lineIndex, i, charsToRender, drawingLeft, top, lineHeight);\n          }\n          charsToRender = '';\n          actualStyle = nextStyle;\n          left += sign * boxWidth;\n          boxWidth = 0;\n        }\n      }\n      ctx.restore();\n    },\n\n    /**\n     * This function try to patch the missing gradientTransform on canvas gradients.\n     * transforming a context to transform the gradient, is going to transform the stroke too.\n     * we want to transform the gradient but not the stroke operation, so we create\n     * a transformed gradient on a pattern and then we use the pattern instead of the gradient.\n     * this method has drawbacks: is slow, is in low resolution, needs a patch for when the size\n     * is limited.\n     * @private\n     * @param {fabric.Gradient} filler a fabric gradient instance\n     * @return {CanvasPattern} a pattern to use as fill/stroke style\n     */\n    _applyPatternGradientTransformText: function(filler) {\n      var pCanvas = fabric.util.createCanvasElement(), pCtx,\n          // TODO: verify compatibility with strokeUniform\n          width = this.width + this.strokeWidth, height = this.height + this.strokeWidth;\n      pCanvas.width = width;\n      pCanvas.height = height;\n      pCtx = pCanvas.getContext('2d');\n      pCtx.beginPath(); pCtx.moveTo(0, 0); pCtx.lineTo(width, 0); pCtx.lineTo(width, height);\n      pCtx.lineTo(0, height); pCtx.closePath();\n      pCtx.translate(width / 2, height / 2);\n      pCtx.fillStyle = filler.toLive(pCtx);\n      this._applyPatternGradientTransform(pCtx, filler);\n      pCtx.fill();\n      return pCtx.createPattern(pCanvas, 'no-repeat');\n    },\n\n    handleFiller: function(ctx, property, filler) {\n      var offsetX, offsetY;\n      if (filler.toLive) {\n        if (filler.gradientUnits === 'percentage' || filler.gradientTransform || filler.patternTransform) {\n          // need to transform gradient in a pattern.\n          // this is a slow process. If you are hitting this codepath, and the object\n          // is not using caching, you should consider switching it on.\n          // we need a canvas as big as the current object caching canvas.\n          offsetX = -this.width / 2;\n          offsetY = -this.height / 2;\n          ctx.translate(offsetX, offsetY);\n          ctx[property] = this._applyPatternGradientTransformText(filler);\n          return { offsetX: offsetX, offsetY: offsetY };\n        }\n        else {\n          // is a simple gradient or pattern\n          ctx[property] = filler.toLive(ctx, this);\n          return this._applyPatternGradientTransform(ctx, filler);\n        }\n      }\n      else {\n        // is a color\n        ctx[property] = filler;\n      }\n      return { offsetX: 0, offsetY: 0 };\n    },\n\n    _setStrokeStyles: function(ctx, decl) {\n      ctx.lineWidth = decl.strokeWidth;\n      ctx.lineCap = this.strokeLineCap;\n      ctx.lineDashOffset = this.strokeDashOffset;\n      ctx.lineJoin = this.strokeLineJoin;\n      ctx.miterLimit = this.strokeMiterLimit;\n      return this.handleFiller(ctx, 'strokeStyle', decl.stroke);\n    },\n\n    _setFillStyles: function(ctx, decl) {\n      return this.handleFiller(ctx, 'fillStyle', decl.fill);\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {String} _char\n     * @param {Number} left Left coordinate\n     * @param {Number} top Top coordinate\n     * @param {Number} lineHeight Height of the line\n     */\n    _renderChar: function(method, ctx, lineIndex, charIndex, _char, left, top) {\n      var decl = this._getStyleDeclaration(lineIndex, charIndex),\n          fullDecl = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          shouldFill = method === 'fillText' && fullDecl.fill,\n          shouldStroke = method === 'strokeText' && fullDecl.stroke && fullDecl.strokeWidth,\n          fillOffsets, strokeOffsets;\n\n      if (!shouldStroke && !shouldFill) {\n        return;\n      }\n      ctx.save();\n\n      shouldFill && (fillOffsets = this._setFillStyles(ctx, fullDecl));\n      shouldStroke && (strokeOffsets = this._setStrokeStyles(ctx, fullDecl));\n\n      ctx.font = this._getFontDeclaration(fullDecl);\n\n\n      if (decl && decl.textBackgroundColor) {\n        this._removeShadow(ctx);\n      }\n      if (decl && decl.deltaY) {\n        top += decl.deltaY;\n      }\n      shouldFill && ctx.fillText(_char, left - fillOffsets.offsetX, top - fillOffsets.offsetY);\n      shouldStroke && ctx.strokeText(_char, left - strokeOffsets.offsetX, top - strokeOffsets.offsetY);\n      ctx.restore();\n    },\n\n    /**\n     * Turns the character into a 'superior figure' (i.e. 'superscript')\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    setSuperscript: function(start, end) {\n      return this._setScript(start, end, this.superscript);\n    },\n\n    /**\n     * Turns the character into an 'inferior figure' (i.e. 'subscript')\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    setSubscript: function(start, end) {\n      return this._setScript(start, end, this.subscript);\n    },\n\n    /**\n     * Applies 'schema' at given position\n     * @private\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @param {Number} schema\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    _setScript: function(start, end, schema) {\n      var loc = this.get2DCursorLocation(start, true),\n          fontSize = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'fontSize'),\n          dy = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'deltaY'),\n          style = { fontSize: fontSize * schema.size, deltaY: dy + fontSize * schema.baseline };\n      this.setSelectionStyles(style, start, end);\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {Object} prevStyle\n     * @param {Object} thisStyle\n     */\n    _hasStyleChanged: function(prevStyle, thisStyle) {\n      return prevStyle.fill !== thisStyle.fill ||\n              prevStyle.stroke !== thisStyle.stroke ||\n              prevStyle.strokeWidth !== thisStyle.strokeWidth ||\n              prevStyle.fontSize !== thisStyle.fontSize ||\n              prevStyle.fontFamily !== thisStyle.fontFamily ||\n              prevStyle.fontWeight !== thisStyle.fontWeight ||\n              prevStyle.fontStyle !== thisStyle.fontStyle ||\n              prevStyle.deltaY !== thisStyle.deltaY;\n    },\n\n    /**\n     * @private\n     * @param {Object} prevStyle\n     * @param {Object} thisStyle\n     */\n    _hasStyleChangedForSvg: function(prevStyle, thisStyle) {\n      return this._hasStyleChanged(prevStyle, thisStyle) ||\n        prevStyle.overline !== thisStyle.overline ||\n        prevStyle.underline !== thisStyle.underline ||\n        prevStyle.linethrough !== thisStyle.linethrough;\n    },\n\n    /**\n     * @private\n     * @param {Number} lineIndex index text line\n     * @return {Number} Line left offset\n     */\n    _getLineLeftOffset: function(lineIndex) {\n      var lineWidth = this.getLineWidth(lineIndex),\n          lineDiff = this.width - lineWidth, textAlign = this.textAlign, direction = this.direction,\n          isEndOfWrapping, leftOffset = 0, isEndOfWrapping = this.isEndOfWrapping(lineIndex);\n      if (textAlign === 'justify'\n        || (textAlign === 'justify-center' && !isEndOfWrapping)\n        || (textAlign === 'justify-right' && !isEndOfWrapping)\n        || (textAlign === 'justify-left' && !isEndOfWrapping)\n      ) {\n        return 0;\n      }\n      if (textAlign === 'center') {\n        leftOffset = lineDiff / 2;\n      }\n      if (textAlign === 'right') {\n        leftOffset = lineDiff;\n      }\n      if (textAlign === 'justify-center') {\n        leftOffset = lineDiff / 2;\n      }\n      if (textAlign === 'justify-right') {\n        leftOffset = lineDiff;\n      }\n      if (direction === 'rtl') {\n        leftOffset -= lineDiff;\n      }\n      return leftOffset;\n    },\n\n    /**\n     * @private\n     */\n    _clearCache: function() {\n      this.__lineWidths = [];\n      this.__lineHeights = [];\n      this.__charBounds = [];\n    },\n\n    /**\n     * @private\n     */\n    _shouldClearDimensionCache: function() {\n      var shouldClear = this._forceClearCache;\n      shouldClear || (shouldClear = this.hasStateChanged('_dimensionAffectingProps'));\n      if (shouldClear) {\n        this.dirty = true;\n        this._forceClearCache = false;\n      }\n      return shouldClear;\n    },\n\n    /**\n     * Measure a single line given its index. Used to calculate the initial\n     * text bounding box. The values are calculated and stored in __lineWidths cache.\n     * @private\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    getLineWidth: function(lineIndex) {\n      if (this.__lineWidths[lineIndex]) {\n        return this.__lineWidths[lineIndex];\n      }\n\n      var width, line = this._textLines[lineIndex], lineInfo;\n\n      if (line === '') {\n        width = 0;\n      }\n      else {\n        lineInfo = this.measureLine(lineIndex);\n        width = lineInfo.width;\n      }\n      this.__lineWidths[lineIndex] = width;\n      return width;\n    },\n\n    _getWidthOfCharSpacing: function() {\n      if (this.charSpacing !== 0) {\n        return this.fontSize * this.charSpacing / 1000;\n      }\n      return 0;\n    },\n\n    /**\n     * Retrieves the value of property at given character position\n     * @param {Number} lineIndex the line number\n     * @param {Number} charIndex the character number\n     * @param {String} property the property name\n     * @returns the value of 'property'\n     */\n    getValueOfPropertyAt: function(lineIndex, charIndex, property) {\n      var charStyle = this._getStyleDeclaration(lineIndex, charIndex);\n      if (charStyle && typeof charStyle[property] !== 'undefined') {\n        return charStyle[property];\n      }\n      return this[property];\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextDecoration: function(ctx, type) {\n      if (!this[type] && !this.styleHas(type)) {\n        return;\n      }\n      var heightOfLine, size, _size,\n          lineLeftOffset, dy, _dy,\n          line, lastDecoration,\n          leftOffset = this._getLeftOffset(),\n          topOffset = this._getTopOffset(), top,\n          boxStart, boxWidth, charBox, currentDecoration,\n          maxHeight, currentFill, lastFill, path = this.path,\n          charSpacing = this._getWidthOfCharSpacing(),\n          offsetY = this.offsets[type];\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this.getHeightOfLine(i);\n        if (!this[type] && !this.styleHas(type, i)) {\n          topOffset += heightOfLine;\n          continue;\n        }\n        line = this._textLines[i];\n        maxHeight = heightOfLine / this.lineHeight;\n        lineLeftOffset = this._getLineLeftOffset(i);\n        boxStart = 0;\n        boxWidth = 0;\n        lastDecoration = this.getValueOfPropertyAt(i, 0, type);\n        lastFill = this.getValueOfPropertyAt(i, 0, 'fill');\n        top = topOffset + maxHeight * (1 - this._fontSizeFraction);\n        size = this.getHeightOfChar(i, 0);\n        dy = this.getValueOfPropertyAt(i, 0, 'deltaY');\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          charBox = this.__charBounds[i][j];\n          currentDecoration = this.getValueOfPropertyAt(i, j, type);\n          currentFill = this.getValueOfPropertyAt(i, j, 'fill');\n          _size = this.getHeightOfChar(i, j);\n          _dy = this.getValueOfPropertyAt(i, j, 'deltaY');\n          if (path && currentDecoration && currentFill) {\n            ctx.save();\n            ctx.fillStyle = lastFill;\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\n            ctx.rotate(charBox.angle);\n            ctx.fillRect(\n              -charBox.kernedWidth / 2,\n              offsetY * _size + _dy,\n              charBox.kernedWidth,\n              this.fontSize / 15\n            );\n            ctx.restore();\n          }\n          else if (\n            (currentDecoration !== lastDecoration || currentFill !== lastFill || _size !== size || _dy !== dy)\n            && boxWidth > 0\n          ) {\n            var drawStart = leftOffset + lineLeftOffset + boxStart;\n            if (this.direction === 'rtl') {\n              drawStart = this.width - drawStart - boxWidth;\n            }\n            if (lastDecoration && lastFill) {\n              ctx.fillStyle = lastFill;\n              ctx.fillRect(\n                drawStart,\n                top + offsetY * size + dy,\n                boxWidth,\n                this.fontSize / 15\n              );\n            }\n            boxStart = charBox.left;\n            boxWidth = charBox.width;\n            lastDecoration = currentDecoration;\n            lastFill = currentFill;\n            size = _size;\n            dy = _dy;\n          }\n          else {\n            boxWidth += charBox.kernedWidth;\n          }\n        }\n        var drawStart = leftOffset + lineLeftOffset + boxStart;\n        if (this.direction === 'rtl') {\n          drawStart = this.width - drawStart - boxWidth;\n        }\n        ctx.fillStyle = currentFill;\n        currentDecoration && currentFill && ctx.fillRect(\n          drawStart,\n          top + offsetY * size + dy,\n          boxWidth - charSpacing,\n          this.fontSize / 15\n        );\n        topOffset += heightOfLine;\n      }\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * return font declaration string for canvas context\n     * @param {Object} [styleObject] object\n     * @returns {String} font declaration formatted for canvas context.\n     */\n    _getFontDeclaration: function(styleObject, forMeasuring) {\n      var style = styleObject || this, family = this.fontFamily,\n          fontIsGeneric = fabric.Text.genericFonts.indexOf(family.toLowerCase()) > -1;\n      var fontFamily = family === undefined ||\n      family.indexOf('\\'') > -1 || family.indexOf(',') > -1 ||\n      family.indexOf('\"') > -1 || fontIsGeneric\n        ? style.fontFamily : '\"' + style.fontFamily + '\"';\n      return [\n        // node-canvas needs \"weight style\", while browsers need \"style weight\"\n        // verify if this can be fixed in JSDOM\n        (fabric.isLikelyNode ? style.fontWeight : style.fontStyle),\n        (fabric.isLikelyNode ? style.fontStyle : style.fontWeight),\n        forMeasuring ? this.CACHE_FONT_SIZE + 'px' : style.fontSize + 'px',\n        fontFamily\n      ].join(' ');\n    },\n\n    /**\n     * Renders text instance on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      // do not render if object is not visible\n      if (!this.visible) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n      }\n      this.callSuper('render', ctx);\n    },\n\n    /**\n     * Returns the text as an array of lines.\n     * @param {String} text text to split\n     * @returns {Array} Lines in the text\n     */\n    _splitTextIntoLines: function(text) {\n      var lines = text.split(this._reNewline),\n          newLines = new Array(lines.length),\n          newLine = ['\\n'],\n          newText = [];\n      for (var i = 0; i < lines.length; i++) {\n        newLines[i] = fabric.util.string.graphemeSplit(lines[i]);\n        newText = newText.concat(newLines[i], newLine);\n      }\n      newText.pop();\n      return { _unwrappedLines: newLines, lines: lines, graphemeText: newText, graphemeLines: newLines };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var additionalProperties = [\n        'text',\n        'fontSize',\n        'fontWeight',\n        'fontFamily',\n        'fontStyle',\n        'lineHeight',\n        'underline',\n        'overline',\n        'linethrough',\n        'textAlign',\n        'textBackgroundColor',\n        'charSpacing',\n        'path',\n        'direction',\n      ].concat(propertiesToInclude);\n      var obj = this.callSuper('toObject', additionalProperties);\n      obj.styles = clone(this.styles, true);\n      obj.path = this.path && this.path.toObject();\n      return obj;\n    },\n\n    /**\n     * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n     * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n     * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    set: function(key, value) {\n      this.callSuper('set', key, value);\n      var needsDims = false;\n      var isAddingPath = false;\n      if (typeof key === 'object') {\n        for (var _key in key) {\n          if (_key === 'path') {\n            this.setPathInfo();\n          }\n          needsDims = needsDims || this._dimensionAffectingProps.indexOf(_key) !== -1;\n          isAddingPath = isAddingPath || _key === 'path';\n        }\n      }\n      else {\n        needsDims = this._dimensionAffectingProps.indexOf(key) !== -1;\n        isAddingPath = key === 'path';\n      }\n      if (isAddingPath) {\n        this.setPathInfo();\n      }\n      if (needsDims) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      return this;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return 1;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Text.fromElement})\n   * @static\n   * @memberOf fabric.Text\n   * @see: http://www.w3.org/TR/SVG/text.html#TextElement\n   */\n  fabric.Text.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    'x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor'.split(' '));\n\n  /**\n   * Default SVG font size\n   * @static\n   * @memberOf fabric.Text\n   */\n  fabric.Text.DEFAULT_SVG_FONT_SIZE = 16;\n\n  /**\n   * Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)\n   * @static\n   * @memberOf fabric.Text\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Text.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Text.ATTRIBUTE_NAMES),\n        parsedAnchor = parsedAttributes.textAnchor || 'left';\n    options = fabric.util.object.extend((options ? clone(options) : { }), parsedAttributes);\n\n    options.top = options.top || 0;\n    options.left = options.left || 0;\n    if (parsedAttributes.textDecoration) {\n      var textDecoration = parsedAttributes.textDecoration;\n      if (textDecoration.indexOf('underline') !== -1) {\n        options.underline = true;\n      }\n      if (textDecoration.indexOf('overline') !== -1) {\n        options.overline = true;\n      }\n      if (textDecoration.indexOf('line-through') !== -1) {\n        options.linethrough = true;\n      }\n      delete options.textDecoration;\n    }\n    if ('dx' in parsedAttributes) {\n      options.left += parsedAttributes.dx;\n    }\n    if ('dy' in parsedAttributes) {\n      options.top += parsedAttributes.dy;\n    }\n    if (!('fontSize' in options)) {\n      options.fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n    }\n\n    var textContent = '';\n\n    // The XML is not properly parsed in IE9 so a workaround to get\n    // textContent is through firstChild.data. Another workaround would be\n    // to convert XML loaded from a file to be converted using DOMParser (same way loadSVGFromString() does)\n    if (!('textContent' in element)) {\n      if ('firstChild' in element && element.firstChild !== null) {\n        if ('data' in element.firstChild && element.firstChild.data !== null) {\n          textContent = element.firstChild.data;\n        }\n      }\n    }\n    else {\n      textContent = element.textContent;\n    }\n\n    textContent = textContent.replace(/^\\s+|\\s+$|\\n+/g, '').replace(/\\s+/g, ' ');\n    var originalStrokeWidth = options.strokeWidth;\n    options.strokeWidth = 0;\n\n    var text = new fabric.Text(textContent, options),\n        textHeightScaleFactor = text.getScaledHeight() / text.height,\n        lineHeightDiff = (text.height + text.strokeWidth) * text.lineHeight - text.height,\n        scaledDiff = lineHeightDiff * textHeightScaleFactor,\n        textHeight = text.getScaledHeight() + scaledDiff,\n        offX = 0;\n    /*\n      Adjust positioning:\n        x/y attributes in SVG correspond to the bottom-left corner of text bounding box\n        fabric output by default at top, left.\n    */\n    if (parsedAnchor === 'center') {\n      offX = text.getScaledWidth() / 2;\n    }\n    if (parsedAnchor === 'right') {\n      offX = text.getScaledWidth();\n    }\n    text.set({\n      left: text.left - offX,\n      top: text.top - (textHeight - text.fontSize * (0.07 + text._fontSizeFraction)) / text.lineHeight,\n      strokeWidth: typeof originalStrokeWidth !== 'undefined' ? originalStrokeWidth : 1,\n    });\n    callback(text);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Text instance from an object representation\n   * @static\n   * @memberOf fabric.Text\n   * @param {Object} object plain js Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Text instance is created\n   */\n  fabric.Text.fromObject = function(object, callback) {\n    var objectCopy = clone(object), path = object.path;\n    delete objectCopy.path;\n    return fabric.Object._fromObject('Text', objectCopy, function(textInstance) {\n      if (path) {\n        fabric.Object._fromObject('Path', path, function(pathInstance) {\n          textInstance.set('path', pathInstance);\n          callback(textInstance);\n        }, 'path');\n      }\n      else {\n        callback(textInstance);\n      }\n    }, 'text');\n  };\n\n  fabric.Text.genericFonts = ['sans-serif', 'serif', 'cursive', 'fantasy', 'monospace'];\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Text);\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\n    /**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */\n    isEmptyStyles: function(lineIndex) {\n      if (!this.styles) {\n        return true;\n      }\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\n        return true;\n      }\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          // eslint-disable-next-line no-unused-vars\n          for (var p3 in obj[p1][p2]) {\n            return false;\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Returns true if object has a style property or has it ina specified line\n     * This function is used to detect if a text will use a particular property or not.\n     * @param {String} property to check for\n     * @param {Number} lineIndex to check the style on\n     * @return {Boolean}\n     */\n    styleHas: function(property, lineIndex) {\n      if (!this.styles || !property || property === '') {\n        return false;\n      }\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\n        return false;\n      }\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { 0: this.styles[lineIndex] };\n      // eslint-disable-next-line\n      for (var p1 in obj) {\n        // eslint-disable-next-line\n        for (var p2 in obj[p1]) {\n          if (typeof obj[p1][p2][property] !== 'undefined') {\n            return true;\n          }\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if characters in a text have a value for a property\n     * whose value matches the textbox's value for that property.  If so,\n     * the character-level property is deleted.  If the character\n     * has no other properties, then it is also deleted.  Finally,\n     * if the line containing that character has no other characters\n     * then it also is deleted.\n     *\n     * @param {string} property The property to compare between characters and text.\n     */\n    cleanStyle: function(property) {\n      if (!this.styles || !property || property === '') {\n        return false;\n      }\n      var obj = this.styles, stylesCount = 0, letterCount, stylePropertyValue,\n          allStyleObjectPropertiesMatch = true, graphemeCount = 0, styleObject;\n      // eslint-disable-next-line\n      for (var p1 in obj) {\n        letterCount = 0;\n        // eslint-disable-next-line\n        for (var p2 in obj[p1]) {\n          var styleObject = obj[p1][p2],\n              stylePropertyHasBeenSet = styleObject.hasOwnProperty(property);\n\n          stylesCount++;\n\n          if (stylePropertyHasBeenSet) {\n            if (!stylePropertyValue) {\n              stylePropertyValue = styleObject[property];\n            }\n            else if (styleObject[property] !== stylePropertyValue) {\n              allStyleObjectPropertiesMatch = false;\n            }\n\n            if (styleObject[property] === this[property]) {\n              delete styleObject[property];\n            }\n          }\n          else {\n            allStyleObjectPropertiesMatch = false;\n          }\n\n          if (Object.keys(styleObject).length !== 0) {\n            letterCount++;\n          }\n          else {\n            delete obj[p1][p2];\n          }\n        }\n\n        if (letterCount === 0) {\n          delete obj[p1];\n        }\n      }\n      // if every grapheme has the same style set then\n      // delete those styles and set it on the parent\n      for (var i = 0; i < this._textLines.length; i++) {\n        graphemeCount += this._textLines[i].length;\n      }\n      if (allStyleObjectPropertiesMatch && stylesCount === graphemeCount) {\n        this[property] = stylePropertyValue;\n        this.removeStyle(property);\n      }\n    },\n\n    /**\n     * Remove a style property or properties from all individual character styles\n     * in a text object.  Deletes the character style object if it contains no other style\n     * props.  Deletes a line style object if it contains no other character styles.\n     *\n     * @param {String} props The property to remove from character styles.\n     */\n    removeStyle: function(property) {\n      if (!this.styles || !property || property === '') {\n        return;\n      }\n      var obj = this.styles, line, lineNum, charNum;\n      for (lineNum in obj) {\n        line = obj[lineNum];\n        for (charNum in line) {\n          delete line[charNum][property];\n          if (Object.keys(line[charNum]).length === 0) {\n            delete line[charNum];\n          }\n        }\n        if (Object.keys(line).length === 0) {\n          delete obj[lineNum];\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _extendStyles: function(index, styles) {\n      var loc = this.get2DCursorLocation(index);\n\n      if (!this._getLineStyle(loc.lineIndex)) {\n        this._setLineStyle(loc.lineIndex);\n      }\n\n      if (!this._getStyleDeclaration(loc.lineIndex, loc.charIndex)) {\n        this._setStyleDeclaration(loc.lineIndex, loc.charIndex, {});\n      }\n\n      fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex, loc.charIndex), styles);\n    },\n\n    /**\n     * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start)\n     * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\n     * @param {Boolean} [skipWrapping] consider the location for unwrapped lines. useful to manage styles.\n     */\n    get2DCursorLocation: function(selectionStart, skipWrapping) {\n      if (typeof selectionStart === 'undefined') {\n        selectionStart = this.selectionStart;\n      }\n      var lines = skipWrapping ? this._unwrappedTextLines : this._textLines,\n          len = lines.length;\n      for (var i = 0; i < len; i++) {\n        if (selectionStart <= lines[i].length) {\n          return {\n            lineIndex: i,\n            charIndex: selectionStart\n          };\n        }\n        selectionStart -= lines[i].length + this.missingNewlineOffset(i);\n      }\n      return {\n        lineIndex: i - 1,\n        charIndex: lines[i - 1].length < selectionStart ? lines[i - 1].length : selectionStart\n      };\n    },\n\n    /**\n     * Gets style of a current selection/cursor (at the start position)\n     * if startIndex or endIndex are not provided, selectionStart or selectionEnd will be used.\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n     * @param {Boolean} [complete] get full style or not\n     * @return {Array} styles an array with one, zero or more Style objects\n     */\n    getSelectionStyles: function(startIndex, endIndex, complete) {\n      if (typeof startIndex === 'undefined') {\n        startIndex = this.selectionStart || 0;\n      }\n      if (typeof endIndex === 'undefined') {\n        endIndex = this.selectionEnd || startIndex;\n      }\n      var styles = [];\n      for (var i = startIndex; i < endIndex; i++) {\n        styles.push(this.getStyleAtPosition(i, complete));\n      }\n      return styles;\n    },\n\n    /**\n     * Gets style of a current selection/cursor position\n     * @param {Number} position  to get styles at\n     * @param {Boolean} [complete] full style if true\n     * @return {Object} style Style object at a specified index\n     * @private\n     */\n    getStyleAtPosition: function(position, complete) {\n      var loc = this.get2DCursorLocation(position),\n          style = complete ? this.getCompleteStyleDeclaration(loc.lineIndex, loc.charIndex) :\n            this._getStyleDeclaration(loc.lineIndex, loc.charIndex);\n      return style || {};\n    },\n\n    /**\n     * Sets style of a current selection, if no selection exist, do not set anything.\n     * @param {Object} [styles] Styles object\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    setSelectionStyles: function(styles, startIndex, endIndex) {\n      if (typeof startIndex === 'undefined') {\n        startIndex = this.selectionStart || 0;\n      }\n      if (typeof endIndex === 'undefined') {\n        endIndex = this.selectionEnd || startIndex;\n      }\n      for (var i = startIndex; i < endIndex; i++) {\n        this._extendStyles(i, styles);\n      }\n      /* not included in _extendStyles to avoid clearing cache more than once */\n      this._forceClearCache = true;\n      return this;\n    },\n\n    /**\n     * get the reference, not a clone, of the style object for a given character\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @return {Object} style object\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex) {\n      var lineStyle = this.styles && this.styles[lineIndex];\n      if (!lineStyle) {\n        return null;\n      }\n      return lineStyle[charIndex];\n    },\n\n    /**\n     * return a new object that contains all the style property for a character\n     * the object returned is newly created\n     * @param {Number} lineIndex of the line where the character is\n     * @param {Number} charIndex position of the character on the line\n     * @return {Object} style object\n     */\n    getCompleteStyleDeclaration: function(lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex) || { },\n          styleObject = { }, prop;\n      for (var i = 0; i < this._styleProperties.length; i++) {\n        prop = this._styleProperties[i];\n        styleObject[prop] = typeof style[prop] === 'undefined' ? this[prop] : style[prop];\n      }\n      return styleObject;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     *\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @return {Boolean} if the line exists or not\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      return !!this.styles[lineIndex];\n    },\n\n    /**\n     * Set the line style to an empty object so that is initialized\n     * @param {Number} lineIndex\n     * @private\n     */\n    _setLineStyle: function(lineIndex) {\n      this.styles[lineIndex] = {};\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _deleteLineStyle: function(lineIndex) {\n      delete this.styles[lineIndex];\n    }\n  });\n})();\n\n\n(function() {\n\n  function parseDecoration(object) {\n    if (object.textDecoration) {\n      object.textDecoration.indexOf('underline') > -1 && (object.underline = true);\n      object.textDecoration.indexOf('line-through') > -1 && (object.linethrough = true);\n      object.textDecoration.indexOf('overline') > -1 && (object.overline = true);\n      delete object.textDecoration;\n    }\n  }\n\n  /**\n   * IText class (introduced in <b>v1.4</b>) Events are also fired with \"text:\"\n   * prefix when observing canvas.\n   * @class fabric.IText\n   * @extends fabric.Text\n   * @mixes fabric.Observable\n   *\n   * @fires changed\n   * @fires selection:changed\n   * @fires editing:entered\n   * @fires editing:exited\n   *\n   * @return {fabric.IText} thisArg\n   * @see {@link fabric.IText#initialize} for constructor definition\n   *\n   * <p>Supported key combinations:</p>\n   * <pre>\n   *   Move cursor:                    left, right, up, down\n   *   Select character:               shift + left, shift + right\n   *   Select text vertically:         shift + up, shift + down\n   *   Move cursor by word:            alt + left, alt + right\n   *   Select words:                   shift + alt + left, shift + alt + right\n   *   Move cursor to line start/end:  cmd + left, cmd + right or home, end\n   *   Select till start/end of line:  cmd + shift + left, cmd + shift + right or shift + home, shift + end\n   *   Jump to start/end of text:      cmd + up, cmd + down\n   *   Select till start/end of text:  cmd + shift + up, cmd + shift + down or shift + pgUp, shift + pgDown\n   *   Delete character:               backspace\n   *   Delete word:                    alt + backspace\n   *   Delete line:                    cmd + backspace\n   *   Forward delete:                 delete\n   *   Copy text:                      ctrl/cmd + c\n   *   Paste text:                     ctrl/cmd + v\n   *   Cut text:                       ctrl/cmd + x\n   *   Select entire text:             ctrl/cmd + a\n   *   Quit editing                    tab or esc\n   * </pre>\n   *\n   * <p>Supported mouse/touch combination</p>\n   * <pre>\n   *   Position cursor:                click/touch\n   *   Create selection:               click/touch & drag\n   *   Create selection:               click & shift + click\n   *   Select word:                    double click\n   *   Select line:                    triple click\n   * </pre>\n   */\n  fabric.IText = fabric.util.createClass(fabric.Text, fabric.Observable, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'i-text',\n\n    /**\n     * Index where text selection starts (or where cursor is when there is no selection)\n     * @type Number\n     * @default\n     */\n    selectionStart: 0,\n\n    /**\n     * Index where text selection ends\n     * @type Number\n     * @default\n     */\n    selectionEnd: 0,\n\n    /**\n     * Color of text selection\n     * @type String\n     * @default\n     */\n    selectionColor: 'rgba(17,119,255,0.3)',\n\n    /**\n     * Indicates whether text is in editing mode\n     * @type Boolean\n     * @default\n     */\n    isEditing: false,\n\n    /**\n     * Indicates whether a text can be edited\n     * @type Boolean\n     * @default\n     */\n    editable: true,\n\n    /**\n     * Border color of text object while it's in editing mode\n     * @type String\n     * @default\n     */\n    editingBorderColor: 'rgba(102,153,255,0.25)',\n\n    /**\n     * Width of cursor (in px)\n     * @type Number\n     * @default\n     */\n    cursorWidth: 2,\n\n    /**\n     * Color of text cursor color in editing mode.\n     * if not set (default) will take color from the text.\n     * if set to a color value that fabric can understand, it will\n     * be used instead of the color of the text at the current position.\n     * @type String\n     * @default\n     */\n    cursorColor: '',\n\n    /**\n     * Delay between cursor blink (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDelay: 1000,\n\n    /**\n     * Duration of cursor fadein (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDuration: 600,\n\n    /**\n     * Indicates whether internal text char widths can be cached\n     * @type Boolean\n     * @default\n     */\n    caching: true,\n\n    /**\n     * @private\n     */\n    _reSpace: /\\s|\\n/,\n\n    /**\n     * @private\n     */\n    _currentCursorOpacity: 0,\n\n    /**\n     * @private\n     */\n    _selectionDirection: null,\n\n    /**\n     * @private\n     */\n    _abortCursorAnimation: false,\n\n    /**\n     * @private\n     */\n    __widthOfSpace: [],\n\n    /**\n     * Helps determining when the text is in composition, so that the cursor\n     * rendering is altered.\n     */\n    inCompositionMode: false,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.IText} thisArg\n     */\n    initialize: function(text, options) {\n      this.callSuper('initialize', text, options);\n      this.initBehavior();\n    },\n\n    /**\n     * Sets selection start (left boundary of a selection)\n     * @param {Number} index Index to set selection start to\n     */\n    setSelectionStart: function(index) {\n      index = Math.max(index, 0);\n      this._updateAndFire('selectionStart', index);\n    },\n\n    /**\n     * Sets selection end (right boundary of a selection)\n     * @param {Number} index Index to set selection end to\n     */\n    setSelectionEnd: function(index) {\n      index = Math.min(index, this.text.length);\n      this._updateAndFire('selectionEnd', index);\n    },\n\n    /**\n     * @private\n     * @param {String} property 'selectionStart' or 'selectionEnd'\n     * @param {Number} index new position of property\n     */\n    _updateAndFire: function(property, index) {\n      if (this[property] !== index) {\n        this._fireSelectionChanged();\n        this[property] = index;\n      }\n      this._updateTextarea();\n    },\n\n    /**\n     * Fires the even of selection changed\n     * @private\n     */\n    _fireSelectionChanged: function() {\n      this.fire('selection:changed');\n      this.canvas && this.canvas.fire('text:selection:changed', { target: this });\n    },\n\n    /**\n     * Initialize text dimensions. Render all text on given context\n     * or on a offscreen canvas to get the text width with measureText.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     * @private\n     */\n    initDimensions: function() {\n      this.isEditing && this.initDelayedCursor();\n      this.clearContextTop();\n      this.callSuper('initDimensions');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      this.clearContextTop();\n      this.callSuper('render', ctx);\n      // clear the cursorOffsetCache, so we ensure to calculate once per renderCursor\n      // the correct position but not at every cursor animation.\n      this.cursorOffsetCache = { };\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this.callSuper('_render', ctx);\n    },\n\n    /**\n     * Prepare and clean the contextTop\n     */\n    clearContextTop: function(skipRestore) {\n      if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\n        return;\n      }\n      var ctx = this.canvas.contextTop, v = this.canvas.viewportTransform;\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      this.transform(ctx);\n      this._clearTextArea(ctx);\n      skipRestore || ctx.restore();\n    },\n    /**\n     * Renders cursor or selection (depending on what exists)\n     * it does on the contextTop. If contextTop is not available, do nothing.\n     */\n    renderCursorOrSelection: function() {\n      if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\n        return;\n      }\n      var boundaries = this._getCursorBoundaries(),\n          ctx = this.canvas.contextTop;\n      this.clearContextTop(true);\n      if (this.selectionStart === this.selectionEnd) {\n        this.renderCursor(boundaries, ctx);\n      }\n      else {\n        this.renderSelection(boundaries, ctx);\n      }\n      ctx.restore();\n    },\n\n    _clearTextArea: function(ctx) {\n      // we add 4 pixel, to be sure to do not leave any pixel out\n      var width = this.width + 4, height = this.height + 4;\n      ctx.clearRect(-width / 2, -height / 2, width, height);\n    },\n\n    /**\n     * Returns cursor boundaries (left, top, leftOffset, topOffset)\n     * @private\n     * @param {Array} chars Array of characters\n     * @param {String} typeOfBoundaries\n     */\n    _getCursorBoundaries: function(position) {\n\n      // left/top are left/top of entire text box\n      // leftOffset/topOffset are offset from that left/top point of a text box\n\n      if (typeof position === 'undefined') {\n        position = this.selectionStart;\n      }\n\n      var left = this._getLeftOffset(),\n          top = this._getTopOffset(),\n          offsets = this._getCursorBoundariesOffsets(position);\n      return {\n        left: left,\n        top: top,\n        leftOffset: offsets.left,\n        topOffset: offsets.top\n      };\n    },\n\n    /**\n     * @private\n     */\n    _getCursorBoundariesOffsets: function(position) {\n      if (this.cursorOffsetCache && 'top' in this.cursorOffsetCache) {\n        return this.cursorOffsetCache;\n      }\n      var lineLeftOffset,\n          lineIndex,\n          charIndex,\n          topOffset = 0,\n          leftOffset = 0,\n          boundaries,\n          cursorPosition = this.get2DCursorLocation(position);\n      charIndex = cursorPosition.charIndex;\n      lineIndex = cursorPosition.lineIndex;\n      for (var i = 0; i < lineIndex; i++) {\n        topOffset += this.getHeightOfLine(i);\n      }\n      lineLeftOffset = this._getLineLeftOffset(lineIndex);\n      var bound = this.__charBounds[lineIndex][charIndex];\n      bound && (leftOffset = bound.left);\n      if (this.charSpacing !== 0 && charIndex === this._textLines[lineIndex].length) {\n        leftOffset -= this._getWidthOfCharSpacing();\n      }\n      boundaries = {\n        top: topOffset,\n        left: lineLeftOffset + (leftOffset > 0 ? leftOffset : 0),\n      };\n      if (this.direction === 'rtl') {\n        boundaries.left *= -1;\n      }\n      this.cursorOffsetCache = boundaries;\n      return this.cursorOffsetCache;\n    },\n\n    /**\n     * Renders cursor\n     * @param {Object} boundaries\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderCursor: function(boundaries, ctx) {\n      var cursorLocation = this.get2DCursorLocation(),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex > 0 ? cursorLocation.charIndex - 1 : 0,\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize'),\n          multiplier = this.scaleX * this.canvas.getZoom(),\n          cursorWidth = this.cursorWidth / multiplier,\n          topOffset = boundaries.topOffset,\n          dy = this.getValueOfPropertyAt(lineIndex, charIndex, 'deltaY');\n      topOffset += (1 - this._fontSizeFraction) * this.getHeightOfLine(lineIndex) / this.lineHeight\n        - charHeight * (1 - this._fontSizeFraction);\n\n      if (this.inCompositionMode) {\n        this.renderSelection(boundaries, ctx);\n      }\n      ctx.fillStyle = this.cursorColor || this.getValueOfPropertyAt(lineIndex, charIndex, 'fill');\n      ctx.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity;\n      ctx.fillRect(\n        boundaries.left + boundaries.leftOffset - cursorWidth / 2,\n        topOffset + boundaries.top + dy,\n        cursorWidth,\n        charHeight);\n    },\n\n    /**\n     * Renders text selection\n     * @param {Object} boundaries Object with left/top/leftOffset/topOffset\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderSelection: function(boundaries, ctx) {\n\n      var selectionStart = this.inCompositionMode ? this.hiddenTextarea.selectionStart : this.selectionStart,\n          selectionEnd = this.inCompositionMode ? this.hiddenTextarea.selectionEnd : this.selectionEnd,\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          start = this.get2DCursorLocation(selectionStart),\n          end = this.get2DCursorLocation(selectionEnd),\n          startLine = start.lineIndex,\n          endLine = end.lineIndex,\n          startChar = start.charIndex < 0 ? 0 : start.charIndex,\n          endChar = end.charIndex < 0 ? 0 : end.charIndex;\n\n      for (var i = startLine; i <= endLine; i++) {\n        var lineOffset = this._getLineLeftOffset(i) || 0,\n            lineHeight = this.getHeightOfLine(i),\n            realLineHeight = 0, boxStart = 0, boxEnd = 0;\n\n        if (i === startLine) {\n          boxStart = this.__charBounds[startLine][startChar].left;\n        }\n        if (i >= startLine && i < endLine) {\n          boxEnd = isJustify && !this.isEndOfWrapping(i) ? this.width : this.getLineWidth(i) || 5; // WTF is this 5?\n        }\n        else if (i === endLine) {\n          if (endChar === 0) {\n            boxEnd = this.__charBounds[endLine][endChar].left;\n          }\n          else {\n            var charSpacing = this._getWidthOfCharSpacing();\n            boxEnd = this.__charBounds[endLine][endChar - 1].left\n              + this.__charBounds[endLine][endChar - 1].width - charSpacing;\n          }\n        }\n        realLineHeight = lineHeight;\n        if (this.lineHeight < 1 || (i === endLine && this.lineHeight > 1)) {\n          lineHeight /= this.lineHeight;\n        }\n        var drawStart = boundaries.left + lineOffset + boxStart,\n            drawWidth = boxEnd - boxStart,\n            drawHeight = lineHeight, extraTop = 0;\n        if (this.inCompositionMode) {\n          ctx.fillStyle = this.compositionColor || 'black';\n          drawHeight = 1;\n          extraTop = lineHeight;\n        }\n        else {\n          ctx.fillStyle = this.selectionColor;\n        }\n        if (this.direction === 'rtl') {\n          drawStart = this.width - drawStart - drawWidth;\n        }\n        ctx.fillRect(\n          drawStart,\n          boundaries.top + boundaries.topOffset + extraTop,\n          drawWidth,\n          drawHeight);\n        boundaries.topOffset += realLineHeight;\n      }\n    },\n\n    /**\n     * High level function to know the height of the cursor.\n     * the currentChar is the one that precedes the cursor\n     * Returns fontSize of char at the current cursor\n     * Unused from the library, is for the end user\n     * @return {Number} Character font size\n     */\n    getCurrentCharFontSize: function() {\n      var cp = this._getCurrentCharIndex();\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fontSize');\n    },\n\n    /**\n     * High level function to know the color of the cursor.\n     * the currentChar is the one that precedes the cursor\n     * Returns color (fill) of char at the current cursor\n     * if the text object has a pattern or gradient for filler, it will return that.\n     * Unused by the library, is for the end user\n     * @return {String | fabric.Gradient | fabric.Pattern} Character color (fill)\n     */\n    getCurrentCharColor: function() {\n      var cp = this._getCurrentCharIndex();\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fill');\n    },\n\n    /**\n     * Returns the cursor position for the getCurrent.. functions\n     * @private\n     */\n    _getCurrentCharIndex: function() {\n      var cursorPosition = this.get2DCursorLocation(this.selectionStart, true),\n          charIndex = cursorPosition.charIndex > 0 ? cursorPosition.charIndex - 1 : 0;\n      return { l: cursorPosition.lineIndex, c: charIndex };\n    }\n  });\n\n  /**\n   * Returns fabric.IText instance from an object representation\n   * @static\n   * @memberOf fabric.IText\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as argument\n   */\n  fabric.IText.fromObject = function(object, callback) {\n    parseDecoration(object);\n    if (object.styles) {\n      for (var i in object.styles) {\n        for (var j in object.styles[i]) {\n          parseDecoration(object.styles[i][j]);\n        }\n      }\n    }\n    fabric.Object._fromObject('IText', object, callback, 'text');\n  };\n})();\n\n\n(function() {\n\n  var clone = fabric.util.object.clone;\n\n  fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Initializes all the interactive behavior of IText\n     */\n    initBehavior: function() {\n      this.initAddedHandler();\n      this.initRemovedHandler();\n      this.initCursorSelectionHandlers();\n      this.initDoubleClickSimulation();\n      this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\n    },\n\n    onDeselect: function() {\n      this.isEditing && this.exitEditing();\n      this.selected = false;\n    },\n\n    /**\n     * Initializes \"added\" event handler\n     */\n    initAddedHandler: function() {\n      var _this = this;\n      this.on('added', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          if (!canvas._hasITextHandlers) {\n            canvas._hasITextHandlers = true;\n            _this._initCanvasHandlers(canvas);\n          }\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          canvas._iTextInstances.push(_this);\n        }\n      });\n    },\n\n    initRemovedHandler: function() {\n      var _this = this;\n      this.on('removed', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          fabric.util.removeFromArray(canvas._iTextInstances, _this);\n          if (canvas._iTextInstances.length === 0) {\n            canvas._hasITextHandlers = false;\n            _this._removeCanvasHandlers(canvas);\n          }\n        }\n      });\n    },\n\n    /**\n     * register canvas event to manage exiting on other instances\n     * @private\n     */\n    _initCanvasHandlers: function(canvas) {\n      canvas._mouseUpITextHandler = function() {\n        if (canvas._iTextInstances) {\n          canvas._iTextInstances.forEach(function(obj) {\n            obj.__isMousedown = false;\n          });\n        }\n      };\n      canvas.on('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * remove canvas event to manage exiting on other instances\n     * @private\n     */\n    _removeCanvasHandlers: function(canvas) {\n      canvas.off('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * @private\n     */\n    _tick: function() {\n      this._currentTickState = this._animateCursor(this, 1, this.cursorDuration, '_onTickComplete');\n    },\n\n    /**\n     * @private\n     */\n    _animateCursor: function(obj, targetOpacity, duration, completeMethod) {\n\n      var tickState;\n\n      tickState = {\n        isAborted: false,\n        abort: function() {\n          this.isAborted = true;\n        },\n      };\n\n      obj.animate('_currentCursorOpacity', targetOpacity, {\n        duration: duration,\n        onComplete: function() {\n          if (!tickState.isAborted) {\n            obj[completeMethod]();\n          }\n        },\n        onChange: function() {\n          // we do not want to animate a selection, only cursor\n          if (obj.canvas && obj.selectionStart === obj.selectionEnd) {\n            obj.renderCursorOrSelection();\n          }\n        },\n        abort: function() {\n          return tickState.isAborted;\n        }\n      });\n      return tickState;\n    },\n\n    /**\n     * @private\n     */\n    _onTickComplete: function() {\n\n      var _this = this;\n\n      if (this._cursorTimeout1) {\n        clearTimeout(this._cursorTimeout1);\n      }\n      this._cursorTimeout1 = setTimeout(function() {\n        _this._currentTickCompleteState = _this._animateCursor(_this, 0, this.cursorDuration / 2, '_tick');\n      }, 100);\n    },\n\n    /**\n     * Initializes delayed cursor\n     */\n    initDelayedCursor: function(restart) {\n      var _this = this,\n          delay = restart ? 0 : this.cursorDelay;\n\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this._cursorTimeout2 = setTimeout(function() {\n        _this._tick();\n      }, delay);\n    },\n\n    /**\n     * Aborts cursor animation and clears all timeouts\n     */\n    abortCursorAnimation: function() {\n      var shouldClear = this._currentTickState || this._currentTickCompleteState,\n          canvas = this.canvas;\n      this._currentTickState && this._currentTickState.abort();\n      this._currentTickCompleteState && this._currentTickCompleteState.abort();\n\n      clearTimeout(this._cursorTimeout1);\n      clearTimeout(this._cursorTimeout2);\n\n      this._currentCursorOpacity = 0;\n      // to clear just itext area we need to transform the context\n      // it may not be worth it\n      if (shouldClear && canvas) {\n        canvas.clearContext(canvas.contextTop || canvas.contextContainer);\n      }\n\n    },\n\n    /**\n     * Selects entire text\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    selectAll: function() {\n      this.selectionStart = 0;\n      this.selectionEnd = this._text.length;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      return this;\n    },\n\n    /**\n     * Returns selected text\n     * @return {String}\n     */\n    getSelectedText: function() {\n      return this._text.slice(this.selectionStart, this.selectionEnd).join('');\n    },\n\n    /**\n     * Find new selection index representing start of current word according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      // remove space before cursor first\n      if (this._reSpace.test(this._text[index])) {\n        while (this._reSpace.test(this._text[index])) {\n          offset++;\n          index--;\n        }\n      }\n      while (/\\S/.test(this._text[index]) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current word according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      // remove space after cursor first\n      if (this._reSpace.test(this._text[index])) {\n        while (this._reSpace.test(this._text[index])) {\n          offset++;\n          index++;\n        }\n      }\n      while (/\\S/.test(this._text[index]) && index < this._text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Find new selection index representing start of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      while (!/\\n/.test(this._text[index]) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      while (!/\\n/.test(this._text[index]) && index < this._text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Finds index corresponding to beginning or end of a word\n     * @param {Number} selectionStart Index of a character\n     * @param {Number} direction 1 or -1\n     * @return {Number} Index of the beginning or end of a word\n     */\n    searchWordBoundary: function(selectionStart, direction) {\n      var text = this._text,\n          index     = this._reSpace.test(text[selectionStart]) ? selectionStart - 1 : selectionStart,\n          _char     = text[index],\n          // wrong\n          reNonWord = fabric.reNonWord;\n\n      while (!reNonWord.test(_char) && index > 0 && index < text.length) {\n        index += direction;\n        _char = text[index];\n      }\n      if (reNonWord.test(_char)) {\n        index += direction === 1 ? 0 : 1;\n      }\n      return index;\n    },\n\n    /**\n     * Selects a word based on the index\n     * @param {Number} selectionStart Index of a character\n     */\n    selectWord: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.searchWordBoundary(selectionStart, -1), /* search backwards */\n          newSelectionEnd = this.searchWordBoundary(selectionStart, 1); /* search forward */\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * Selects a line based on the index\n     * @param {Number} selectionStart Index of a character\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    selectLine: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.findLineBoundaryLeft(selectionStart),\n          newSelectionEnd = this.findLineBoundaryRight(selectionStart);\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      return this;\n    },\n\n    /**\n     * Enters editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    enterEditing: function(e) {\n      if (this.isEditing || !this.editable) {\n        return;\n      }\n\n      if (this.canvas) {\n        this.canvas.calcOffset();\n        this.exitEditingOnOthers(this.canvas);\n      }\n\n      this.isEditing = true;\n\n      this.initHiddenTextarea(e);\n      this.hiddenTextarea.focus();\n      this.hiddenTextarea.value = this.text;\n      this._updateTextarea();\n      this._saveEditingProps();\n      this._setEditingProps();\n      this._textBeforeEdit = this.text;\n\n      this._tick();\n      this.fire('editing:entered');\n      this._fireSelectionChanged();\n      if (!this.canvas) {\n        return this;\n      }\n      this.canvas.fire('text:editing:entered', { target: this });\n      this.initMouseMoveHandler();\n      this.canvas.requestRenderAll();\n      return this;\n    },\n\n    exitEditingOnOthers: function(canvas) {\n      if (canvas._iTextInstances) {\n        canvas._iTextInstances.forEach(function(obj) {\n          obj.selected = false;\n          if (obj.isEditing) {\n            obj.exitEditing();\n          }\n        });\n      }\n    },\n\n    /**\n     * Initializes \"mousemove\" event handler\n     */\n    initMouseMoveHandler: function() {\n      this.canvas.on('mouse:move', this.mouseMoveHandler);\n    },\n\n    /**\n     * @private\n     */\n    mouseMoveHandler: function(options) {\n      if (!this.__isMousedown || !this.isEditing) {\n        return;\n      }\n\n      var newSelectionStart = this.getSelectionStartFromPointer(options.e),\n          currentStart = this.selectionStart,\n          currentEnd = this.selectionEnd;\n      if (\n        (newSelectionStart !== this.__selectionStartOnMouseDown || currentStart === currentEnd)\n        &&\n        (currentStart === newSelectionStart || currentEnd === newSelectionStart)\n      ) {\n        return;\n      }\n      if (newSelectionStart > this.__selectionStartOnMouseDown) {\n        this.selectionStart = this.__selectionStartOnMouseDown;\n        this.selectionEnd = newSelectionStart;\n      }\n      else {\n        this.selectionStart = newSelectionStart;\n        this.selectionEnd = this.__selectionStartOnMouseDown;\n      }\n      if (this.selectionStart !== currentStart || this.selectionEnd !== currentEnd) {\n        this.restartCursorIfNeeded();\n        this._fireSelectionChanged();\n        this._updateTextarea();\n        this.renderCursorOrSelection();\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setEditingProps: function() {\n      this.hoverCursor = 'text';\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this.canvas.moveCursor = 'text';\n      }\n\n      this.borderColor = this.editingBorderColor;\n      this.hasControls = this.selectable = false;\n      this.lockMovementX = this.lockMovementY = true;\n    },\n\n    /**\n     * convert from textarea to grapheme indexes\n     */\n    fromStringToGraphemeSelection: function(start, end, text) {\n      var smallerTextStart = text.slice(0, start),\n          graphemeStart = fabric.util.string.graphemeSplit(smallerTextStart).length;\n      if (start === end) {\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n      }\n      var smallerTextEnd = text.slice(start, end),\n          graphemeEnd = fabric.util.string.graphemeSplit(smallerTextEnd).length;\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\n    },\n\n    /**\n     * convert from fabric to textarea values\n     */\n    fromGraphemeToStringSelection: function(start, end, _text) {\n      var smallerTextStart = _text.slice(0, start),\n          graphemeStart = smallerTextStart.join('').length;\n      if (start === end) {\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n      }\n      var smallerTextEnd = _text.slice(start, end),\n          graphemeEnd = smallerTextEnd.join('').length;\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\n    },\n\n    /**\n     * @private\n     */\n    _updateTextarea: function() {\n      this.cursorOffsetCache = { };\n      if (!this.hiddenTextarea) {\n        return;\n      }\n      if (!this.inCompositionMode) {\n        var newSelection = this.fromGraphemeToStringSelection(this.selectionStart, this.selectionEnd, this._text);\n        this.hiddenTextarea.selectionStart = newSelection.selectionStart;\n        this.hiddenTextarea.selectionEnd = newSelection.selectionEnd;\n      }\n      this.updateTextareaPosition();\n    },\n\n    /**\n     * @private\n     */\n    updateFromTextArea: function() {\n      if (!this.hiddenTextarea) {\n        return;\n      }\n      this.cursorOffsetCache = { };\n      this.text = this.hiddenTextarea.value;\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      var newSelection = this.fromStringToGraphemeSelection(\n        this.hiddenTextarea.selectionStart, this.hiddenTextarea.selectionEnd, this.hiddenTextarea.value);\n      this.selectionEnd = this.selectionStart = newSelection.selectionEnd;\n      if (!this.inCompositionMode) {\n        this.selectionStart = newSelection.selectionStart;\n      }\n      this.updateTextareaPosition();\n    },\n\n    /**\n     * @private\n     */\n    updateTextareaPosition: function() {\n      if (this.selectionStart === this.selectionEnd) {\n        var style = this._calcTextareaPosition();\n        this.hiddenTextarea.style.left = style.left;\n        this.hiddenTextarea.style.top = style.top;\n      }\n    },\n\n    /**\n     * @private\n     * @return {Object} style contains style for hiddenTextarea\n     */\n    _calcTextareaPosition: function() {\n      if (!this.canvas) {\n        return { x: 1, y: 1 };\n      }\n      var desiredPosition = this.inCompositionMode ? this.compositionStart : this.selectionStart,\n          boundaries = this._getCursorBoundaries(desiredPosition),\n          cursorLocation = this.get2DCursorLocation(desiredPosition),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex,\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize') * this.lineHeight,\n          leftOffset = boundaries.leftOffset,\n          m = this.calcTransformMatrix(),\n          p = {\n            x: boundaries.left + leftOffset,\n            y: boundaries.top + boundaries.topOffset + charHeight\n          },\n          retinaScaling = this.canvas.getRetinaScaling(),\n          upperCanvas = this.canvas.upperCanvasEl,\n          upperCanvasWidth = upperCanvas.width / retinaScaling,\n          upperCanvasHeight = upperCanvas.height / retinaScaling,\n          maxWidth = upperCanvasWidth - charHeight,\n          maxHeight = upperCanvasHeight - charHeight,\n          scaleX = upperCanvas.clientWidth / upperCanvasWidth,\n          scaleY = upperCanvas.clientHeight / upperCanvasHeight;\n\n      p = fabric.util.transformPoint(p, m);\n      p = fabric.util.transformPoint(p, this.canvas.viewportTransform);\n      p.x *= scaleX;\n      p.y *= scaleY;\n      if (p.x < 0) {\n        p.x = 0;\n      }\n      if (p.x > maxWidth) {\n        p.x = maxWidth;\n      }\n      if (p.y < 0) {\n        p.y = 0;\n      }\n      if (p.y > maxHeight) {\n        p.y = maxHeight;\n      }\n\n      // add canvas offset on document\n      p.x += this.canvas._offset.left;\n      p.y += this.canvas._offset.top;\n\n      return { left: p.x + 'px', top: p.y + 'px', fontSize: charHeight + 'px', charHeight: charHeight };\n    },\n\n    /**\n     * @private\n     */\n    _saveEditingProps: function() {\n      this._savedProps = {\n        hasControls: this.hasControls,\n        borderColor: this.borderColor,\n        lockMovementX: this.lockMovementX,\n        lockMovementY: this.lockMovementY,\n        hoverCursor: this.hoverCursor,\n        selectable: this.selectable,\n        defaultCursor: this.canvas && this.canvas.defaultCursor,\n        moveCursor: this.canvas && this.canvas.moveCursor\n      };\n    },\n\n    /**\n     * @private\n     */\n    _restoreEditingProps: function() {\n      if (!this._savedProps) {\n        return;\n      }\n\n      this.hoverCursor = this._savedProps.hoverCursor;\n      this.hasControls = this._savedProps.hasControls;\n      this.borderColor = this._savedProps.borderColor;\n      this.selectable = this._savedProps.selectable;\n      this.lockMovementX = this._savedProps.lockMovementX;\n      this.lockMovementY = this._savedProps.lockMovementY;\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this._savedProps.defaultCursor;\n        this.canvas.moveCursor = this._savedProps.moveCursor;\n      }\n    },\n\n    /**\n     * Exits from editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    exitEditing: function() {\n      var isTextChanged = (this._textBeforeEdit !== this.text);\n      var hiddenTextarea = this.hiddenTextarea;\n      this.selected = false;\n      this.isEditing = false;\n\n      this.selectionEnd = this.selectionStart;\n\n      if (hiddenTextarea) {\n        hiddenTextarea.blur && hiddenTextarea.blur();\n        hiddenTextarea.parentNode && hiddenTextarea.parentNode.removeChild(hiddenTextarea);\n      }\n      this.hiddenTextarea = null;\n      this.abortCursorAnimation();\n      this._restoreEditingProps();\n      this._currentCursorOpacity = 0;\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      this.fire('editing:exited');\n      isTextChanged && this.fire('modified');\n      if (this.canvas) {\n        this.canvas.off('mouse:move', this.mouseMoveHandler);\n        this.canvas.fire('text:editing:exited', { target: this });\n        isTextChanged && this.canvas.fire('object:modified', { target: this });\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _removeExtraneousStyles: function() {\n      for (var prop in this.styles) {\n        if (!this._textLines[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * remove and reflow a style block from start to end.\n     * @param {Number} start linear start position for removal (included in removal)\n     * @param {Number} end linear end position for removal ( excluded from removal )\n     */\n    removeStyleFromTo: function(start, end) {\n      var cursorStart = this.get2DCursorLocation(start, true),\n          cursorEnd = this.get2DCursorLocation(end, true),\n          lineStart = cursorStart.lineIndex,\n          charStart = cursorStart.charIndex,\n          lineEnd = cursorEnd.lineIndex,\n          charEnd = cursorEnd.charIndex,\n          i, styleObj;\n      if (lineStart !== lineEnd) {\n        // step1 remove the trailing of lineStart\n        if (this.styles[lineStart]) {\n          for (i = charStart; i < this._unwrappedTextLines[lineStart].length; i++) {\n            delete this.styles[lineStart][i];\n          }\n        }\n        // step2 move the trailing of lineEnd to lineStart if needed\n        if (this.styles[lineEnd]) {\n          for (i = charEnd; i < this._unwrappedTextLines[lineEnd].length; i++) {\n            styleObj = this.styles[lineEnd][i];\n            if (styleObj) {\n              this.styles[lineStart] || (this.styles[lineStart] = { });\n              this.styles[lineStart][charStart + i - charEnd] = styleObj;\n            }\n          }\n        }\n        // step3 detects lines will be completely removed.\n        for (i = lineStart + 1; i <= lineEnd; i++) {\n          delete this.styles[i];\n        }\n        // step4 shift remaining lines.\n        this.shiftLineStyles(lineEnd, lineStart - lineEnd);\n      }\n      else {\n        // remove and shift left on the same line\n        if (this.styles[lineStart]) {\n          styleObj = this.styles[lineStart];\n          var diff = charEnd - charStart, numericChar, _char;\n          for (i = charStart; i < charEnd; i++) {\n            delete styleObj[i];\n          }\n          for (_char in this.styles[lineStart]) {\n            numericChar = parseInt(_char, 10);\n            if (numericChar >= charEnd) {\n              styleObj[numericChar - diff] = styleObj[_char];\n              delete styleObj[_char];\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Shifts line styles up or down\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} offset Can any number?\n     */\n    shiftLineStyles: function(lineIndex, offset) {\n      // shift all line styles by offset upward or downward\n      // do not clone deep. we need new array, not new style objects\n      var clonedStyles = clone(this.styles);\n      for (var line in this.styles) {\n        var numericLine = parseInt(line, 10);\n        if (numericLine > lineIndex) {\n          this.styles[numericLine + offset] = clonedStyles[numericLine];\n          if (!clonedStyles[numericLine - offset]) {\n            delete this.styles[numericLine];\n          }\n        }\n      }\n    },\n\n    restartCursorIfNeeded: function() {\n      if (!this._currentTickState || this._currentTickState.isAborted\n        || !this._currentTickCompleteState || this._currentTickCompleteState.isAborted\n      ) {\n        this.initDelayedCursor();\n      }\n    },\n\n    /**\n     * Handle insertion of more consecutive style lines for when one or more\n     * newlines gets added to the text. Since current style needs to be shifted\n     * first we shift the current style of the number lines needed, then we add\n     * new lines from the last to the first.\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Number} qty number of lines to add\n     * @param {Array} copiedStyle Array of objects styles\n     */\n    insertNewlineStyleObject: function(lineIndex, charIndex, qty, copiedStyle) {\n      var currentCharStyle,\n          newLineStyles = {},\n          somethingAdded = false,\n          isEndOfLine = this._unwrappedTextLines[lineIndex].length === charIndex;\n\n      qty || (qty = 1);\n      this.shiftLineStyles(lineIndex, qty);\n      if (this.styles[lineIndex]) {\n        currentCharStyle = this.styles[lineIndex][charIndex === 0 ? charIndex : charIndex - 1];\n      }\n      // we clone styles of all chars\n      // after cursor onto the current line\n      for (var index in this.styles[lineIndex]) {\n        var numIndex = parseInt(index, 10);\n        if (numIndex >= charIndex) {\n          somethingAdded = true;\n          newLineStyles[numIndex - charIndex] = this.styles[lineIndex][index];\n          // remove lines from the previous line since they're on a new line now\n          if (!(isEndOfLine && charIndex === 0)) {\n            delete this.styles[lineIndex][index];\n          }\n        }\n      }\n      var styleCarriedOver = false;\n      if (somethingAdded && !isEndOfLine) {\n        // if is end of line, the extra style we copied\n        // is probably not something we want\n        this.styles[lineIndex + qty] = newLineStyles;\n        styleCarriedOver = true;\n      }\n      if (styleCarriedOver) {\n        // skip the last line of since we already prepared it.\n        qty--;\n      }\n      // for the all the lines or all the other lines\n      // we clone current char style onto the next (otherwise empty) line\n      while (qty > 0) {\n        if (copiedStyle && copiedStyle[qty - 1]) {\n          this.styles[lineIndex + qty] = { 0: clone(copiedStyle[qty - 1]) };\n        }\n        else if (currentCharStyle) {\n          this.styles[lineIndex + qty] = { 0: clone(currentCharStyle) };\n        }\n        else {\n          delete this.styles[lineIndex + qty];\n        }\n        qty--;\n      }\n      this._forceClearCache = true;\n    },\n\n    /**\n     * Inserts style object for a given line/char index\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Number} quantity number Style object to insert, if given\n     * @param {Array} copiedStyle array of style objects\n     */\n    insertCharStyleObject: function(lineIndex, charIndex, quantity, copiedStyle) {\n      if (!this.styles) {\n        this.styles = {};\n      }\n      var currentLineStyles       = this.styles[lineIndex],\n          currentLineStylesCloned = currentLineStyles ? clone(currentLineStyles) : {};\n\n      quantity || (quantity = 1);\n      // shift all char styles by quantity forward\n      // 0,1,2,3 -> (charIndex=2) -> 0,1,3,4 -> (insert 2) -> 0,1,2,3,4\n      for (var index in currentLineStylesCloned) {\n        var numericIndex = parseInt(index, 10);\n        if (numericIndex >= charIndex) {\n          currentLineStyles[numericIndex + quantity] = currentLineStylesCloned[numericIndex];\n          // only delete the style if there was nothing moved there\n          if (!currentLineStylesCloned[numericIndex - quantity]) {\n            delete currentLineStyles[numericIndex];\n          }\n        }\n      }\n      this._forceClearCache = true;\n      if (copiedStyle) {\n        while (quantity--) {\n          if (!Object.keys(copiedStyle[quantity]).length) {\n            continue;\n          }\n          if (!this.styles[lineIndex]) {\n            this.styles[lineIndex] = {};\n          }\n          this.styles[lineIndex][charIndex + quantity] = clone(copiedStyle[quantity]);\n        }\n        return;\n      }\n      if (!currentLineStyles) {\n        return;\n      }\n      var newStyle = currentLineStyles[charIndex ? charIndex - 1 : 1];\n      while (newStyle && quantity--) {\n        this.styles[lineIndex][charIndex + quantity] = clone(newStyle);\n      }\n    },\n\n    /**\n     * Inserts style object(s)\n     * @param {Array} insertedText Characters at the location where style is inserted\n     * @param {Number} start cursor index for inserting style\n     * @param {Array} [copiedStyle] array of style objects to insert.\n     */\n    insertNewStyleBlock: function(insertedText, start, copiedStyle) {\n      var cursorLoc = this.get2DCursorLocation(start, true),\n          addedLines = [0], linesLength = 0;\n      // get an array of how many char per lines are being added.\n      for (var i = 0; i < insertedText.length; i++) {\n        if (insertedText[i] === '\\n') {\n          linesLength++;\n          addedLines[linesLength] = 0;\n        }\n        else {\n          addedLines[linesLength]++;\n        }\n      }\n      // for the first line copy the style from the current char position.\n      if (addedLines[0] > 0) {\n        this.insertCharStyleObject(cursorLoc.lineIndex, cursorLoc.charIndex, addedLines[0], copiedStyle);\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[0] + 1);\n      }\n      linesLength && this.insertNewlineStyleObject(\n        cursorLoc.lineIndex, cursorLoc.charIndex + addedLines[0], linesLength);\n      for (var i = 1; i < linesLength; i++) {\n        if (addedLines[i] > 0) {\n          this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\n        }\n        else if (copiedStyle) {\n          this.styles[cursorLoc.lineIndex + i][0] = copiedStyle[0];\n        }\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[i] + 1);\n      }\n      // we use i outside the loop to get it like linesLength\n      if (addedLines[i] > 0) {\n        this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\n      }\n    },\n\n    /**\n     * Set the selectionStart and selectionEnd according to the new position of cursor\n     * mimic the key - mouse navigation when shift is pressed.\n     */\n    setSelectionStartEndWithShift: function(start, end, newSelection) {\n      if (newSelection <= start) {\n        if (end === start) {\n          this._selectionDirection = 'left';\n        }\n        else if (this._selectionDirection === 'right') {\n          this._selectionDirection = 'left';\n          this.selectionEnd = start;\n        }\n        this.selectionStart = newSelection;\n      }\n      else if (newSelection > start && newSelection < end) {\n        if (this._selectionDirection === 'right') {\n          this.selectionEnd = newSelection;\n        }\n        else {\n          this.selectionStart = newSelection;\n        }\n      }\n      else {\n        // newSelection is > selection start and end\n        if (end === start) {\n          this._selectionDirection = 'right';\n        }\n        else if (this._selectionDirection === 'left') {\n          this._selectionDirection = 'right';\n          this.selectionStart = end;\n        }\n        this.selectionEnd = newSelection;\n      }\n    },\n\n    setSelectionInBoundaries: function() {\n      var length = this.text.length;\n      if (this.selectionStart > length) {\n        this.selectionStart = length;\n      }\n      else if (this.selectionStart < 0) {\n        this.selectionStart = 0;\n      }\n      if (this.selectionEnd > length) {\n        this.selectionEnd = length;\n      }\n      else if (this.selectionEnd < 0) {\n        this.selectionEnd = 0;\n      }\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n  /**\n   * Initializes \"dbclick\" event handler\n   */\n  initDoubleClickSimulation: function() {\n\n    // for double click\n    this.__lastClickTime = +new Date();\n\n    // for triple click\n    this.__lastLastClickTime = +new Date();\n\n    this.__lastPointer = { };\n\n    this.on('mousedown', this.onMouseDown);\n  },\n\n  /**\n   * Default event handler to simulate triple click\n   * @private\n   */\n  onMouseDown: function(options) {\n    if (!this.canvas) {\n      return;\n    }\n    this.__newClickTime = +new Date();\n    var newPointer = options.pointer;\n    if (this.isTripleClick(newPointer)) {\n      this.fire('tripleclick', options);\n      this._stopEvent(options.e);\n    }\n    this.__lastLastClickTime = this.__lastClickTime;\n    this.__lastClickTime = this.__newClickTime;\n    this.__lastPointer = newPointer;\n    this.__lastIsEditing = this.isEditing;\n    this.__lastSelected = this.selected;\n  },\n\n  isTripleClick: function(newPointer) {\n    return this.__newClickTime - this.__lastClickTime < 500 &&\n        this.__lastClickTime - this.__lastLastClickTime < 500 &&\n        this.__lastPointer.x === newPointer.x &&\n        this.__lastPointer.y === newPointer.y;\n  },\n\n  /**\n   * @private\n   */\n  _stopEvent: function(e) {\n    e.preventDefault && e.preventDefault();\n    e.stopPropagation && e.stopPropagation();\n  },\n\n  /**\n   * Initializes event handlers related to cursor or selection\n   */\n  initCursorSelectionHandlers: function() {\n    this.initMousedownHandler();\n    this.initMouseupHandler();\n    this.initClicks();\n  },\n\n  /**\n   * Default handler for double click, select a word\n   */\n  doubleClickHandler: function(options) {\n    if (!this.isEditing) {\n      return;\n    }\n    this.selectWord(this.getSelectionStartFromPointer(options.e));\n  },\n\n  /**\n   * Default handler for triple click, select a line\n   */\n  tripleClickHandler: function(options) {\n    if (!this.isEditing) {\n      return;\n    }\n    this.selectLine(this.getSelectionStartFromPointer(options.e));\n  },\n\n  /**\n   * Initializes double and triple click event handlers\n   */\n  initClicks: function() {\n    this.on('mousedblclick', this.doubleClickHandler);\n    this.on('tripleclick', this.tripleClickHandler);\n  },\n\n  /**\n   * Default event handler for the basic functionalities needed on _mouseDown\n   * can be overridden to do something different.\n   * Scope of this implementation is: find the click position, set selectionStart\n   * find selectionEnd, initialize the drawing of either cursor or selection area\n   * initializing a mousedDown on a text area will cancel fabricjs knowledge of\n   * current compositionMode. It will be set to false.\n   */\n  _mouseDownHandler: function(options) {\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n\n    this.__isMousedown = true;\n\n    if (this.selected) {\n      this.inCompositionMode = false;\n      this.setCursorByClick(options.e);\n    }\n\n    if (this.isEditing) {\n      this.__selectionStartOnMouseDown = this.selectionStart;\n      if (this.selectionStart === this.selectionEnd) {\n        this.abortCursorAnimation();\n      }\n      this.renderCursorOrSelection();\n    }\n  },\n\n  /**\n   * Default event handler for the basic functionalities needed on mousedown:before\n   * can be overridden to do something different.\n   * Scope of this implementation is: verify the object is already selected when mousing down\n   */\n  _mouseDownHandlerBefore: function(options) {\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n    // we want to avoid that an object that was selected and then becomes unselectable,\n    // may trigger editing mode in some way.\n    this.selected = this === this.canvas._activeObject;\n  },\n\n  /**\n   * Initializes \"mousedown\" event handler\n   */\n  initMousedownHandler: function() {\n    this.on('mousedown', this._mouseDownHandler);\n    this.on('mousedown:before', this._mouseDownHandlerBefore);\n  },\n\n  /**\n   * Initializes \"mouseup\" event handler\n   */\n  initMouseupHandler: function() {\n    this.on('mouseup', this.mouseUpHandler);\n  },\n\n  /**\n   * standard handler for mouse up, overridable\n   * @private\n   */\n  mouseUpHandler: function(options) {\n    this.__isMousedown = false;\n    if (!this.editable || this.group ||\n      (options.transform && options.transform.actionPerformed) ||\n      (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n\n    if (this.canvas) {\n      var currentActive = this.canvas._activeObject;\n      if (currentActive && currentActive !== this) {\n        // avoid running this logic when there is an active object\n        // this because is possible with shift click and fast clicks,\n        // to rapidly deselect and reselect this object and trigger an enterEdit\n        return;\n      }\n    }\n\n    if (this.__lastSelected && !this.__corner) {\n      this.selected = false;\n      this.__lastSelected = false;\n      this.enterEditing(options.e);\n      if (this.selectionStart === this.selectionEnd) {\n        this.initDelayedCursor(true);\n      }\n      else {\n        this.renderCursorOrSelection();\n      }\n    }\n    else {\n      this.selected = true;\n    }\n  },\n\n  /**\n   * Changes cursor location in a text depending on passed pointer (x/y) object\n   * @param {Event} e Event object\n   */\n  setCursorByClick: function(e) {\n    var newSelection = this.getSelectionStartFromPointer(e),\n        start = this.selectionStart, end = this.selectionEnd;\n    if (e.shiftKey) {\n      this.setSelectionStartEndWithShift(start, end, newSelection);\n    }\n    else {\n      this.selectionStart = newSelection;\n      this.selectionEnd = newSelection;\n    }\n    if (this.isEditing) {\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Returns index of a character corresponding to where an object was clicked\n   * @param {Event} e Event object\n   * @return {Number} Index of a character\n   */\n  getSelectionStartFromPointer: function(e) {\n    var mouseOffset = this.getLocalPointer(e),\n        prevWidth = 0,\n        width = 0,\n        height = 0,\n        charIndex = 0,\n        lineIndex = 0,\n        lineLeftOffset,\n        line;\n    for (var i = 0, len = this._textLines.length; i < len; i++) {\n      if (height <= mouseOffset.y) {\n        height += this.getHeightOfLine(i) * this.scaleY;\n        lineIndex = i;\n        if (i > 0) {\n          charIndex += this._textLines[i - 1].length + this.missingNewlineOffset(i - 1);\n        }\n      }\n      else {\n        break;\n      }\n    }\n    lineLeftOffset = this._getLineLeftOffset(lineIndex);\n    width = lineLeftOffset * this.scaleX;\n    line = this._textLines[lineIndex];\n    // handling of RTL: in order to get things work correctly,\n    // we assume RTL writing is mirrored compared to LTR writing.\n    // so in position detection we mirror the X offset, and when is time\n    // of rendering it, we mirror it again.\n    if (this.direction === 'rtl') {\n      mouseOffset.x = this.width * this.scaleX - mouseOffset.x + width;\n    }\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\n      prevWidth = width;\n      // i removed something about flipX here, check.\n      width += this.__charBounds[lineIndex][j].kernedWidth * this.scaleX;\n      if (width <= mouseOffset.x) {\n        charIndex++;\n      }\n      else {\n        break;\n      }\n    }\n    return this._getNewSelectionStartFromOffset(mouseOffset, prevWidth, width, charIndex, jlen);\n  },\n\n  /**\n   * @private\n   */\n  _getNewSelectionStartFromOffset: function(mouseOffset, prevWidth, width, index, jlen) {\n    // we need Math.abs because when width is after the last char, the offset is given as 1, while is 0\n    var distanceBtwLastCharAndCursor = mouseOffset.x - prevWidth,\n        distanceBtwNextCharAndCursor = width - mouseOffset.x,\n        offset = distanceBtwNextCharAndCursor > distanceBtwLastCharAndCursor ||\n          distanceBtwNextCharAndCursor < 0 ? 0 : 1,\n        newSelectionStart = index + offset;\n    // if object is horizontally flipped, mirror cursor location from the end\n    if (this.flipX) {\n      newSelectionStart = jlen - newSelectionStart;\n    }\n\n    if (newSelectionStart > this._text.length) {\n      newSelectionStart = this._text.length;\n    }\n\n    return newSelectionStart;\n  }\n});\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n  /**\n   * Initializes hidden textarea (needed to bring up keyboard in iOS)\n   */\n  initHiddenTextarea: function() {\n    this.hiddenTextarea = fabric.document.createElement('textarea');\n    this.hiddenTextarea.setAttribute('autocapitalize', 'off');\n    this.hiddenTextarea.setAttribute('autocorrect', 'off');\n    this.hiddenTextarea.setAttribute('autocomplete', 'off');\n    this.hiddenTextarea.setAttribute('spellcheck', 'false');\n    this.hiddenTextarea.setAttribute('data-fabric-hiddentextarea', '');\n    this.hiddenTextarea.setAttribute('wrap', 'off');\n    var style = this._calcTextareaPosition();\n    // line-height: 1px; was removed from the style to fix this:\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=870966\n    this.hiddenTextarea.style.cssText = 'position: absolute; top: ' + style.top +\n    '; left: ' + style.left + '; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;' +\n    ' paddingtop: ' + style.fontSize + ';';\n    fabric.document.body.appendChild(this.hiddenTextarea);\n\n    fabric.util.addListener(this.hiddenTextarea, 'keydown', this.onKeyDown.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'keyup', this.onKeyUp.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'input', this.onInput.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'copy', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'cut', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'paste', this.paste.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionstart', this.onCompositionStart.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionupdate', this.onCompositionUpdate.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionend', this.onCompositionEnd.bind(this));\n\n    if (!this._clickHandlerInitialized && this.canvas) {\n      fabric.util.addListener(this.canvas.upperCanvasEl, 'click', this.onClick.bind(this));\n      this._clickHandlerInitialized = true;\n    }\n  },\n\n  /**\n   * For functionalities on keyDown\n   * Map a special key to a function of the instance/prototype\n   * If you need different behaviour for ESC or TAB or arrows, you have to change\n   * this map setting the name of a function that you build on the fabric.Itext or\n   * your prototype.\n   * the map change will affect all Instances unless you need for only some text Instances\n   * in that case you have to clone this object and assign your Instance.\n   * this.keysMap = fabric.util.object.clone(this.keysMap);\n   * The function must be in fabric.Itext.prototype.myFunction And will receive event as args[0]\n   */\n  keysMap: {\n    9:  'exitEditing',\n    27: 'exitEditing',\n    33: 'moveCursorUp',\n    34: 'moveCursorDown',\n    35: 'moveCursorRight',\n    36: 'moveCursorLeft',\n    37: 'moveCursorLeft',\n    38: 'moveCursorUp',\n    39: 'moveCursorRight',\n    40: 'moveCursorDown',\n  },\n\n  keysMapRtl: {\n    9:  'exitEditing',\n    27: 'exitEditing',\n    33: 'moveCursorUp',\n    34: 'moveCursorDown',\n    35: 'moveCursorLeft',\n    36: 'moveCursorRight',\n    37: 'moveCursorRight',\n    38: 'moveCursorUp',\n    39: 'moveCursorLeft',\n    40: 'moveCursorDown',\n  },\n\n  /**\n   * For functionalities on keyUp + ctrl || cmd\n   */\n  ctrlKeysMapUp: {\n    67: 'copy',\n    88: 'cut'\n  },\n\n  /**\n   * For functionalities on keyDown + ctrl || cmd\n   */\n  ctrlKeysMapDown: {\n    65: 'selectAll'\n  },\n\n  onClick: function() {\n    // No need to trigger click event here, focus is enough to have the keyboard appear on Android\n    this.hiddenTextarea && this.hiddenTextarea.focus();\n  },\n\n  /**\n   * Handles keydown event\n   * only used for arrows and combination of modifier keys.\n   * @param {Event} e Event object\n   */\n  onKeyDown: function(e) {\n    if (!this.isEditing) {\n      return;\n    }\n    var keyMap = this.direction === 'rtl' ? this.keysMapRtl : this.keysMap;\n    if (e.keyCode in keyMap) {\n      this[keyMap[e.keyCode]](e);\n    }\n    else if ((e.keyCode in this.ctrlKeysMapDown) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapDown[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    if (e.keyCode >= 33 && e.keyCode <= 40) {\n      // if i press an arrow key just update selection\n      this.inCompositionMode = false;\n      this.clearContextTop();\n      this.renderCursorOrSelection();\n    }\n    else {\n      this.canvas && this.canvas.requestRenderAll();\n    }\n  },\n\n  /**\n   * Handles keyup event\n   * We handle KeyUp because ie11 and edge have difficulties copy/pasting\n   * if a copy/cut event fired, keyup is dismissed\n   * @param {Event} e Event object\n   */\n  onKeyUp: function(e) {\n    if (!this.isEditing || this._copyDone || this.inCompositionMode) {\n      this._copyDone = false;\n      return;\n    }\n    if ((e.keyCode in this.ctrlKeysMapUp) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapUp[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    this.canvas && this.canvas.requestRenderAll();\n  },\n\n  /**\n   * Handles onInput event\n   * @param {Event} e Event object\n   */\n  onInput: function(e) {\n    var fromPaste = this.fromPaste;\n    this.fromPaste = false;\n    e && e.stopPropagation();\n    if (!this.isEditing) {\n      return;\n    }\n    // decisions about style changes.\n    var nextText = this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,\n        charCount = this._text.length,\n        nextCharCount = nextText.length,\n        removedText, insertedText,\n        charDiff = nextCharCount - charCount,\n        selectionStart = this.selectionStart, selectionEnd = this.selectionEnd,\n        selection = selectionStart !== selectionEnd,\n        copiedStyle, removeFrom, removeTo;\n    if (this.hiddenTextarea.value === '') {\n      this.styles = { };\n      this.updateFromTextArea();\n      this.fire('changed');\n      if (this.canvas) {\n        this.canvas.fire('text:changed', { target: this });\n        this.canvas.requestRenderAll();\n      }\n      return;\n    }\n\n    var textareaSelection = this.fromStringToGraphemeSelection(\n      this.hiddenTextarea.selectionStart,\n      this.hiddenTextarea.selectionEnd,\n      this.hiddenTextarea.value\n    );\n    var backDelete = selectionStart > textareaSelection.selectionStart;\n\n    if (selection) {\n      removedText = this._text.slice(selectionStart, selectionEnd);\n      charDiff += selectionEnd - selectionStart;\n    }\n    else if (nextCharCount < charCount) {\n      if (backDelete) {\n        removedText = this._text.slice(selectionEnd + charDiff, selectionEnd);\n      }\n      else {\n        removedText = this._text.slice(selectionStart, selectionStart - charDiff);\n      }\n    }\n    insertedText = nextText.slice(textareaSelection.selectionEnd - charDiff, textareaSelection.selectionEnd);\n    if (removedText && removedText.length) {\n      if (insertedText.length) {\n        // let's copy some style before deleting.\n        // we want to copy the style before the cursor OR the style at the cursor if selection\n        // is bigger than 0.\n        copiedStyle = this.getSelectionStyles(selectionStart, selectionStart + 1, false);\n        // now duplicate the style one for each inserted text.\n        copiedStyle = insertedText.map(function() {\n          // this return an array of references, but that is fine since we are\n          // copying the style later.\n          return copiedStyle[0];\n        });\n      }\n      if (selection) {\n        removeFrom = selectionStart;\n        removeTo = selectionEnd;\n      }\n      else if (backDelete) {\n        // detect differences between forwardDelete and backDelete\n        removeFrom = selectionEnd - removedText.length;\n        removeTo = selectionEnd;\n      }\n      else {\n        removeFrom = selectionEnd;\n        removeTo = selectionEnd + removedText.length;\n      }\n      this.removeStyleFromTo(removeFrom, removeTo);\n    }\n    if (insertedText.length) {\n      if (fromPaste && insertedText.join('') === fabric.copiedText && !fabric.disableStyleCopyPaste) {\n        copiedStyle = fabric.copiedTextStyle;\n      }\n      this.insertNewStyleBlock(insertedText, selectionStart, copiedStyle);\n    }\n    this.updateFromTextArea();\n    this.fire('changed');\n    if (this.canvas) {\n      this.canvas.fire('text:changed', { target: this });\n      this.canvas.requestRenderAll();\n    }\n  },\n  /**\n   * Composition start\n   */\n  onCompositionStart: function() {\n    this.inCompositionMode = true;\n  },\n\n  /**\n   * Composition end\n   */\n  onCompositionEnd: function() {\n    this.inCompositionMode = false;\n  },\n\n  // /**\n  //  * Composition update\n  //  */\n  onCompositionUpdate: function(e) {\n    this.compositionStart = e.target.selectionStart;\n    this.compositionEnd = e.target.selectionEnd;\n    this.updateTextareaPosition();\n  },\n\n  /**\n   * Copies selected text\n   * @param {Event} e Event object\n   */\n  copy: function() {\n    if (this.selectionStart === this.selectionEnd) {\n      //do not cut-copy if no selection\n      return;\n    }\n\n    fabric.copiedText = this.getSelectedText();\n    if (!fabric.disableStyleCopyPaste) {\n      fabric.copiedTextStyle = this.getSelectionStyles(this.selectionStart, this.selectionEnd, true);\n    }\n    else {\n      fabric.copiedTextStyle = null;\n    }\n    this._copyDone = true;\n  },\n\n  /**\n   * Pastes text\n   * @param {Event} e Event object\n   */\n  paste: function() {\n    this.fromPaste = true;\n  },\n\n  /**\n   * @private\n   * @param {Event} e Event object\n   * @return {Object} Clipboard data object\n   */\n  _getClipboardData: function(e) {\n    return (e && e.clipboardData) || fabric.window.clipboardData;\n  },\n\n  /**\n   * Finds the width in pixels before the cursor on the same line\n   * @private\n   * @param {Number} lineIndex\n   * @param {Number} charIndex\n   * @return {Number} widthBeforeCursor width before cursor\n   */\n  _getWidthBeforeCursor: function(lineIndex, charIndex) {\n    var widthBeforeCursor = this._getLineLeftOffset(lineIndex), bound;\n\n    if (charIndex > 0) {\n      bound = this.__charBounds[lineIndex][charIndex - 1];\n      widthBeforeCursor += bound.left + bound.width;\n    }\n    return widthBeforeCursor;\n  },\n\n  /**\n   * Gets start offset of a selection\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getDownCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    // if on last line, down cursor goes to end of line\n    if (lineIndex === this._textLines.length - 1 || e.metaKey || e.keyCode === 34) {\n      // move to the end of a text\n      return this._text.length - selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex + 1, widthBeforeCursor),\n        textAfterCursor = this._textLines[lineIndex].slice(charIndex);\n    return textAfterCursor.length + indexOnOtherLine + 1 + this.missingNewlineOffset(lineIndex);\n  },\n\n  /**\n   * private\n   * Helps finding if the offset should be counted from Start or End\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  _getSelectionForOffset: function(e, isRight) {\n    if (e.shiftKey && this.selectionStart !== this.selectionEnd && isRight) {\n      return this.selectionEnd;\n    }\n    else {\n      return this.selectionStart;\n    }\n  },\n\n  /**\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getUpCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    if (lineIndex === 0 || e.metaKey || e.keyCode === 33) {\n      // if on first line, up cursor goes to start of line\n      return -selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex - 1, widthBeforeCursor),\n        textBeforeCursor = this._textLines[lineIndex].slice(0, charIndex),\n        missingNewlineOffset = this.missingNewlineOffset(lineIndex - 1);\n    // return a negative offset\n    return -this._textLines[lineIndex - 1].length\n     + indexOnOtherLine - textBeforeCursor.length + (1 - missingNewlineOffset);\n  },\n\n  /**\n   * for a given width it founds the matching character.\n   * @private\n   */\n  _getIndexOnLine: function(lineIndex, width) {\n\n    var line = this._textLines[lineIndex],\n        lineLeftOffset = this._getLineLeftOffset(lineIndex),\n        widthOfCharsOnLine = lineLeftOffset,\n        indexOnLine = 0, charWidth, foundMatch;\n\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\n      charWidth = this.__charBounds[lineIndex][j].width;\n      widthOfCharsOnLine += charWidth;\n      if (widthOfCharsOnLine > width) {\n        foundMatch = true;\n        var leftEdge = widthOfCharsOnLine - charWidth,\n            rightEdge = widthOfCharsOnLine,\n            offsetFromLeftEdge = Math.abs(leftEdge - width),\n            offsetFromRightEdge = Math.abs(rightEdge - width);\n\n        indexOnLine = offsetFromRightEdge < offsetFromLeftEdge ? j : (j - 1);\n        break;\n      }\n    }\n\n    // reached end\n    if (!foundMatch) {\n      indexOnLine = line.length - 1;\n    }\n\n    return indexOnLine;\n  },\n\n\n  /**\n   * Moves cursor down\n   * @param {Event} e Event object\n   */\n  moveCursorDown: function(e) {\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\n      return;\n    }\n    this._moveCursorUpOrDown('Down', e);\n  },\n\n  /**\n   * Moves cursor up\n   * @param {Event} e Event object\n   */\n  moveCursorUp: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorUpOrDown('Up', e);\n  },\n\n  /**\n   * Moves cursor up or down, fires the events\n   * @param {String} direction 'Up' or 'Down'\n   * @param {Event} e Event object\n   */\n  _moveCursorUpOrDown: function(direction, e) {\n    // getUpCursorOffset\n    // getDownCursorOffset\n    var action = 'get' + direction + 'CursorOffset',\n        offset = this[action](e, this._selectionDirection === 'right');\n    if (e.shiftKey) {\n      this.moveCursorWithShift(offset);\n    }\n    else {\n      this.moveCursorWithoutShift(offset);\n    }\n    if (offset !== 0) {\n      this.setSelectionInBoundaries();\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor with shift\n   * @param {Number} offset\n   */\n  moveCursorWithShift: function(offset) {\n    var newSelection = this._selectionDirection === 'left'\n      ? this.selectionStart + offset\n      : this.selectionEnd + offset;\n    this.setSelectionStartEndWithShift(this.selectionStart, this.selectionEnd, newSelection);\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor up without shift\n   * @param {Number} offset\n   */\n  moveCursorWithoutShift: function(offset) {\n    if (offset < 0) {\n      this.selectionStart += offset;\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionEnd += offset;\n      this.selectionStart = this.selectionEnd;\n    }\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor left\n   * @param {Event} e Event object\n   */\n  moveCursorLeft: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Left', e);\n  },\n\n  /**\n   * @private\n   * @return {Boolean} true if a change happened\n   */\n  _move: function(e, prop, direction) {\n    var newValue;\n    if (e.altKey) {\n      newValue = this['findWordBoundary' + direction](this[prop]);\n    }\n    else if (e.metaKey || e.keyCode === 35 ||  e.keyCode === 36 ) {\n      newValue = this['findLineBoundary' + direction](this[prop]);\n    }\n    else {\n      this[prop] += direction === 'Left' ? -1 : 1;\n      return true;\n    }\n    if (typeof newValue !== undefined && this[prop] !== newValue) {\n      this[prop] = newValue;\n      return true;\n    }\n  },\n\n  /**\n   * @private\n   */\n  _moveLeft: function(e, prop) {\n    return this._move(e, prop, 'Left');\n  },\n\n  /**\n   * @private\n   */\n  _moveRight: function(e, prop) {\n    return this._move(e, prop, 'Right');\n  },\n\n  /**\n   * Moves cursor left without keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithoutShift: function(e) {\n    var change = true;\n    this._selectionDirection = 'left';\n\n    // only move cursor when there is no selection,\n    // otherwise we discard it, and leave cursor on same place\n    if (this.selectionEnd === this.selectionStart && this.selectionStart !== 0) {\n      change = this._moveLeft(e, 'selectionStart');\n\n    }\n    this.selectionEnd = this.selectionStart;\n    return change;\n  },\n\n  /**\n   * Moves cursor left while keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithShift: function(e) {\n    if (this._selectionDirection === 'right' && this.selectionStart !== this.selectionEnd) {\n      return this._moveLeft(e, 'selectionEnd');\n    }\n    else if (this.selectionStart !== 0){\n      this._selectionDirection = 'left';\n      return this._moveLeft(e, 'selectionStart');\n    }\n  },\n\n  /**\n   * Moves cursor right\n   * @param {Event} e Event object\n   */\n  moveCursorRight: function(e) {\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Right', e);\n  },\n\n  /**\n   * Moves cursor right or Left, fires event\n   * @param {String} direction 'Left', 'Right'\n   * @param {Event} e Event object\n   */\n  _moveCursorLeftOrRight: function(direction, e) {\n    var actionName = 'moveCursor' + direction + 'With';\n    this._currentCursorOpacity = 1;\n\n    if (e.shiftKey) {\n      actionName += 'Shift';\n    }\n    else {\n      actionName += 'outShift';\n    }\n    if (this[actionName](e)) {\n      this.abortCursorAnimation();\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor right while keeping selection\n   * @param {Event} e\n   */\n  moveCursorRightWithShift: function(e) {\n    if (this._selectionDirection === 'left' && this.selectionStart !== this.selectionEnd) {\n      return this._moveRight(e, 'selectionStart');\n    }\n    else if (this.selectionEnd !== this._text.length) {\n      this._selectionDirection = 'right';\n      return this._moveRight(e, 'selectionEnd');\n    }\n  },\n\n  /**\n   * Moves cursor right without keeping selection\n   * @param {Event} e Event object\n   */\n  moveCursorRightWithoutShift: function(e) {\n    var changed = true;\n    this._selectionDirection = 'right';\n\n    if (this.selectionStart === this.selectionEnd) {\n      changed = this._moveRight(e, 'selectionStart');\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionStart = this.selectionEnd;\n    }\n    return changed;\n  },\n\n  /**\n   * Removes characters from start/end\n   * start/end ar per grapheme position in _text array.\n   *\n   * @param {Number} start\n   * @param {Number} end default to start + 1\n   */\n  removeChars: function(start, end) {\n    if (typeof end === 'undefined') {\n      end = start + 1;\n    }\n    this.removeStyleFromTo(start, end);\n    this._text.splice(start, end - start);\n    this.text = this._text.join('');\n    this.set('dirty', true);\n    if (this._shouldClearDimensionCache()) {\n      this.initDimensions();\n      this.setCoords();\n    }\n    this._removeExtraneousStyles();\n  },\n\n  /**\n   * insert characters at start position, before start position.\n   * start  equal 1 it means the text get inserted between actual grapheme 0 and 1\n   * if style array is provided, it must be as the same length of text in graphemes\n   * if end is provided and is bigger than start, old text is replaced.\n   * start/end ar per grapheme position in _text array.\n   *\n   * @param {String} text text to insert\n   * @param {Array} style array of style objects\n   * @param {Number} start\n   * @param {Number} end default to start + 1\n   */\n  insertChars: function(text, style, start, end) {\n    if (typeof end === 'undefined') {\n      end = start;\n    }\n    if (end > start) {\n      this.removeStyleFromTo(start, end);\n    }\n    var graphemes = fabric.util.string.graphemeSplit(text);\n    this.insertNewStyleBlock(graphemes, start, style);\n    this._text = [].concat(this._text.slice(0, start), graphemes, this._text.slice(end));\n    this.text = this._text.join('');\n    this.set('dirty', true);\n    if (this._shouldClearDimensionCache()) {\n      this.initDimensions();\n      this.setCoords();\n    }\n    this._removeExtraneousStyles();\n  },\n\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n  var toFixed = fabric.util.toFixed,\n      multipleSpacesRegex = /  +/g;\n\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    _toSVG: function() {\n      var offsets = this._getSVGLeftTopOffsets(),\n          textAndBg = this._getSVGTextAndBg(offsets.textTop, offsets.textLeft);\n      return this._wrapSVGTextAndBg(textAndBg);\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      return this._createBaseSVGMarkup(\n        this._toSVG(),\n        { reviver: reviver, noStyle: true, withShadow: true }\n      );\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLeftTopOffsets: function() {\n      return {\n        textLeft: -this.width / 2,\n        textTop: -this.height / 2,\n        lineTop: this.getHeightOfLine(0)\n      };\n    },\n\n    /**\n     * @private\n     */\n    _wrapSVGTextAndBg: function(textAndBg) {\n      var noShadow = true,\n          textDecoration = this.getSvgTextDecoration(this);\n      return [\n        textAndBg.textBgRects.join(''),\n        '\\t\\t<text xml:space=\"preserve\" ',\n        (this.fontFamily ? 'font-family=\"' + this.fontFamily.replace(/\"/g, '\\'') + '\" ' : ''),\n        (this.fontSize ? 'font-size=\"' + this.fontSize + '\" ' : ''),\n        (this.fontStyle ? 'font-style=\"' + this.fontStyle + '\" ' : ''),\n        (this.fontWeight ? 'font-weight=\"' + this.fontWeight + '\" ' : ''),\n        (textDecoration ? 'text-decoration=\"' + textDecoration + '\" ' : ''),\n        'style=\"', this.getSvgStyles(noShadow), '\"', this.addPaintOrder(), ' >',\n        textAndBg.textSpans.join(''),\n        '</text>\\n'\n      ];\n    },\n\n    /**\n     * @private\n     * @param {Number} textTopOffset Text top offset\n     * @param {Number} textLeftOffset Text left offset\n     * @return {Object}\n     */\n    _getSVGTextAndBg: function(textTopOffset, textLeftOffset) {\n      var textSpans = [],\n          textBgRects = [],\n          height = textTopOffset, lineOffset;\n      // bounding-box background\n      this._setSVGBg(textBgRects);\n\n      // text and text-background\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineOffset = this._getLineLeftOffset(i);\n        if (this.textBackgroundColor || this.styleHas('textBackgroundColor', i)) {\n          this._setSVGTextLineBg(textBgRects, i, textLeftOffset + lineOffset, height);\n        }\n        this._setSVGTextLineText(textSpans, i, textLeftOffset + lineOffset, height);\n        height += this.getHeightOfLine(i);\n      }\n\n      return {\n        textSpans: textSpans,\n        textBgRects: textBgRects\n      };\n    },\n\n    /**\n     * @private\n     */\n    _createTextCharSpan: function(_char, styleDecl, left, top) {\n      var shouldUseWhitespace = _char !== _char.trim() || _char.match(multipleSpacesRegex),\n          styleProps = this.getSvgSpanStyles(styleDecl, shouldUseWhitespace),\n          fillStyles = styleProps ? 'style=\"' + styleProps + '\"' : '',\n          dy = styleDecl.deltaY, dySpan = '',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n      if (dy) {\n        dySpan = ' dy=\"' + toFixed(dy, NUM_FRACTION_DIGITS) + '\" ';\n      }\n      return [\n        '<tspan x=\"', toFixed(left, NUM_FRACTION_DIGITS), '\" y=\"',\n        toFixed(top, NUM_FRACTION_DIGITS), '\" ', dySpan,\n        fillStyles, '>',\n        fabric.util.string.escapeXml(_char),\n        '</tspan>'\n      ].join('');\n    },\n\n    _setSVGTextLineText: function(textSpans, lineIndex, textLeftOffset, textTopOffset) {\n      // set proper line offset\n      var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = '',\n          charBox, style,\n          boxWidth = 0,\n          line = this._textLines[lineIndex],\n          timeToRender;\n\n      textTopOffset += lineHeight * (1 - this._fontSizeFraction) / this.lineHeight;\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\n        timeToRender = i === len || this.charSpacing;\n        charsToRender += line[i];\n        charBox = this.__charBounds[lineIndex][i];\n        if (boxWidth === 0) {\n          textLeftOffset += charBox.kernedWidth - charBox.width;\n          boxWidth += charBox.width;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n        if (isJustify && !timeToRender) {\n          if (this._reSpaceAndTab.test(line[i])) {\n            timeToRender = true;\n          }\n        }\n        if (!timeToRender) {\n          // if we have charSpacing, we render char by char\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n          timeToRender = this._hasStyleChangedForSvg(actualStyle, nextStyle);\n        }\n        if (timeToRender) {\n          style = this._getStyleDeclaration(lineIndex, i) || { };\n          textSpans.push(this._createTextCharSpan(charsToRender, style, textLeftOffset, textTopOffset));\n          charsToRender = '';\n          actualStyle = nextStyle;\n          textLeftOffset += boxWidth;\n          boxWidth = 0;\n        }\n      }\n    },\n\n    _pushTextBgRect: function(textBgRects, color, left, top, width, height) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n      textBgRects.push(\n        '\\t\\t<rect ',\n        this._getFillAttributes(color),\n        ' x=\"',\n        toFixed(left, NUM_FRACTION_DIGITS),\n        '\" y=\"',\n        toFixed(top, NUM_FRACTION_DIGITS),\n        '\" width=\"',\n        toFixed(width, NUM_FRACTION_DIGITS),\n        '\" height=\"',\n        toFixed(height, NUM_FRACTION_DIGITS),\n        '\"></rect>\\n');\n    },\n\n    _setSVGTextLineBg: function(textBgRects, i, leftOffset, textTopOffset) {\n      var line = this._textLines[i],\n          heightOfLine = this.getHeightOfLine(i) / this.lineHeight,\n          boxWidth = 0,\n          boxStart = 0,\n          charBox, currentColor,\n          lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\n      for (var j = 0, jlen = line.length; j < jlen; j++) {\n        charBox = this.__charBounds[i][j];\n        currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\n        if (currentColor !== lastColor) {\n          lastColor && this._pushTextBgRect(textBgRects, lastColor, leftOffset + boxStart,\n            textTopOffset, boxWidth, heightOfLine);\n          boxStart = charBox.left;\n          boxWidth = charBox.width;\n          lastColor = currentColor;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n      }\n      currentColor && this._pushTextBgRect(textBgRects, currentColor, leftOffset + boxStart,\n        textTopOffset, boxWidth, heightOfLine);\n    },\n\n    /**\n     * Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values\n     * we work around it by \"moving\" alpha channel into opacity attribute and setting fill's alpha to 1\n     *\n     * @private\n     * @param {*} value\n     * @return {String}\n     */\n    _getFillAttributes: function(value) {\n      var fillColor = (value && typeof value === 'string') ? new fabric.Color(value) : '';\n      if (!fillColor || !fillColor.getSource() || fillColor.getAlpha() === 1) {\n        return 'fill=\"' + value + '\"';\n      }\n      return 'opacity=\"' + fillColor.getAlpha() + '\" fill=\"' + fillColor.setAlpha(1).toRgb() + '\"';\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLineTopOffset: function(lineIndex) {\n      var lineTopOffset = 0, lastHeight = 0;\n      for (var j = 0; j < lineIndex; j++) {\n        lineTopOffset += this.getHeightOfLine(j);\n      }\n      lastHeight = this.getHeightOfLine(j);\n      return {\n        lineTop: lineTopOffset,\n        offset: (this._fontSizeMult - this._fontSizeFraction) * lastHeight / (this.lineHeight * this._fontSizeMult)\n      };\n    },\n\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n      var svgStyle = fabric.Object.prototype.getSvgStyles.call(this, skipShadow);\n      return svgStyle + ' white-space: pre;';\n    },\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  /**\n   * Textbox class, based on IText, allows the user to resize the text rectangle\n   * and wraps lines automatically. Textboxes have their Y scaling locked, the\n   * user can only change width. Height is adjusted automatically based on the\n   * wrapping of lines.\n   * @class fabric.Textbox\n   * @extends fabric.IText\n   * @mixes fabric.Observable\n   * @return {fabric.Textbox} thisArg\n   * @see {@link fabric.Textbox#initialize} for constructor definition\n   */\n  fabric.Textbox = fabric.util.createClass(fabric.IText, fabric.Observable, {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'textbox',\n\n    /**\n     * Minimum width of textbox, in pixels.\n     * @type Number\n     * @default\n     */\n    minWidth: 20,\n\n    /**\n     * Minimum calculated width of a textbox, in pixels.\n     * fixed to 2 so that an empty textbox cannot go to 0\n     * and is still selectable without text.\n     * @type Number\n     * @default\n     */\n    dynamicMinWidth: 2,\n\n    /**\n     * Cached array of text wrapping.\n     * @type Array\n     */\n    __cachedLines: null,\n\n    /**\n     * Override standard Object class values\n     */\n    lockScalingFlip: true,\n\n    /**\n     * Override standard Object class values\n     * Textbox needs this on false\n     */\n    noScaleCache: false,\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Object\n     * @private\n     */\n    _dimensionAffectingProps: fabric.Text.prototype._dimensionAffectingProps.concat('width'),\n\n    /**\n     * Use this regular expression to split strings in breakable lines\n     * @private\n     */\n    _wordJoiners: /[ \\t\\r]/,\n\n    /**\n     * Use this boolean property in order to split strings that have no white space concept.\n     * this is a cheap way to help with chinese/japanese\n     * @type Boolean\n     * @since 2.6.0\n     */\n    splitByGrapheme: false,\n\n    /**\n     * Unlike superclass's version of this function, Textbox does not update\n     * its width.\n     * @private\n     * @override\n     */\n    initDimensions: function() {\n      if (this.__skipDimension) {\n        return;\n      }\n      this.isEditing && this.initDelayedCursor();\n      this.clearContextTop();\n      this._clearCache();\n      // clear dynamicMinWidth as it will be different after we re-wrap line\n      this.dynamicMinWidth = 0;\n      // wrap lines\n      this._styleMap = this._generateStyleMap(this._splitText());\n      // if after wrapping, the width is smaller than dynamicMinWidth, change the width and re-wrap\n      if (this.dynamicMinWidth > this.width) {\n        this._set('width', this.dynamicMinWidth);\n      }\n      if (this.textAlign.indexOf('justify') !== -1) {\n        // once text is measured we need to make space fatter to make justified text.\n        this.enlargeSpaces();\n      }\n      // clear cache and re-calculate height\n      this.height = this.calcTextHeight();\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Generate an object that translates the style object so that it is\n     * broken up by visual lines (new lines and automatic wrapping).\n     * The original text styles object is broken up by actual lines (new lines only),\n     * which is only sufficient for Text / IText\n     * @private\n     */\n    _generateStyleMap: function(textInfo) {\n      var realLineCount     = 0,\n          realLineCharCount = 0,\n          charCount         = 0,\n          map               = {};\n\n      for (var i = 0; i < textInfo.graphemeLines.length; i++) {\n        if (textInfo.graphemeText[charCount] === '\\n' && i > 0) {\n          realLineCharCount = 0;\n          charCount++;\n          realLineCount++;\n        }\n        else if (!this.splitByGrapheme && this._reSpaceAndTab.test(textInfo.graphemeText[charCount]) && i > 0) {\n          // this case deals with space's that are removed from end of lines when wrapping\n          realLineCharCount++;\n          charCount++;\n        }\n\n        map[i] = { line: realLineCount, offset: realLineCharCount };\n\n        charCount += textInfo.graphemeLines[i].length;\n        realLineCharCount += textInfo.graphemeLines[i].length;\n      }\n\n      return map;\n    },\n\n    /**\n     * Returns true if object has a style property or has it on a specified line\n     * @param {Number} lineIndex\n     * @return {Boolean}\n     */\n    styleHas: function(property, lineIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (map) {\n          lineIndex = map.line;\n        }\n      }\n      return fabric.Text.prototype.styleHas.call(this, property, lineIndex);\n    },\n\n    /**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */\n    isEmptyStyles: function(lineIndex) {\n      if (!this.styles) {\n        return true;\n      }\n      var offset = 0, nextLineIndex = lineIndex + 1, nextOffset, obj, shouldLimit = false,\n          map = this._styleMap[lineIndex], mapNextLine = this._styleMap[lineIndex + 1];\n      if (map) {\n        lineIndex = map.line;\n        offset = map.offset;\n      }\n      if (mapNextLine) {\n        nextLineIndex = mapNextLine.line;\n        shouldLimit = nextLineIndex === lineIndex;\n        nextOffset = mapNextLine.offset;\n      }\n      obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          if (p2 >= offset && (!shouldLimit || p2 < nextOffset)) {\n            // eslint-disable-next-line no-unused-vars\n            for (var p3 in obj[p1][p2]) {\n              return false;\n            }\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (!map) {\n          return null;\n        }\n        lineIndex = map.line;\n        charIndex = map.offset + charIndex;\n      }\n      return this.callSuper('_getStyleDeclaration', lineIndex, charIndex);\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * probably broken need a fix\n     * Returns the real style line that correspond to the wrapped lineIndex line\n     * Used just to verify if the line does exist or not.\n     * @param {Number} lineIndex\n     * @returns {Boolean} if the line exists or not\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      return !!this.styles[map.line];\n    },\n\n    /**\n     * Set the line style to an empty object so that is initialized\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */\n    _setLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      this.styles[map.line] = {};\n    },\n\n    /**\n     * Wraps text using the 'width' property of Textbox. First this function\n     * splits text on newlines, so we preserve newlines entered by the user.\n     * Then it wraps each line using the width of the Textbox by calling\n     * _wrapLine().\n     * @param {Array} lines The string array of text that is split into lines\n     * @param {Number} desiredWidth width you want to wrap to\n     * @returns {Array} Array of lines\n     */\n    _wrapText: function(lines, desiredWidth) {\n      var wrapped = [], i;\n      this.isWrapping = true;\n      for (i = 0; i < lines.length; i++) {\n        wrapped = wrapped.concat(this._wrapLine(lines[i], i, desiredWidth));\n      }\n      this.isWrapping = false;\n      return wrapped;\n    },\n\n    /**\n     * Helper function to measure a string of text, given its lineIndex and charIndex offset\n     * it gets called when charBounds are not available yet.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {String} text\n     * @param {number} lineIndex\n     * @param {number} charOffset\n     * @returns {number}\n     * @private\n     */\n    _measureWord: function(word, lineIndex, charOffset) {\n      var width = 0, prevGrapheme, skipLeft = true;\n      charOffset = charOffset || 0;\n      for (var i = 0, len = word.length; i < len; i++) {\n        var box = this._getGraphemeBox(word[i], lineIndex, i + charOffset, prevGrapheme, skipLeft);\n        width += box.kernedWidth;\n        prevGrapheme = word[i];\n      }\n      return width;\n    },\n\n    /**\n     * Wraps a line of text using the width of the Textbox and a context.\n     * @param {Array} line The grapheme array that represent the line\n     * @param {Number} lineIndex\n     * @param {Number} desiredWidth width you want to wrap the line to\n     * @param {Number} reservedSpace space to remove from wrapping for custom functionalities\n     * @returns {Array} Array of line(s) into which the given text is wrapped\n     * to.\n     */\n    _wrapLine: function(_line, lineIndex, desiredWidth, reservedSpace) {\n      var lineWidth = 0,\n          splitByGrapheme = this.splitByGrapheme,\n          graphemeLines = [],\n          line = [],\n          // spaces in different languages?\n          words = splitByGrapheme ? fabric.util.string.graphemeSplit(_line) : _line.split(this._wordJoiners),\n          word = '',\n          offset = 0,\n          infix = splitByGrapheme ? '' : ' ',\n          wordWidth = 0,\n          infixWidth = 0,\n          largestWordWidth = 0,\n          lineJustStarted = true,\n          additionalSpace = this._getWidthOfCharSpacing(),\n          reservedSpace = reservedSpace || 0;\n      // fix a difference between split and graphemeSplit\n      if (words.length === 0) {\n        words.push([]);\n      }\n      desiredWidth -= reservedSpace;\n      for (var i = 0; i < words.length; i++) {\n        // if using splitByGrapheme words are already in graphemes.\n        word = splitByGrapheme ? words[i] : fabric.util.string.graphemeSplit(words[i]);\n        wordWidth = this._measureWord(word, lineIndex, offset);\n        offset += word.length;\n\n        lineWidth += infixWidth + wordWidth - additionalSpace;\n        if (lineWidth > desiredWidth && !lineJustStarted) {\n          graphemeLines.push(line);\n          line = [];\n          lineWidth = wordWidth;\n          lineJustStarted = true;\n        }\n        else {\n          lineWidth += additionalSpace;\n        }\n\n        if (!lineJustStarted && !splitByGrapheme) {\n          line.push(infix);\n        }\n        line = line.concat(word);\n\n        infixWidth = splitByGrapheme ? 0 : this._measureWord([infix], lineIndex, offset);\n        offset++;\n        lineJustStarted = false;\n        // keep track of largest word\n        if (wordWidth > largestWordWidth) {\n          largestWordWidth = wordWidth;\n        }\n      }\n\n      i && graphemeLines.push(line);\n\n      if (largestWordWidth + reservedSpace > this.dynamicMinWidth) {\n        this.dynamicMinWidth = largestWordWidth - additionalSpace + reservedSpace;\n      }\n      return graphemeLines;\n    },\n\n    /**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @param {Number} lineIndex text to split\n     * @return {Boolean}\n     */\n    isEndOfWrapping: function(lineIndex) {\n      if (!this._styleMap[lineIndex + 1]) {\n        // is last line, return true;\n        return true;\n      }\n      if (this._styleMap[lineIndex + 1].line !== this._styleMap[lineIndex].line) {\n        // this is last line before a line break, return true;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Detect if a line has a linebreak and so we need to account for it when moving\n     * and counting style.\n     * @return Number\n     */\n    missingNewlineOffset: function(lineIndex) {\n      if (this.splitByGrapheme) {\n        return this.isEndOfWrapping(lineIndex) ? 1 : 0;\n      }\n      return 1;\n    },\n\n    /**\n    * Gets lines of text to render in the Textbox. This function calculates\n    * text wrapping on the fly every time it is called.\n    * @param {String} text text to split\n    * @returns {Array} Array of lines in the Textbox.\n    * @override\n    */\n    _splitTextIntoLines: function(text) {\n      var newText = fabric.Text.prototype._splitTextIntoLines.call(this, text),\n          graphemeLines = this._wrapText(newText.lines, this.width),\n          lines = new Array(graphemeLines.length);\n      for (var i = 0; i < graphemeLines.length; i++) {\n        lines[i] = graphemeLines[i].join('');\n      }\n      newText.lines = lines;\n      newText.graphemeLines = graphemeLines;\n      return newText;\n    },\n\n    getMinWidth: function() {\n      return Math.max(this.minWidth, this.dynamicMinWidth);\n    },\n\n    _removeExtraneousStyles: function() {\n      var linesToKeep = {};\n      for (var prop in this._styleMap) {\n        if (this._textLines[prop]) {\n          linesToKeep[this._styleMap[prop].line] = 1;\n        }\n      }\n      for (var prop in this.styles) {\n        if (!linesToKeep[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['minWidth', 'splitByGrapheme'].concat(propertiesToInclude));\n    }\n  });\n\n  /**\n   * Returns fabric.Textbox instance from an object representation\n   * @static\n   * @memberOf fabric.Textbox\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Textbox instance is created\n   */\n  fabric.Textbox.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Textbox', object, callback, 'text');\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var controlsUtils = fabric.controlsUtils,\n      scaleSkewStyleHandler = controlsUtils.scaleSkewCursorStyleHandler,\n      scaleStyleHandler = controlsUtils.scaleCursorStyleHandler,\n      scalingEqually = controlsUtils.scalingEqually,\n      scalingYOrSkewingX = controlsUtils.scalingYOrSkewingX,\n      scalingXOrSkewingY = controlsUtils.scalingXOrSkewingY,\n      scaleOrSkewActionName = controlsUtils.scaleOrSkewActionName,\n      objectControls = fabric.Object.prototype.controls;\n\n  objectControls.ml = new fabric.Control({\n    x: -0.5,\n    y: 0,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingXOrSkewingY,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mr = new fabric.Control({\n    x: 0.5,\n    y: 0,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingXOrSkewingY,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mb = new fabric.Control({\n    x: 0,\n    y: 0.5,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingYOrSkewingX,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mt = new fabric.Control({\n    x: 0,\n    y: -0.5,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingYOrSkewingX,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.tl = new fabric.Control({\n    x: -0.5,\n    y: -0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.tr = new fabric.Control({\n    x: 0.5,\n    y: -0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.bl = new fabric.Control({\n    x: -0.5,\n    y: 0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.br = new fabric.Control({\n    x: 0.5,\n    y: 0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.mtr = new fabric.Control({\n    x: 0,\n    y: -0.5,\n    actionHandler: controlsUtils.rotationWithSnapping,\n    cursorStyleHandler: controlsUtils.rotationStyleHandler,\n    offsetY: -40,\n    withConnection: true,\n    actionName: 'rotate',\n  });\n\n  if (fabric.Textbox) {\n    // this is breaking the prototype inheritance, no time / ideas to fix it.\n    // is important to document that if you want to have all objects to have a\n    // specific custom control, you have to add it to Object prototype and to Textbox\n    // prototype. The controls are shared as references. So changes to control `tr`\n    // can still apply to all objects if needed.\n    var textBoxControls = fabric.Textbox.prototype.controls = { };\n\n    textBoxControls.mtr = objectControls.mtr;\n    textBoxControls.tr = objectControls.tr;\n    textBoxControls.br = objectControls.br;\n    textBoxControls.tl = objectControls.tl;\n    textBoxControls.bl = objectControls.bl;\n    textBoxControls.mt = objectControls.mt;\n    textBoxControls.mb = objectControls.mb;\n\n    textBoxControls.mr = new fabric.Control({\n      x: 0.5,\n      y: 0,\n      actionHandler: controlsUtils.changeWidth,\n      cursorStyleHandler: scaleSkewStyleHandler,\n      actionName: 'resizing',\n    });\n\n    textBoxControls.ml = new fabric.Control({\n      x: -0.5,\n      y: 0,\n      actionHandler: controlsUtils.changeWidth,\n      cursorStyleHandler: scaleSkewStyleHandler,\n      actionName: 'resizing',\n    });\n  }\n})();\n\n","\n/**\n * Module dependencies.\n */\n\nvar url = require('./url');\nvar parser = require('socket.io-parser');\nvar Manager = require('./manager');\nvar debug = require('debug')('socket.io-client');\n\n/**\n * Module exports.\n */\n\nmodule.exports = exports = lookup;\n\n/**\n * Managers cache.\n */\n\nvar cache = exports.managers = {};\n\n/**\n * Looks up an existing `Manager` for multiplexing.\n * If the user summons:\n *\n *   `io('http://localhost/a');`\n *   `io('http://localhost/b');`\n *\n * We reuse the existing instance based on same scheme/port/host,\n * and we initialize sockets for each namespace.\n *\n * @api public\n */\n\nfunction lookup (uri, opts) {\n  if (typeof uri === 'object') {\n    opts = uri;\n    uri = undefined;\n  }\n\n  opts = opts || {};\n\n  var parsed = url(uri);\n  var source = parsed.source;\n  var id = parsed.id;\n  var path = parsed.path;\n  var sameNamespace = cache[id] && path in cache[id].nsps;\n  var newConnection = opts.forceNew || opts['force new connection'] ||\n                      false === opts.multiplex || sameNamespace;\n\n  var io;\n\n  if (newConnection) {\n    debug('ignoring socket cache for %s', source);\n    io = Manager(source, opts);\n  } else {\n    if (!cache[id]) {\n      debug('new io instance for %s', source);\n      cache[id] = Manager(source, opts);\n    }\n    io = cache[id];\n  }\n  if (parsed.query && !opts.query) {\n    opts.query = parsed.query;\n  }\n  return io.socket(parsed.path, opts);\n}\n\n/**\n * Protocol version.\n *\n * @api public\n */\n\nexports.protocol = parser.protocol;\n\n/**\n * `connect`.\n *\n * @param {String} uri\n * @api public\n */\n\nexports.connect = lookup;\n\n/**\n * Expose constructors for standalone build.\n *\n * @api public\n */\n\nexports.Manager = require('./manager');\nexports.Socket = require('./socket');\n","/*\n * base64-arraybuffer\n * https://github.com/niklasvh/base64-arraybuffer\n *\n * Copyright (c) 2012 Niklas von Hertzen\n * Licensed under the MIT license.\n */\n(function(chars){\n  \"use strict\";\n\n  exports.encode = function(arraybuffer) {\n    var bytes = new Uint8Array(arraybuffer),\n    i, len = bytes.length, base64 = \"\";\n\n    for (i = 0; i < len; i+=3) {\n      base64 += chars[bytes[i] >> 2];\n      base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n      base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n      base64 += chars[bytes[i + 2] & 63];\n    }\n\n    if ((len % 3) === 2) {\n      base64 = base64.substring(0, base64.length - 1) + \"=\";\n    } else if (len % 3 === 1) {\n      base64 = base64.substring(0, base64.length - 2) + \"==\";\n    }\n\n    return base64;\n  };\n\n  exports.decode =  function(base64) {\n    var bufferLength = base64.length * 0.75,\n    len = base64.length, i, p = 0,\n    encoded1, encoded2, encoded3, encoded4;\n\n    if (base64[base64.length - 1] === \"=\") {\n      bufferLength--;\n      if (base64[base64.length - 2] === \"=\") {\n        bufferLength--;\n      }\n    }\n\n    var arraybuffer = new ArrayBuffer(bufferLength),\n    bytes = new Uint8Array(arraybuffer);\n\n    for (i = 0; i < len; i+=4) {\n      encoded1 = chars.indexOf(base64[i]);\n      encoded2 = chars.indexOf(base64[i+1]);\n      encoded3 = chars.indexOf(base64[i+2]);\n      encoded4 = chars.indexOf(base64[i+3]);\n\n      bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n      bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n      bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n    }\n\n    return arraybuffer;\n  };\n})(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\");\n","module.exports = toArray\n\nfunction toArray(list, index) {\n    var array = []\n\n    index = index || 0\n\n    for (var i = index || 0; i < list.length; i++) {\n        array[i - index] = list[i]\n    }\n\n    return array\n}\n","/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nexports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = (e * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = (m * 256) + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = (nBytes * 8) - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = ((value * c) - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"wraper\",staticClass:\"wraper\"},[_c('div',{staticClass:\"canvas-wraper\"},[_c('canvas',{ref:\"canvas\",attrs:{\"id\":\"canvas\"}})]),_c('div',{staticClass:\"controlPanel\"},[_vm._l((_vm.toolsArr),function(item,idx){return _c('div',{key:idx,class:[_vm.initIdx == idx ? 'contro-item active' : 'contro-item'],on:{\"click\":function($event){return _vm.handleTools(item, idx)}}},[_vm._v(\" \"+_vm._s(item.name)+\" \")])}),_c('div',[_c('input',{attrs:{\"id\":\"filereader\",\"type\":\"file\",\"accept\":\"image/*\"},on:{\"change\":_vm.uploadImage}})])],2),_c('img',{staticStyle:{\"width\":\"500px\",\"display\":\"none\"},attrs:{\"id\":\"photo\",\"src\":require(\"../assets/images.png\")}}),_vm._m(0)])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('video',{staticStyle:{\"display\":\"none\"},attrs:{\"width\":\"350\",\"height\":\"220\",\"id\":\"video\",\"control\":\"\"}},[_c('source',{attrs:{\"src\":\"http://html5demos.com/assets/dizzy.mp4\"}})])}]\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"wraper\" ref=\"wraper\">\r\n    <div class=\"canvas-wraper\">\r\n      <canvas id=\"canvas\" ref=\"canvas\"></canvas>\r\n    </div>\r\n    <div class=\"controlPanel\">\r\n      <div\r\n        :class=\"[initIdx == idx ? 'contro-item active' : 'contro-item']\"\r\n        v-for=\"(item, idx) in toolsArr\"\r\n        :key=\"idx\"\r\n        @click=\"handleTools(item, idx)\"\r\n      >\r\n        {{ item.name }}\r\n        <!-- <i :class=\"item.icon\">{{ item.name }}</i> -->\r\n      </div>\r\n      <div>\r\n        <input\r\n          id=\"filereader\"\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          @change=\"uploadImage\"\r\n        />\r\n      </div>\r\n    </div>\r\n    <img\r\n      id=\"photo\"\r\n      src=\"../assets/images.png\"\r\n      style=\"width: 500px; display: none\"\r\n    />\r\n\r\n    <video width=\"350\" height=\"220\" id=\"video\" style=\"display: none;\" control>\r\n      <source src=\"http://html5demos.com/assets/dizzy.mp4\" />\r\n    </video>\r\n\r\n    <!-- <div class=\"download\">      \r\n      <button type=\"button\" :disabled=\"done\" @click=\"downLoadImage\">\r\n        base64\r\n      </button>\r\n      <img :src=\"imageBase64\" v-show=\"imageBase64 != ''\" alt=\"\" />\r\n    </div> -->\r\n  </div>\r\n</template>\r\n<script>\r\nimport { fabric } from \"fabric\";\r\nimport io from \"socket.io-client\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      currentTool: \"\",\r\n      done: false,\r\n      fabricObj: null,\r\n      initIdx: 0,\r\n      toolsArr: [\r\n        {\r\n          name: \"pencil\",\r\n          icon: \"fa fa-pencil\",\r\n        },\r\n        {\r\n          name: \"line\",\r\n          icon: \"fas fas-grip-lines\",\r\n        },\r\n        {\r\n          name: \"arrow\",\r\n          icon: \"fa fa-arrow-up\",\r\n        },\r\n        {\r\n          name: \"dashedline\",\r\n          icon: \"fa fa-xuxian\",\r\n        },\r\n        {\r\n          name: \"text\",\r\n          icon: \"fa fa-ziti\",\r\n        },\r\n        {\r\n          name: \"rectangle\",\r\n          icon: \"fa fa-square\",\r\n        },\r\n        {\r\n          name: \"circle\",\r\n          icon: \"fa fa-circle\",\r\n        },\r\n        {\r\n          name: \"ellipse\",\r\n          icon: \"fa fa-ellipse\",\r\n        },\r\n        {\r\n          name: \"equilateral\",\r\n          icon: \"fas fa-caret-square-up\",\r\n        },\r\n        {\r\n          name: \"remove\",\r\n          icon: \" icon-remove\",\r\n        },\r\n        {\r\n          name: \"undo\",\r\n          icon: \" icon-huitui\",\r\n        },\r\n        {\r\n          name: \"redo\",\r\n          icon: \" icon-xiangqian\",\r\n        },\r\n        {\r\n          name: \"reset\",\r\n          icon: \" icon-reset\",\r\n        },\r\n        {\r\n          name: \"move\",\r\n          icon: \" icon-move\",\r\n        },\r\n        {\r\n          name: \"photo\",\r\n          icon: \" icon-photo\",\r\n        },\r\n        {\r\n          name: \"video\",\r\n          icon: \" icon-video\",\r\n        },\r\n      ],\r\n      mouseFrom: {},\r\n      mouseTo: {},\r\n      moveCount: 1,\r\n      doDrawing: false,\r\n      fabricHistoryJson: [],\r\n      mods: 0,\r\n      drawingObject: null,\r\n      drawColor: \"#E34F51\",\r\n      drawWidth: 2,\r\n      imageBase64: \"\",\r\n      zoom: window.zoom ? window.zoom : 1,\r\n      socket: {},\r\n      socketLoaded: false,\r\n      roomName: \"\",\r\n    };\r\n  },\r\n  mounted() {\r\n    this.initCanvas();\r\n  },\r\n  computed: {\r\n    canvasWidth() {\r\n      return window.innerWidth;\r\n    },\r\n    canvasHeight() {\r\n      return window.innerHeight - 150;\r\n    },\r\n  },\r\n  methods: {\r\n    urlForSocket() {\r\n      const protocol = \"http://\";\r\n      const hostName = \"localhost\";\r\n      const hostPort = 3000;\r\n      return protocol + hostName + `:${hostPort}`;\r\n    },\r\n    sendCanvas() {\r\n      const canvasAsJSON = this.fabricObj.toJSON();\r\n      if (this.socketLoaded) {\r\n        this.socket.emit(\"send-board-data\", {\r\n          canvasData: canvasAsJSON,\r\n          roomName: this.roomName,\r\n        });\r\n      }\r\n    },\r\n    receiveCanvas(data) {\r\n      if (this.socketLoaded && !!data && !!data.canvasData) {\r\n        this.fabricObj.loadFromJSON(\r\n          data.canvasData,\r\n          this.fabricObj.renderAll.bind(this.fabricObj)\r\n        );\r\n      }\r\n    },\r\n    initCanvas() {\r\n      this.roomName = this.$route.params.room;\r\n\r\n      this.fabricObj = new fabric.Canvas(\"canvas\", {\r\n        isDrawingMode: true,\r\n        selectable: false,\r\n        selection: false,\r\n        devicePixelRatio: true,\r\n      });\r\n      this.fabricObj.freeDrawingBrush.color = \"#E34F51\";\r\n      this.fabricObj.freeDrawingBrush.width = 2;\r\n      this.fabricObj.setWidth(this.canvasWidth);\r\n      this.fabricObj.setHeight(this.canvasHeight);\r\n\r\n      this.fabricObjAddEvent();\r\n      fabric.util.requestAnimFrame(this.render);\r\n      \r\n      this.socket = io.connect(this.urlForSocket(), { secure: true });\r\n\r\n      this.socket.on(\"got-connected\", () => {\r\n        this.socketLoaded = true;\r\n        this.socket.emit(\"join-room\", {\r\n          roomName: this.roomName,\r\n        });\r\n      });\r\n\r\n      this.socket.on(\"send-board-data\", (drawData) => {\r\n        this.receiveCanvas(drawData);\r\n      });\r\n    },\r\n    render() {\r\n      this.fabricObj.renderAll();\r\n      fabric.util.requestAnimFrame(this.render);\r\n    },\r\n    fabricObjAddEvent() {\r\n      this.fabricObj.on({\r\n        \"mouse:down\": (o) => {\r\n          this.mouseFrom.x = o.pointer.x;\r\n          this.mouseFrom.y = o.pointer.y;\r\n          this.doDrawing = true;\r\n          if (this.currentTool == \"text\") {\r\n            this.drawText();\r\n          }\r\n          this.sendCanvas();\r\n        },\r\n        \"mouse:up\": (o) => {\r\n          this.mouseTo.x = o.pointer.x;\r\n          this.mouseTo.y = o.pointer.y;\r\n          this.drawingObject = null;\r\n          this.moveCount = 1;\r\n          this.doDrawing = false;\r\n          this.updateModifications(true);\r\n          this.sendCanvas();\r\n        },\r\n        \"mouse:move\": (o) => {\r\n          if (!this.doDrawing) {\r\n            return;\r\n          }\r\n          this.moveCount++;\r\n          this.mouseTo.x = o.pointer.x;\r\n          this.mouseTo.y = o.pointer.y;\r\n          this.drawing();\r\n          this.sendCanvas();\r\n        },\r\n        \"object:moving\": (e) => {\r\n          e.target.opacity = 0.5;\r\n          this.sendCanvas();\r\n        },\r\n        \"object:added\": () => {},\r\n        \"object:modified\": (e) => {\r\n          e.target.opacity = 1;\r\n          this.updateModifications(true);\r\n          this.sendCanvas();\r\n        },\r\n        \"selection:created\": (e) => {\r\n          if (this.currentTool !== \"remove\") {\r\n            return;\r\n          }\r\n\r\n          if (e.target._objects) {\r\n            // \r\n            var etCount = e.target._objects.length;\r\n            for (var etindex = 0; etindex < etCount; etindex++) {\r\n              this.fabricObj.remove(e.target._objects[etindex]);\r\n            }\r\n          } else {\r\n            //\r\n            this.fabricObj.remove(e.target);\r\n          }\r\n          this.fabricObj.discardActiveObject();\r\n          this.updateModifications(true);\r\n          this.sendCanvas();\r\n        },\r\n      });\r\n    },\r\n    updateModifications(savehistory) {\r\n      if (savehistory == true) {\r\n        this.fabricHistoryJson.push(JSON.stringify(this.fabricObj));\r\n      }\r\n    },\r\n    undo() {\r\n      let state = this.fabricHistoryJson;\r\n      if (this.mods < state.length) {\r\n        this.fabricObj.clear().renderAll();\r\n        this.fabricObj.loadFromJSON(state[state.length - 1 - this.mods - 1]);\r\n        this.fabricObj.renderAll();\r\n        this.mods += 1;\r\n      }\r\n    },\r\n    redo() {\r\n      let state = this.fabricHistoryJson;\r\n      if (this.mods > 0) {\r\n        this.fabricObj.clear().renderAll();\r\n        this.fabricObj.loadFromJSON(state[state.length - 1 - this.mods + 1]);\r\n        this.fabricObj.renderAll();\r\n        this.mods -= 1;\r\n      }\r\n    },\r\n    transformMouse(mouseX, mouseY) {\r\n      return { x: mouseX / this.zoom, y: mouseY / this.zoom };\r\n    },\r\n    resetObj() {\r\n      this.fabricObj.selectable = false;\r\n      this.fabricObj.selection = false;\r\n      this.fabricObj.skipTargetFind = true;\r\n\r\n      if (this.textboxObj) {\r\n        this.textboxObj.exitEditing();\r\n        this.textboxObj = null;\r\n      }\r\n    },\r\n    handleTools(tools, idx) {\r\n      this.initIdx = idx;\r\n      this.currentTool = tools.name;\r\n      \r\n      this.fabricObj.isDrawingMode = false;\r\n      this.resetObj();\r\n      switch (tools.name) {\r\n        case \"pencil\":\r\n          this.fabricObj.isDrawingMode = true;\r\n          break;\r\n        case \"remove\":\r\n          this.fabricObj.selection = true;\r\n          this.fabricObj.skipTargetFind = false;\r\n          this.fabricObj.selectable = true;\r\n\r\n          this.fabricObj.discardActiveObject().renderAll();\r\n          this.sendCanvas();\r\n          break;\r\n        case \"reset\":\r\n          this.fabricObj.clear();\r\n          this.sendCanvas();\r\n          break;\r\n        case \"redo\":\r\n          this.redo();\r\n          this.sendCanvas();\r\n          break;\r\n        case \"undo\":\r\n          this.undo();\r\n          this.sendCanvas();\r\n          break;\r\n        case \"move\":\r\n          this.fabricObj.skipTargetFind = false;\r\n          this.fabricObj.selectable = true;\r\n          this.fabricObj.selection = true;\r\n          // this.fabricObj.evented = true;\r\n          // this.fabricObj.forEachObject(object => {\r\n          //     object.selectable = true;\r\n          //     object.evented = true;\r\n          // });\r\n          break;\r\n        case \"photo\":\r\n          var imgElement = document.getElementById(\"photo\");\r\n          var imgInstance = new fabric.Image(imgElement, {\r\n            left: 100,\r\n            top: 100,\r\n            angle: 0,\r\n            // opacity: 0.75,\r\n            // width: 200,\r\n            // height: 220,\r\n          });\r\n          this.fabricObj.add(imgInstance);\r\n          this.sendCanvas();\r\n          break;\r\n        case \"video\":\r\n          var videoElement = document.getElementById(\"video\");\r\n          var videoInstance = new fabric.Image(videoElement, {\r\n            left: 100,\r\n            top: 100,\r\n            angle: 0,\r\n            // opacity: 0.75,\r\n            // width: 200,\r\n            // height: 220,\r\n          });\r\n          this.fabricObj.add(videoInstance);\r\n          videoInstance.getElement().play();\r\n          this.sendCanvas();\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    },\r\n    drawText() {\r\n      this.textboxObj = new fabric.Textbox(\" \", {\r\n        left: this.mouseFrom.x,\r\n        top: this.mouseFrom.y,\r\n        width: 220,\r\n        fontSize: 18,\r\n        fill: this.drawColor,\r\n        hasControls: true,\r\n      });\r\n      this.fabricObj.add(this.textboxObj);\r\n      this.textboxObj.enterEditing();\r\n      this.textboxObj.hiddenTextarea.focus();\r\n      this.updateModifications(true);\r\n    },\r\n    drawing() {\r\n      if (this.drawingObject) {\r\n        this.fabricObj.remove(this.drawingObject);\r\n      }\r\n      let fabricObject = null;\r\n      switch (this.currentTool) {\r\n        case \"pencil\":\r\n          this.fabricObj.isDrawingMode = true;\r\n          break;\r\n        case \"line\":\r\n          fabricObject = new fabric.Line(\r\n            [\r\n              this.mouseFrom.x,\r\n              this.mouseFrom.y,\r\n              this.mouseTo.x,\r\n              this.mouseTo.y,\r\n            ],\r\n            {\r\n              stroke: this.drawColor,\r\n              strokeWidth: this.drawWidth,\r\n            }\r\n          );\r\n          break;\r\n        case \"arrow\":\r\n          fabricObject = new fabric.Path(\r\n            this.drawArrow(\r\n              this.mouseFrom.x,\r\n              this.mouseFrom.y,\r\n              this.mouseTo.x,\r\n              this.mouseTo.y,\r\n              15.5,\r\n              15.5\r\n            ),\r\n            {\r\n              stroke: this.drawColor,\r\n              fill: \"rgba(255,255,255,0)\",\r\n              strokeWidth: this.drawWidth,\r\n            }\r\n          );\r\n          break;\r\n        case \"dashedline\":\r\n          fabricObject = this.drawDoshedLine();\r\n          break;\r\n        case \"rectangle\":\r\n          fabricObject = this.drawRectangle();\r\n          break;\r\n        case \"circle\":\r\n          fabricObject = this.drawCircle();\r\n          break;\r\n        case \"ellipse\":\r\n          fabricObject = this.drawEllipse();\r\n          break;\r\n        case \"equilateral\":\r\n          fabricObject = this.drawTriangle();\r\n          break;\r\n        case \"remove\":\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n      if (fabricObject) {\r\n        this.$nextTick(() => {\r\n          this.fabricObj.add(fabricObject);\r\n          this.drawingObject = fabricObject;\r\n        });\r\n      }\r\n    },\r\n    drawDoshedLine() {\r\n      return new fabric.Line(\r\n        [this.mouseFrom.x, this.mouseFrom.y, this.mouseTo.x, this.mouseTo.y],\r\n        {\r\n          strokeDashArray: [10, 3],\r\n          stroke: this.drawColor,\r\n          strokeWidth: this.drawWidth,\r\n        }\r\n      );\r\n    },\r\n    drawCircle() {\r\n      let radius =\r\n        Math.sqrt(\r\n          (this.mouseTo.x - this.mouseFrom.x) *\r\n            (this.mouseTo.x - this.mouseFrom.x) +\r\n            (this.mouseTo.y - this.mouseFrom.y) *\r\n              (this.mouseTo.y - this.mouseFrom.y)\r\n        ) / 2;\r\n      return new fabric.Circle({\r\n        left: this.mouseFrom.x,\r\n        top: this.mouseFrom.y,\r\n        stroke: this.drawColor,\r\n        fill: \"rgba(255, 255, 255, 0)\",\r\n        radius: radius,\r\n        strokeWidth: this.drawWidth,\r\n      });\r\n    },\r\n    drawTriangle() {\r\n      let height = this.mouseTo.y - this.mouseFrom.y;\r\n      return new fabric.Triangle({\r\n        top: this.mouseFrom.y,\r\n        left: this.mouseFrom.x,\r\n        width: Math.sqrt(Math.pow(height, 2) + Math.pow(height / 2.0, 2)),\r\n        height: height,\r\n        stroke: this.drawColor,\r\n        strokeWidth: this.drawWidth,\r\n        fill: \"rgba(255,255,255,0)\",\r\n      });\r\n    },\r\n    drawEllipse() {\r\n      let left = this.mouseFrom.x;\r\n      let top = this.mouseFrom.y;\r\n      // let ellipse = Math.sqrt((this.mouseTo.x - left) * (this.mouseTo.x - left) + (this.mouseTo.y - top) * (this.mouseTo.y - top)) / 2;\r\n      return new fabric.Ellipse({\r\n        left: left,\r\n        top: top,\r\n        stroke: this.drawColor,\r\n        fill: \"rgba(255, 255, 255, 0)\",\r\n        originX: \"center\",\r\n        originY: \"center\",\r\n        rx: Math.abs(left - this.mouseTo.x),\r\n        ry: Math.abs(top - this.mouseTo.y),\r\n        strokeWidth: this.drawWidth,\r\n      });\r\n    },\r\n    drawRectangle() {\r\n      return new fabric.Rect({\r\n        left: this.mouseFrom.x,\r\n        top: this.mouseFrom.y,\r\n        width: this.mouseTo.x - this.mouseFrom.x,\r\n        height: this.mouseTo.y - this.mouseFrom.y,\r\n        fill: \"rgba(255, 255, 255, 0)\",\r\n        stroke: this.drawColor,\r\n        strokeWidth: this.drawWidth,\r\n      });\r\n    },\r\n    drawArrow(fromX, fromY, toX, toY, theta, headlen) {\r\n      theta = typeof theta != \"undefined\" ? theta : 30;\r\n      headlen = typeof theta != \"undefined\" ? headlen : 10;\r\n\r\n      let angle = (Math.atan2(fromY - toY, fromX - toX) * 180) / Math.PI,\r\n        angle1 = ((angle + theta) * Math.PI) / 180,\r\n        angle2 = ((angle - theta) * Math.PI) / 180,\r\n        topX = headlen * Math.cos(angle1),\r\n        topY = headlen * Math.sin(angle1),\r\n        botX = headlen * Math.cos(angle2),\r\n        botY = headlen * Math.sin(angle2);\r\n      let arrowX = fromX - topX,\r\n        arrowY = fromY - topY;\r\n      let path = \" M \" + fromX + \" \" + fromY;\r\n      path += \" L \" + toX + \" \" + toY;\r\n      arrowX = toX + topX;\r\n      arrowY = toY + topY;\r\n      path += \" M \" + arrowX + \" \" + arrowY;\r\n      path += \" L \" + toX + \" \" + toY;\r\n      arrowX = toX + botX;\r\n      arrowY = toY + botY;\r\n      path += \" L \" + arrowX + \" \" + arrowY;\r\n      return path;\r\n    },\r\n    downLoadImage() {\r\n      this.done = true;\r\n      let base64URl = this.fabricObj.toDataURL({\r\n        formart: \"png\",\r\n        multiplier: 2,\r\n      });\r\n      this.imageBase64 = base64URl;\r\n      this.done = false;\r\n    },\r\n    uploadImage(e) {\r\n      var reader = new FileReader();\r\n      reader.onload = (event) => {\r\n        var imgObj = new Image();\r\n        imgObj.src = event.target.result;\r\n        imgObj.onload = () => {\r\n          var image = new fabric.Image(imgObj);\r\n          image.set({\r\n            left: 250,\r\n            top: 250,\r\n          });\r\n          //image.scale(getRandomNum(0.1, 0.25)).setCoords();\r\n          this.fabricObj.add(image);\r\n          this.sendCanvas();\r\n        };\r\n      };\r\n\r\n      reader.readAsDataURL(e.target.files[0]);\r\n      e.target.value = \"\";\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.wraper {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n  .canvas-wraper {\r\n    height: 150%;\r\n    width: 100%;\r\n    margin-bottom: 10px;\r\n    overflow: hidden;\r\n    background: url(\"../assets/001.jpg\") repeat;\r\n  }\r\n  .controlPanel {\r\n    width: 100%;\r\n    height: 62px;\r\n    background: #ddd;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    margin-bottom: 15px;\r\n    .contro-item {\r\n      flex-basis: 100px;\r\n      border-right: 1px solid #dad7d9;\r\n      text-align: center;\r\n      cursor: pointer;\r\n      background: #fefefe;\r\n      i {\r\n        font-size: 38px;\r\n        line-height: 62px;\r\n      }\r\n      &.active {\r\n        background: #e34f51;\r\n        color: #fff;\r\n        border-radius: 3px;\r\n        i {\r\n          font-size: 42px;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .download {\r\n    img {\r\n      width: 100%;\r\n    }\r\n  }\r\n}\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Board.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Board.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Board.vue?vue&type=template&id=57556501&scoped=true&\"\nimport script from \"./Board.vue?vue&type=script&lang=js&\"\nexport * from \"./Board.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Board.vue?vue&type=style&index=0&id=57556501&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"57556501\",\n  null\n  \n)\n\nexport default component.exports","\nmodule.exports = require('./socket');\n\n/**\n * Exports parser\n *\n * @api public\n *\n */\nmodule.exports.parser = require('engine.io-parser');\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = createDebug.debug = createDebug['default'] = createDebug;\nexports.coerce = coerce;\nexports.disable = disable;\nexports.enable = enable;\nexports.enabled = enabled;\nexports.humanize = require('ms');\n\n/**\n * Active `debug` instances.\n */\nexports.instances = [];\n\n/**\n * The currently active debug mode names, and names to skip.\n */\n\nexports.names = [];\nexports.skips = [];\n\n/**\n * Map of special \"%n\" handling functions, for the debug \"format\" argument.\n *\n * Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n */\n\nexports.formatters = {};\n\n/**\n * Select a color.\n * @param {String} namespace\n * @return {Number}\n * @api private\n */\n\nfunction selectColor(namespace) {\n  var hash = 0, i;\n\n  for (i in namespace) {\n    hash  = ((hash << 5) - hash) + namespace.charCodeAt(i);\n    hash |= 0; // Convert to 32bit integer\n  }\n\n  return exports.colors[Math.abs(hash) % exports.colors.length];\n}\n\n/**\n * Create a debugger with the given `namespace`.\n *\n * @param {String} namespace\n * @return {Function}\n * @api public\n */\n\nfunction createDebug(namespace) {\n\n  var prevTime;\n\n  function debug() {\n    // disabled?\n    if (!debug.enabled) return;\n\n    var self = debug;\n\n    // set `diff` timestamp\n    var curr = +new Date();\n    var ms = curr - (prevTime || curr);\n    self.diff = ms;\n    self.prev = prevTime;\n    self.curr = curr;\n    prevTime = curr;\n\n    // turn the `arguments` into a proper Array\n    var args = new Array(arguments.length);\n    for (var i = 0; i < args.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    args[0] = exports.coerce(args[0]);\n\n    if ('string' !== typeof args[0]) {\n      // anything else let's inspect with %O\n      args.unshift('%O');\n    }\n\n    // apply any `formatters` transformations\n    var index = 0;\n    args[0] = args[0].replace(/%([a-zA-Z%])/g, function(match, format) {\n      // if we encounter an escaped % then don't increase the array index\n      if (match === '%%') return match;\n      index++;\n      var formatter = exports.formatters[format];\n      if ('function' === typeof formatter) {\n        var val = args[index];\n        match = formatter.call(self, val);\n\n        // now we need to remove `args[index]` since it's inlined in the `format`\n        args.splice(index, 1);\n        index--;\n      }\n      return match;\n    });\n\n    // apply env-specific formatting (colors, etc.)\n    exports.formatArgs.call(self, args);\n\n    var logFn = debug.log || exports.log || console.log.bind(console);\n    logFn.apply(self, args);\n  }\n\n  debug.namespace = namespace;\n  debug.enabled = exports.enabled(namespace);\n  debug.useColors = exports.useColors();\n  debug.color = selectColor(namespace);\n  debug.destroy = destroy;\n\n  // env-specific initialization logic for debug instances\n  if ('function' === typeof exports.init) {\n    exports.init(debug);\n  }\n\n  exports.instances.push(debug);\n\n  return debug;\n}\n\nfunction destroy () {\n  var index = exports.instances.indexOf(this);\n  if (index !== -1) {\n    exports.instances.splice(index, 1);\n    return true;\n  } else {\n    return false;\n  }\n}\n\n/**\n * Enables a debug mode by namespaces. This can include modes\n * separated by a colon and wildcards.\n *\n * @param {String} namespaces\n * @api public\n */\n\nfunction enable(namespaces) {\n  exports.save(namespaces);\n\n  exports.names = [];\n  exports.skips = [];\n\n  var i;\n  var split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n  var len = split.length;\n\n  for (i = 0; i < len; i++) {\n    if (!split[i]) continue; // ignore empty strings\n    namespaces = split[i].replace(/\\*/g, '.*?');\n    if (namespaces[0] === '-') {\n      exports.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n    } else {\n      exports.names.push(new RegExp('^' + namespaces + '$'));\n    }\n  }\n\n  for (i = 0; i < exports.instances.length; i++) {\n    var instance = exports.instances[i];\n    instance.enabled = exports.enabled(instance.namespace);\n  }\n}\n\n/**\n * Disable debug output.\n *\n * @api public\n */\n\nfunction disable() {\n  exports.enable('');\n}\n\n/**\n * Returns true if the given mode name is enabled, false otherwise.\n *\n * @param {String} name\n * @return {Boolean}\n * @api public\n */\n\nfunction enabled(name) {\n  if (name[name.length - 1] === '*') {\n    return true;\n  }\n  var i, len;\n  for (i = 0, len = exports.skips.length; i < len; i++) {\n    if (exports.skips[i].test(name)) {\n      return false;\n    }\n  }\n  for (i = 0, len = exports.names.length; i < len; i++) {\n    if (exports.names[i].test(name)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Coerce `val`.\n *\n * @param {Mixed} val\n * @return {Mixed}\n * @api private\n */\n\nfunction coerce(val) {\n  if (val instanceof Error) return val.stack || val.message;\n  return val;\n}\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Board.vue?vue&type=style&index=0&id=57556501&lang=scss&scoped=true&\"","/*! https://mths.be/utf8js v2.1.2 by @mathias */\n\nvar stringFromCharCode = String.fromCharCode;\n\n// Taken from https://mths.be/punycode\nfunction ucs2decode(string) {\n\tvar output = [];\n\tvar counter = 0;\n\tvar length = string.length;\n\tvar value;\n\tvar extra;\n\twhile (counter < length) {\n\t\tvalue = string.charCodeAt(counter++);\n\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t// high surrogate, and there is a next character\n\t\t\textra = string.charCodeAt(counter++);\n\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t} else {\n\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\toutput.push(value);\n\t\t\t\tcounter--;\n\t\t\t}\n\t\t} else {\n\t\t\toutput.push(value);\n\t\t}\n\t}\n\treturn output;\n}\n\n// Taken from https://mths.be/punycode\nfunction ucs2encode(array) {\n\tvar length = array.length;\n\tvar index = -1;\n\tvar value;\n\tvar output = '';\n\twhile (++index < length) {\n\t\tvalue = array[index];\n\t\tif (value > 0xFFFF) {\n\t\t\tvalue -= 0x10000;\n\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t}\n\t\toutput += stringFromCharCode(value);\n\t}\n\treturn output;\n}\n\nfunction checkScalarValue(codePoint, strict) {\n\tif (codePoint >= 0xD800 && codePoint <= 0xDFFF) {\n\t\tif (strict) {\n\t\t\tthrow Error(\n\t\t\t\t'Lone surrogate U+' + codePoint.toString(16).toUpperCase() +\n\t\t\t\t' is not a scalar value'\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\treturn true;\n}\n/*--------------------------------------------------------------------------*/\n\nfunction createByte(codePoint, shift) {\n\treturn stringFromCharCode(((codePoint >> shift) & 0x3F) | 0x80);\n}\n\nfunction encodeCodePoint(codePoint, strict) {\n\tif ((codePoint & 0xFFFFFF80) == 0) { // 1-byte sequence\n\t\treturn stringFromCharCode(codePoint);\n\t}\n\tvar symbol = '';\n\tif ((codePoint & 0xFFFFF800) == 0) { // 2-byte sequence\n\t\tsymbol = stringFromCharCode(((codePoint >> 6) & 0x1F) | 0xC0);\n\t}\n\telse if ((codePoint & 0xFFFF0000) == 0) { // 3-byte sequence\n\t\tif (!checkScalarValue(codePoint, strict)) {\n\t\t\tcodePoint = 0xFFFD;\n\t\t}\n\t\tsymbol = stringFromCharCode(((codePoint >> 12) & 0x0F) | 0xE0);\n\t\tsymbol += createByte(codePoint, 6);\n\t}\n\telse if ((codePoint & 0xFFE00000) == 0) { // 4-byte sequence\n\t\tsymbol = stringFromCharCode(((codePoint >> 18) & 0x07) | 0xF0);\n\t\tsymbol += createByte(codePoint, 12);\n\t\tsymbol += createByte(codePoint, 6);\n\t}\n\tsymbol += stringFromCharCode((codePoint & 0x3F) | 0x80);\n\treturn symbol;\n}\n\nfunction utf8encode(string, opts) {\n\topts = opts || {};\n\tvar strict = false !== opts.strict;\n\n\tvar codePoints = ucs2decode(string);\n\tvar length = codePoints.length;\n\tvar index = -1;\n\tvar codePoint;\n\tvar byteString = '';\n\twhile (++index < length) {\n\t\tcodePoint = codePoints[index];\n\t\tbyteString += encodeCodePoint(codePoint, strict);\n\t}\n\treturn byteString;\n}\n\n/*--------------------------------------------------------------------------*/\n\nfunction readContinuationByte() {\n\tif (byteIndex >= byteCount) {\n\t\tthrow Error('Invalid byte index');\n\t}\n\n\tvar continuationByte = byteArray[byteIndex] & 0xFF;\n\tbyteIndex++;\n\n\tif ((continuationByte & 0xC0) == 0x80) {\n\t\treturn continuationByte & 0x3F;\n\t}\n\n\t// If we end up here, its not a continuation byte\n\tthrow Error('Invalid continuation byte');\n}\n\nfunction decodeSymbol(strict) {\n\tvar byte1;\n\tvar byte2;\n\tvar byte3;\n\tvar byte4;\n\tvar codePoint;\n\n\tif (byteIndex > byteCount) {\n\t\tthrow Error('Invalid byte index');\n\t}\n\n\tif (byteIndex == byteCount) {\n\t\treturn false;\n\t}\n\n\t// Read first byte\n\tbyte1 = byteArray[byteIndex] & 0xFF;\n\tbyteIndex++;\n\n\t// 1-byte sequence (no continuation bytes)\n\tif ((byte1 & 0x80) == 0) {\n\t\treturn byte1;\n\t}\n\n\t// 2-byte sequence\n\tif ((byte1 & 0xE0) == 0xC0) {\n\t\tbyte2 = readContinuationByte();\n\t\tcodePoint = ((byte1 & 0x1F) << 6) | byte2;\n\t\tif (codePoint >= 0x80) {\n\t\t\treturn codePoint;\n\t\t} else {\n\t\t\tthrow Error('Invalid continuation byte');\n\t\t}\n\t}\n\n\t// 3-byte sequence (may include unpaired surrogates)\n\tif ((byte1 & 0xF0) == 0xE0) {\n\t\tbyte2 = readContinuationByte();\n\t\tbyte3 = readContinuationByte();\n\t\tcodePoint = ((byte1 & 0x0F) << 12) | (byte2 << 6) | byte3;\n\t\tif (codePoint >= 0x0800) {\n\t\t\treturn checkScalarValue(codePoint, strict) ? codePoint : 0xFFFD;\n\t\t} else {\n\t\t\tthrow Error('Invalid continuation byte');\n\t\t}\n\t}\n\n\t// 4-byte sequence\n\tif ((byte1 & 0xF8) == 0xF0) {\n\t\tbyte2 = readContinuationByte();\n\t\tbyte3 = readContinuationByte();\n\t\tbyte4 = readContinuationByte();\n\t\tcodePoint = ((byte1 & 0x07) << 0x12) | (byte2 << 0x0C) |\n\t\t\t(byte3 << 0x06) | byte4;\n\t\tif (codePoint >= 0x010000 && codePoint <= 0x10FFFF) {\n\t\t\treturn codePoint;\n\t\t}\n\t}\n\n\tthrow Error('Invalid UTF-8 detected');\n}\n\nvar byteArray;\nvar byteCount;\nvar byteIndex;\nfunction utf8decode(byteString, opts) {\n\topts = opts || {};\n\tvar strict = false !== opts.strict;\n\n\tbyteArray = ucs2decode(byteString);\n\tbyteCount = byteArray.length;\n\tbyteIndex = 0;\n\tvar codePoints = [];\n\tvar tmp;\n\twhile ((tmp = decodeSymbol(strict)) !== false) {\n\t\tcodePoints.push(tmp);\n\t}\n\treturn ucs2encode(codePoints);\n}\n\nmodule.exports = {\n\tversion: '2.1.2',\n\tencode: utf8encode,\n\tdecode: utf8decode\n};\n","\nmodule.exports = isBuf;\n\nvar withNativeBuffer = typeof Buffer === 'function' && typeof Buffer.isBuffer === 'function';\nvar withNativeArrayBuffer = typeof ArrayBuffer === 'function';\n\nvar isView = function (obj) {\n  return typeof ArrayBuffer.isView === 'function' ? ArrayBuffer.isView(obj) : (obj.buffer instanceof ArrayBuffer);\n};\n\n/**\n * Returns true if obj is a buffer or an arraybuffer.\n *\n * @api private\n */\n\nfunction isBuf(obj) {\n  return (withNativeBuffer && Buffer.isBuffer(obj)) ||\n          (withNativeArrayBuffer && (obj instanceof ArrayBuffer || isView(obj)));\n}\n","var DESCRIPTORS = require('../internals/descriptors');\nvar defineProperty = require('../internals/object-define-property').f;\n\nvar FunctionPrototype = Function.prototype;\nvar FunctionPrototypeToString = FunctionPrototype.toString;\nvar nameRE = /^\\s*function ([^ (]*)/;\nvar NAME = 'name';\n\n// Function instances `.name` property\n// https://tc39.es/ecma262/#sec-function-instances-name\nif (DESCRIPTORS && !(NAME in FunctionPrototype)) {\n  defineProperty(FunctionPrototype, NAME, {\n    configurable: true,\n    get: function () {\n      try {\n        return FunctionPrototypeToString.call(this).match(nameRE)[1];\n      } catch (error) {\n        return '';\n      }\n    }\n  });\n}\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\n/*\n * Export kMaxLength after typed array support is determined.\n */\nexports.kMaxLength = kMaxLength()\n\nfunction typedArraySupport () {\n  try {\n    var arr = new Uint8Array(1)\n    arr.__proto__ = {__proto__: Uint8Array.prototype, foo: function () { return 42 }}\n    return arr.foo() === 42 && // typed array instances can be augmented\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\nfunction createBuffer (that, length) {\n  if (kMaxLength() < length) {\n    throw new RangeError('Invalid typed array length')\n  }\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = new Uint8Array(length)\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    if (that === null) {\n      that = new Buffer(length)\n    }\n    that.length = length\n  }\n\n  return that\n}\n\n/**\n * The Buffer constructor returns instances of `Uint8Array` that have their\n * prototype changed to `Buffer.prototype`. Furthermore, `Buffer` is a subclass of\n * `Uint8Array`, so the returned instances will have all the node `Buffer` methods\n * and the `Uint8Array` methods. Square bracket notation works as expected -- it\n * returns a single octet.\n *\n * The `Uint8Array` prototype remains unmodified.\n */\n\nfunction Buffer (arg, encodingOrOffset, length) {\n  if (!Buffer.TYPED_ARRAY_SUPPORT && !(this instanceof Buffer)) {\n    return new Buffer(arg, encodingOrOffset, length)\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    if (typeof encodingOrOffset === 'string') {\n      throw new Error(\n        'If encoding is specified then the first argument must be a string'\n      )\n    }\n    return allocUnsafe(this, arg)\n  }\n  return from(this, arg, encodingOrOffset, length)\n}\n\nBuffer.poolSize = 8192 // not used by this implementation\n\n// TODO: Legacy, not needed anymore. Remove in next major version.\nBuffer._augment = function (arr) {\n  arr.__proto__ = Buffer.prototype\n  return arr\n}\n\nfunction from (that, value, encodingOrOffset, length) {\n  if (typeof value === 'number') {\n    throw new TypeError('\"value\" argument must not be a number')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined' && value instanceof ArrayBuffer) {\n    return fromArrayBuffer(that, value, encodingOrOffset, length)\n  }\n\n  if (typeof value === 'string') {\n    return fromString(that, value, encodingOrOffset)\n  }\n\n  return fromObject(that, value)\n}\n\n/**\n * Functionally equivalent to Buffer(arg, encoding) but throws a TypeError\n * if value is a number.\n * Buffer.from(str[, encoding])\n * Buffer.from(array)\n * Buffer.from(buffer)\n * Buffer.from(arrayBuffer[, byteOffset[, length]])\n **/\nBuffer.from = function (value, encodingOrOffset, length) {\n  return from(null, value, encodingOrOffset, length)\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n  if (typeof Symbol !== 'undefined' && Symbol.species &&\n      Buffer[Symbol.species] === Buffer) {\n    // Fix subarray() in ES2016. See: https://github.com/feross/buffer/pull/97\n    Object.defineProperty(Buffer, Symbol.species, {\n      value: null,\n      configurable: true\n    })\n  }\n}\n\nfunction assertSize (size) {\n  if (typeof size !== 'number') {\n    throw new TypeError('\"size\" argument must be a number')\n  } else if (size < 0) {\n    throw new RangeError('\"size\" argument must not be negative')\n  }\n}\n\nfunction alloc (that, size, fill, encoding) {\n  assertSize(size)\n  if (size <= 0) {\n    return createBuffer(that, size)\n  }\n  if (fill !== undefined) {\n    // Only pay attention to encoding if it's a string. This\n    // prevents accidentally sending in a number that would\n    // be interpretted as a start offset.\n    return typeof encoding === 'string'\n      ? createBuffer(that, size).fill(fill, encoding)\n      : createBuffer(that, size).fill(fill)\n  }\n  return createBuffer(that, size)\n}\n\n/**\n * Creates a new filled Buffer instance.\n * alloc(size[, fill[, encoding]])\n **/\nBuffer.alloc = function (size, fill, encoding) {\n  return alloc(null, size, fill, encoding)\n}\n\nfunction allocUnsafe (that, size) {\n  assertSize(size)\n  that = createBuffer(that, size < 0 ? 0 : checked(size) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < size; ++i) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\n/**\n * Equivalent to Buffer(num), by default creates a non-zero-filled Buffer instance.\n * */\nBuffer.allocUnsafe = function (size) {\n  return allocUnsafe(null, size)\n}\n/**\n * Equivalent to SlowBuffer(num), by default creates a non-zero-filled Buffer instance.\n */\nBuffer.allocUnsafeSlow = function (size) {\n  return allocUnsafe(null, size)\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') {\n    encoding = 'utf8'\n  }\n\n  if (!Buffer.isEncoding(encoding)) {\n    throw new TypeError('\"encoding\" must be a valid string encoding')\n  }\n\n  var length = byteLength(string, encoding) | 0\n  that = createBuffer(that, length)\n\n  var actual = that.write(string, encoding)\n\n  if (actual !== length) {\n    // Writing a hex string, for example, that contains invalid characters will\n    // cause everything after the first invalid character to be ignored. (e.g.\n    // 'abxxcd' will be treated as 'ab')\n    that = that.slice(0, actual)\n  }\n\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = array.length < 0 ? 0 : checked(array.length) | 0\n  that = createBuffer(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array, byteOffset, length) {\n  array.byteLength // this throws if `array` is not a valid ArrayBuffer\n\n  if (byteOffset < 0 || array.byteLength < byteOffset) {\n    throw new RangeError('\\'offset\\' is out of bounds')\n  }\n\n  if (array.byteLength < byteOffset + (length || 0)) {\n    throw new RangeError('\\'length\\' is out of bounds')\n  }\n\n  if (byteOffset === undefined && length === undefined) {\n    array = new Uint8Array(array)\n  } else if (length === undefined) {\n    array = new Uint8Array(array, byteOffset)\n  } else {\n    array = new Uint8Array(array, byteOffset, length)\n  }\n\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = array\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromArrayLike(that, array)\n  }\n  return that\n}\n\nfunction fromObject (that, obj) {\n  if (Buffer.isBuffer(obj)) {\n    var len = checked(obj.length) | 0\n    that = createBuffer(that, len)\n\n    if (that.length === 0) {\n      return that\n    }\n\n    obj.copy(that, 0, 0, len)\n    return that\n  }\n\n  if (obj) {\n    if ((typeof ArrayBuffer !== 'undefined' &&\n        obj.buffer instanceof ArrayBuffer) || 'length' in obj) {\n      if (typeof obj.length !== 'number' || isnan(obj.length)) {\n        return createBuffer(that, 0)\n      }\n      return fromArrayLike(that, obj)\n    }\n\n    if (obj.type === 'Buffer' && isArray(obj.data)) {\n      return fromArrayLike(that, obj.data)\n    }\n  }\n\n  throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength()` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (length) {\n  if (+length != length) { // eslint-disable-line eqeqeq\n    length = 0\n  }\n  return Buffer.alloc(+length)\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  for (var i = 0, len = Math.min(x, y); i < len; ++i) {\n    if (a[i] !== b[i]) {\n      x = a[i]\n      y = b[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'latin1':\n    case 'binary':\n    case 'base64':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) {\n    throw new TypeError('\"list\" argument must be an Array of Buffers')\n  }\n\n  if (list.length === 0) {\n    return Buffer.alloc(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; ++i) {\n      length += list[i].length\n    }\n  }\n\n  var buffer = Buffer.allocUnsafe(length)\n  var pos = 0\n  for (i = 0; i < list.length; ++i) {\n    var buf = list[i]\n    if (!Buffer.isBuffer(buf)) {\n      throw new TypeError('\"list\" argument must be an Array of Buffers')\n    }\n    buf.copy(buffer, pos)\n    pos += buf.length\n  }\n  return buffer\n}\n\nfunction byteLength (string, encoding) {\n  if (Buffer.isBuffer(string)) {\n    return string.length\n  }\n  if (typeof ArrayBuffer !== 'undefined' && typeof ArrayBuffer.isView === 'function' &&\n      (ArrayBuffer.isView(string) || string instanceof ArrayBuffer)) {\n    return string.byteLength\n  }\n  if (typeof string !== 'string') {\n    string = '' + string\n  }\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'latin1':\n      case 'binary':\n        return len\n      case 'utf8':\n      case 'utf-8':\n      case undefined:\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  // No need to verify that \"this.length <= MAX_UINT32\" since it's a read-only\n  // property of a typed array.\n\n  // This behaves neither like String nor Uint8Array in that we set start/end\n  // to their upper/lower bounds if the value passed is out of range.\n  // undefined is handled specially as per ECMA-262 6th Edition,\n  // Section 13.3.3.7 Runtime Semantics: KeyedBindingInitialization.\n  if (start === undefined || start < 0) {\n    start = 0\n  }\n  // Return early if start > this.length. Done here to prevent potential uint32\n  // coercion fail below.\n  if (start > this.length) {\n    return ''\n  }\n\n  if (end === undefined || end > this.length) {\n    end = this.length\n  }\n\n  if (end <= 0) {\n    return ''\n  }\n\n  // Force coersion to uint32. This will also coerce falsey/NaN values to 0.\n  end >>>= 0\n  start >>>= 0\n\n  if (end <= start) {\n    return ''\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Slice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\n// The property is used by `Buffer.isBuffer` and `is-buffer` (in Safari 5-7) to detect\n// Buffer instances.\nBuffer.prototype._isBuffer = true\n\nfunction swap (b, n, m) {\n  var i = b[n]\n  b[n] = b[m]\n  b[m] = i\n}\n\nBuffer.prototype.swap16 = function swap16 () {\n  var len = this.length\n  if (len % 2 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 16-bits')\n  }\n  for (var i = 0; i < len; i += 2) {\n    swap(this, i, i + 1)\n  }\n  return this\n}\n\nBuffer.prototype.swap32 = function swap32 () {\n  var len = this.length\n  if (len % 4 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 32-bits')\n  }\n  for (var i = 0; i < len; i += 4) {\n    swap(this, i, i + 3)\n    swap(this, i + 1, i + 2)\n  }\n  return this\n}\n\nBuffer.prototype.swap64 = function swap64 () {\n  var len = this.length\n  if (len % 8 !== 0) {\n    throw new RangeError('Buffer size must be a multiple of 64-bits')\n  }\n  for (var i = 0; i < len; i += 8) {\n    swap(this, i, i + 7)\n    swap(this, i + 1, i + 6)\n    swap(this, i + 2, i + 5)\n    swap(this, i + 3, i + 4)\n  }\n  return this\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (target, start, end, thisStart, thisEnd) {\n  if (!Buffer.isBuffer(target)) {\n    throw new TypeError('Argument must be a Buffer')\n  }\n\n  if (start === undefined) {\n    start = 0\n  }\n  if (end === undefined) {\n    end = target ? target.length : 0\n  }\n  if (thisStart === undefined) {\n    thisStart = 0\n  }\n  if (thisEnd === undefined) {\n    thisEnd = this.length\n  }\n\n  if (start < 0 || end > target.length || thisStart < 0 || thisEnd > this.length) {\n    throw new RangeError('out of range index')\n  }\n\n  if (thisStart >= thisEnd && start >= end) {\n    return 0\n  }\n  if (thisStart >= thisEnd) {\n    return -1\n  }\n  if (start >= end) {\n    return 1\n  }\n\n  start >>>= 0\n  end >>>= 0\n  thisStart >>>= 0\n  thisEnd >>>= 0\n\n  if (this === target) return 0\n\n  var x = thisEnd - thisStart\n  var y = end - start\n  var len = Math.min(x, y)\n\n  var thisCopy = this.slice(thisStart, thisEnd)\n  var targetCopy = target.slice(start, end)\n\n  for (var i = 0; i < len; ++i) {\n    if (thisCopy[i] !== targetCopy[i]) {\n      x = thisCopy[i]\n      y = targetCopy[i]\n      break\n    }\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\n// Finds either the first index of `val` in `buffer` at offset >= `byteOffset`,\n// OR the last index of `val` in `buffer` at offset <= `byteOffset`.\n//\n// Arguments:\n// - buffer - a Buffer to search\n// - val - a string, Buffer, or number\n// - byteOffset - an index into `buffer`; will be clamped to an int32\n// - encoding - an optional encoding, relevant is val is a string\n// - dir - true for indexOf, false for lastIndexOf\nfunction bidirectionalIndexOf (buffer, val, byteOffset, encoding, dir) {\n  // Empty buffer means no match\n  if (buffer.length === 0) return -1\n\n  // Normalize byteOffset\n  if (typeof byteOffset === 'string') {\n    encoding = byteOffset\n    byteOffset = 0\n  } else if (byteOffset > 0x7fffffff) {\n    byteOffset = 0x7fffffff\n  } else if (byteOffset < -0x80000000) {\n    byteOffset = -0x80000000\n  }\n  byteOffset = +byteOffset  // Coerce to Number.\n  if (isNaN(byteOffset)) {\n    // byteOffset: it it's undefined, null, NaN, \"foo\", etc, search whole buffer\n    byteOffset = dir ? 0 : (buffer.length - 1)\n  }\n\n  // Normalize byteOffset: negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = buffer.length + byteOffset\n  if (byteOffset >= buffer.length) {\n    if (dir) return -1\n    else byteOffset = buffer.length - 1\n  } else if (byteOffset < 0) {\n    if (dir) byteOffset = 0\n    else return -1\n  }\n\n  // Normalize val\n  if (typeof val === 'string') {\n    val = Buffer.from(val, encoding)\n  }\n\n  // Finally, search either indexOf (if dir is true) or lastIndexOf\n  if (Buffer.isBuffer(val)) {\n    // Special case: looking for empty string/buffer always fails\n    if (val.length === 0) {\n      return -1\n    }\n    return arrayIndexOf(buffer, val, byteOffset, encoding, dir)\n  } else if (typeof val === 'number') {\n    val = val & 0xFF // Search for a byte value [0-255]\n    if (Buffer.TYPED_ARRAY_SUPPORT &&\n        typeof Uint8Array.prototype.indexOf === 'function') {\n      if (dir) {\n        return Uint8Array.prototype.indexOf.call(buffer, val, byteOffset)\n      } else {\n        return Uint8Array.prototype.lastIndexOf.call(buffer, val, byteOffset)\n      }\n    }\n    return arrayIndexOf(buffer, [ val ], byteOffset, encoding, dir)\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\nfunction arrayIndexOf (arr, val, byteOffset, encoding, dir) {\n  var indexSize = 1\n  var arrLength = arr.length\n  var valLength = val.length\n\n  if (encoding !== undefined) {\n    encoding = String(encoding).toLowerCase()\n    if (encoding === 'ucs2' || encoding === 'ucs-2' ||\n        encoding === 'utf16le' || encoding === 'utf-16le') {\n      if (arr.length < 2 || val.length < 2) {\n        return -1\n      }\n      indexSize = 2\n      arrLength /= 2\n      valLength /= 2\n      byteOffset /= 2\n    }\n  }\n\n  function read (buf, i) {\n    if (indexSize === 1) {\n      return buf[i]\n    } else {\n      return buf.readUInt16BE(i * indexSize)\n    }\n  }\n\n  var i\n  if (dir) {\n    var foundIndex = -1\n    for (i = byteOffset; i < arrLength; i++) {\n      if (read(arr, i) === read(val, foundIndex === -1 ? 0 : i - foundIndex)) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === valLength) return foundIndex * indexSize\n      } else {\n        if (foundIndex !== -1) i -= i - foundIndex\n        foundIndex = -1\n      }\n    }\n  } else {\n    if (byteOffset + valLength > arrLength) byteOffset = arrLength - valLength\n    for (i = byteOffset; i >= 0; i--) {\n      var found = true\n      for (var j = 0; j < valLength; j++) {\n        if (read(arr, i + j) !== read(val, j)) {\n          found = false\n          break\n        }\n      }\n      if (found) return i\n    }\n  }\n\n  return -1\n}\n\nBuffer.prototype.includes = function includes (val, byteOffset, encoding) {\n  return this.indexOf(val, byteOffset, encoding) !== -1\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, true)\n}\n\nBuffer.prototype.lastIndexOf = function lastIndexOf (val, byteOffset, encoding) {\n  return bidirectionalIndexOf(this, val, byteOffset, encoding, false)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new TypeError('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; ++i) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) return i\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction latin1Write (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    throw new Error(\n      'Buffer.write(string, encoding, offset[, length]) is no longer supported'\n    )\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('Attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'latin1':\n      case 'binary':\n        return latin1Write(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction latin1Slice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; ++i) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; ++i) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = this.subarray(start, end)\n    newBuf.__proto__ = Buffer.prototype\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; ++i) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('\"buffer\" argument must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('\"value\" argument is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    var maxBytes = Math.pow(2, 8 * byteLength) - 1\n    checkInt(this, value, offset, byteLength, maxBytes, 0)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; ++i) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; ++i) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i - 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    if (value < 0 && sub === 0 && this[offset + i + 1] !== 0) {\n      sub = 1\n    }\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (offset + ext > buf.length) throw new RangeError('Index out of range')\n  if (offset < 0) throw new RangeError('Index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; --i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; ++i) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    Uint8Array.prototype.set.call(\n      target,\n      this.subarray(start, start + len),\n      targetStart\n    )\n  }\n\n  return len\n}\n\n// Usage:\n//    buffer.fill(number[, offset[, end]])\n//    buffer.fill(buffer[, offset[, end]])\n//    buffer.fill(string[, offset[, end]][, encoding])\nBuffer.prototype.fill = function fill (val, start, end, encoding) {\n  // Handle string cases:\n  if (typeof val === 'string') {\n    if (typeof start === 'string') {\n      encoding = start\n      start = 0\n      end = this.length\n    } else if (typeof end === 'string') {\n      encoding = end\n      end = this.length\n    }\n    if (val.length === 1) {\n      var code = val.charCodeAt(0)\n      if (code < 256) {\n        val = code\n      }\n    }\n    if (encoding !== undefined && typeof encoding !== 'string') {\n      throw new TypeError('encoding must be a string')\n    }\n    if (typeof encoding === 'string' && !Buffer.isEncoding(encoding)) {\n      throw new TypeError('Unknown encoding: ' + encoding)\n    }\n  } else if (typeof val === 'number') {\n    val = val & 255\n  }\n\n  // Invalid ranges are not set to a default, so can range check early.\n  if (start < 0 || this.length < start || this.length < end) {\n    throw new RangeError('Out of range index')\n  }\n\n  if (end <= start) {\n    return this\n  }\n\n  start = start >>> 0\n  end = end === undefined ? this.length : end >>> 0\n\n  if (!val) val = 0\n\n  var i\n  if (typeof val === 'number') {\n    for (i = start; i < end; ++i) {\n      this[i] = val\n    }\n  } else {\n    var bytes = Buffer.isBuffer(val)\n      ? val\n      : utf8ToBytes(new Buffer(val, encoding).toString())\n    var len = bytes.length\n    for (i = 0; i < end - start; ++i) {\n      this[i + start] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; ++i) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; ++i) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; ++i) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n\nfunction isnan (val) {\n  return val !== val // eslint-disable-line no-self-compare\n}\n","'use strict';\nvar $ = require('../internals/export');\n\n// `URL.prototype.toJSON` method\n// https://url.spec.whatwg.org/#dom-url-tojson\n$({ target: 'URL', proto: true, enumerable: true }, {\n  toJSON: function toJSON() {\n    return URL.prototype.toString.call(this);\n  }\n});\n","/**\n * This is the web browser implementation of `debug()`.\n *\n * Expose `debug()` as the module.\n */\n\nexports = module.exports = require('./debug');\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = 'undefined' != typeof chrome\n               && 'undefined' != typeof chrome.storage\n                  ? chrome.storage.local\n                  : localstorage();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n  '#0000CC', '#0000FF', '#0033CC', '#0033FF', '#0066CC', '#0066FF', '#0099CC',\n  '#0099FF', '#00CC00', '#00CC33', '#00CC66', '#00CC99', '#00CCCC', '#00CCFF',\n  '#3300CC', '#3300FF', '#3333CC', '#3333FF', '#3366CC', '#3366FF', '#3399CC',\n  '#3399FF', '#33CC00', '#33CC33', '#33CC66', '#33CC99', '#33CCCC', '#33CCFF',\n  '#6600CC', '#6600FF', '#6633CC', '#6633FF', '#66CC00', '#66CC33', '#9900CC',\n  '#9900FF', '#9933CC', '#9933FF', '#99CC00', '#99CC33', '#CC0000', '#CC0033',\n  '#CC0066', '#CC0099', '#CC00CC', '#CC00FF', '#CC3300', '#CC3333', '#CC3366',\n  '#CC3399', '#CC33CC', '#CC33FF', '#CC6600', '#CC6633', '#CC9900', '#CC9933',\n  '#CCCC00', '#CCCC33', '#FF0000', '#FF0033', '#FF0066', '#FF0099', '#FF00CC',\n  '#FF00FF', '#FF3300', '#FF3333', '#FF3366', '#FF3399', '#FF33CC', '#FF33FF',\n  '#FF6600', '#FF6633', '#FF9900', '#FF9933', '#FFCC00', '#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\nfunction useColors() {\n  // NB: In an Electron preload script, document will be defined but not fully\n  // initialized. Since we know we're in Chrome, we'll just detect this case\n  // explicitly\n  if (typeof window !== 'undefined' && window.process && window.process.type === 'renderer') {\n    return true;\n  }\n\n  // Internet Explorer and Edge do not support colors.\n  if (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n    return false;\n  }\n\n  // is webkit? http://stackoverflow.com/a/16459606/376773\n  // document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n  return (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n    // is firebug? http://stackoverflow.com/a/398120/376773\n    (typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n    // is firefox >= v31?\n    // https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n    (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n    // double check webkit in userAgent just in case we are in a worker\n    (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nexports.formatters.j = function(v) {\n  try {\n    return JSON.stringify(v);\n  } catch (err) {\n    return '[UnexpectedJSONParseError]: ' + err.message;\n  }\n};\n\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n  var useColors = this.useColors;\n\n  args[0] = (useColors ? '%c' : '')\n    + this.namespace\n    + (useColors ? ' %c' : ' ')\n    + args[0]\n    + (useColors ? '%c ' : ' ')\n    + '+' + exports.humanize(this.diff);\n\n  if (!useColors) return;\n\n  var c = 'color: ' + this.color;\n  args.splice(1, 0, c, 'color: inherit')\n\n  // the final \"%c\" is somewhat tricky, because there could be other\n  // arguments passed either before or after the %c, so we need to\n  // figure out the correct index to insert the CSS into\n  var index = 0;\n  var lastC = 0;\n  args[0].replace(/%[a-zA-Z%]/g, function(match) {\n    if ('%%' === match) return;\n    index++;\n    if ('%c' === match) {\n      // we only are interested in the *last* %c\n      // (the user may have provided their own)\n      lastC = index;\n    }\n  });\n\n  args.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.log()` when available.\n * No-op when `console.log` is not a \"function\".\n *\n * @api public\n */\n\nfunction log() {\n  // this hackery is required for IE8/9, where\n  // the `console.log` function doesn't have 'apply'\n  return 'object' === typeof console\n    && console.log\n    && Function.prototype.apply.call(console.log, console, arguments);\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\n\nfunction save(namespaces) {\n  try {\n    if (null == namespaces) {\n      exports.storage.removeItem('debug');\n    } else {\n      exports.storage.debug = namespaces;\n    }\n  } catch(e) {}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n  var r;\n  try {\n    r = exports.storage.debug;\n  } catch(e) {}\n\n  // If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n  if (!r && typeof process !== 'undefined' && 'env' in process) {\n    r = process.env.DEBUG;\n  }\n\n  return r;\n}\n\n/**\n * Enable namespaces listed in `localStorage.debug` initially.\n */\n\nexports.enable(load());\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n  try {\n    return window.localStorage;\n  } catch (e) {}\n}\n","\n/**\n * Module exports.\n *\n * Logic borrowed from Modernizr:\n *\n *   - https://github.com/Modernizr/Modernizr/blob/master/feature-detects/cors.js\n */\n\ntry {\n  module.exports = typeof XMLHttpRequest !== 'undefined' &&\n    'withCredentials' in new XMLHttpRequest();\n} catch (err) {\n  // if XMLHttp support is disabled in IE then it will throw\n  // when trying to create\n  module.exports = false;\n}\n","/**\n * An abstraction for slicing an arraybuffer even when\n * ArrayBuffer.prototype.slice is not supported\n *\n * @api public\n */\n\nmodule.exports = function(arraybuffer, start, end) {\n  var bytes = arraybuffer.byteLength;\n  start = start || 0;\n  end = end || bytes;\n\n  if (arraybuffer.slice) { return arraybuffer.slice(start, end); }\n\n  if (start < 0) { start += bytes; }\n  if (end < 0) { end += bytes; }\n  if (end > bytes) { end = bytes; }\n\n  if (start >= bytes || start >= end || bytes === 0) {\n    return new ArrayBuffer(0);\n  }\n\n  var abv = new Uint8Array(arraybuffer);\n  var result = new Uint8Array(end - start);\n  for (var i = start, ii = 0; i < end; i++, ii++) {\n    result[ii] = abv[i];\n  }\n  return result.buffer;\n};\n","\n/**\n * Module dependencies.\n */\n\nvar parseuri = require('parseuri');\nvar debug = require('debug')('socket.io-client:url');\n\n/**\n * Module exports.\n */\n\nmodule.exports = url;\n\n/**\n * URL parser.\n *\n * @param {String} url\n * @param {Object} An object meant to mimic window.location.\n *                 Defaults to window.location.\n * @api public\n */\n\nfunction url (uri, loc) {\n  var obj = uri;\n\n  // default to window.location\n  loc = loc || (typeof location !== 'undefined' && location);\n  if (null == uri) uri = loc.protocol + '//' + loc.host;\n\n  // relative path support\n  if ('string' === typeof uri) {\n    if ('/' === uri.charAt(0)) {\n      if ('/' === uri.charAt(1)) {\n        uri = loc.protocol + uri;\n      } else {\n        uri = loc.host + uri;\n      }\n    }\n\n    if (!/^(https?|wss?):\\/\\//.test(uri)) {\n      debug('protocol-less url %s', uri);\n      if ('undefined' !== typeof loc) {\n        uri = loc.protocol + '//' + uri;\n      } else {\n        uri = 'https://' + uri;\n      }\n    }\n\n    // parse\n    debug('parse %s', uri);\n    obj = parseuri(uri);\n  }\n\n  // make sure we treat `localhost:80` and `localhost` equally\n  if (!obj.port) {\n    if (/^(http|ws)$/.test(obj.protocol)) {\n      obj.port = '80';\n    } else if (/^(http|ws)s$/.test(obj.protocol)) {\n      obj.port = '443';\n    }\n  }\n\n  obj.path = obj.path || '/';\n\n  var ipv6 = obj.host.indexOf(':') !== -1;\n  var host = ipv6 ? '[' + obj.host + ']' : obj.host;\n\n  // define unique id\n  obj.id = obj.protocol + '://' + host + ':' + obj.port;\n  // define href\n  obj.href = obj.protocol + '://' + host + (loc && loc.port === obj.port ? '' : (':' + obj.port));\n\n  return obj;\n}\n","module.exports = after\n\nfunction after(count, callback, err_cb) {\n    var bail = false\n    err_cb = err_cb || noop\n    proxy.count = count\n\n    return (count === 0) ? callback() : proxy\n\n    function proxy(err, result) {\n        if (proxy.count <= 0) {\n            throw new Error('after called too many times')\n        }\n        --proxy.count\n\n        // after first error, rest are passed to err_cb\n        if (err) {\n            bail = true\n            callback(err)\n            // future error callbacks will go to error handler\n            callback = err_cb\n        } else if (proxy.count === 0 && !bail) {\n            callback(null, result)\n        }\n    }\n}\n\nfunction noop() {}\n","/* global attachEvent */\n\n/**\n * Module requirements.\n */\n\nvar XMLHttpRequest = require('xmlhttprequest-ssl');\nvar Polling = require('./polling');\nvar Emitter = require('component-emitter');\nvar inherit = require('component-inherit');\nvar debug = require('debug')('engine.io-client:polling-xhr');\nvar globalThis = require('../globalThis');\n\n/**\n * Module exports.\n */\n\nmodule.exports = XHR;\nmodule.exports.Request = Request;\n\n/**\n * Empty function\n */\n\nfunction empty () {}\n\n/**\n * XHR Polling constructor.\n *\n * @param {Object} opts\n * @api public\n */\n\nfunction XHR (opts) {\n  Polling.call(this, opts);\n  this.requestTimeout = opts.requestTimeout;\n  this.extraHeaders = opts.extraHeaders;\n\n  if (typeof location !== 'undefined') {\n    var isSSL = 'https:' === location.protocol;\n    var port = location.port;\n\n    // some user agents have empty `location.port`\n    if (!port) {\n      port = isSSL ? 443 : 80;\n    }\n\n    this.xd = (typeof location !== 'undefined' && opts.hostname !== location.hostname) ||\n      port !== opts.port;\n    this.xs = opts.secure !== isSSL;\n  }\n}\n\n/**\n * Inherits from Polling.\n */\n\ninherit(XHR, Polling);\n\n/**\n * XHR supports binary\n */\n\nXHR.prototype.supportsBinary = true;\n\n/**\n * Creates a request.\n *\n * @param {String} method\n * @api private\n */\n\nXHR.prototype.request = function (opts) {\n  opts = opts || {};\n  opts.uri = this.uri();\n  opts.xd = this.xd;\n  opts.xs = this.xs;\n  opts.agent = this.agent || false;\n  opts.supportsBinary = this.supportsBinary;\n  opts.enablesXDR = this.enablesXDR;\n  opts.withCredentials = this.withCredentials;\n\n  // SSL options for Node.js client\n  opts.pfx = this.pfx;\n  opts.key = this.key;\n  opts.passphrase = this.passphrase;\n  opts.cert = this.cert;\n  opts.ca = this.ca;\n  opts.ciphers = this.ciphers;\n  opts.rejectUnauthorized = this.rejectUnauthorized;\n  opts.requestTimeout = this.requestTimeout;\n\n  // other options for Node.js client\n  opts.extraHeaders = this.extraHeaders;\n\n  return new Request(opts);\n};\n\n/**\n * Sends data.\n *\n * @param {String} data to send.\n * @param {Function} called upon flush.\n * @api private\n */\n\nXHR.prototype.doWrite = function (data, fn) {\n  var isBinary = typeof data !== 'string' && data !== undefined;\n  var req = this.request({ method: 'POST', data: data, isBinary: isBinary });\n  var self = this;\n  req.on('success', fn);\n  req.on('error', function (err) {\n    self.onError('xhr post error', err);\n  });\n  this.sendXhr = req;\n};\n\n/**\n * Starts a poll cycle.\n *\n * @api private\n */\n\nXHR.prototype.doPoll = function () {\n  debug('xhr poll');\n  var req = this.request();\n  var self = this;\n  req.on('data', function (data) {\n    self.onData(data);\n  });\n  req.on('error', function (err) {\n    self.onError('xhr poll error', err);\n  });\n  this.pollXhr = req;\n};\n\n/**\n * Request constructor\n *\n * @param {Object} options\n * @api public\n */\n\nfunction Request (opts) {\n  this.method = opts.method || 'GET';\n  this.uri = opts.uri;\n  this.xd = !!opts.xd;\n  this.xs = !!opts.xs;\n  this.async = false !== opts.async;\n  this.data = undefined !== opts.data ? opts.data : null;\n  this.agent = opts.agent;\n  this.isBinary = opts.isBinary;\n  this.supportsBinary = opts.supportsBinary;\n  this.enablesXDR = opts.enablesXDR;\n  this.withCredentials = opts.withCredentials;\n  this.requestTimeout = opts.requestTimeout;\n\n  // SSL options for Node.js client\n  this.pfx = opts.pfx;\n  this.key = opts.key;\n  this.passphrase = opts.passphrase;\n  this.cert = opts.cert;\n  this.ca = opts.ca;\n  this.ciphers = opts.ciphers;\n  this.rejectUnauthorized = opts.rejectUnauthorized;\n\n  // other options for Node.js client\n  this.extraHeaders = opts.extraHeaders;\n\n  this.create();\n}\n\n/**\n * Mix in `Emitter`.\n */\n\nEmitter(Request.prototype);\n\n/**\n * Creates the XHR object and sends the request.\n *\n * @api private\n */\n\nRequest.prototype.create = function () {\n  var opts = { agent: this.agent, xdomain: this.xd, xscheme: this.xs, enablesXDR: this.enablesXDR };\n\n  // SSL options for Node.js client\n  opts.pfx = this.pfx;\n  opts.key = this.key;\n  opts.passphrase = this.passphrase;\n  opts.cert = this.cert;\n  opts.ca = this.ca;\n  opts.ciphers = this.ciphers;\n  opts.rejectUnauthorized = this.rejectUnauthorized;\n\n  var xhr = this.xhr = new XMLHttpRequest(opts);\n  var self = this;\n\n  try {\n    debug('xhr open %s: %s', this.method, this.uri);\n    xhr.open(this.method, this.uri, this.async);\n    try {\n      if (this.extraHeaders) {\n        xhr.setDisableHeaderCheck && xhr.setDisableHeaderCheck(true);\n        for (var i in this.extraHeaders) {\n          if (this.extraHeaders.hasOwnProperty(i)) {\n            xhr.setRequestHeader(i, this.extraHeaders[i]);\n          }\n        }\n      }\n    } catch (e) {}\n\n    if ('POST' === this.method) {\n      try {\n        if (this.isBinary) {\n          xhr.setRequestHeader('Content-type', 'application/octet-stream');\n        } else {\n          xhr.setRequestHeader('Content-type', 'text/plain;charset=UTF-8');\n        }\n      } catch (e) {}\n    }\n\n    try {\n      xhr.setRequestHeader('Accept', '*/*');\n    } catch (e) {}\n\n    // ie6 check\n    if ('withCredentials' in xhr) {\n      xhr.withCredentials = this.withCredentials;\n    }\n\n    if (this.requestTimeout) {\n      xhr.timeout = this.requestTimeout;\n    }\n\n    if (this.hasXDR()) {\n      xhr.onload = function () {\n        self.onLoad();\n      };\n      xhr.onerror = function () {\n        self.onError(xhr.responseText);\n      };\n    } else {\n      xhr.onreadystatechange = function () {\n        if (xhr.readyState === 2) {\n          try {\n            var contentType = xhr.getResponseHeader('Content-Type');\n            if (self.supportsBinary && contentType === 'application/octet-stream' || contentType === 'application/octet-stream; charset=UTF-8') {\n              xhr.responseType = 'arraybuffer';\n            }\n          } catch (e) {}\n        }\n        if (4 !== xhr.readyState) return;\n        if (200 === xhr.status || 1223 === xhr.status) {\n          self.onLoad();\n        } else {\n          // make sure the `error` event handler that's user-set\n          // does not throw in the same tick and gets caught here\n          setTimeout(function () {\n            self.onError(typeof xhr.status === 'number' ? xhr.status : 0);\n          }, 0);\n        }\n      };\n    }\n\n    debug('xhr data %s', this.data);\n    xhr.send(this.data);\n  } catch (e) {\n    // Need to defer since .create() is called directly fhrom the constructor\n    // and thus the 'error' event can only be only bound *after* this exception\n    // occurs.  Therefore, also, we cannot throw here at all.\n    setTimeout(function () {\n      self.onError(e);\n    }, 0);\n    return;\n  }\n\n  if (typeof document !== 'undefined') {\n    this.index = Request.requestsCount++;\n    Request.requests[this.index] = this;\n  }\n};\n\n/**\n * Called upon successful response.\n *\n * @api private\n */\n\nRequest.prototype.onSuccess = function () {\n  this.emit('success');\n  this.cleanup();\n};\n\n/**\n * Called if we have data.\n *\n * @api private\n */\n\nRequest.prototype.onData = function (data) {\n  this.emit('data', data);\n  this.onSuccess();\n};\n\n/**\n * Called upon error.\n *\n * @api private\n */\n\nRequest.prototype.onError = function (err) {\n  this.emit('error', err);\n  this.cleanup(true);\n};\n\n/**\n * Cleans up house.\n *\n * @api private\n */\n\nRequest.prototype.cleanup = function (fromError) {\n  if ('undefined' === typeof this.xhr || null === this.xhr) {\n    return;\n  }\n  // xmlhttprequest\n  if (this.hasXDR()) {\n    this.xhr.onload = this.xhr.onerror = empty;\n  } else {\n    this.xhr.onreadystatechange = empty;\n  }\n\n  if (fromError) {\n    try {\n      this.xhr.abort();\n    } catch (e) {}\n  }\n\n  if (typeof document !== 'undefined') {\n    delete Request.requests[this.index];\n  }\n\n  this.xhr = null;\n};\n\n/**\n * Called upon load.\n *\n * @api private\n */\n\nRequest.prototype.onLoad = function () {\n  var data;\n  try {\n    var contentType;\n    try {\n      contentType = this.xhr.getResponseHeader('Content-Type');\n    } catch (e) {}\n    if (contentType === 'application/octet-stream' || contentType === 'application/octet-stream; charset=UTF-8') {\n      data = this.xhr.response || this.xhr.responseText;\n    } else {\n      data = this.xhr.responseText;\n    }\n  } catch (e) {\n    this.onError(e);\n  }\n  if (null != data) {\n    this.onData(data);\n  }\n};\n\n/**\n * Check if it has XDomainRequest.\n *\n * @api private\n */\n\nRequest.prototype.hasXDR = function () {\n  return typeof XDomainRequest !== 'undefined' && !this.xs && this.enablesXDR;\n};\n\n/**\n * Aborts the request.\n *\n * @api public\n */\n\nRequest.prototype.abort = function () {\n  this.cleanup();\n};\n\n/**\n * Aborts pending requests when unloading the window. This is needed to prevent\n * memory leaks (e.g. when using IE) and to ensure that no spurious error is\n * emitted.\n */\n\nRequest.requestsCount = 0;\nRequest.requests = {};\n\nif (typeof document !== 'undefined') {\n  if (typeof attachEvent === 'function') {\n    attachEvent('onunload', unloadHandler);\n  } else if (typeof addEventListener === 'function') {\n    var terminationEvent = 'onpagehide' in globalThis ? 'pagehide' : 'unload';\n    addEventListener(terminationEvent, unloadHandler, false);\n  }\n}\n\nfunction unloadHandler () {\n  for (var i in Request.requests) {\n    if (Request.requests.hasOwnProperty(i)) {\n      Request.requests[i].abort();\n    }\n  }\n}\n","/**\r\n * Create a blob builder even when vendor prefixes exist\r\n */\r\n\r\nvar BlobBuilder = typeof BlobBuilder !== 'undefined' ? BlobBuilder :\r\n  typeof WebKitBlobBuilder !== 'undefined' ? WebKitBlobBuilder :\r\n  typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder :\r\n  typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder : \r\n  false;\r\n\r\n/**\r\n * Check if Blob constructor is supported\r\n */\r\n\r\nvar blobSupported = (function() {\r\n  try {\r\n    var a = new Blob(['hi']);\r\n    return a.size === 2;\r\n  } catch(e) {\r\n    return false;\r\n  }\r\n})();\r\n\r\n/**\r\n * Check if Blob constructor supports ArrayBufferViews\r\n * Fails in Safari 6, so we need to map to ArrayBuffers there.\r\n */\r\n\r\nvar blobSupportsArrayBufferView = blobSupported && (function() {\r\n  try {\r\n    var b = new Blob([new Uint8Array([1,2])]);\r\n    return b.size === 2;\r\n  } catch(e) {\r\n    return false;\r\n  }\r\n})();\r\n\r\n/**\r\n * Check if BlobBuilder is supported\r\n */\r\n\r\nvar blobBuilderSupported = BlobBuilder\r\n  && BlobBuilder.prototype.append\r\n  && BlobBuilder.prototype.getBlob;\r\n\r\n/**\r\n * Helper function that maps ArrayBufferViews to ArrayBuffers\r\n * Used by BlobBuilder constructor and old browsers that didn't\r\n * support it in the Blob constructor.\r\n */\r\n\r\nfunction mapArrayBufferViews(ary) {\r\n  return ary.map(function(chunk) {\r\n    if (chunk.buffer instanceof ArrayBuffer) {\r\n      var buf = chunk.buffer;\r\n\r\n      // if this is a subarray, make a copy so we only\r\n      // include the subarray region from the underlying buffer\r\n      if (chunk.byteLength !== buf.byteLength) {\r\n        var copy = new Uint8Array(chunk.byteLength);\r\n        copy.set(new Uint8Array(buf, chunk.byteOffset, chunk.byteLength));\r\n        buf = copy.buffer;\r\n      }\r\n\r\n      return buf;\r\n    }\r\n\r\n    return chunk;\r\n  });\r\n}\r\n\r\nfunction BlobBuilderConstructor(ary, options) {\r\n  options = options || {};\r\n\r\n  var bb = new BlobBuilder();\r\n  mapArrayBufferViews(ary).forEach(function(part) {\r\n    bb.append(part);\r\n  });\r\n\r\n  return (options.type) ? bb.getBlob(options.type) : bb.getBlob();\r\n};\r\n\r\nfunction BlobConstructor(ary, options) {\r\n  return new Blob(mapArrayBufferViews(ary), options || {});\r\n};\r\n\r\nif (typeof Blob !== 'undefined') {\r\n  BlobBuilderConstructor.prototype = Blob.prototype;\r\n  BlobConstructor.prototype = Blob.prototype;\r\n}\r\n\r\nmodule.exports = (function() {\r\n  if (blobSupported) {\r\n    return blobSupportsArrayBufferView ? Blob : BlobConstructor;\r\n  } else if (blobBuilderSupported) {\r\n    return BlobBuilderConstructor;\r\n  } else {\r\n    return undefined;\r\n  }\r\n})();\r\n","\n/**\n * Module exports.\n */\n\nmodule.exports = on;\n\n/**\n * Helper for subscriptions.\n *\n * @param {Object|EventEmitter} obj with `Emitter` mixin or `EventEmitter`\n * @param {String} event name\n * @param {Function} callback\n * @api public\n */\n\nfunction on (obj, ev, fn) {\n  obj.on(ev, fn);\n  return {\n    destroy: function () {\n      obj.removeListener(ev, fn);\n    }\n  };\n}\n","module.exports = (function () {\n  if (typeof self !== 'undefined') {\n    return self;\n  } else if (typeof window !== 'undefined') {\n    return window;\n  } else {\n    return Function('return this')(); // eslint-disable-line no-new-func\n  }\n})();\n","/**\n * Module dependencies.\n */\n\nvar transports = require('./transports/index');\nvar Emitter = require('component-emitter');\nvar debug = require('debug')('engine.io-client:socket');\nvar index = require('indexof');\nvar parser = require('engine.io-parser');\nvar parseuri = require('parseuri');\nvar parseqs = require('parseqs');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Socket;\n\n/**\n * Socket constructor.\n *\n * @param {String|Object} uri or options\n * @param {Object} options\n * @api public\n */\n\nfunction Socket (uri, opts) {\n  if (!(this instanceof Socket)) return new Socket(uri, opts);\n\n  opts = opts || {};\n\n  if (uri && 'object' === typeof uri) {\n    opts = uri;\n    uri = null;\n  }\n\n  if (uri) {\n    uri = parseuri(uri);\n    opts.hostname = uri.host;\n    opts.secure = uri.protocol === 'https' || uri.protocol === 'wss';\n    opts.port = uri.port;\n    if (uri.query) opts.query = uri.query;\n  } else if (opts.host) {\n    opts.hostname = parseuri(opts.host).host;\n  }\n\n  this.secure = null != opts.secure ? opts.secure\n    : (typeof location !== 'undefined' && 'https:' === location.protocol);\n\n  if (opts.hostname && !opts.port) {\n    // if no port is specified manually, use the protocol default\n    opts.port = this.secure ? '443' : '80';\n  }\n\n  this.agent = opts.agent || false;\n  this.hostname = opts.hostname ||\n    (typeof location !== 'undefined' ? location.hostname : 'localhost');\n  this.port = opts.port || (typeof location !== 'undefined' && location.port\n      ? location.port\n      : (this.secure ? 443 : 80));\n  this.query = opts.query || {};\n  if ('string' === typeof this.query) this.query = parseqs.decode(this.query);\n  this.upgrade = false !== opts.upgrade;\n  this.path = (opts.path || '/engine.io').replace(/\\/$/, '') + '/';\n  this.forceJSONP = !!opts.forceJSONP;\n  this.jsonp = false !== opts.jsonp;\n  this.forceBase64 = !!opts.forceBase64;\n  this.enablesXDR = !!opts.enablesXDR;\n  this.withCredentials = false !== opts.withCredentials;\n  this.timestampParam = opts.timestampParam || 't';\n  this.timestampRequests = opts.timestampRequests;\n  this.transports = opts.transports || ['polling', 'websocket'];\n  this.transportOptions = opts.transportOptions || {};\n  this.readyState = '';\n  this.writeBuffer = [];\n  this.prevBufferLen = 0;\n  this.policyPort = opts.policyPort || 843;\n  this.rememberUpgrade = opts.rememberUpgrade || false;\n  this.binaryType = null;\n  this.onlyBinaryUpgrades = opts.onlyBinaryUpgrades;\n  this.perMessageDeflate = false !== opts.perMessageDeflate ? (opts.perMessageDeflate || {}) : false;\n\n  if (true === this.perMessageDeflate) this.perMessageDeflate = {};\n  if (this.perMessageDeflate && null == this.perMessageDeflate.threshold) {\n    this.perMessageDeflate.threshold = 1024;\n  }\n\n  // SSL options for Node.js client\n  this.pfx = opts.pfx || undefined;\n  this.key = opts.key || undefined;\n  this.passphrase = opts.passphrase || undefined;\n  this.cert = opts.cert || undefined;\n  this.ca = opts.ca || undefined;\n  this.ciphers = opts.ciphers || undefined;\n  this.rejectUnauthorized = opts.rejectUnauthorized === undefined ? true : opts.rejectUnauthorized;\n  this.forceNode = !!opts.forceNode;\n\n  // detect ReactNative environment\n  this.isReactNative = (typeof navigator !== 'undefined' && typeof navigator.product === 'string' && navigator.product.toLowerCase() === 'reactnative');\n\n  // other options for Node.js or ReactNative client\n  if (typeof self === 'undefined' || this.isReactNative) {\n    if (opts.extraHeaders && Object.keys(opts.extraHeaders).length > 0) {\n      this.extraHeaders = opts.extraHeaders;\n    }\n\n    if (opts.localAddress) {\n      this.localAddress = opts.localAddress;\n    }\n  }\n\n  // set on handshake\n  this.id = null;\n  this.upgrades = null;\n  this.pingInterval = null;\n  this.pingTimeout = null;\n\n  // set on heartbeat\n  this.pingIntervalTimer = null;\n  this.pingTimeoutTimer = null;\n\n  this.open();\n}\n\nSocket.priorWebsocketSuccess = false;\n\n/**\n * Mix in `Emitter`.\n */\n\nEmitter(Socket.prototype);\n\n/**\n * Protocol version.\n *\n * @api public\n */\n\nSocket.protocol = parser.protocol; // this is an int\n\n/**\n * Expose deps for legacy compatibility\n * and standalone browser access.\n */\n\nSocket.Socket = Socket;\nSocket.Transport = require('./transport');\nSocket.transports = require('./transports/index');\nSocket.parser = require('engine.io-parser');\n\n/**\n * Creates transport of the given type.\n *\n * @param {String} transport name\n * @return {Transport}\n * @api private\n */\n\nSocket.prototype.createTransport = function (name) {\n  debug('creating transport \"%s\"', name);\n  var query = clone(this.query);\n\n  // append engine.io protocol identifier\n  query.EIO = parser.protocol;\n\n  // transport name\n  query.transport = name;\n\n  // per-transport options\n  var options = this.transportOptions[name] || {};\n\n  // session id if we already have one\n  if (this.id) query.sid = this.id;\n\n  var transport = new transports[name]({\n    query: query,\n    socket: this,\n    agent: options.agent || this.agent,\n    hostname: options.hostname || this.hostname,\n    port: options.port || this.port,\n    secure: options.secure || this.secure,\n    path: options.path || this.path,\n    forceJSONP: options.forceJSONP || this.forceJSONP,\n    jsonp: options.jsonp || this.jsonp,\n    forceBase64: options.forceBase64 || this.forceBase64,\n    enablesXDR: options.enablesXDR || this.enablesXDR,\n    withCredentials: options.withCredentials || this.withCredentials,\n    timestampRequests: options.timestampRequests || this.timestampRequests,\n    timestampParam: options.timestampParam || this.timestampParam,\n    policyPort: options.policyPort || this.policyPort,\n    pfx: options.pfx || this.pfx,\n    key: options.key || this.key,\n    passphrase: options.passphrase || this.passphrase,\n    cert: options.cert || this.cert,\n    ca: options.ca || this.ca,\n    ciphers: options.ciphers || this.ciphers,\n    rejectUnauthorized: options.rejectUnauthorized || this.rejectUnauthorized,\n    perMessageDeflate: options.perMessageDeflate || this.perMessageDeflate,\n    extraHeaders: options.extraHeaders || this.extraHeaders,\n    forceNode: options.forceNode || this.forceNode,\n    localAddress: options.localAddress || this.localAddress,\n    requestTimeout: options.requestTimeout || this.requestTimeout,\n    protocols: options.protocols || void (0),\n    isReactNative: this.isReactNative\n  });\n\n  return transport;\n};\n\nfunction clone (obj) {\n  var o = {};\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      o[i] = obj[i];\n    }\n  }\n  return o;\n}\n\n/**\n * Initializes transport to use and starts probe.\n *\n * @api private\n */\nSocket.prototype.open = function () {\n  var transport;\n  if (this.rememberUpgrade && Socket.priorWebsocketSuccess && this.transports.indexOf('websocket') !== -1) {\n    transport = 'websocket';\n  } else if (0 === this.transports.length) {\n    // Emit error on next tick so it can be listened to\n    var self = this;\n    setTimeout(function () {\n      self.emit('error', 'No transports available');\n    }, 0);\n    return;\n  } else {\n    transport = this.transports[0];\n  }\n  this.readyState = 'opening';\n\n  // Retry with the next transport if the transport is disabled (jsonp: false)\n  try {\n    transport = this.createTransport(transport);\n  } catch (e) {\n    this.transports.shift();\n    this.open();\n    return;\n  }\n\n  transport.open();\n  this.setTransport(transport);\n};\n\n/**\n * Sets the current transport. Disables the existing one (if any).\n *\n * @api private\n */\n\nSocket.prototype.setTransport = function (transport) {\n  debug('setting transport %s', transport.name);\n  var self = this;\n\n  if (this.transport) {\n    debug('clearing existing transport %s', this.transport.name);\n    this.transport.removeAllListeners();\n  }\n\n  // set up transport\n  this.transport = transport;\n\n  // set up transport listeners\n  transport\n  .on('drain', function () {\n    self.onDrain();\n  })\n  .on('packet', function (packet) {\n    self.onPacket(packet);\n  })\n  .on('error', function (e) {\n    self.onError(e);\n  })\n  .on('close', function () {\n    self.onClose('transport close');\n  });\n};\n\n/**\n * Probes a transport.\n *\n * @param {String} transport name\n * @api private\n */\n\nSocket.prototype.probe = function (name) {\n  debug('probing transport \"%s\"', name);\n  var transport = this.createTransport(name, { probe: 1 });\n  var failed = false;\n  var self = this;\n\n  Socket.priorWebsocketSuccess = false;\n\n  function onTransportOpen () {\n    if (self.onlyBinaryUpgrades) {\n      var upgradeLosesBinary = !this.supportsBinary && self.transport.supportsBinary;\n      failed = failed || upgradeLosesBinary;\n    }\n    if (failed) return;\n\n    debug('probe transport \"%s\" opened', name);\n    transport.send([{ type: 'ping', data: 'probe' }]);\n    transport.once('packet', function (msg) {\n      if (failed) return;\n      if ('pong' === msg.type && 'probe' === msg.data) {\n        debug('probe transport \"%s\" pong', name);\n        self.upgrading = true;\n        self.emit('upgrading', transport);\n        if (!transport) return;\n        Socket.priorWebsocketSuccess = 'websocket' === transport.name;\n\n        debug('pausing current transport \"%s\"', self.transport.name);\n        self.transport.pause(function () {\n          if (failed) return;\n          if ('closed' === self.readyState) return;\n          debug('changing transport and sending upgrade packet');\n\n          cleanup();\n\n          self.setTransport(transport);\n          transport.send([{ type: 'upgrade' }]);\n          self.emit('upgrade', transport);\n          transport = null;\n          self.upgrading = false;\n          self.flush();\n        });\n      } else {\n        debug('probe transport \"%s\" failed', name);\n        var err = new Error('probe error');\n        err.transport = transport.name;\n        self.emit('upgradeError', err);\n      }\n    });\n  }\n\n  function freezeTransport () {\n    if (failed) return;\n\n    // Any callback called by transport should be ignored since now\n    failed = true;\n\n    cleanup();\n\n    transport.close();\n    transport = null;\n  }\n\n  // Handle any error that happens while probing\n  function onerror (err) {\n    var error = new Error('probe error: ' + err);\n    error.transport = transport.name;\n\n    freezeTransport();\n\n    debug('probe transport \"%s\" failed because of error: %s', name, err);\n\n    self.emit('upgradeError', error);\n  }\n\n  function onTransportClose () {\n    onerror('transport closed');\n  }\n\n  // When the socket is closed while we're probing\n  function onclose () {\n    onerror('socket closed');\n  }\n\n  // When the socket is upgraded while we're probing\n  function onupgrade (to) {\n    if (transport && to.name !== transport.name) {\n      debug('\"%s\" works - aborting \"%s\"', to.name, transport.name);\n      freezeTransport();\n    }\n  }\n\n  // Remove all listeners on the transport and on self\n  function cleanup () {\n    transport.removeListener('open', onTransportOpen);\n    transport.removeListener('error', onerror);\n    transport.removeListener('close', onTransportClose);\n    self.removeListener('close', onclose);\n    self.removeListener('upgrading', onupgrade);\n  }\n\n  transport.once('open', onTransportOpen);\n  transport.once('error', onerror);\n  transport.once('close', onTransportClose);\n\n  this.once('close', onclose);\n  this.once('upgrading', onupgrade);\n\n  transport.open();\n};\n\n/**\n * Called when connection is deemed open.\n *\n * @api public\n */\n\nSocket.prototype.onOpen = function () {\n  debug('socket open');\n  this.readyState = 'open';\n  Socket.priorWebsocketSuccess = 'websocket' === this.transport.name;\n  this.emit('open');\n  this.flush();\n\n  // we check for `readyState` in case an `open`\n  // listener already closed the socket\n  if ('open' === this.readyState && this.upgrade && this.transport.pause) {\n    debug('starting upgrade probes');\n    for (var i = 0, l = this.upgrades.length; i < l; i++) {\n      this.probe(this.upgrades[i]);\n    }\n  }\n};\n\n/**\n * Handles a packet.\n *\n * @api private\n */\n\nSocket.prototype.onPacket = function (packet) {\n  if ('opening' === this.readyState || 'open' === this.readyState ||\n      'closing' === this.readyState) {\n    debug('socket receive: type \"%s\", data \"%s\"', packet.type, packet.data);\n\n    this.emit('packet', packet);\n\n    // Socket is live - any packet counts\n    this.emit('heartbeat');\n\n    switch (packet.type) {\n      case 'open':\n        this.onHandshake(JSON.parse(packet.data));\n        break;\n\n      case 'pong':\n        this.setPing();\n        this.emit('pong');\n        break;\n\n      case 'error':\n        var err = new Error('server error');\n        err.code = packet.data;\n        this.onError(err);\n        break;\n\n      case 'message':\n        this.emit('data', packet.data);\n        this.emit('message', packet.data);\n        break;\n    }\n  } else {\n    debug('packet received with socket readyState \"%s\"', this.readyState);\n  }\n};\n\n/**\n * Called upon handshake completion.\n *\n * @param {Object} handshake obj\n * @api private\n */\n\nSocket.prototype.onHandshake = function (data) {\n  this.emit('handshake', data);\n  this.id = data.sid;\n  this.transport.query.sid = data.sid;\n  this.upgrades = this.filterUpgrades(data.upgrades);\n  this.pingInterval = data.pingInterval;\n  this.pingTimeout = data.pingTimeout;\n  this.onOpen();\n  // In case open handler closes socket\n  if ('closed' === this.readyState) return;\n  this.setPing();\n\n  // Prolong liveness of socket on heartbeat\n  this.removeListener('heartbeat', this.onHeartbeat);\n  this.on('heartbeat', this.onHeartbeat);\n};\n\n/**\n * Resets ping timeout.\n *\n * @api private\n */\n\nSocket.prototype.onHeartbeat = function (timeout) {\n  clearTimeout(this.pingTimeoutTimer);\n  var self = this;\n  self.pingTimeoutTimer = setTimeout(function () {\n    if ('closed' === self.readyState) return;\n    self.onClose('ping timeout');\n  }, timeout || (self.pingInterval + self.pingTimeout));\n};\n\n/**\n * Pings server every `this.pingInterval` and expects response\n * within `this.pingTimeout` or closes connection.\n *\n * @api private\n */\n\nSocket.prototype.setPing = function () {\n  var self = this;\n  clearTimeout(self.pingIntervalTimer);\n  self.pingIntervalTimer = setTimeout(function () {\n    debug('writing ping packet - expecting pong within %sms', self.pingTimeout);\n    self.ping();\n    self.onHeartbeat(self.pingTimeout);\n  }, self.pingInterval);\n};\n\n/**\n* Sends a ping packet.\n*\n* @api private\n*/\n\nSocket.prototype.ping = function () {\n  var self = this;\n  this.sendPacket('ping', function () {\n    self.emit('ping');\n  });\n};\n\n/**\n * Called on `drain` event\n *\n * @api private\n */\n\nSocket.prototype.onDrain = function () {\n  this.writeBuffer.splice(0, this.prevBufferLen);\n\n  // setting prevBufferLen = 0 is very important\n  // for example, when upgrading, upgrade packet is sent over,\n  // and a nonzero prevBufferLen could cause problems on `drain`\n  this.prevBufferLen = 0;\n\n  if (0 === this.writeBuffer.length) {\n    this.emit('drain');\n  } else {\n    this.flush();\n  }\n};\n\n/**\n * Flush write buffers.\n *\n * @api private\n */\n\nSocket.prototype.flush = function () {\n  if ('closed' !== this.readyState && this.transport.writable &&\n    !this.upgrading && this.writeBuffer.length) {\n    debug('flushing %d packets in socket', this.writeBuffer.length);\n    this.transport.send(this.writeBuffer);\n    // keep track of current length of writeBuffer\n    // splice writeBuffer and callbackBuffer on `drain`\n    this.prevBufferLen = this.writeBuffer.length;\n    this.emit('flush');\n  }\n};\n\n/**\n * Sends a message.\n *\n * @param {String} message.\n * @param {Function} callback function.\n * @param {Object} options.\n * @return {Socket} for chaining.\n * @api public\n */\n\nSocket.prototype.write =\nSocket.prototype.send = function (msg, options, fn) {\n  this.sendPacket('message', msg, options, fn);\n  return this;\n};\n\n/**\n * Sends a packet.\n *\n * @param {String} packet type.\n * @param {String} data.\n * @param {Object} options.\n * @param {Function} callback function.\n * @api private\n */\n\nSocket.prototype.sendPacket = function (type, data, options, fn) {\n  if ('function' === typeof data) {\n    fn = data;\n    data = undefined;\n  }\n\n  if ('function' === typeof options) {\n    fn = options;\n    options = null;\n  }\n\n  if ('closing' === this.readyState || 'closed' === this.readyState) {\n    return;\n  }\n\n  options = options || {};\n  options.compress = false !== options.compress;\n\n  var packet = {\n    type: type,\n    data: data,\n    options: options\n  };\n  this.emit('packetCreate', packet);\n  this.writeBuffer.push(packet);\n  if (fn) this.once('flush', fn);\n  this.flush();\n};\n\n/**\n * Closes the connection.\n *\n * @api private\n */\n\nSocket.prototype.close = function () {\n  if ('opening' === this.readyState || 'open' === this.readyState) {\n    this.readyState = 'closing';\n\n    var self = this;\n\n    if (this.writeBuffer.length) {\n      this.once('drain', function () {\n        if (this.upgrading) {\n          waitForUpgrade();\n        } else {\n          close();\n        }\n      });\n    } else if (this.upgrading) {\n      waitForUpgrade();\n    } else {\n      close();\n    }\n  }\n\n  function close () {\n    self.onClose('forced close');\n    debug('socket closing - telling transport to close');\n    self.transport.close();\n  }\n\n  function cleanupAndClose () {\n    self.removeListener('upgrade', cleanupAndClose);\n    self.removeListener('upgradeError', cleanupAndClose);\n    close();\n  }\n\n  function waitForUpgrade () {\n    // wait for upgrade to finish since we can't send packets while pausing a transport\n    self.once('upgrade', cleanupAndClose);\n    self.once('upgradeError', cleanupAndClose);\n  }\n\n  return this;\n};\n\n/**\n * Called upon transport error\n *\n * @api private\n */\n\nSocket.prototype.onError = function (err) {\n  debug('socket error %j', err);\n  Socket.priorWebsocketSuccess = false;\n  this.emit('error', err);\n  this.onClose('transport error', err);\n};\n\n/**\n * Called upon transport close.\n *\n * @api private\n */\n\nSocket.prototype.onClose = function (reason, desc) {\n  if ('opening' === this.readyState || 'open' === this.readyState || 'closing' === this.readyState) {\n    debug('socket close with reason: \"%s\"', reason);\n    var self = this;\n\n    // clear timers\n    clearTimeout(this.pingIntervalTimer);\n    clearTimeout(this.pingTimeoutTimer);\n\n    // stop event from firing again for transport\n    this.transport.removeAllListeners('close');\n\n    // ensure transport won't stay open\n    this.transport.close();\n\n    // ignore further transport communication\n    this.transport.removeAllListeners();\n\n    // set ready state\n    this.readyState = 'closed';\n\n    // clear session id\n    this.id = null;\n\n    // emit close event\n    this.emit('close', reason, desc);\n\n    // clean buffers after, so users can still\n    // grab the buffers on `close` event\n    self.writeBuffer = [];\n    self.prevBufferLen = 0;\n  }\n};\n\n/**\n * Filters upgrades, returning only those matching client transports.\n *\n * @param {Array} server upgrades\n * @api private\n *\n */\n\nSocket.prototype.filterUpgrades = function (upgrades) {\n  var filteredUpgrades = [];\n  for (var i = 0, j = upgrades.length; i < j; i++) {\n    if (~index(this.transports, upgrades[i])) filteredUpgrades.push(upgrades[i]);\n  }\n  return filteredUpgrades;\n};\n","// .dirname, .basename, and .extname methods are extracted from Node.js v8.11.1,\n// backported and transplited with Babel, with backwards-compat fixes\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// resolves . and .. elements in a path array with directory names there\n// must be no slashes, empty elements, or device names (c:\\) in the array\n// (so also no leading and trailing slashes - it does not distinguish\n// relative and absolute paths)\nfunction normalizeArray(parts, allowAboveRoot) {\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = parts.length - 1; i >= 0; i--) {\n    var last = parts[i];\n    if (last === '.') {\n      parts.splice(i, 1);\n    } else if (last === '..') {\n      parts.splice(i, 1);\n      up++;\n    } else if (up) {\n      parts.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (allowAboveRoot) {\n    for (; up--; up) {\n      parts.unshift('..');\n    }\n  }\n\n  return parts;\n}\n\n// path.resolve([from ...], to)\n// posix version\nexports.resolve = function() {\n  var resolvedPath = '',\n      resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = (i >= 0) ? arguments[i] : process.cwd();\n\n    // Skip empty and invalid entries\n    if (typeof path !== 'string') {\n      throw new TypeError('Arguments to path.resolve must be strings');\n    } else if (!path) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charAt(0) === '/';\n  }\n\n  // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n\n  // Normalize the path\n  resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function(p) {\n    return !!p;\n  }), !resolvedAbsolute).join('/');\n\n  return ((resolvedAbsolute ? '/' : '') + resolvedPath) || '.';\n};\n\n// path.normalize(path)\n// posix version\nexports.normalize = function(path) {\n  var isAbsolute = exports.isAbsolute(path),\n      trailingSlash = substr(path, -1) === '/';\n\n  // Normalize the path\n  path = normalizeArray(filter(path.split('/'), function(p) {\n    return !!p;\n  }), !isAbsolute).join('/');\n\n  if (!path && !isAbsolute) {\n    path = '.';\n  }\n  if (path && trailingSlash) {\n    path += '/';\n  }\n\n  return (isAbsolute ? '/' : '') + path;\n};\n\n// posix version\nexports.isAbsolute = function(path) {\n  return path.charAt(0) === '/';\n};\n\n// posix version\nexports.join = function() {\n  var paths = Array.prototype.slice.call(arguments, 0);\n  return exports.normalize(filter(paths, function(p, index) {\n    if (typeof p !== 'string') {\n      throw new TypeError('Arguments to path.join must be strings');\n    }\n    return p;\n  }).join('/'));\n};\n\n\n// path.relative(from, to)\n// posix version\nexports.relative = function(from, to) {\n  from = exports.resolve(from).substr(1);\n  to = exports.resolve(to).substr(1);\n\n  function trim(arr) {\n    var start = 0;\n    for (; start < arr.length; start++) {\n      if (arr[start] !== '') break;\n    }\n\n    var end = arr.length - 1;\n    for (; end >= 0; end--) {\n      if (arr[end] !== '') break;\n    }\n\n    if (start > end) return [];\n    return arr.slice(start, end - start + 1);\n  }\n\n  var fromParts = trim(from.split('/'));\n  var toParts = trim(to.split('/'));\n\n  var length = Math.min(fromParts.length, toParts.length);\n  var samePartsLength = length;\n  for (var i = 0; i < length; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      samePartsLength = i;\n      break;\n    }\n  }\n\n  var outputParts = [];\n  for (var i = samePartsLength; i < fromParts.length; i++) {\n    outputParts.push('..');\n  }\n\n  outputParts = outputParts.concat(toParts.slice(samePartsLength));\n\n  return outputParts.join('/');\n};\n\nexports.sep = '/';\nexports.delimiter = ':';\n\nexports.dirname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  if (path.length === 0) return '.';\n  var code = path.charCodeAt(0);\n  var hasRoot = code === 47 /*/*/;\n  var end = -1;\n  var matchedSlash = true;\n  for (var i = path.length - 1; i >= 1; --i) {\n    code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n      // We saw the first non-path separator\n      matchedSlash = false;\n    }\n  }\n\n  if (end === -1) return hasRoot ? '/' : '.';\n  if (hasRoot && end === 1) {\n    // return '//';\n    // Backwards-compat fix:\n    return '/';\n  }\n  return path.slice(0, end);\n};\n\nfunction basename(path) {\n  if (typeof path !== 'string') path = path + '';\n\n  var start = 0;\n  var end = -1;\n  var matchedSlash = true;\n  var i;\n\n  for (i = path.length - 1; i >= 0; --i) {\n    if (path.charCodeAt(i) === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // path component\n      matchedSlash = false;\n      end = i + 1;\n    }\n  }\n\n  if (end === -1) return '';\n  return path.slice(start, end);\n}\n\n// Uses a mixed approach for backwards-compatibility, as ext behavior changed\n// in new Node.js versions, so only basename() above is backported here\nexports.basename = function (path, ext) {\n  var f = basename(path);\n  if (ext && f.substr(-1 * ext.length) === ext) {\n    f = f.substr(0, f.length - ext.length);\n  }\n  return f;\n};\n\nexports.extname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  var startDot = -1;\n  var startPart = 0;\n  var end = -1;\n  var matchedSlash = true;\n  // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find\n  var preDotState = 0;\n  for (var i = path.length - 1; i >= 0; --i) {\n    var code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n    if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension\n      matchedSlash = false;\n      end = i + 1;\n    }\n    if (code === 46 /*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n    } else if (startDot !== -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension\n      preDotState = -1;\n    }\n  }\n\n  if (startDot === -1 || end === -1 ||\n      // We saw a non-dot character immediately before the dot\n      preDotState === 0 ||\n      // The (right-most) trimmed path component is exactly '..'\n      preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n    return '';\n  }\n  return path.slice(startDot, end);\n};\n\nfunction filter (xs, f) {\n    if (xs.filter) return xs.filter(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        if (f(xs[i], i, xs)) res.push(xs[i]);\n    }\n    return res;\n}\n\n// String.prototype.substr - negative index don't work in IE8\nvar substr = 'ab'.substr(-1) === 'b'\n    ? function (str, start, len) { return str.substr(start, len) }\n    : function (str, start, len) {\n        if (start < 0) start = str.length + start;\n        return str.substr(start, len);\n    }\n;\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isNaN(val) === false) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^((?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  if (ms >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (ms >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (ms >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (ms >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  return plural(ms, d, 'day') ||\n    plural(ms, h, 'hour') ||\n    plural(ms, m, 'minute') ||\n    plural(ms, s, 'second') ||\n    ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, n, name) {\n  if (ms < n) {\n    return;\n  }\n  if (ms < n * 1.5) {\n    return Math.floor(ms / n) + ' ' + name;\n  }\n  return Math.ceil(ms / n) + ' ' + name + 's';\n}\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","\nvar indexOf = [].indexOf;\n\nmodule.exports = function(arr, obj){\n  if (indexOf) return arr.indexOf(obj);\n  for (var i = 0; i < arr.length; ++i) {\n    if (arr[i] === obj) return i;\n  }\n  return -1;\n};"],"sourceRoot":""}